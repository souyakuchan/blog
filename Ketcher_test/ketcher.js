!function(t,e){"use strict";"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.returnExports=e()}(this,function(){var t,e,n=Array,r=n.prototype,o=Object,i=o.prototype,a=Function,s=a.prototype,l=String,u=l.prototype,c=Number,p=c.prototype,h=r.slice,f=r.splice,d=r.push,g=r.unshift,m=r.concat,b=r.join,v=s.call,y=s.apply,w=Math.max,x=Math.min,S=i.toString,O="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,T=Function.prototype.toString,E=/^\s*class /,A=function(t){try{var e=T.call(t),n=e.replace(/\/\/.*\n/g,""),r=n.replace(/\/\*[.\s\S]*\*\//g,""),o=r.replace(/\n/gm," ").replace(/ {2}/g," ");return E.test(o)}catch(t){return!1}},C=function(t){try{return!A(t)&&(T.call(t),!0)}catch(t){return!1}},P="[object Function]",N="[object GeneratorFunction]",t=function(t){if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(O)return C(t);if(A(t))return!1;var e=S.call(t);return e===P||e===N},j=RegExp.prototype.exec,R=function(t){try{return j.call(t),!0}catch(t){return!1}},B="[object RegExp]";e=function(t){return"object"==typeof t&&(O?R(t):S.call(t)===B)};var M,_=String.prototype.valueOf,I=function(t){try{return _.call(t),!0}catch(t){return!1}},k="[object String]";M=function(t){return"string"==typeof t||"object"==typeof t&&(O?I(t):S.call(t)===k)};var D=o.defineProperty&&function(){try{var t={};o.defineProperty(t,"x",{enumerable:!1,value:t});for(var e in t)return!1;return t.x===t}catch(t){return!1}}(),L=function(t){var e;return e=D?function(t,e,n,r){!r&&e in t||o.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(t,e,n,r){!r&&e in t||(t[e]=n)},function(n,r,o){for(var i in r)t.call(r,i)&&e(n,i,r[i],o)}}(i.hasOwnProperty),F=function(t){var e=typeof t;return null===t||"object"!==e&&"function"!==e},G=c.isNaN||function(t){return t!==t},U={ToInteger:function(t){var e=+t;return G(e)?e=0:0!==e&&e!==1/0&&e!==-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e},ToPrimitive:function(e){var n,r,o;if(F(e))return e;if(r=e.valueOf,t(r)&&(n=r.call(e),F(n)))return n;if(o=e.toString,t(o)&&(n=o.call(e),F(n)))return n;throw new TypeError},ToObject:function(t){if(null==t)throw new TypeError("can't convert "+t+" to object");return o(t)},ToUint32:function(t){return t>>>0}},H=function(){};L(s,{bind:function(e){var n=this;if(!t(n))throw new TypeError("Function.prototype.bind called on incompatible "+n);for(var r,i=h.call(arguments,1),s=function(){if(this instanceof r){var t=y.call(n,this,m.call(i,h.call(arguments)));return o(t)===t?t:this}return y.call(n,e,m.call(i,h.call(arguments)))},l=w(0,n.length-i.length),u=[],c=0;c<l;c++)d.call(u,"$"+c);return r=a("binder","return function ("+b.call(u,",")+"){ return binder.apply(this, arguments); }")(s),n.prototype&&(H.prototype=n.prototype,r.prototype=new H,H.prototype=null),r}});var z=v.bind(i.hasOwnProperty),V=v.bind(i.toString),W=v.bind(h),$=y.bind(h),Y=v.bind(u.slice),q=v.bind(u.split),K=v.bind(u.indexOf),X=v.bind(d),Z=v.bind(i.propertyIsEnumerable),J=v.bind(r.sort),Q=n.isArray||function(t){return"[object Array]"===V(t)},tt=1!==[].unshift(0);L(r,{unshift:function(){return g.apply(this,arguments),this.length}},tt),L(n,{isArray:Q});var et=o("a"),nt="a"!==et[0]||!(0 in et),rt=function(t){var e=!0,n=!0,r=!1;if(t)try{t.call("foo",function(t,n,r){"object"!=typeof r&&(e=!1)}),t.call([1],function(){"use strict";n="string"==typeof this},"x")}catch(t){r=!0}return!!t&&!r&&e&&n};L(r,{forEach:function(e){var n,r=U.ToObject(this),o=nt&&M(this)?q(this,""):r,i=-1,a=U.ToUint32(o.length);if(arguments.length>1&&(n=arguments[1]),!t(e))throw new TypeError("Array.prototype.forEach callback must be a function");for(;++i<a;)i in o&&("undefined"==typeof n?e(o[i],i,r):e.call(n,o[i],i,r))}},!rt(r.forEach)),L(r,{map:function(e){var r,o=U.ToObject(this),i=nt&&M(this)?q(this,""):o,a=U.ToUint32(i.length),s=n(a);if(arguments.length>1&&(r=arguments[1]),!t(e))throw new TypeError("Array.prototype.map callback must be a function");for(var l=0;l<a;l++)l in i&&("undefined"==typeof r?s[l]=e(i[l],l,o):s[l]=e.call(r,i[l],l,o));return s}},!rt(r.map)),L(r,{filter:function(e){var n,r,o=U.ToObject(this),i=nt&&M(this)?q(this,""):o,a=U.ToUint32(i.length),s=[];if(arguments.length>1&&(r=arguments[1]),!t(e))throw new TypeError("Array.prototype.filter callback must be a function");for(var l=0;l<a;l++)l in i&&(n=i[l],("undefined"==typeof r?e(n,l,o):e.call(r,n,l,o))&&X(s,n));return s}},!rt(r.filter)),L(r,{every:function(e){var n,r=U.ToObject(this),o=nt&&M(this)?q(this,""):r,i=U.ToUint32(o.length);if(arguments.length>1&&(n=arguments[1]),!t(e))throw new TypeError("Array.prototype.every callback must be a function");for(var a=0;a<i;a++)if(a in o&&!("undefined"==typeof n?e(o[a],a,r):e.call(n,o[a],a,r)))return!1;return!0}},!rt(r.every)),L(r,{some:function(e){var n,r=U.ToObject(this),o=nt&&M(this)?q(this,""):r,i=U.ToUint32(o.length);if(arguments.length>1&&(n=arguments[1]),!t(e))throw new TypeError("Array.prototype.some callback must be a function");for(var a=0;a<i;a++)if(a in o&&("undefined"==typeof n?e(o[a],a,r):e.call(n,o[a],a,r)))return!0;return!1}},!rt(r.some));var ot=!1;r.reduce&&(ot="object"==typeof r.reduce.call("es5",function(t,e,n,r){return r})),L(r,{reduce:function(e){var n=U.ToObject(this),r=nt&&M(this)?q(this,""):n,o=U.ToUint32(r.length);if(!t(e))throw new TypeError("Array.prototype.reduce callback must be a function");if(0===o&&1===arguments.length)throw new TypeError("reduce of empty array with no initial value");var i,a=0;if(arguments.length>=2)i=arguments[1];else for(;;){if(a in r){i=r[a++];break}if(++a>=o)throw new TypeError("reduce of empty array with no initial value")}for(;a<o;a++)a in r&&(i=e(i,r[a],a,n));return i}},!ot);var it=!1;r.reduceRight&&(it="object"==typeof r.reduceRight.call("es5",function(t,e,n,r){return r})),L(r,{reduceRight:function(e){var n=U.ToObject(this),r=nt&&M(this)?q(this,""):n,o=U.ToUint32(r.length);if(!t(e))throw new TypeError("Array.prototype.reduceRight callback must be a function");if(0===o&&1===arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var i,a=o-1;if(arguments.length>=2)i=arguments[1];else for(;;){if(a in r){i=r[a--];break}if(--a<0)throw new TypeError("reduceRight of empty array with no initial value")}if(a<0)return i;do a in r&&(i=e(i,r[a],a,n));while(a--);return i}},!it);var at=r.indexOf&&[0,1].indexOf(1,2)!==-1;L(r,{indexOf:function(t){var e=nt&&M(this)?q(this,""):U.ToObject(this),n=U.ToUint32(e.length);if(0===n)return-1;var r=0;for(arguments.length>1&&(r=U.ToInteger(arguments[1])),r=r>=0?r:w(0,n+r);r<n;r++)if(r in e&&e[r]===t)return r;return-1}},at);var st=r.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;L(r,{lastIndexOf:function(t){var e=nt&&M(this)?q(this,""):U.ToObject(this),n=U.ToUint32(e.length);if(0===n)return-1;var r=n-1;for(arguments.length>1&&(r=x(r,U.ToInteger(arguments[1]))),r=r>=0?r:n-Math.abs(r);r>=0;r--)if(r in e&&t===e[r])return r;return-1}},st);var lt=function(){var t=[1,2],e=t.splice();return 2===t.length&&Q(e)&&0===e.length}();L(r,{splice:function(t,e){return 0===arguments.length?[]:f.apply(this,arguments)}},!lt);var ut=function(){var t={};return r.splice.call(t,0,0,1),1===t.length}();L(r,{splice:function(t,e){if(0===arguments.length)return[];var n=arguments;return this.length=w(U.ToInteger(this.length),0),arguments.length>0&&"number"!=typeof e&&(n=W(arguments),n.length<2?X(n,this.length-t):n[1]=U.ToInteger(e)),f.apply(this,n)}},!ut);var ct=function(){var t=new n(1e5);return t[8]="x",t.splice(1,1),7===t.indexOf("x")}(),pt=function(){var t=256,e=[];return e[t]="a",e.splice(t+1,0,"b"),"a"===e[t]}();L(r,{splice:function(t,e){for(var n,r=U.ToObject(this),o=[],i=U.ToUint32(r.length),a=U.ToInteger(t),s=a<0?w(i+a,0):x(a,i),u=x(w(U.ToInteger(e),0),i-s),c=0;c<u;)n=l(s+c),z(r,n)&&(o[c]=r[n]),c+=1;var p,h=W(arguments,2),f=h.length;if(f<u){c=s;for(var d=i-u;c<d;)n=l(c+u),p=l(c+f),z(r,n)?r[p]=r[n]:delete r[p],c+=1;c=i;for(var g=i-u+f;c>g;)delete r[c-1],c-=1}else if(f>u)for(c=i-u;c>s;)n=l(c+u-1),p=l(c+f-1),z(r,n)?r[p]=r[n]:delete r[p],c-=1;c=s;for(var m=0;m<h.length;++m)r[c]=h[m],c+=1;return r.length=i-u+f,o}},!ct||!pt);var ht,ft=r.join;try{ht="1,2,3"!==Array.prototype.join.call("123",",")}catch(t){ht=!0}ht&&L(r,{join:function(t){var e="undefined"==typeof t?",":t;return ft.call(M(this)?q(this,""):this,e)}},ht);var dt="1,2"!==[1,2].join(void 0);dt&&L(r,{join:function(t){var e="undefined"==typeof t?",":t;return ft.call(this,e)}},dt);var gt=function(t){for(var e=U.ToObject(this),n=U.ToUint32(e.length),r=0;r<arguments.length;)e[n+r]=arguments[r],r+=1;return e.length=n+r,n+r},mt=function(){var t={},e=Array.prototype.push.call(t,void 0);return 1!==e||1!==t.length||"undefined"!=typeof t[0]||!z(t,0)}();L(r,{push:function(t){return Q(this)?d.apply(this,arguments):gt.apply(this,arguments)}},mt);var bt=function(){var t=[],e=t.push(void 0);return 1!==e||1!==t.length||"undefined"!=typeof t[0]||!z(t,0)}();L(r,{push:gt},bt),L(r,{slice:function(t,e){var n=M(this)?q(this,""):this;return $(n,arguments)}},nt);var vt=function(){try{return[1,2].sort(null),[1,2].sort({}),!0}catch(t){}return!1}(),yt=function(){try{return[1,2].sort(/a/),!1}catch(t){}return!0}(),wt=function(){try{return[1,2].sort(void 0),!0}catch(t){}return!1}();L(r,{sort:function(e){if("undefined"==typeof e)return J(this);if(!t(e))throw new TypeError("Array.prototype.sort callback must be a function");return J(this,e)}},vt||!wt||!yt);var xt=!Z({toString:null},"toString"),St=Z(function(){},"prototype"),Ot=!z("x","0"),Tt=function(t){var e=t.constructor;return e&&e.prototype===t},Et={$window:!0,$console:!0,$parent:!0,$self:!0,$frame:!0,$frames:!0,$frameElement:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$external:!0},At=function(){if("undefined"==typeof window)return!1;for(var t in window)try{!Et["$"+t]&&z(window,t)&&null!==window[t]&&"object"==typeof window[t]&&Tt(window[t])}catch(t){return!0}return!1}(),Ct=function(t){if("undefined"==typeof window||!At)return Tt(t);try{return Tt(t)}catch(t){return!1}},Pt=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Nt=Pt.length,jt=function(t){return"[object Arguments]"===V(t)},Rt=function(e){return null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&!Q(e)&&t(e.callee)},Bt=jt(arguments)?jt:Rt;L(o,{keys:function(e){var n=t(e),r=Bt(e),o=null!==e&&"object"==typeof e,i=o&&M(e);if(!o&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var a=[],s=St&&n;if(i&&Ot||r)for(var u=0;u<e.length;++u)X(a,l(u));if(!r)for(var c in e)s&&"prototype"===c||!z(e,c)||X(a,l(c));if(xt)for(var p=Ct(e),h=0;h<Nt;h++){var f=Pt[h];p&&"constructor"===f||!z(e,f)||X(a,f)}return a}});var Mt=o.keys&&function(){return 2===o.keys(arguments).length}(1,2),_t=o.keys&&function(){var t=o.keys(arguments);return 1!==arguments.length||1!==t.length||1!==t[0]}(1),It=o.keys;L(o,{keys:function(t){return It(Bt(t)?W(t):t)}},!Mt||_t);var kt,Dt,Lt=0!==new Date((-0xc782b5b342b24)).getUTCMonth(),Ft=new Date((-0x55d318d56a724)),Gt=new Date(14496624e5),Ut="Mon, 01 Jan -45875 11:59:59 GMT"!==Ft.toUTCString(),Ht=Ft.getTimezoneOffset();Ht<-720?(kt="Tue Jan 02 -45875"!==Ft.toDateString(),Dt=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/.test(Gt.toString())):(kt="Mon Jan 01 -45875"!==Ft.toDateString(),Dt=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/.test(Gt.toString()));var zt=v.bind(Date.prototype.getFullYear),Vt=v.bind(Date.prototype.getMonth),Wt=v.bind(Date.prototype.getDate),$t=v.bind(Date.prototype.getUTCFullYear),Yt=v.bind(Date.prototype.getUTCMonth),qt=v.bind(Date.prototype.getUTCDate),Kt=v.bind(Date.prototype.getUTCDay),Xt=v.bind(Date.prototype.getUTCHours),Zt=v.bind(Date.prototype.getUTCMinutes),Jt=v.bind(Date.prototype.getUTCSeconds),Qt=v.bind(Date.prototype.getUTCMilliseconds),te=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ee=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ne=function(t,e){return Wt(new Date(e,t,0))};L(Date.prototype,{getFullYear:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=zt(this);return t<0&&Vt(this)>11?t+1:t},getMonth:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=zt(this),e=Vt(this);return t<0&&e>11?0:e},getDate:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=zt(this),e=Vt(this),n=Wt(this);if(t<0&&e>11){if(12===e)return n;var r=ne(0,t+1);return r-n+1}return n},getUTCFullYear:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=$t(this);return t<0&&Yt(this)>11?t+1:t},getUTCMonth:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=$t(this),e=Yt(this);return t<0&&e>11?0:e},getUTCDate:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=$t(this),e=Yt(this),n=qt(this);if(t<0&&e>11){if(12===e)return n;var r=ne(0,t+1);return r-n+1}return n}},Lt),L(Date.prototype,{toUTCString:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=Kt(this),e=qt(this),n=Yt(this),r=$t(this),o=Xt(this),i=Zt(this),a=Jt(this);return te[t]+", "+(e<10?"0"+e:e)+" "+ee[n]+" "+r+" "+(o<10?"0"+o:o)+":"+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+" GMT"}},Lt||Ut),L(Date.prototype,{toDateString:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=this.getDay(),e=this.getDate(),n=this.getMonth(),r=this.getFullYear();return te[t]+" "+ee[n]+" "+(e<10?"0"+e:e)+" "+r}},Lt||kt),(Lt||Dt)&&(Date.prototype.toString=function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=this.getDay(),e=this.getDate(),n=this.getMonth(),r=this.getFullYear(),o=this.getHours(),i=this.getMinutes(),a=this.getSeconds(),s=this.getTimezoneOffset(),l=Math.floor(Math.abs(s)/60),u=Math.floor(Math.abs(s)%60);return te[t]+" "+ee[n]+" "+(e<10?"0"+e:e)+" "+r+" "+(o<10?"0"+o:o)+":"+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+" GMT"+(s>0?"-":"+")+(l<10?"0"+l:l)+(u<10?"0"+u:u)},D&&o.defineProperty(Date.prototype,"toString",{configurable:!0,enumerable:!1,writable:!0}));var re=-621987552e5,oe="-000001",ie=Date.prototype.toISOString&&new Date(re).toISOString().indexOf(oe)===-1,ae=Date.prototype.toISOString&&"1969-12-31T23:59:59.999Z"!==new Date((-1)).toISOString(),se=v.bind(Date.prototype.getTime);L(Date.prototype,{toISOString:function(){if(!isFinite(this)||!isFinite(se(this)))throw new RangeError("Date.prototype.toISOString called on non-finite value.");var t=$t(this),e=Yt(this);t+=Math.floor(e/12),e=(e%12+12)%12;var n=[e+1,qt(this),Xt(this),Zt(this),Jt(this)];t=(t<0?"-":t>9999?"+":"")+Y("00000"+Math.abs(t),0<=t&&t<=9999?-4:-6);for(var r=0;r<n.length;++r)n[r]=Y("00"+n[r],-2);return t+"-"+W(n,0,2).join("-")+"T"+W(n,2).join(":")+"."+Y("000"+Qt(this),-3)+"Z"}},ie||ae);var le=function(){try{return Date.prototype.toJSON&&null===new Date(NaN).toJSON()&&new Date(re).toJSON().indexOf(oe)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(t){return!1}}();le||(Date.prototype.toJSON=function(e){var n=o(this),r=U.ToPrimitive(n);if("number"==typeof r&&!isFinite(r))return null;var i=n.toISOString;if(!t(i))throw new TypeError("toISOString property is not callable");return i.call(n)});var ue=1e15===Date.parse("+033658-09-27T01:46:40.000Z"),ce=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z")),pe=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(pe||ce||!ue){var he=Math.pow(2,31)-1,fe=G(new Date(1970,0,1,0,0,0,he+1).getTime());Date=function(t){var e=function(n,r,o,i,a,s,u){var c,p=arguments.length;if(this instanceof t){var h=s,f=u;if(fe&&p>=7&&u>he){var d=Math.floor(u/he)*he,g=Math.floor(d/1e3);h+=g,f-=1e3*g}c=1===p&&l(n)===n?new t(e.parse(n)):p>=7?new t(n,r,o,i,a,h,f):p>=6?new t(n,r,o,i,a,h):p>=5?new t(n,r,o,i,a):p>=4?new t(n,r,o,i):p>=3?new t(n,r,o):p>=2?new t(n,r):p>=1?new t(n instanceof t?+n:n):new t}else c=t.apply(this,arguments);return F(c)||L(c,{constructor:e},!0),c},n=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:(\\.\\d{1,}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),r=[0,31,59,90,120,151,181,212,243,273,304,334,365],o=function(t,e){var n=e>1?1:0;return r[e]+Math.floor((t-1969+n)/4)-Math.floor((t-1901+n)/100)+Math.floor((t-1601+n)/400)+365*(t-1970)},i=function(e){var n=0,r=e;if(fe&&r>he){var o=Math.floor(r/he)*he,i=Math.floor(o/1e3);n+=i,r-=1e3*i}return c(new t(1970,0,1,0,0,n,r))};for(var a in t)z(t,a)&&(e[a]=t[a]);L(e,{now:t.now,UTC:t.UTC},!0),e.prototype=t.prototype,L(e.prototype,{constructor:e},!0);var s=function(e){var r=n.exec(e);if(r){var a,s=c(r[1]),l=c(r[2]||1)-1,u=c(r[3]||1)-1,p=c(r[4]||0),h=c(r[5]||0),f=c(r[6]||0),d=Math.floor(1e3*c(r[7]||0)),g=Boolean(r[4]&&!r[8]),m="-"===r[9]?1:-1,b=c(r[10]||0),v=c(r[11]||0),y=h>0||f>0||d>0;return p<(y?24:25)&&h<60&&f<60&&d<1e3&&l>-1&&l<12&&b<24&&v<60&&u>-1&&u<o(s,l+1)-o(s,l)&&(a=60*(24*(o(s,l)+u)+p+b*m),a=1e3*(60*(a+h+v*m)+f)+d,g&&(a=i(a)),-864e13<=a&&a<=864e13)?a:NaN}return t.parse.apply(this,arguments)};return L(e,{parse:s}),e}(Date)}Date.now||(Date.now=function(){return(new Date).getTime()});var de=p.toFixed&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0)),ge={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function(t,e){for(var n=-1,r=e;++n<ge.size;)r+=t*ge.data[n],ge.data[n]=r%ge.base,r=Math.floor(r/ge.base)},divide:function(t){for(var e=ge.size,n=0;--e>=0;)n+=ge.data[e],ge.data[e]=Math.floor(n/t),n=n%t*ge.base},numToString:function(){for(var t=ge.size,e="";--t>=0;)if(""!==e||0===t||0!==ge.data[t]){var n=l(ge.data[t]);""===e?e=n:e+=Y("0000000",0,7-n.length)+n}return e},pow:function t(e,n,r){return 0===n?r:n%2===1?t(e,n-1,r*e):t(e*e,n/2,r)},log:function(t){for(var e=0,n=t;n>=4096;)e+=12,n/=4096;for(;n>=2;)e+=1,n/=2;return e}},me=function(t){var e,n,r,o,i,a,s,u;if(e=c(t),e=G(e)?0:Math.floor(e),e<0||e>20)throw new RangeError("Number.toFixed called with invalid number of decimals");if(n=c(this),G(n))return"NaN";if(n<=-1e21||n>=1e21)return l(n);if(r="",n<0&&(r="-",n=-n),o="0",n>1e-21)if(i=ge.log(n*ge.pow(2,69,1))-69,a=i<0?n*ge.pow(2,-i,1):n/ge.pow(2,i,1),a*=4503599627370496,i=52-i,i>0){for(ge.multiply(0,a),s=e;s>=7;)ge.multiply(1e7,0),s-=7;for(ge.multiply(ge.pow(10,s,1),0),s=i-1;s>=23;)ge.divide(1<<23),s-=23;ge.divide(1<<s),ge.multiply(1,1),ge.divide(2),o=ge.numToString()}else ge.multiply(0,a),ge.multiply(1<<-i,0),o=ge.numToString()+Y("0.00000000000000000000",2,2+e);return e>0?(u=o.length,o=u<=e?r+Y("0.0000000000000000000",0,e-u+2)+o:r+Y(o,0,u-e)+"."+Y(o,u-e)):o=r+o,o};L(p,{toFixed:me},de);var be=function(){try{return"1"===1..toPrecision(void 0)}catch(t){return!0}}(),ve=p.toPrecision;L(p,{toPrecision:function(t){return"undefined"==typeof t?ve.call(this):ve.call(this,t)}},be),2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?!function(){var t="undefined"==typeof/()??/.exec("")[1],n=Math.pow(2,32)-1;u.split=function(r,o){var i=String(this);if("undefined"==typeof r&&0===o)return[];if(!e(r))return q(this,r,o);var a,s,l,u,c=[],p=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.unicode?"u":"")+(r.sticky?"y":""),h=0,f=new RegExp(r.source,p+"g");t||(a=new RegExp("^"+f.source+"$(?!\\s)",p));var g="undefined"==typeof o?n:U.ToUint32(o);for(s=f.exec(i);s&&(l=s.index+s[0].length,!(l>h&&(X(c,Y(i,h,s.index)),!t&&s.length>1&&s[0].replace(a,function(){for(var t=1;t<arguments.length-2;t++)"undefined"==typeof arguments[t]&&(s[t]=void 0)}),s.length>1&&s.index<i.length&&d.apply(c,W(s,1)),u=s[0].length,h=l,c.length>=g)));)f.lastIndex===s.index&&f.lastIndex++,s=f.exec(i);return h===i.length?!u&&f.test("")||X(c,""):X(c,Y(i,h)),c.length>g?W(c,0,g):c}}():"0".split(void 0,0).length&&(u.split=function(t,e){return"undefined"==typeof t&&0===e?[]:q(this,t,e)});var ye=u.replace,we=function(){var t=[];return"x".replace(/x(.)?/g,function(e,n){X(t,n)}),1===t.length&&"undefined"==typeof t[0]}();we||(u.replace=function(n,r){var o=t(r),i=e(n)&&/\)[*?]/.test(n.source);if(o&&i){var a=function(t){var e=arguments.length,o=n.lastIndex;n.lastIndex=0;var i=n.exec(t)||[];return n.lastIndex=o,X(i,arguments[e-2],arguments[e-1]),r.apply(this,i)};return ye.call(this,n,a)}return ye.call(this,n,r)});var xe=u.substr,Se="".substr&&"b"!=="0b".substr(-1);L(u,{substr:function(t,e){var n=t;return t<0&&(n=w(this.length+t,0)),xe.call(this,n,e)}},Se);var Oe="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff",Te="​",Ee="["+Oe+"]",Ae=new RegExp("^"+Ee+Ee+"*"),Ce=new RegExp(Ee+Ee+"*$"),Pe=u.trim&&(Oe.trim()||!Te.trim());L(u,{trim:function(){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");return l(this).replace(Ae,"").replace(Ce,"")}},Pe);var Ne=v.bind(String.prototype.trim),je=u.lastIndexOf&&"abcあい".lastIndexOf("あい",2)!==-1;L(u,{lastIndexOf:function(t){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");for(var e=l(this),n=l(t),r=arguments.length>1?c(arguments[1]):NaN,o=G(r)?1/0:U.ToInteger(r),i=x(w(o,0),e.length),a=n.length,s=i+a;s>0;){s=w(0,s-a);var u=K(Y(e,s,i+a),n);if(u!==-1)return s+u}return-1}},je);var Re=u.lastIndexOf;if(L(u,{lastIndexOf:function(t){return Re.apply(this,arguments)}},1!==u.lastIndexOf.length),8===parseInt(Oe+"08")&&22===parseInt(Oe+"0x16")||(parseInt=function(t){var e=/^[\-+]?0[xX]/;return function(n,r){var o=Ne(String(n)),i=c(r)||(e.test(o)?16:10);return t(o,i)}}(parseInt)),1/parseFloat("-0")!==-(1/0)&&(parseFloat=function(t){return function(e){var n=Ne(String(e)),r=t(n);return 0===r&&"-"===Y(n,0,1)?-0:r}}(parseFloat)),"RangeError: test"!==String(new RangeError("test"))){var Be=function(){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");var t=this.name;"undefined"==typeof t?t="Error":"string"!=typeof t&&(t=l(t));var e=this.message;return"undefined"==typeof e?e="":"string"!=typeof e&&(e=l(e)),t?e?t+": "+e:t:e};Error.prototype.toString=Be}if(D){var Me=function(t,e){if(Z(t,e)){var n=Object.getOwnPropertyDescriptor(t,e);n.configurable&&(n.enumerable=!1,Object.defineProperty(t,e,n))}};Me(Error.prototype,"message"),""!==Error.prototype.message&&(Error.prototype.message=""),Me(Error.prototype,"name")}if("/a/gim"!==String(/a/gim)){var _e=function(){var t="/"+this.source+"/";return this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),t};RegExp.prototype.toString=_e}}),function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.returnExports=e()}(this,function(){"use strict";var t,e=Function.call.bind(Function.apply),n=Function.call.bind(Function.call),r=Array.isArray,o=Object.keys,i=function(t){return function(){return!e(t,this,arguments)}},a=function(t){try{return t(),!1}catch(t){return!0}},s=function(t){try{return t()}catch(t){return!1}},l=i(a),u=function(){return!a(function(){Object.defineProperty({},"x",{get:function(){}})})},c=!!Object.defineProperty&&u(),p="foo"===function(){}.name,h=Function.call.bind(Array.prototype.forEach),f=Function.call.bind(Array.prototype.reduce),d=Function.call.bind(Array.prototype.filter),g=Function.call.bind(Array.prototype.some),m=function(t,e,n,r){!r&&e in t||(c?Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:!0,value:n}):t[e]=n)},b=function(t,e,n){h(o(e),function(r){var o=e[r];m(t,r,o,!!n)})},v=Function.call.bind(Object.prototype.toString),y="function"==typeof/abc/?function(t){return"function"==typeof t&&"[object Function]"===v(t)}:function(t){return"function"==typeof t},w={getter:function(t,e,n){if(!c)throw new TypeError("getters require true ES5 support");Object.defineProperty(t,e,{configurable:!0,enumerable:!1,get:n})},proxy:function(t,e,n){if(!c)throw new TypeError("getters require true ES5 support");var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,{configurable:r.configurable,enumerable:r.enumerable,get:function(){return t[e]},set:function(n){t[e]=n}})},redefine:function(t,e,n){if(c){var r=Object.getOwnPropertyDescriptor(t,e);r.value=n,Object.defineProperty(t,e,r)}else t[e]=n},defineByDescriptor:function(t,e,n){c?Object.defineProperty(t,e,n):"value"in n&&(t[e]=n.value)},preserveToString:function(t,e){e&&y(e.toString)&&m(t,"toString",e.toString.bind(e),!0)}},x=Object.create||function(t,e){var n=function(){};n.prototype=t;var r=new n;return"undefined"!=typeof e&&o(e).forEach(function(t){w.defineByDescriptor(r,t,e[t])}),r},S=function(t,e){return!!Object.setPrototypeOf&&s(function(){var n=function e(n){var r=new t(n);return Object.setPrototypeOf(r,e.prototype),r};return Object.setPrototypeOf(n,t),n.prototype=x(t.prototype,{constructor:{value:n}}),e(n)})},O=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")},T=O(),E=T.isFinite,A=Function.call.bind(String.prototype.indexOf),C=Function.apply.bind(Array.prototype.indexOf),P=Function.call.bind(Array.prototype.concat),N=Function.call.bind(String.prototype.slice),j=Function.call.bind(Array.prototype.push),R=Function.apply.bind(Array.prototype.push),B=Function.call.bind(Array.prototype.shift),M=Math.max,_=Math.min,I=Math.floor,k=Math.abs,D=Math.exp,L=Math.log,F=Math.sqrt,G=Function.call.bind(Object.prototype.hasOwnProperty),U=function(){},H=T.Symbol||{},z=H.species||"@@species",V=Number.isNaN||function(t){return t!==t},W=Number.isFinite||function(t){return"number"==typeof t&&E(t)},$=y(Math.sign)?Math.sign:function(t){var e=Number(t);return 0===e?e:V(e)?e:e<0?-1:1},Y=function(t){return"[object Arguments]"===v(t)},q=function(t){return null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==v(t)&&"[object Function]"===v(t.callee)},K=Y(arguments)?Y:q,X={primitive:function(t){return null===t||"function"!=typeof t&&"object"!=typeof t},string:function(t){return"[object String]"===v(t)},regex:function(t){return"[object RegExp]"===v(t)},symbol:function(t){return"function"==typeof T.Symbol&&"symbol"==typeof t}},Z=function(t,e,n){var r=t[e];m(t,e,n,!0),w.preserveToString(t[e],r)},J="function"==typeof H&&"function"==typeof H.for&&X.symbol(H()),Q=X.symbol(H.iterator)?H.iterator:"_es6-shim iterator_";T.Set&&"function"==typeof(new T.Set)["@@iterator"]&&(Q="@@iterator"),T.Reflect||m(T,"Reflect",{},!0);var tt=T.Reflect,et=String,nt={Call:function(t,n){var r=arguments.length>2?arguments[2]:[];if(!nt.IsCallable(t))throw new TypeError(t+" is not a function");return e(t,n,r)},RequireObjectCoercible:function(t,e){if(null==t)throw new TypeError(e||"Cannot call method on "+t);return t},TypeIsObject:function(t){return void 0!==t&&null!==t&&t!==!0&&t!==!1&&("function"==typeof t||"object"==typeof t)},ToObject:function(t,e){return Object(nt.RequireObjectCoercible(t,e))},IsCallable:y,IsConstructor:function(t){return nt.IsCallable(t)},ToInt32:function(t){return nt.ToNumber(t)>>0},ToUint32:function(t){return nt.ToNumber(t)>>>0},ToNumber:function(t){if("[object Symbol]"===v(t))throw new TypeError("Cannot convert a Symbol value to a number");return+t},ToInteger:function(t){var e=nt.ToNumber(t);return V(e)?0:0!==e&&W(e)?(e>0?1:-1)*I(k(e)):e},ToLength:function(t){var e=nt.ToInteger(t);return e<=0?0:e>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e},SameValue:function(t,e){return t===e?0!==t||1/t===1/e:V(t)&&V(e)},SameValueZero:function(t,e){return t===e||V(t)&&V(e)},IsIterable:function(t){return nt.TypeIsObject(t)&&("undefined"!=typeof t[Q]||K(t))},GetIterator:function(e){if(K(e))return new t(e,"value");var n=nt.GetMethod(e,Q);if(!nt.IsCallable(n))throw new TypeError("value is not an iterable");var r=nt.Call(n,e);if(!nt.TypeIsObject(r))throw new TypeError("bad iterator");return r},GetMethod:function(t,e){var n=nt.ToObject(t)[e];if(void 0!==n&&null!==n){if(!nt.IsCallable(n))throw new TypeError("Method not callable: "+e);return n}},IteratorComplete:function(t){return!!t.done},IteratorClose:function(t,e){var n=nt.GetMethod(t,"return");if(void 0!==n){var r,o;try{r=nt.Call(n,t)}catch(t){o=t}if(!e){if(o)throw o;if(!nt.TypeIsObject(r))throw new TypeError("Iterator's return method returned a non-object.")}}},IteratorNext:function(t){var e=arguments.length>1?t.next(arguments[1]):t.next();if(!nt.TypeIsObject(e))throw new TypeError("bad iterator");return e},IteratorStep:function(t){var e=nt.IteratorNext(t),n=nt.IteratorComplete(e);return!n&&e},Construct:function(t,e,n,r){var o="undefined"==typeof n?t:n;if(!r&&tt.construct)return tt.construct(t,e,o);var i=o.prototype;nt.TypeIsObject(i)||(i=Object.prototype);var a=x(i),s=nt.Call(t,a,e);return nt.TypeIsObject(s)?s:a},SpeciesConstructor:function(t,e){var n=t.constructor;if(void 0===n)return e;if(!nt.TypeIsObject(n))throw new TypeError("Bad constructor");var r=n[z];if(void 0===r||null===r)return e;if(!nt.IsConstructor(r))throw new TypeError("Bad @@species");return r},CreateHTML:function(t,e,n,r){var o=nt.ToString(t),i="<"+e;if(""!==n){var a=nt.ToString(r),s=a.replace(/"/g,"&quot;");i+=" "+n+'="'+s+'"'}var l=i+">",u=l+o;return u+"</"+e+">"},IsRegExp:function(t){if(!nt.TypeIsObject(t))return!1;var e=t[H.match];return"undefined"!=typeof e?!!e:X.regex(t)},ToString:function(t){return et(t)}};if(c&&J){var rt=function(t){if(X.symbol(H[t]))return H[t];var e=H.for("Symbol."+t);return Object.defineProperty(H,t,{configurable:!1,enumerable:!1,writable:!1,value:e}),e};if(!X.symbol(H.search)){var ot=rt("search"),it=String.prototype.search;m(RegExp.prototype,ot,function(t){return nt.Call(it,t,[this])});var at=function(t){var e=nt.RequireObjectCoercible(this);if(null!==t&&"undefined"!=typeof t){var n=nt.GetMethod(t,ot);if("undefined"!=typeof n)return nt.Call(n,t,[e])}return nt.Call(it,e,[nt.ToString(t)])};Z(String.prototype,"search",at)}if(!X.symbol(H.replace)){var st=rt("replace"),lt=String.prototype.replace;m(RegExp.prototype,st,function(t,e){return nt.Call(lt,t,[this,e])});var ut=function(t,e){var n=nt.RequireObjectCoercible(this);if(null!==t&&"undefined"!=typeof t){var r=nt.GetMethod(t,st);if("undefined"!=typeof r)return nt.Call(r,t,[n,e])}return nt.Call(lt,n,[nt.ToString(t),e])};Z(String.prototype,"replace",ut)}if(!X.symbol(H.split)){var ct=rt("split"),pt=String.prototype.split;m(RegExp.prototype,ct,function(t,e){return nt.Call(pt,t,[this,e])});var ht=function(t,e){var n=nt.RequireObjectCoercible(this);if(null!==t&&"undefined"!=typeof t){var r=nt.GetMethod(t,ct);if("undefined"!=typeof r)return nt.Call(r,t,[n,e])}return nt.Call(pt,n,[nt.ToString(t),e])};Z(String.prototype,"split",ht)}var ft=X.symbol(H.match),dt=ft&&function(){var t={};return t[H.match]=function(){return 42},42!=="a".match(t)}();if(!ft||dt){var gt=rt("match"),mt=String.prototype.match;m(RegExp.prototype,gt,function(t){return nt.Call(mt,t,[this])});var bt=function(t){var e=nt.RequireObjectCoercible(this);if(null!==t&&"undefined"!=typeof t){var n=nt.GetMethod(t,gt);if("undefined"!=typeof n)return nt.Call(n,t,[e])}return nt.Call(mt,e,[nt.ToString(t)])};Z(String.prototype,"match",bt)}}var vt=function(t,e,n){w.preserveToString(e,t),Object.setPrototypeOf&&Object.setPrototypeOf(t,e),c?h(Object.getOwnPropertyNames(t),function(r){r in U||n[r]||w.proxy(t,r,e)}):h(Object.keys(t),function(r){r in U||n[r]||(e[r]=t[r])}),e.prototype=t.prototype,w.redefine(t.prototype,"constructor",e)},yt=function(){return this},wt=function(t){c&&!G(t,z)&&w.getter(t,z,yt)},xt=function(t,e){var n=e||function(){return this};m(t,Q,n),!t[Q]&&X.symbol(Q)&&(t[Q]=n)},St=function(t,e,n){c?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,writable:!0,value:n}):t[e]=n},Ot=function(t,e,n){if(St(t,e,n),!nt.SameValue(t[e],n))throw new TypeError("property is nonconfigurable")},Tt=function(t,e,n,r){if(!nt.TypeIsObject(t))throw new TypeError("Constructor requires `new`: "+e.name);
var o=e.prototype;nt.TypeIsObject(o)||(o=n);var i=x(o);for(var a in r)if(G(r,a)){var s=r[a];m(i,a,s,!0)}return i};if(String.fromCodePoint&&1!==String.fromCodePoint.length){var Et=String.fromCodePoint;Z(String,"fromCodePoint",function(t){return nt.Call(Et,this,arguments)})}var At={fromCodePoint:function(t){for(var e,n=[],r=0,o=arguments.length;r<o;r++){if(e=Number(arguments[r]),!nt.SameValue(e,nt.ToInteger(e))||e<0||e>1114111)throw new RangeError("Invalid code point "+e);e<65536?j(n,String.fromCharCode(e)):(e-=65536,j(n,String.fromCharCode((e>>10)+55296)),j(n,String.fromCharCode(e%1024+56320)))}return n.join("")},raw:function(t){var e=nt.ToObject(t,"bad callSite"),n=nt.ToObject(e.raw,"bad raw value"),r=n.length,o=nt.ToLength(r);if(o<=0)return"";for(var i,a,s,l,u=[],c=0;c<o&&(i=nt.ToString(c),s=nt.ToString(n[i]),j(u,s),!(c+1>=o));)a=c+1<arguments.length?arguments[c+1]:"",l=nt.ToString(a),j(u,l),c+=1;return u.join("")}};String.raw&&"xy"!==String.raw({raw:{0:"x",1:"y",length:2}})&&Z(String,"raw",At.raw),b(String,At);var Ct=function t(e,n){if(n<1)return"";if(n%2)return t(e,n-1)+e;var r=t(e,n/2);return r+r},Pt=1/0,Nt={repeat:function(t){var e=nt.ToString(nt.RequireObjectCoercible(this)),n=nt.ToInteger(t);if(n<0||n>=Pt)throw new RangeError("repeat count must be less than infinity and not overflow maximum string size");return Ct(e,n)},startsWith:function(t){var e=nt.ToString(nt.RequireObjectCoercible(this));if(nt.IsRegExp(t))throw new TypeError('Cannot call method "startsWith" with a regex');var n,r=nt.ToString(t);arguments.length>1&&(n=arguments[1]);var o=M(nt.ToInteger(n),0);return N(e,o,o+r.length)===r},endsWith:function(t){var e=nt.ToString(nt.RequireObjectCoercible(this));if(nt.IsRegExp(t))throw new TypeError('Cannot call method "endsWith" with a regex');var n,r=nt.ToString(t),o=e.length;arguments.length>1&&(n=arguments[1]);var i="undefined"==typeof n?o:nt.ToInteger(n),a=_(M(i,0),o);return N(e,a-r.length,a)===r},includes:function(t){if(nt.IsRegExp(t))throw new TypeError('"includes" does not accept a RegExp');var e,n=nt.ToString(t);return arguments.length>1&&(e=arguments[1]),A(this,n,e)!==-1},codePointAt:function(t){var e=nt.ToString(nt.RequireObjectCoercible(this)),n=nt.ToInteger(t),r=e.length;if(n>=0&&n<r){var o=e.charCodeAt(n),i=n+1===r;if(o<55296||o>56319||i)return o;var a=e.charCodeAt(n+1);return a<56320||a>57343?o:1024*(o-55296)+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",1/0)!==!1&&Z(String.prototype,"includes",Nt.includes),String.prototype.startsWith&&String.prototype.endsWith){var jt=a(function(){"/a/".startsWith(/a/)}),Rt=s(function(){return"abc".startsWith("a",1/0)===!1});jt&&Rt||(Z(String.prototype,"startsWith",Nt.startsWith),Z(String.prototype,"endsWith",Nt.endsWith))}if(J){var Bt=s(function(){var t=/a/;return t[H.match]=!1,"/a/".startsWith(t)});Bt||Z(String.prototype,"startsWith",Nt.startsWith);var Mt=s(function(){var t=/a/;return t[H.match]=!1,"/a/".endsWith(t)});Mt||Z(String.prototype,"endsWith",Nt.endsWith);var _t=s(function(){var t=/a/;return t[H.match]=!1,"/a/".includes(t)});_t||Z(String.prototype,"includes",Nt.includes)}b(String.prototype,Nt);var It=["\t\n\v\f\r   ᠎    ","         　\u2028","\u2029\ufeff"].join(""),kt=new RegExp("(^["+It+"]+)|(["+It+"]+$)","g"),Dt=function(){return nt.ToString(nt.RequireObjectCoercible(this)).replace(kt,"")},Lt=["","​","￾"].join(""),Ft=new RegExp("["+Lt+"]","g"),Gt=/^[\-+]0x[0-9a-f]+$/i,Ut=Lt.trim().length!==Lt.length;m(String.prototype,"trim",Dt,Ut);var Ht=function(t){return{value:t,done:0===arguments.length}},zt=function(t){nt.RequireObjectCoercible(t),this._s=nt.ToString(t),this._i=0};zt.prototype.next=function(){var t=this._s,e=this._i;if("undefined"==typeof t||e>=t.length)return this._s=void 0,Ht();var n,r,o=t.charCodeAt(e);return o<55296||o>56319||e+1===t.length?r=1:(n=t.charCodeAt(e+1),r=n<56320||n>57343?1:2),this._i=e+r,Ht(t.substr(e,r))},xt(zt.prototype),xt(String.prototype,function(){return new zt(this)});var Vt={from:function(t){var e,r=this;arguments.length>1&&(e=arguments[1]);var o,i;if("undefined"==typeof e)o=!1;else{if(!nt.IsCallable(e))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2]),o=!0}var a,s,l,u="undefined"!=typeof(K(t)||nt.GetMethod(t,Q));if(u){s=nt.IsConstructor(r)?Object(new r):[];var c,p,h=nt.GetIterator(t);for(l=0;;){if(c=nt.IteratorStep(h),c===!1)break;p=c.value;try{o&&(p="undefined"==typeof i?e(p,l):n(e,i,p,l)),s[l]=p}catch(t){throw nt.IteratorClose(h,!0),t}l+=1}a=l}else{var f=nt.ToObject(t);a=nt.ToLength(f.length),s=nt.IsConstructor(r)?Object(new r(a)):new Array(a);var d;for(l=0;l<a;++l)d=f[l],o&&(d="undefined"==typeof i?e(d,l):n(e,i,d,l)),Ot(s,l,d)}return s.length=a,s},of:function(){for(var t=arguments.length,e=this,n=r(e)||!nt.IsCallable(e)?new Array(t):nt.Construct(e,[t]),o=0;o<t;++o)Ot(n,o,arguments[o]);return n.length=t,n}};b(Array,Vt),wt(Array),t=function(t,e){this.i=0,this.array=t,this.kind=e},b(t.prototype,{next:function(){var e=this.i,n=this.array;if(!(this instanceof t))throw new TypeError("Not an ArrayIterator");if("undefined"!=typeof n)for(var r=nt.ToLength(n.length);e<r;e++){var o,i=this.kind;return"key"===i?o=e:"value"===i?o=n[e]:"entry"===i&&(o=[e,n[e]]),this.i=e+1,Ht(o)}return this.array=void 0,Ht()}}),xt(t.prototype);var Wt=Array.of===Vt.of||function(){var t=function(t){this.length=t};t.prototype=[];var e=Array.of.apply(t,[1,2]);return e instanceof t&&2===e.length}();Wt||Z(Array,"of",Vt.of);var $t={copyWithin:function(t,e){var n,r=nt.ToObject(this),o=nt.ToLength(r.length),i=nt.ToInteger(t),a=nt.ToInteger(e),s=i<0?M(o+i,0):_(i,o),l=a<0?M(o+a,0):_(a,o);arguments.length>2&&(n=arguments[2]);var u="undefined"==typeof n?o:nt.ToInteger(n),c=u<0?M(o+u,0):_(u,o),p=_(c-l,o-s),h=1;for(l<s&&s<l+p&&(h=-1,l+=p-1,s+=p-1);p>0;)l in r?r[s]=r[l]:delete r[s],l+=h,s+=h,p-=1;return r},fill:function(t){var e;arguments.length>1&&(e=arguments[1]);var n;arguments.length>2&&(n=arguments[2]);var r=nt.ToObject(this),o=nt.ToLength(r.length);e=nt.ToInteger("undefined"==typeof e?0:e),n=nt.ToInteger("undefined"==typeof n?o:n);for(var i=e<0?M(o+e,0):_(e,o),a=n<0?o+n:n,s=i;s<o&&s<a;++s)r[s]=t;return r},find:function(t){var e=nt.ToObject(this),r=nt.ToLength(e.length);if(!nt.IsCallable(t))throw new TypeError("Array#find: predicate must be a function");for(var o,i=arguments.length>1?arguments[1]:null,a=0;a<r;a++)if(o=e[a],i){if(n(t,i,o,a,e))return o}else if(t(o,a,e))return o},findIndex:function(t){var e=nt.ToObject(this),r=nt.ToLength(e.length);if(!nt.IsCallable(t))throw new TypeError("Array#findIndex: predicate must be a function");for(var o=arguments.length>1?arguments[1]:null,i=0;i<r;i++)if(o){if(n(t,o,e[i],i,e))return i}else if(t(e[i],i,e))return i;return-1},keys:function(){return new t(this,"key")},values:function(){return new t(this,"value")},entries:function(){return new t(this,"entry")}};if(Array.prototype.keys&&!nt.IsCallable([1].keys().next)&&delete Array.prototype.keys,Array.prototype.entries&&!nt.IsCallable([1].entries().next)&&delete Array.prototype.entries,Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[Q]&&(b(Array.prototype,{values:Array.prototype[Q]}),X.symbol(H.unscopables)&&(Array.prototype[H.unscopables].values=!0)),p&&Array.prototype.values&&"values"!==Array.prototype.values.name){var Yt=Array.prototype.values;Z(Array.prototype,"values",function(){return nt.Call(Yt,this,arguments)}),m(Array.prototype,Q,Array.prototype.values,!0)}b(Array.prototype,$t),1/[!0].indexOf(!0,-0)<0&&m(Array.prototype,"indexOf",function(t){var e=C(this,arguments);return 0===e&&1/e<0?0:e},!0),xt(Array.prototype,function(){return this.values()}),Object.getPrototypeOf&&xt(Object.getPrototypeOf([].values()));var qt=function(){return s(function(){return 0===Array.from({length:-1}).length})}(),Kt=function(){var t=Array.from([0].entries());return 1===t.length&&r(t[0])&&0===t[0][0]&&0===t[0][1]}();qt&&Kt||Z(Array,"from",Vt.from);var Xt=function(){return s(function(){return Array.from([0],void 0)})}();if(!Xt){var Zt=Array.from;Z(Array,"from",function(t){return arguments.length>1&&"undefined"!=typeof arguments[1]?nt.Call(Zt,this,arguments):n(Zt,this,t)})}var Jt=-(Math.pow(2,32)-1),Qt=function(t,e){var r={length:Jt};return r[e?(r.length>>>0)-1:0]=!0,s(function(){return n(t,r,function(){throw new RangeError("should not reach here")},[]),!0})};if(!Qt(Array.prototype.forEach)){var te=Array.prototype.forEach;Z(Array.prototype,"forEach",function(t){return nt.Call(te,this.length>=0?this:[],arguments)},!0)}if(!Qt(Array.prototype.map)){var ee=Array.prototype.map;Z(Array.prototype,"map",function(t){return nt.Call(ee,this.length>=0?this:[],arguments)},!0)}if(!Qt(Array.prototype.filter)){var ne=Array.prototype.filter;Z(Array.prototype,"filter",function(t){return nt.Call(ne,this.length>=0?this:[],arguments)},!0)}if(!Qt(Array.prototype.some)){var re=Array.prototype.some;Z(Array.prototype,"some",function(t){return nt.Call(re,this.length>=0?this:[],arguments)},!0)}if(!Qt(Array.prototype.every)){var oe=Array.prototype.every;Z(Array.prototype,"every",function(t){return nt.Call(oe,this.length>=0?this:[],arguments)},!0)}if(!Qt(Array.prototype.reduce)){var ie=Array.prototype.reduce;Z(Array.prototype,"reduce",function(t){return nt.Call(ie,this.length>=0?this:[],arguments)},!0)}if(!Qt(Array.prototype.reduceRight,!0)){var ae=Array.prototype.reduceRight;Z(Array.prototype,"reduceRight",function(t){return nt.Call(ae,this.length>=0?this:[],arguments)},!0)}var se=8!==Number("0o10"),le=2!==Number("0b10"),ue=g(Lt,function(t){return 0===Number(t+0+t)});if(se||le||ue){var ce=Number,pe=/^0b[01]+$/i,he=/^0o[0-7]+$/i,fe=pe.test.bind(pe),de=he.test.bind(he),ge=function(t){var e;if("function"==typeof t.valueOf&&(e=t.valueOf(),X.primitive(e)))return e;if("function"==typeof t.toString&&(e=t.toString(),X.primitive(e)))return e;throw new TypeError("No default value")},me=Ft.test.bind(Ft),be=Gt.test.bind(Gt),ve=function(){var t=function(e){var n;n=arguments.length>0?X.primitive(e)?e:ge(e,"number"):0,"string"==typeof n&&(n=nt.Call(Dt,n),fe(n)?n=parseInt(N(n,2),2):de(n)?n=parseInt(N(n,2),8):(me(n)||be(n))&&(n=NaN));var r=this,o=s(function(){return ce.prototype.valueOf.call(r),!0});return r instanceof t&&!o?new ce(n):ce(n)};return t}();vt(ce,ve,{}),b(ve,{NaN:ce.NaN,MAX_VALUE:ce.MAX_VALUE,MIN_VALUE:ce.MIN_VALUE,NEGATIVE_INFINITY:ce.NEGATIVE_INFINITY,POSITIVE_INFINITY:ce.POSITIVE_INFINITY}),Number=ve,w.redefine(T,"Number",ve)}var ye=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:ye,MIN_SAFE_INTEGER:-ye,EPSILON:2.220446049250313e-16,parseInt:T.parseInt,parseFloat:T.parseFloat,isFinite:W,isInteger:function(t){return W(t)&&nt.ToInteger(t)===t},isSafeInteger:function(t){return Number.isInteger(t)&&k(t)<=Number.MAX_SAFE_INTEGER},isNaN:V}),m(Number,"parseInt",T.parseInt,Number.parseInt!==T.parseInt),[,1].find(function(t,e){return 0===e})||Z(Array.prototype,"find",$t.find),0!==[,1].findIndex(function(t,e){return 0===e})&&Z(Array.prototype,"findIndex",$t.findIndex);var we=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable),xe=function(t,e){c&&we(t,e)&&Object.defineProperty(t,e,{enumerable:!1})},Se=function(){for(var t=Number(this),e=arguments.length,n=e-t,r=new Array(n<0?0:n),o=t;o<e;++o)r[o-t]=arguments[o];return r},Oe=function(t){return function(e,n){return e[n]=t[n],e}},Te=function(t,e){var n,r=o(Object(e));return nt.IsCallable(Object.getOwnPropertySymbols)&&(n=d(Object.getOwnPropertySymbols(Object(e)),we(e))),f(P(r,n||[]),Oe(e),t)},Ee={assign:function(t,e){var n=nt.ToObject(t,"Cannot convert undefined or null to object");return f(nt.Call(Se,1,arguments),Te,n)},is:function(t,e){return nt.SameValue(t,e)}},Ae=Object.assign&&Object.preventExtensions&&function(){var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch(e){return"y"===t[1]}}();if(Ae&&Z(Object,"assign",Ee.assign),b(Object,Ee),c){var Ce={setPrototypeOf:function(t,e){var r,o=function(t,e){if(!nt.TypeIsObject(t))throw new TypeError("cannot set prototype on a non-object");if(null!==e&&!nt.TypeIsObject(e))throw new TypeError("can only set prototype to an object or null"+e)},i=function(t,e){return o(t,e),n(r,t,e),t};try{r=t.getOwnPropertyDescriptor(t.prototype,e).set,n(r,{},null)}catch(n){if(t.prototype!=={}[e])return;r=function(t){this[e]=t},i.polyfill=i(i({},null),t.prototype)instanceof t}return i}(Object,"__proto__")};b(Object,Ce)}Object.setPrototypeOf&&Object.getPrototypeOf&&null!==Object.getPrototypeOf(Object.setPrototypeOf({},null))&&null===Object.getPrototypeOf(Object.create(null))&&!function(){var t=Object.create(null),e=Object.getPrototypeOf,n=Object.setPrototypeOf;Object.getPrototypeOf=function(n){var r=e(n);return r===t?null:r},Object.setPrototypeOf=function(e,r){var o=null===r?t:r;return n(e,o)},Object.setPrototypeOf.polyfill=!1}();var Pe=!a(function(){Object.keys("foo")});if(!Pe){var Ne=Object.keys;Z(Object,"keys",function(t){return Ne(nt.ToObject(t))}),o=Object.keys}var je=a(function(){Object.keys(/a/g)});if(je){var Re=Object.keys;Z(Object,"keys",function(t){if(X.regex(t)){var e=[];for(var n in t)G(t,n)&&j(e,n);return e}return Re(t)}),o=Object.keys}if(Object.getOwnPropertyNames){var Be=!a(function(){Object.getOwnPropertyNames("foo")});if(!Be){var Me="object"==typeof window?Object.getOwnPropertyNames(window):[],_e=Object.getOwnPropertyNames;Z(Object,"getOwnPropertyNames",function(t){var e=nt.ToObject(t);if("[object Window]"===v(e))try{return _e(e)}catch(t){return P([],Me)}return _e(e)})}}if(Object.getOwnPropertyDescriptor){var Ie=!a(function(){Object.getOwnPropertyDescriptor("foo","bar")});if(!Ie){var ke=Object.getOwnPropertyDescriptor;Z(Object,"getOwnPropertyDescriptor",function(t,e){return ke(nt.ToObject(t),e)})}}if(Object.seal){var De=!a(function(){Object.seal("foo")});if(!De){var Le=Object.seal;Z(Object,"seal",function(t){return nt.TypeIsObject(t)?Le(t):t})}}if(Object.isSealed){var Fe=!a(function(){Object.isSealed("foo")});if(!Fe){var Ge=Object.isSealed;Z(Object,"isSealed",function(t){return!nt.TypeIsObject(t)||Ge(t)})}}if(Object.freeze){var Ue=!a(function(){Object.freeze("foo")});if(!Ue){var He=Object.freeze;Z(Object,"freeze",function(t){return nt.TypeIsObject(t)?He(t):t})}}if(Object.isFrozen){var ze=!a(function(){Object.isFrozen("foo")});if(!ze){var Ve=Object.isFrozen;Z(Object,"isFrozen",function(t){return!nt.TypeIsObject(t)||Ve(t)})}}if(Object.preventExtensions){var We=!a(function(){Object.preventExtensions("foo")});if(!We){var $e=Object.preventExtensions;Z(Object,"preventExtensions",function(t){return nt.TypeIsObject(t)?$e(t):t})}}if(Object.isExtensible){var Ye=!a(function(){Object.isExtensible("foo")});if(!Ye){var qe=Object.isExtensible;Z(Object,"isExtensible",function(t){return!!nt.TypeIsObject(t)&&qe(t)})}}if(Object.getPrototypeOf){var Ke=!a(function(){Object.getPrototypeOf("foo")});if(!Ke){var Xe=Object.getPrototypeOf;Z(Object,"getPrototypeOf",function(t){return Xe(nt.ToObject(t))})}}var Ze=c&&function(){var t=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return t&&nt.IsCallable(t.get)}();if(c&&!Ze){var Je=function(){if(!nt.TypeIsObject(this))throw new TypeError("Method called on incompatible type: must be an object.");var t="";return this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.unicode&&(t+="u"),this.sticky&&(t+="y"),t};w.getter(RegExp.prototype,"flags",Je)}var Qe=c&&s(function(){return"/a/i"===String(new RegExp(/a/g,"i"))}),tn=J&&c&&function(){var t=/./;return t[H.match]=!1,RegExp(t)===t}(),en=s(function(){return"/abc/"===RegExp.prototype.toString.call({source:"abc"})}),nn=en&&s(function(){return"/a/b"===RegExp.prototype.toString.call({source:"a",flags:"b"})});if(!en||!nn){var rn=RegExp.prototype.toString;m(RegExp.prototype,"toString",function(){var t=nt.RequireObjectCoercible(this);if(X.regex(t))return n(rn,t);var e=et(t.source),r=et(t.flags);return"/"+e+"/"+r},!0),w.preserveToString(RegExp.prototype.toString,rn)}if(c&&(!Qe||tn)){var on=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get,an=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{},sn=function(){return this.source},ln=nt.IsCallable(an.get)?an.get:sn,un=RegExp,cn=function(){return function t(e,n){var r=nt.IsRegExp(e),o=this instanceof t;if(!o&&r&&"undefined"==typeof n&&e.constructor===t)return e;var i=e,a=n;return X.regex(e)?(i=nt.Call(ln,e),a="undefined"==typeof n?nt.Call(on,e):n,new t(i,a)):(r&&(i=e.source,a="undefined"==typeof n?e.flags:n),new un(e,n))}}();vt(un,cn,{$input:!0}),RegExp=cn,w.redefine(T,"RegExp",cn)}if(c){var pn={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};h(o(pn),function(t){t in RegExp&&!(pn[t]in RegExp)&&w.getter(RegExp,pn[t],function(){return RegExp[t]})})}wt(RegExp);var hn=1/Number.EPSILON,fn=function(t){return t+hn-hn},dn=Math.pow(2,-23),gn=Math.pow(2,127)*(2-dn),mn=Math.pow(2,-126),bn=Math.E,vn=Math.LOG2E,yn=Math.LOG10E,wn=Number.prototype.clz;delete Number.prototype.clz;var xn={acosh:function(t){var e=Number(t);return V(e)||t<1?NaN:1===e?0:e===1/0?e:L(e/bn+F(e+1)*F(e-1)/bn)+1},asinh:function t(e){var n=Number(e);return 0!==n&&E(n)?n<0?-t(-n):L(n+F(n*n+1)):n},atanh:function(t){var e=Number(t);return V(e)||e<-1||e>1?NaN:e===-1?-(1/0):1===e?1/0:0===e?e:.5*L((1+e)/(1-e))},cbrt:function(t){var e=Number(t);if(0===e)return e;var n,r=e<0;return r&&(e=-e),e===1/0?n=1/0:(n=D(L(e)/3),n=(e/(n*n)+2*n)/3),r?-n:n},clz32:function(t){var e=Number(t),n=nt.ToUint32(e);return 0===n?32:wn?nt.Call(wn,n):31-I(L(n+.5)*vn)},cosh:function(t){var e=Number(t);return 0===e?1:V(e)?NaN:E(e)?(e<0&&(e=-e),e>21?D(e)/2:(D(e)+D(-e))/2):1/0},expm1:function(t){var e=Number(t);if(e===-(1/0))return-1;if(!E(e)||0===e)return e;if(k(e)>.5)return D(e)-1;for(var n=e,r=0,o=1;r+n!==r;)r+=n,o+=1,n*=e/o;return r},hypot:function(t,e){for(var n=0,r=0,o=0;o<arguments.length;++o){var i=k(Number(arguments[o]));r<i?(n*=r/i*(r/i),n+=1,r=i):n+=i>0?i/r*(i/r):i}return r===1/0?1/0:r*F(n)},log2:function(t){return L(t)*vn},log10:function(t){return L(t)*yn},log1p:function(t){var e=Number(t);return e<-1||V(e)?NaN:0===e||e===1/0?e:e===-1?-(1/0):1+e-1===0?e:e*(L(1+e)/(1+e-1))},sign:$,sinh:function(t){var e=Number(t);return E(e)&&0!==e?k(e)<1?(Math.expm1(e)-Math.expm1(-e))/2:(D(e-1)-D(-e-1))*bn/2:e},tanh:function(t){var e=Number(t);return V(e)||0===e?e:e>=20?1:e<=-20?-1:(Math.expm1(e)-Math.expm1(-e))/(D(e)+D(-e))},trunc:function(t){var e=Number(t);return e<0?-I(-e):I(e)},imul:function(t,e){var n=nt.ToUint32(t),r=nt.ToUint32(e),o=n>>>16&65535,i=65535&n,a=r>>>16&65535,s=65535&r;return i*s+(o*s+i*a<<16>>>0)|0},fround:function(t){var e=Number(t);if(0===e||e===1/0||e===-(1/0)||V(e))return e;var n=$(e),r=k(e);if(r<mn)return n*fn(r/mn/dn)*mn*dn;var o=(1+dn/Number.EPSILON)*r,i=o-(o-r);return i>gn||V(i)?n*(1/0):n*i}};b(Math,xn),m(Math,"log1p",xn.log1p,Math.log1p(-1e-17)!==-1e-17),m(Math,"asinh",xn.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7)),m(Math,"tanh",xn.tanh,Math.tanh(-2e-17)!==-2e-17),m(Math,"acosh",xn.acosh,Math.acosh(Number.MAX_VALUE)===1/0),m(Math,"cbrt",xn.cbrt,Math.abs(1-Math.cbrt(1e-300)/1e-100)/Number.EPSILON>8),m(Math,"sinh",xn.sinh,Math.sinh(-2e-17)!==-2e-17);var Sn=Math.expm1(10);m(Math,"expm1",xn.expm1,Sn>22025.465794806718||Sn<22025.465794806718);var On=Math.round,Tn=0===Math.round(.5-Number.EPSILON/4)&&1===Math.round(-.5+Number.EPSILON/3.99),En=hn+1,An=2*hn-1,Cn=[En,An].every(function(t){return Math.round(t)===t});m(Math,"round",function(t){var e=I(t),n=e===-1?-0:e+1;return t-e<.5?e:n},!Tn||!Cn),w.preserveToString(Math.round,On);var Pn=Math.imul;Math.imul(4294967295,5)!==-5&&(Math.imul=xn.imul,w.preserveToString(Math.imul,Pn)),2!==Math.imul.length&&Z(Math,"imul",function(t,e){return nt.Call(Pn,Math,arguments)});var Nn=function(){var t=T.setTimeout;if("function"==typeof t||"object"==typeof t){nt.IsPromise=function(t){return!!nt.TypeIsObject(t)&&"undefined"!=typeof t._promise};var e,r=function(t){if(!nt.IsConstructor(t))throw new TypeError("Bad promise constructor");var e=this,n=function(t,n){if(void 0!==e.resolve||void 0!==e.reject)throw new TypeError("Bad Promise implementation!");e.resolve=t,e.reject=n};if(e.resolve=void 0,e.reject=void 0,e.promise=new t(n),!nt.IsCallable(e.resolve)||!nt.IsCallable(e.reject))throw new TypeError("Bad promise constructor")};"undefined"!=typeof window&&nt.IsCallable(window.postMessage)&&(e=function(){var t=[],e="zero-timeout-message",n=function(n){j(t,n),window.postMessage(e,"*")},r=function(n){if(n.source===window&&n.data===e){if(n.stopPropagation(),0===t.length)return;var r=B(t);r()}};return window.addEventListener("message",r,!0),n});var o,i,a=function(){var t=T.Promise,e=t&&t.resolve&&t.resolve();return e&&function(t){return e.then(t)}},s=nt.IsCallable(T.setImmediate)?T.setImmediate:"object"==typeof process&&process.nextTick?process.nextTick:a()||(nt.IsCallable(e)?e():function(e){t(e,0)}),l=function(t){return t},u=function(t){throw t},c=0,p=1,h=2,f=0,d=1,g=2,m={},v=function(t,e,n){s(function(){y(t,e,n)})},y=function(t,e,n){var r,o;if(e===m)return t(n);try{r=t(n),o=e.resolve}catch(t){r=t,o=e.reject}o(r)},w=function(t,e){var n=t._promise,r=n.reactionLength;if(r>0&&(v(n.fulfillReactionHandler0,n.reactionCapability0,e),n.fulfillReactionHandler0=void 0,n.rejectReactions0=void 0,n.reactionCapability0=void 0,r>1))for(var o=1,i=0;o<r;o++,i+=3)v(n[i+f],n[i+g],e),t[i+f]=void 0,t[i+d]=void 0,t[i+g]=void 0;n.result=e,n.state=p,n.reactionLength=0},x=function(t,e){var n=t._promise,r=n.reactionLength;if(r>0&&(v(n.rejectReactionHandler0,n.reactionCapability0,e),n.fulfillReactionHandler0=void 0,n.rejectReactions0=void 0,n.reactionCapability0=void 0,r>1))for(var o=1,i=0;o<r;o++,i+=3)v(n[i+d],n[i+g],e),t[i+f]=void 0,t[i+d]=void 0,t[i+g]=void 0;n.result=e,n.state=h,n.reactionLength=0},S=function(t){var e=!1,n=function(n){var r;if(!e){if(e=!0,n===t)return x(t,new TypeError("Self resolution"));if(!nt.TypeIsObject(n))return w(t,n);try{r=n.then}catch(e){return x(t,e)}return nt.IsCallable(r)?void s(function(){E(t,n,r)}):w(t,n)}},r=function(n){if(!e)return e=!0,x(t,n)};return{resolve:n,reject:r}},O=function(t,e,r,o){t===i?n(t,e,r,o,m):n(t,e,r,o)},E=function(t,e,n){var r=S(t),o=r.resolve,i=r.reject;try{O(n,e,o,i)}catch(t){i(t)}},A=function(){var t=function(e){if(!(this instanceof t))throw new TypeError('Constructor Promise requires "new"');if(this&&this._promise)throw new TypeError("Bad construction");if(!nt.IsCallable(e))throw new TypeError("not a valid resolver");var n=Tt(this,t,o,{_promise:{result:void 0,state:c,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}}),r=S(n),i=r.reject;try{e(r.resolve,i)}catch(t){i(t)}return n};return t}();o=A.prototype;var C=function(t,e,n,r){var o=!1;return function(i){if(!o&&(o=!0,e[t]=i,0===--r.count)){var a=n.resolve;a(e)}}},P=function(t,e,n){for(var r,o,i=t.iterator,a=[],s={count:1},l=0;;){try{if(r=nt.IteratorStep(i),r===!1){t.done=!0;break}o=r.value}catch(e){throw t.done=!0,e}a[l]=void 0;var u=e.resolve(o),c=C(l,a,n,s);s.count+=1,O(u.then,u,c,n.reject),l+=1}if(0===--s.count){var p=n.resolve;p(a)}return n.promise},N=function(t,e,n){for(var r,o,i,a=t.iterator;;){try{if(r=nt.IteratorStep(a),r===!1){t.done=!0;break}o=r.value}catch(e){throw t.done=!0,e}i=e.resolve(o),O(i.then,i,n.resolve,n.reject)}return n.promise};return b(A,{all:function(t){var e=this;if(!nt.TypeIsObject(e))throw new TypeError("Promise is not object");var n,o,i=new r(e);try{return n=nt.GetIterator(t),o={iterator:n,done:!1},P(o,e,i)}catch(t){var a=t;if(o&&!o.done)try{nt.IteratorClose(n,!0)}catch(t){a=t}var s=i.reject;return s(a),i.promise}},race:function(t){var e=this;if(!nt.TypeIsObject(e))throw new TypeError("Promise is not object");var n,o,i=new r(e);try{return n=nt.GetIterator(t),o={iterator:n,done:!1},N(o,e,i)}catch(t){var a=t;if(o&&!o.done)try{nt.IteratorClose(n,!0)}catch(t){a=t}var s=i.reject;return s(a),i.promise}},reject:function(t){var e=this;if(!nt.TypeIsObject(e))throw new TypeError("Bad promise constructor");var n=new r(e),o=n.reject;return o(t),n.promise},resolve:function(t){var e=this;if(!nt.TypeIsObject(e))throw new TypeError("Bad promise constructor");if(nt.IsPromise(t)){var n=t.constructor;if(n===e)return t}var o=new r(e),i=o.resolve;return i(t),o.promise}}),b(o,{catch:function(t){return this.then(null,t)},then:function(t,e){var n=this;if(!nt.IsPromise(n))throw new TypeError("not a promise");var o,i=nt.SpeciesConstructor(n,A),a=arguments.length>2&&arguments[2]===m;o=a&&i===A?m:new r(i);var s,b=nt.IsCallable(t)?t:l,y=nt.IsCallable(e)?e:u,w=n._promise;if(w.state===c){if(0===w.reactionLength)w.fulfillReactionHandler0=b,w.rejectReactionHandler0=y,w.reactionCapability0=o;else{var x=3*(w.reactionLength-1);w[x+f]=b,w[x+d]=y,w[x+g]=o}w.reactionLength+=1}else if(w.state===p)s=w.result,v(b,o,s);else{if(w.state!==h)throw new TypeError("unexpected Promise state");s=w.result,v(y,o,s)}return o.promise}}),m=new r(A),i=o.then,A}}();if(T.Promise&&(delete T.Promise.accept,delete T.Promise.defer,delete T.Promise.prototype.chain),"function"==typeof Nn){b(T,{Promise:Nn});var jn=S(T.Promise,function(t){return t.resolve(42).then(function(){})instanceof t}),Rn=!a(function(){T.Promise.reject(42).then(null,5).then(null,U)}),Bn=a(function(){T.Promise.call(3,U)}),Mn=function(t){var e=t.resolve(5);e.constructor={};var n=t.resolve(e);try{n.then(null,U).then(null,U)}catch(t){return!0}return e===n}(T.Promise),_n=c&&function(){var t=0,e=Object.defineProperty({},"then",{get:function(){t+=1}});return Promise.resolve(e),1===t}(),In=function t(e){var n=new Promise(e);e(3,function(){}),this.then=n.then,this.constructor=t};In.prototype=Promise.prototype,In.all=Promise.all;var kn=s(function(){return!!In.all([1,2])});if(jn&&Rn&&Bn&&!Mn&&_n&&!kn||(Promise=Nn,Z(T,"Promise",Nn)),1!==Promise.all.length){var Dn=Promise.all;Z(Promise,"all",function(t){return nt.Call(Dn,this,arguments)})}if(1!==Promise.race.length){var Ln=Promise.race;Z(Promise,"race",function(t){return nt.Call(Ln,this,arguments)})}if(1!==Promise.resolve.length){var Fn=Promise.resolve;Z(Promise,"resolve",function(t){return nt.Call(Fn,this,arguments)})}if(1!==Promise.reject.length){var Gn=Promise.reject;Z(Promise,"reject",function(t){return nt.Call(Gn,this,arguments)})}xe(Promise,"all"),xe(Promise,"race"),xe(Promise,"resolve"),xe(Promise,"reject"),wt(Promise)}var Un=function(t){var e=o(f(t,function(t,e){return t[e]=!0,t},{}));return t.join(":")===e.join(":")},Hn=Un(["z","a","bb"]),zn=Un(["z",1,"a","3",2]);if(c){var Vn=function(t){return Hn?"undefined"==typeof t||null===t?"^"+nt.ToString(t):"string"==typeof t?"$"+t:"number"==typeof t?zn?t:"n"+t:"boolean"==typeof t?"b"+t:null:null},Wn=function(){return Object.create?Object.create(null):{}},$n=function(t,e,o){if(r(o)||X.string(o))h(o,function(t){if(!nt.TypeIsObject(t))throw new TypeError("Iterator value "+t+" is not an entry object");e.set(t[0],t[1])});else if(o instanceof t)n(t.prototype.forEach,o,function(t,n){e.set(n,t)});else{var i,a;if(null!==o&&"undefined"!=typeof o){if(a=e.set,!nt.IsCallable(a))throw new TypeError("bad map");i=nt.GetIterator(o)}if("undefined"!=typeof i)for(;;){var s=nt.IteratorStep(i);if(s===!1)break;var l=s.value;try{if(!nt.TypeIsObject(l))throw new TypeError("Iterator value "+l+" is not an entry object");n(a,e,l[0],l[1])}catch(t){throw nt.IteratorClose(i,!0),t}}}},Yn=function(t,e,o){if(r(o)||X.string(o))h(o,function(t){e.add(t)});else if(o instanceof t)n(t.prototype.forEach,o,function(t){e.add(t)});else{var i,a;if(null!==o&&"undefined"!=typeof o){if(a=e.add,!nt.IsCallable(a))throw new TypeError("bad set");i=nt.GetIterator(o)}if("undefined"!=typeof i)for(;;){var s=nt.IteratorStep(i);if(s===!1)break;var l=s.value;try{n(a,e,l)}catch(t){throw nt.IteratorClose(i,!0),t}}}},qn={Map:function(){var t={},e=function(t,e){this.key=t,this.value=e,this.next=null,this.prev=null};e.prototype.isRemoved=function(){return this.key===t};var r=function(t){return!!t._es6map},o=function(t,e){if(!nt.TypeIsObject(t)||!r(t))throw new TypeError("Method Map.prototype."+e+" called on incompatible receiver "+nt.ToString(t))},i=function(t,e){o(t,"[[MapIterator]]"),this.head=t._head,this.i=this.head,this.kind=e};i.prototype={next:function(){var t=this.i,e=this.kind,n=this.head;if("undefined"==typeof this.i)return Ht();for(;t.isRemoved()&&t!==n;)t=t.prev;for(var r;t.next!==n;)if(t=t.next,!t.isRemoved())return r="key"===e?t.key:"value"===e?t.value:[t.key,t.value],this.i=t,Ht(r);return this.i=void 0,Ht()}},xt(i.prototype);var a,s=function t(){if(!(this instanceof t))throw new TypeError('Constructor Map requires "new"');if(this&&this._es6map)throw new TypeError("Bad construction");var n=Tt(this,t,a,{_es6map:!0,_head:null,_storage:Wn(),_size:0}),r=new e(null,null);return r.next=r.prev=r,n._head=r,arguments.length>0&&$n(t,n,arguments[0]),n};return a=s.prototype,w.getter(a,"size",function(){if("undefined"==typeof this._size)throw new TypeError("size method called on incompatible Map");return this._size}),b(a,{get:function(t){o(this,"get");var e=Vn(t);if(null!==e){var n=this._storage[e];return n?n.value:void 0}for(var r=this._head,i=r;(i=i.next)!==r;)if(nt.SameValueZero(i.key,t))return i.value},has:function(t){o(this,"has");var e=Vn(t);if(null!==e)return"undefined"!=typeof this._storage[e];for(var n=this._head,r=n;(r=r.next)!==n;)if(nt.SameValueZero(r.key,t))return!0;return!1},set:function(t,n){o(this,"set");var r,i=this._head,a=i,s=Vn(t);if(null!==s){if("undefined"!=typeof this._storage[s])return this._storage[s].value=n,this;r=this._storage[s]=new e(t,n),a=i.prev}for(;(a=a.next)!==i;)if(nt.SameValueZero(a.key,t))return a.value=n,this;return r=r||new e(t,n),nt.SameValue(-0,t)&&(r.key=0),r.next=this._head,r.prev=this._head.prev,r.prev.next=r,r.next.prev=r,this._size+=1,this},delete:function(e){o(this,"delete");var n=this._head,r=n,i=Vn(e);if(null!==i){if("undefined"==typeof this._storage[i])return!1;r=this._storage[i].prev,delete this._storage[i]}for(;(r=r.next)!==n;)if(nt.SameValueZero(r.key,e))return r.key=r.value=t,r.prev.next=r.next,r.next.prev=r.prev,this._size-=1,!0;return!1},clear:function(){o(this,"clear"),this._size=0,this._storage=Wn();for(var e=this._head,n=e,r=n.next;(n=r)!==e;)n.key=n.value=t,r=n.next,n.next=n.prev=e;e.next=e.prev=e},keys:function(){return o(this,"keys"),new i(this,"key")},values:function(){return o(this,"values"),new i(this,"value")},entries:function(){return o(this,"entries"),new i(this,"key+value")},forEach:function(t){o(this,"forEach");for(var e=arguments.length>1?arguments[1]:null,r=this.entries(),i=r.next();!i.done;i=r.next())e?n(t,e,i.value[1],i.value[0],this):t(i.value[1],i.value[0],this)}}),xt(a,a.entries),s}(),Set:function(){var t,e=function(t){return t._es6set&&"undefined"!=typeof t._storage},r=function(t,n){if(!nt.TypeIsObject(t)||!e(t))throw new TypeError("Set.prototype."+n+" called on incompatible receiver "+nt.ToString(t))},i=function e(){if(!(this instanceof e))throw new TypeError('Constructor Set requires "new"');if(this&&this._es6set)throw new TypeError("Bad construction");var n=Tt(this,e,t,{_es6set:!0,"[[SetData]]":null,_storage:Wn()});if(!n._es6set)throw new TypeError("bad set");return arguments.length>0&&Yn(e,n,arguments[0]),n};t=i.prototype;var a=function(t){var e=t;if("^null"===e)return null;if("^undefined"!==e){var n=e.charAt(0);return"$"===n?N(e,1):"n"===n?+N(e,1):"b"===n?"btrue"===e:+e}},s=function(t){if(!t["[[SetData]]"]){var e=t["[[SetData]]"]=new qn.Map;h(o(t._storage),function(t){var n=a(t);e.set(n,n)}),t["[[SetData]]"]=e}t._storage=null};return w.getter(i.prototype,"size",function(){return r(this,"size"),this._storage?o(this._storage).length:(s(this),this["[[SetData]]"].size)}),b(i.prototype,{has:function(t){r(this,"has");var e;return this._storage&&null!==(e=Vn(t))?!!this._storage[e]:(s(this),this["[[SetData]]"].has(t))},add:function(t){r(this,"add");var e;return this._storage&&null!==(e=Vn(t))?(this._storage[e]=!0,this):(s(this),this["[[SetData]]"].set(t,t),this)},delete:function(t){r(this,"delete");var e;if(this._storage&&null!==(e=Vn(t))){var n=G(this._storage,e);return delete this._storage[e]&&n}return s(this),this["[[SetData]]"].delete(t);
},clear:function(){r(this,"clear"),this._storage&&(this._storage=Wn()),this["[[SetData]]"]&&this["[[SetData]]"].clear()},values:function(){return r(this,"values"),s(this),this["[[SetData]]"].values()},entries:function(){return r(this,"entries"),s(this),this["[[SetData]]"].entries()},forEach:function(t){r(this,"forEach");var e=arguments.length>1?arguments[1]:null,o=this;s(o),this["[[SetData]]"].forEach(function(r,i){e?n(t,e,i,i,o):t(i,i,o)})}}),m(i.prototype,"keys",i.prototype.values,!0),xt(i.prototype,i.prototype.values),i}()};if(T.Map||T.Set){var Kn=s(function(){return 2===new Map([[1,2]]).get(1)});if(!Kn){var Xn=T.Map;T.Map=function t(){if(!(this instanceof t))throw new TypeError('Constructor Map requires "new"');var e=new Xn;return arguments.length>0&&$n(t,e,arguments[0]),delete e.constructor,Object.setPrototypeOf(e,T.Map.prototype),e},T.Map.prototype=x(Xn.prototype),m(T.Map.prototype,"constructor",T.Map,!0),w.preserveToString(T.Map,Xn)}var Zn=new Map,Jn=function(){var t=new Map([[1,0],[2,0],[3,0],[4,0]]);return t.set(-0,t),t.get(0)===t&&t.get(-0)===t&&t.has(0)&&t.has(-0)}(),Qn=Zn.set(1,2)===Zn;if(!Jn||!Qn){var tr=Map.prototype.set;Z(Map.prototype,"set",function(t,e){return n(tr,this,0===t?0:t,e),this})}if(!Jn){var er=Map.prototype.get,nr=Map.prototype.has;b(Map.prototype,{get:function(t){return n(er,this,0===t?0:t)},has:function(t){return n(nr,this,0===t?0:t)}},!0),w.preserveToString(Map.prototype.get,er),w.preserveToString(Map.prototype.has,nr)}var rr=new Set,or=function(t){return t.delete(0),t.add(-0),!t.has(0)}(rr),ir=rr.add(1)===rr;if(!or||!ir){var ar=Set.prototype.add;Set.prototype.add=function(t){return n(ar,this,0===t?0:t),this},w.preserveToString(Set.prototype.add,ar)}if(!or){var sr=Set.prototype.has;Set.prototype.has=function(t){return n(sr,this,0===t?0:t)},w.preserveToString(Set.prototype.has,sr);var lr=Set.prototype.delete;Set.prototype.delete=function(t){return n(lr,this,0===t?0:t)},w.preserveToString(Set.prototype.delete,lr)}var ur=S(T.Map,function(t){var e=new t([]);return e.set(42,42),e instanceof t}),cr=Object.setPrototypeOf&&!ur,pr=function(){try{return!(T.Map()instanceof T.Map)}catch(t){return t instanceof TypeError}}();if(0!==T.Map.length||cr||!pr){var hr=T.Map;T.Map=function t(){if(!(this instanceof t))throw new TypeError('Constructor Map requires "new"');var e=new hr;return arguments.length>0&&$n(t,e,arguments[0]),delete e.constructor,Object.setPrototypeOf(e,t.prototype),e},T.Map.prototype=hr.prototype,m(T.Map.prototype,"constructor",T.Map,!0),w.preserveToString(T.Map,hr)}var fr=S(T.Set,function(t){var e=new t([]);return e.add(42,42),e instanceof t}),dr=Object.setPrototypeOf&&!fr,gr=function(){try{return!(T.Set()instanceof T.Set)}catch(t){return t instanceof TypeError}}();if(0!==T.Set.length||dr||!gr){var mr=T.Set;T.Set=function t(){if(!(this instanceof t))throw new TypeError('Constructor Set requires "new"');var e=new mr;return arguments.length>0&&Yn(t,e,arguments[0]),delete e.constructor,Object.setPrototypeOf(e,t.prototype),e},T.Set.prototype=mr.prototype,m(T.Set.prototype,"constructor",T.Set,!0),w.preserveToString(T.Set,mr)}var br=new T.Map,vr=!s(function(){return br.keys().next().done});if(("function"!=typeof T.Map.prototype.clear||0!==(new T.Set).size||0!==br.size||"function"!=typeof T.Map.prototype.keys||"function"!=typeof T.Set.prototype.keys||"function"!=typeof T.Map.prototype.forEach||"function"!=typeof T.Set.prototype.forEach||l(T.Map)||l(T.Set)||"function"!=typeof br.keys().next||vr||!ur)&&b(T,{Map:qn.Map,Set:qn.Set},!0),T.Set.prototype.keys!==T.Set.prototype.values&&m(T.Set.prototype,"keys",T.Set.prototype.values,!0),xt(Object.getPrototypeOf((new T.Map).keys())),xt(Object.getPrototypeOf((new T.Set).keys())),p&&"has"!==T.Set.prototype.has.name){var yr=T.Set.prototype.has;Z(T.Set.prototype,"has",function(t){return n(yr,this,t)})}}b(T,qn),wt(T.Map),wt(T.Set)}var wr=function(t){if(!nt.TypeIsObject(t))throw new TypeError("target must be an object")},xr={apply:function(){return nt.Call(nt.Call,null,arguments)},construct:function(t,e){if(!nt.IsConstructor(t))throw new TypeError("First argument must be a constructor.");var n=arguments.length>2?arguments[2]:t;if(!nt.IsConstructor(n))throw new TypeError("new.target must be a constructor.");return nt.Construct(t,e,n,"internal")},deleteProperty:function(t,e){if(wr(t),c){var n=Object.getOwnPropertyDescriptor(t,e);if(n&&!n.configurable)return!1}return delete t[e]},has:function(t,e){return wr(t),e in t}};Object.getOwnPropertyNames&&Object.assign(xr,{ownKeys:function(t){wr(t);var e=Object.getOwnPropertyNames(t);return nt.IsCallable(Object.getOwnPropertySymbols)&&R(e,Object.getOwnPropertySymbols(t)),e}});var Sr=function(t){return!a(t)};if(Object.preventExtensions&&Object.assign(xr,{isExtensible:function(t){return wr(t),Object.isExtensible(t)},preventExtensions:function(t){return wr(t),Sr(function(){Object.preventExtensions(t)})}}),c){var Or=function(t,e,n){var r=Object.getOwnPropertyDescriptor(t,e);if(!r){var o=Object.getPrototypeOf(t);if(null===o)return;return Or(o,e,n)}return"value"in r?r.value:r.get?nt.Call(r.get,n):void 0},Tr=function(t,e,r,o){var i=Object.getOwnPropertyDescriptor(t,e);if(!i){var a=Object.getPrototypeOf(t);if(null!==a)return Tr(a,e,r,o);i={value:void 0,writable:!0,enumerable:!0,configurable:!0}}if("value"in i){if(!i.writable)return!1;if(!nt.TypeIsObject(o))return!1;var s=Object.getOwnPropertyDescriptor(o,e);return s?tt.defineProperty(o,e,{value:r}):tt.defineProperty(o,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}return!!i.set&&(n(i.set,o,r),!0)};Object.assign(xr,{defineProperty:function(t,e,n){return wr(t),Sr(function(){Object.defineProperty(t,e,n)})},getOwnPropertyDescriptor:function(t,e){return wr(t),Object.getOwnPropertyDescriptor(t,e)},get:function(t,e){wr(t);var n=arguments.length>2?arguments[2]:t;return Or(t,e,n)},set:function(t,e,n){wr(t);var r=arguments.length>3?arguments[3]:t;return Tr(t,e,n,r)}})}if(Object.getPrototypeOf){var Er=Object.getPrototypeOf;xr.getPrototypeOf=function(t){return wr(t),Er(t)}}if(Object.setPrototypeOf&&xr.getPrototypeOf){var Ar=function(t,e){for(var n=e;n;){if(t===n)return!0;n=xr.getPrototypeOf(n)}return!1};Object.assign(xr,{setPrototypeOf:function(t,e){if(wr(t),null!==e&&!nt.TypeIsObject(e))throw new TypeError("proto must be an object or null");return e===tt.getPrototypeOf(t)||!(tt.isExtensible&&!tt.isExtensible(t))&&(!Ar(t,e)&&(Object.setPrototypeOf(t,e),!0))}})}var Cr=function(t,e){if(nt.IsCallable(T.Reflect[t])){var n=s(function(){return T.Reflect[t](1),T.Reflect[t](NaN),T.Reflect[t](!0),!0});n&&Z(T.Reflect,t,e)}else m(T.Reflect,t,e)};Object.keys(xr).forEach(function(t){Cr(t,xr[t])});var Pr=T.Reflect.getPrototypeOf;if(p&&Pr&&"getPrototypeOf"!==Pr.name&&Z(T.Reflect,"getPrototypeOf",function(t){return n(Pr,T.Reflect,t)}),T.Reflect.setPrototypeOf&&s(function(){return T.Reflect.setPrototypeOf(1,{}),!0})&&Z(T.Reflect,"setPrototypeOf",xr.setPrototypeOf),T.Reflect.defineProperty&&(s(function(){var t=!T.Reflect.defineProperty(1,"test",{value:1}),e="function"!=typeof Object.preventExtensions||!T.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return t&&e})||Z(T.Reflect,"defineProperty",xr.defineProperty)),T.Reflect.construct&&(s(function(){var t=function(){};return T.Reflect.construct(function(){},[],t)instanceof t})||Z(T.Reflect,"construct",xr.construct)),"Invalid Date"!==String(new Date(NaN))){var Nr=Date.prototype.toString,jr=function(){var t=+this;return t!==t?"Invalid Date":nt.Call(Nr,this)};Z(Date.prototype,"toString",jr)}var Rr={anchor:function(t){return nt.CreateHTML(this,"a","name",t)},big:function(){return nt.CreateHTML(this,"big","","")},blink:function(){return nt.CreateHTML(this,"blink","","")},bold:function(){return nt.CreateHTML(this,"b","","")},fixed:function(){return nt.CreateHTML(this,"tt","","")},fontcolor:function(t){return nt.CreateHTML(this,"font","color",t)},fontsize:function(t){return nt.CreateHTML(this,"font","size",t)},italics:function(){return nt.CreateHTML(this,"i","","")},link:function(t){return nt.CreateHTML(this,"a","href",t)},small:function(){return nt.CreateHTML(this,"small","","")},strike:function(){return nt.CreateHTML(this,"strike","","")},sub:function(){return nt.CreateHTML(this,"sub","","")},sup:function(){return nt.CreateHTML(this,"sup","","")}};h(Object.keys(Rr),function(t){var e=String.prototype[t],r=!1;if(nt.IsCallable(e)){var o=n(e,"",' " '),i=P([],o.match(/"/g)).length;r=o!==o.toLowerCase()||i>2}else r=!0;r&&Z(String.prototype,t,Rr[t])});var Br=function(){if(!J)return!1;var t="object"==typeof JSON&&"function"==typeof JSON.stringify?JSON.stringify:null;if(!t)return!1;if("undefined"!=typeof t(H()))return!0;if("[null]"!==t([H()]))return!0;var e={a:H()};return e[H()]=!0,"{}"!==t(e)}(),Mr=s(function(){return!J||"{}"===JSON.stringify(Object(H()))&&"[{}]"===JSON.stringify([Object(H())])});if(Br||!Mr){var _r=JSON.stringify;Z(JSON,"stringify",function(t){if("symbol"!=typeof t){var e;arguments.length>1&&(e=arguments[1]);var o=[t];if(r(e))o.push(e);else{var i=nt.IsCallable(e)?e:null,a=function(t,e){var r=i?n(i,this,t,e):e;if("symbol"!=typeof r)return X.symbol(r)?Oe({})(r):r};o.push(a)}return arguments.length>2&&o.push(arguments[2]),_r.apply(this,o)}})}return T}),function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return o(n?n:t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){"use strict";var r=t("./Array.prototype");e.exports={prototype:r,shim:function(){r.shim()}}},{"./Array.prototype":3}],2:[function(t,e,n){"use strict";e.exports=t("array-includes")},{"array-includes":14}],3:[function(t,e,n){"use strict";var r=t("./Array.prototype.includes");e.exports={includes:r,shim:function(){r.shim()}}},{"./Array.prototype.includes":2}],4:[function(t,e,n){"use strict";var r=t("object.getownpropertydescriptors"),o=t("object.entries"),i=t("object.values");e.exports={entries:o,getOwnPropertyDescriptors:r,shim:function(){r.shim(),o.shim(),i.shim()},values:i}},{"object.entries":38,"object.getownpropertydescriptors":64,"object.values":89}],5:[function(t,e,n){"use strict";var r=t("./String.prototype");e.exports={prototype:r,shim:function(){r.shim()}}},{"./String.prototype":7}],6:[function(t,e,n){"use strict";e.exports=t("string-at")},{"string-at":114}],7:[function(t,e,n){"use strict";var r=t("./String.prototype.at"),o=t("./String.prototype.padStart"),i=t("./String.prototype.padEnd"),a=t("./String.prototype.trimLeft"),s=t("./String.prototype.trimRight");e.exports={at:r,padStart:o,padEnd:i,trimLeft:a,trimRight:s,shim:function(){r.shim(),o.shim(),i.shim(),a.shim(),s.shim()}}},{"./String.prototype.at":6,"./String.prototype.padEnd":8,"./String.prototype.padStart":9,"./String.prototype.trimLeft":10,"./String.prototype.trimRight":11}],8:[function(t,e,n){"use strict";e.exports=t("string.prototype.padend")},{"string.prototype.padend":137}],9:[function(t,e,n){"use strict";e.exports=t("string.prototype.padstart")},{"string.prototype.padstart":162}],10:[function(t,e,n){"use strict";e.exports=t("string.prototype.trimleft")},{"string.prototype.trimleft":187}],11:[function(t,e,n){"use strict";e.exports=t("string.prototype.trimright")},{"string.prototype.trimright":197}],12:[function(t,e,n){"use strict";var r=t("./Array"),o=t("./Object"),i=t("./String");e.exports={Array:r,Object:o,String:i,shim:function(){r.shim(),o.shim(),i.shim()}}},{"./Array":1,"./Object":4,"./String":5}],13:[function(t,e,n){(function(n){"use strict";var r=t("es-abstract/es6"),o=Number.isNaN||function(t){return t!==t},i=Number.isFinite||function(t){return"number"==typeof t&&n.isFinite(t)},a=Array.prototype.indexOf;e.exports=function(t){var e=arguments.length>1?r.ToInteger(arguments[1]):0;if(a&&!o(t)&&i(e)&&"undefined"!=typeof t)return a.apply(this,arguments)>-1;var n=r.ToObject(this),s=r.ToLength(n.length);if(0===s)return!1;for(var l=e>=0?e:Math.max(0,s+e);l<s;){if(r.SameValueZero(t,n[l]))return!0;l+=1}return!1}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"es-abstract/es6":17}],14:[function(t,e,n){"use strict";var r=t("define-properties"),o=t("es-abstract/es6"),i=t("./implementation"),a=t("./polyfill"),s=a(),l=t("./shim"),u=Array.prototype.slice,c=function(t,e){return o.RequireObjectCoercible(t),s.apply(t,u.call(arguments,1))};r(c,{implementation:i,getPolyfill:a,shim:l}),e.exports=c},{"./implementation":13,"./polyfill":35,"./shim":36,"define-properties":15,"es-abstract/es6":17}],15:[function(t,e,n){"use strict";var r=t("object-keys"),o=t("foreach"),i="function"==typeof Symbol&&"symbol"==typeof Symbol(),a=Object.prototype.toString,s=function(t){return"function"==typeof t&&"[object Function]"===a.call(t)},l=function(){var t={};try{Object.defineProperty(t,"x",{enumerable:!1,value:t});for(var e in t)return!1;return t.x===t}catch(t){return!1}},u=Object.defineProperty&&l(),c=function(t,e,n,r){(!(e in t)||s(r)&&r())&&(u?Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n,writable:!0}):t[e]=n)},p=function(t,e){var n=arguments.length>2?arguments[2]:{},a=r(e);i&&(a=a.concat(Object.getOwnPropertySymbols(e))),o(a,function(r){c(t,r,e[r],n[r])})};p.supportsDescriptors=!!u,e.exports=p},{foreach:26,"object-keys":33}],16:[function(t,e,n){"use strict";var r=Number.isNaN||function(t){return t!==t},o=t("./helpers/isFinite"),i=t("./helpers/sign"),a=t("./helpers/mod"),s=t("is-callable"),l=t("es-to-primitive/es5"),u={ToPrimitive:l,ToBoolean:function(t){return Boolean(t)},ToNumber:function(t){return Number(t)},ToInteger:function(t){var e=this.ToNumber(t);return r(e)?0:0!==e&&o(e)?i(e)*Math.floor(Math.abs(e)):e},ToInt32:function(t){return this.ToNumber(t)>>0},ToUint32:function(t){return this.ToNumber(t)>>>0},ToUint16:function(t){var e=this.ToNumber(t);if(r(e)||0===e||!o(e))return 0;var n=i(e)*Math.floor(Math.abs(e));return a(n,65536)},ToString:function(t){return String(t)},ToObject:function(t){return this.CheckObjectCoercible(t),Object(t)},CheckObjectCoercible:function(t,e){if(null==t)throw new TypeError(e||"Cannot call method on "+t);return t},IsCallable:s,SameValue:function(t,e){return t===e?0!==t||1/t===1/e:r(t)&&r(e)}};e.exports=u},{"./helpers/isFinite":19,"./helpers/mod":21,"./helpers/sign":22,"es-to-primitive/es5":23,"is-callable":29}],17:[function(t,e,n){"use strict";var r=Object.prototype.toString,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,i=o?Symbol.prototype.toString:r,a=Number.isNaN||function(t){return t!==t},s=t("./helpers/isFinite"),l=Number.MAX_SAFE_INTEGER||Math.pow(2,53)-1,u=t("./helpers/assign"),c=t("./helpers/sign"),p=t("./helpers/mod"),h=t("./helpers/isPrimitive"),f=t("es-to-primitive/es6"),d=parseInt,g=t("function-bind"),m=g.call(Function.call,String.prototype.slice),b=g.call(Function.call,RegExp.prototype.test,/^0b[01]+$/i),v=g.call(Function.call,RegExp.prototype.test,/^0o[0-7]+$/i),y=["","​","￾"].join(""),w=new RegExp("["+y+"]","g"),x=g.call(Function.call,RegExp.prototype.test,w),S=/^[\-\+]0x[0-9a-f]+$/i,O=g.call(Function.call,RegExp.prototype.test,S),T=["\t\n\v\f\r   ᠎    ","         　\u2028","\u2029\ufeff"].join(""),E=new RegExp("(^["+T+"]+)|(["+T+"]+$)","g"),A=g.call(Function.call,String.prototype.replace),C=function(t){return A(t,E,"")},P=t("./es5"),N=t("is-regex"),j=u(u({},P),{Call:function(t,e){var n=arguments.length>2?arguments[2]:[];if(!this.IsCallable(t))throw new TypeError(t+" is not a function");return t.apply(e,n)},ToPrimitive:f,ToNumber:function(t){var e=h(t)?t:f(t,"number");if("symbol"==typeof e)throw new TypeError("Cannot convert a Symbol value to a number");if("string"==typeof e){if(b(e))return this.ToNumber(d(m(e,2),2));if(v(e))return this.ToNumber(d(m(e,2),8));if(x(e)||O(e))return NaN;var n=C(e);if(n!==e)return this.ToNumber(n)}return Number(e)},ToInt16:function(t){var e=this.ToUint16(t);return e>=32768?e-65536:e},ToInt8:function(t){var e=this.ToUint8(t);return e>=128?e-256:e},ToUint8:function(t){var e=this.ToNumber(t);if(a(e)||0===e||!s(e))return 0;var n=c(e)*Math.floor(Math.abs(e));return p(n,256)},ToUint8Clamp:function(t){var e=this.ToNumber(t);if(a(e)||e<=0)return 0;if(e>=255)return 255;var n=Math.floor(t);return n+.5<e?n+1:e<n+.5?n:n%2!==0?n+1:n},ToString:function(t){if("symbol"==typeof t)throw new TypeError("Cannot convert a Symbol value to a string");return String(t)},ToObject:function(t){return this.RequireObjectCoercible(t),Object(t)},ToPropertyKey:function(t){var e=this.ToPrimitive(t,String);return"symbol"==typeof e?i.call(e):this.ToString(e)},ToLength:function(t){var e=this.ToInteger(t);return e<=0?0:e>l?l:e},CanonicalNumericIndexString:function(t){if("[object String]"!==r.call(t))throw new TypeError("must be a string");if("-0"===t)return-0;var e=this.ToNumber(t);return this.SameValue(this.ToString(e),t)?e:void 0},RequireObjectCoercible:P.CheckObjectCoercible,IsArray:Array.isArray||function(t){return"[object Array]"===r.call(t)},IsConstructor:function(t){return this.IsCallable(t)},IsExtensible:function(t){return!Object.preventExtensions||!h(t)&&Object.isExtensible(t)},IsInteger:function(t){if("number"!=typeof t||a(t)||!s(t))return!1;var e=Math.abs(t);return Math.floor(e)===e},IsPropertyKey:function(t){return"string"==typeof t||"symbol"==typeof t},IsRegExp:function(t){if(!t||"object"!=typeof t)return!1;if(o){var e=RegExp[Symbol.match];if("undefined"!=typeof e)return P.ToBoolean(e)}return N(t)},SameValueZero:function(t,e){return t===e||a(t)&&a(e)}});delete j.CheckObjectCoercible,e.exports=j},{"./es5":16,"./helpers/assign":18,"./helpers/isFinite":19,"./helpers/isPrimitive":20,"./helpers/mod":21,"./helpers/sign":22,"es-to-primitive/es6":24,"function-bind":28,"is-regex":31}],18:[function(t,e,n){var r=Object.prototype.hasOwnProperty;e.exports=Object.assign||function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t}},{}],19:[function(t,e,n){var r=Number.isNaN||function(t){return t!==t};e.exports=Number.isFinite||function(t){return"number"==typeof t&&!r(t)&&t!==1/0&&t!==-(1/0)}},{}],20:[function(t,e,n){e.exports=function(t){return null===t||"function"!=typeof t&&"object"!=typeof t}},{}],21:[function(t,e,n){e.exports=function(t,e){var n=t%e;return Math.floor(n>=0?n:n+e)}},{}],22:[function(t,e,n){e.exports=function(t){return t>=0?1:-1}},{}],23:[function(t,e,n){"use strict";var r=Object.prototype.toString,o=t("./helpers/isPrimitive"),i=t("is-callable"),a={"[[DefaultValue]]":function(t,e){var n=e||("[object Date]"===r.call(t)?String:Number);if(n===String||n===Number){var a,s,l=n===String?["toString","valueOf"]:["valueOf","toString"];for(s=0;s<l.length;++s)if(i(t[l[s]])&&(a=t[l[s]](),o(a)))return a;throw new TypeError("No default value")}throw new TypeError("invalid [[DefaultValue]] hint supplied")}};e.exports=function(t,e){return o(t)?t:a["[[DefaultValue]]"](t,e)}},{"./helpers/isPrimitive":25,"is-callable":29}],24:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,o=t("./helpers/isPrimitive"),i=t("is-callable"),a=t("is-date-object"),s=t("is-symbol"),l=function(t,e){if("undefined"==typeof t||null===t)throw new TypeError("Cannot call method on "+t);if("string"!=typeof e||"number"!==e&&"string"!==e)throw new TypeError('hint must be "string" or "number"');var n,r,a,s="string"===e?["toString","valueOf"]:["valueOf","toString"];for(a=0;a<s.length;++a)if(n=t[s[a]],i(n)&&(r=n.call(t),o(r)))return r;throw new TypeError("No default value")},u=function(t,e){var n=t[e];if(null!==n&&"undefined"!=typeof n){if(!i(n))throw new TypeError(n+" returned for property "+e+" of object "+t+" is not a function");return n}};e.exports=function(t,e){if(o(t))return t;var n="default";arguments.length>1&&(e===String?n="string":e===Number&&(n="number"));var i;if(r&&(Symbol.toPrimitive?i=u(t,Symbol.toPrimitive):s(t)&&(i=Symbol.prototype.valueOf)),"undefined"!=typeof i){var c=i.call(t,n);if(o(c))return c;throw new TypeError("unable to convert exotic object to primitive")}return"default"===n&&(a(t)||s(t))&&(n="string"),l(t,"default"===n?"number":n)}},{"./helpers/isPrimitive":25,"is-callable":29,"is-date-object":30,"is-symbol":32}],25:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],26:[function(t,e,n){var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString;e.exports=function(t,e,n){if("[object Function]"!==o.call(e))throw new TypeError("iterator must be a function");var i=t.length;if(i===+i)for(var a=0;a<i;a++)e.call(n,t[a],a,t);else for(var s in t)r.call(t,s)&&e.call(n,t[s],s,t)}},{}],27:[function(t,e,n){var r="Function.prototype.bind called on incompatible ",o=Array.prototype.slice,i=Object.prototype.toString,a="[object Function]";e.exports=function(t){var e=this;if("function"!=typeof e||i.call(e)!==a)throw new TypeError(r+e);for(var n,s=o.call(arguments,1),l=function(){if(this instanceof n){var r=e.apply(this,s.concat(o.call(arguments)));return Object(r)===r?r:this}return e.apply(t,s.concat(o.call(arguments)))},u=Math.max(0,e.length-s.length),c=[],p=0;p<u;p++)c.push("$"+p);if(n=Function("binder","return function ("+c.join(",")+"){ return binder.apply(this,arguments); }")(l),e.prototype){var h=function(){};h.prototype=e.prototype,n.prototype=new h,h.prototype=null}return n}},{}],28:[function(t,e,n){var r=t("./implementation");e.exports=Function.prototype.bind||r},{"./implementation":27}],29:[function(t,e,n){"use strict";var r=Function.prototype.toString,o=/^\s*class /,i=function(t){try{var e=r.call(t),n=e.replace(/\/\/.*\n/g,""),i=n.replace(/\/\*[.\s\S]*\*\//g,""),a=i.replace(/\n/gm," ").replace(/ {2}/g," ");return o.test(a)}catch(t){return!1}},a=function(t){try{return!i(t)&&(r.call(t),!0)}catch(t){return!1}},s=Object.prototype.toString,l="[object Function]",u="[object GeneratorFunction]",c="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(t){if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(c)return a(t);if(i(t))return!1;var e=s.call(t);return e===l||e===u}},{}],30:[function(t,e,n){"use strict";var r=Date.prototype.getDay,o=function(t){try{return r.call(t),!0}catch(t){return!1}},i=Object.prototype.toString,a="[object Date]",s="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(t){return"object"==typeof t&&null!==t&&(s?o(t):i.call(t)===a)}},{}],31:[function(t,e,n){"use strict";var r=RegExp.prototype.exec,o=function(t){try{return r.call(t),!0}catch(t){return!1}},i=Object.prototype.toString,a="[object RegExp]",s="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(t){return"object"==typeof t&&(s?o(t):i.call(t)===a)}},{}],32:[function(t,e,n){"use strict";var r=Object.prototype.toString,o="function"==typeof Symbol&&"symbol"==typeof Symbol();if(o){var i=Symbol.prototype.toString,a=/^Symbol\(.*\)$/,s=function(t){return"symbol"==typeof t.valueOf()&&a.test(i.call(t))};e.exports=function(t){if("symbol"==typeof t)return!0;if("[object Symbol]"!==r.call(t))return!1;try{return s(t)}catch(t){return!1}}}else e.exports=function(t){return!1}},{}],33:[function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString,i=Array.prototype.slice,a=t("./isArguments"),s=!{toString:null}.propertyIsEnumerable("toString"),l=function(){}.propertyIsEnumerable("prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(t){var e=t.constructor;return e&&e.prototype===t},p={$console:!0,$frame:!0,$frameElement:!0,$frames:!0,$parent:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},h=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!p["$"+t]&&r.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{c(window[t])}catch(t){return!0}}catch(t){return!0}return!1}(),f=function(t){if("undefined"==typeof window||!h)return c(t);try{return c(t)}catch(t){return!1}},d=function(t){var e=null!==t&&"object"==typeof t,n="[object Function]"===o.call(t),i=a(t),c=e&&"[object String]"===o.call(t),p=[];if(!e&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var h=l&&n;if(c&&t.length>0&&!r.call(t,0))for(var d=0;d<t.length;++d)p.push(String(d));if(i&&t.length>0)for(var g=0;g<t.length;++g)p.push(String(g));else for(var m in t)h&&"prototype"===m||!r.call(t,m)||p.push(String(m));if(s)for(var b=f(t),v=0;v<u.length;++v)b&&"constructor"===u[v]||!r.call(t,u[v])||p.push(u[v]);return p};d.shim=function(){if(Object.keys){var t=function(){return 2===(Object.keys(arguments)||"").length}(1,2);if(!t){var e=Object.keys;Object.keys=function(t){return e(a(t)?i.call(t):t)}}}else Object.keys=d;return Object.keys||d},e.exports=d},{"./isArguments":34}],34:[function(t,e,n){"use strict";var r=Object.prototype.toString;e.exports=function(t){var e=r.call(t),n="[object Arguments]"===e;return n||(n="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===r.call(t.callee)),n}},{}],35:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){return Array.prototype.includes||r}},{"./implementation":13}],36:[function(t,e,n){"use strict";var r=t("define-properties"),o=t("./polyfill");e.exports=function(){var t=o();return Array.prototype.includes!==t&&r(Array.prototype,{includes:t}),t}},{"./polyfill":35,"define-properties":15}],37:[function(t,e,n){"use strict";var r=t("es-abstract/es7"),o=t("has"),i=t("function-bind"),a=i.call(Function.call,Object.prototype.propertyIsEnumerable);e.exports=function(t){var e=r.RequireObjectCoercible(t),n=[];for(var i in e)o(e,i)&&a(e,i)&&n.push([i,e[i]]);return n}},{"es-abstract/es7":42,"function-bind":53,has:54}],38:[function(t,e,n){"use strict";var r=t("define-properties"),o=t("./implementation"),i=t("./polyfill"),a=t("./shim");r(o,{getPolyfill:i,implementation:o,shim:a}),e.exports=o},{"./implementation":37,"./polyfill":61,"./shim":62,"define-properties":39}],39:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:51,"object-keys":59}],40:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{"./helpers/isFinite":44,"./helpers/mod":46,"./helpers/sign":47,dup:16,"es-to-primitive/es5":48,"is-callable":55}],41:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{"./es5":40,"./helpers/assign":43,"./helpers/isFinite":44,"./helpers/isPrimitive":45,"./helpers/mod":46,"./helpers/sign":47,dup:17,"es-to-primitive/es6":49,"function-bind":53,"is-regex":57}],42:[function(t,e,n){"use strict";var r=t("./es6"),o=t("./helpers/assign"),i=o(r,{SameValueNonNumber:function(t,e){if("number"==typeof t||typeof t!=typeof e)throw new TypeError("SameValueNonNumber requires two non-number values of the same type.");return this.SameValue(t,e)}});e.exports=i},{"./es6":41,"./helpers/assign":43}],43:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],44:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],45:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],46:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],47:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],48:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{"./helpers/isPrimitive":50,dup:23,"is-callable":55}],49:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{"./helpers/isPrimitive":50,dup:24,"is-callable":55,"is-date-object":56,"is-symbol":58}],50:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],51:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],52:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],53:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":52,dup:28}],54:[function(t,e,n){var r=t("function-bind");e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":53}],55:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],56:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{dup:30}],57:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],58:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],59:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":60,dup:33}],60:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],61:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){return"function"==typeof Object.entries?Object.entries:r}},{"./implementation":37}],62:[function(t,e,n){"use strict";var r=t("./polyfill"),o=t("define-properties");e.exports=function(){var t=r();return o(Object,{entries:t},{entries:function(){return Object.entries!==t}}),t}},{"./polyfill":61,"define-properties":39}],63:[function(t,e,n){"use strict";var r=t("es-abstract/es7"),o=Object.defineProperty,i=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,l=Function.call.bind(Array.prototype.concat),u=Function.call.bind(Array.prototype.reduce),c=s?function(t){return l(a(t),s(t))}:a,p=r.IsCallable(i)&&r.IsCallable(a),h=function(t,e,n){o&&e in t?o(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n};e.exports=function(t){if(r.RequireObjectCoercible(t),!p)throw new TypeError("getOwnPropertyDescriptors requires Object.getOwnPropertyDescriptor");var e=r.ToObject(t);return u(c(e),function(t,n){return h(t,n,i(e,n)),t},{})}},{"es-abstract/es7":68}],64:[function(t,e,n){arguments[4][38][0].apply(n,arguments)},{"./implementation":63,"./polyfill":86,"./shim":87,"define-properties":65,dup:38}],65:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:77,"object-keys":84}],66:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{"./helpers/isFinite":70,"./helpers/mod":72,"./helpers/sign":73,dup:16,"es-to-primitive/es5":74,"is-callable":80}],67:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{"./es5":66,"./helpers/assign":69,"./helpers/isFinite":70,"./helpers/isPrimitive":71,"./helpers/mod":72,"./helpers/sign":73,dup:17,"es-to-primitive/es6":75,"function-bind":79,"is-regex":82}],68:[function(t,e,n){arguments[4][42][0].apply(n,arguments)},{"./es6":67,"./helpers/assign":69,dup:42}],69:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],70:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],71:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],72:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],73:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],74:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{"./helpers/isPrimitive":76,dup:23,"is-callable":80}],75:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{"./helpers/isPrimitive":76,dup:24,"is-callable":80,"is-date-object":81,"is-symbol":83}],76:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],77:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],78:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],79:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":78,dup:28}],80:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],81:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{dup:30}],82:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],83:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],84:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":85,dup:33}],85:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],86:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){return"function"==typeof Object.getOwnPropertyDescriptors?Object.getOwnPropertyDescriptors:r}},{"./implementation":63}],87:[function(t,e,n){"use strict";var r=t("./polyfill"),o=t("define-properties");e.exports=function(){var t=r();return o(Object,{getOwnPropertyDescriptors:t},{getOwnPropertyDescriptors:function(){
return Object.getOwnPropertyDescriptors!==t}}),t}},{"./polyfill":86,"define-properties":65}],88:[function(t,e,n){"use strict";var r=t("es-abstract/es7"),o=t("has"),i=t("function-bind"),a=i.call(Function.call,Object.prototype.propertyIsEnumerable);e.exports=function(t){var e=r.RequireObjectCoercible(t),n=[];for(var i in e)o(e,i)&&a(e,i)&&n.push(e[i]);return n}},{"es-abstract/es7":93,"function-bind":104,has:105}],89:[function(t,e,n){arguments[4][38][0].apply(n,arguments)},{"./implementation":88,"./polyfill":112,"./shim":113,"define-properties":90,dup:38}],90:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:102,"object-keys":110}],91:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{"./helpers/isFinite":95,"./helpers/mod":97,"./helpers/sign":98,dup:16,"es-to-primitive/es5":99,"is-callable":106}],92:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{"./es5":91,"./helpers/assign":94,"./helpers/isFinite":95,"./helpers/isPrimitive":96,"./helpers/mod":97,"./helpers/sign":98,dup:17,"es-to-primitive/es6":100,"function-bind":104,"is-regex":108}],93:[function(t,e,n){arguments[4][42][0].apply(n,arguments)},{"./es6":92,"./helpers/assign":94,dup:42}],94:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],95:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],96:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],97:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],98:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],99:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{"./helpers/isPrimitive":101,dup:23,"is-callable":106}],100:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{"./helpers/isPrimitive":101,dup:24,"is-callable":106,"is-date-object":107,"is-symbol":109}],101:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],102:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],103:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],104:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":103,dup:28}],105:[function(t,e,n){arguments[4][54][0].apply(n,arguments)},{dup:54,"function-bind":104}],106:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],107:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{dup:30}],108:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],109:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],110:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":111,dup:33}],111:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],112:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){return"function"==typeof Object.values?Object.values:r}},{"./implementation":88}],113:[function(t,e,n){"use strict";var r=t("./polyfill"),o=t("define-properties");e.exports=function(){var t=r();return o(Object,{values:t},{values:function(){return Object.values!==t}}),t}},{"./polyfill":112,"define-properties":90}],114:[function(t,e,n){"use strict";var r=t("define-properties"),o=t("es-abstract/es7"),i=t("function-bind"),a=function(t){o.RequireObjectCoercible(this);var e=o.ToObject(this),n=o.ToString(e),r=o.ToInteger(t),i=n.length;if(r<0||r>=i)return"";var a,s=n.charCodeAt(r),l=r+1,u=1,c=s>=55296&&s<=56319;return c&&i>l&&(a=n.charCodeAt(l),a>=56320&&a<=57343&&(u=2)),n.slice(r,r+u)},s=i.call(Function.call,a);r(s,{method:a,shim:function(){return r(String.prototype,{at:a}),String.prototype.at}}),e.exports=s},{"define-properties":115,"es-abstract/es7":118,"function-bind":129}],115:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:127,"object-keys":134}],116:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{"./helpers/isFinite":120,"./helpers/mod":122,"./helpers/sign":123,dup:16,"es-to-primitive/es5":124,"is-callable":130}],117:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{"./es5":116,"./helpers/assign":119,"./helpers/isFinite":120,"./helpers/isPrimitive":121,"./helpers/mod":122,"./helpers/sign":123,dup:17,"es-to-primitive/es6":125,"function-bind":129,"is-regex":132}],118:[function(t,e,n){arguments[4][42][0].apply(n,arguments)},{"./es6":117,"./helpers/assign":119,dup:42}],119:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],120:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],121:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],122:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],123:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],124:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{"./helpers/isPrimitive":126,dup:23,"is-callable":130}],125:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{"./helpers/isPrimitive":126,dup:24,"is-callable":130,"is-date-object":131,"is-symbol":133}],126:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],127:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],128:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],129:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":128,dup:28}],130:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],131:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{dup:30}],132:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],133:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],134:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":135,dup:33}],135:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],136:[function(t,e,n){"use strict";var r=t("function-bind"),o=t("es-abstract/es7"),i=r.call(Function.call,String.prototype.slice);e.exports=function(t){var e,n=o.RequireObjectCoercible(this),r=o.ToString(n),a=o.ToLength(r.length);arguments.length>1&&(e=arguments[1]);var s="undefined"==typeof e?"":o.ToString(e);""===s&&(s=" ");var l=o.ToLength(t);if(l<=a)return r;for(var u=l-a;s.length<u;){var c=s.length,p=u-c;s+=c>p?i(s,0,p):s}var h=s.length>u?i(s,0,u):s;return r+h}},{"es-abstract/es7":141,"function-bind":152}],137:[function(t,e,n){"use strict";var r=t("function-bind"),o=t("define-properties"),i=t("es-abstract/es7"),a=t("./implementation"),s=t("./polyfill"),l=t("./shim"),u=r.call(Function.apply,a),c=function(t,e){i.RequireObjectCoercible(t);var n=[e];return arguments.length>2&&n.push(arguments[2]),u(t,n)};o(c,{getPolyfill:s,implementation:a,shim:l}),e.exports=c},{"./implementation":136,"./polyfill":159,"./shim":160,"define-properties":138,"es-abstract/es7":141,"function-bind":152}],138:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:150,"object-keys":157}],139:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{"./helpers/isFinite":143,"./helpers/mod":145,"./helpers/sign":146,dup:16,"es-to-primitive/es5":147,"is-callable":153}],140:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{"./es5":139,"./helpers/assign":142,"./helpers/isFinite":143,"./helpers/isPrimitive":144,"./helpers/mod":145,"./helpers/sign":146,dup:17,"es-to-primitive/es6":148,"function-bind":152,"is-regex":155}],141:[function(t,e,n){arguments[4][42][0].apply(n,arguments)},{"./es6":140,"./helpers/assign":142,dup:42}],142:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],143:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],144:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],145:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],146:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],147:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{"./helpers/isPrimitive":149,dup:23,"is-callable":153}],148:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{"./helpers/isPrimitive":149,dup:24,"is-callable":153,"is-date-object":154,"is-symbol":156}],149:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],150:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],151:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],152:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":151,dup:28}],153:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],154:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{dup:30}],155:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],156:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],157:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":158,dup:33}],158:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],159:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){return"function"==typeof String.prototype.padEnd?String.prototype.padEnd:r}},{"./implementation":136}],160:[function(t,e,n){"use strict";var r=t("./polyfill"),o=t("define-properties");e.exports=function(){var t=r();return o(String.prototype,{padEnd:t},{padEnd:function(){return String.prototype.padEnd!==t}}),t}},{"./polyfill":159,"define-properties":138}],161:[function(t,e,n){"use strict";var r=t("function-bind"),o=t("es-abstract/es7"),i=r.call(Function.call,String.prototype.slice);e.exports=function(t){var e,n=o.RequireObjectCoercible(this),r=o.ToString(n),a=o.ToLength(r.length);arguments.length>1&&(e=arguments[1]);var s="undefined"==typeof e?"":o.ToString(e);""===s&&(s=" ");var l=o.ToLength(t);if(l<=a)return r;for(var u=l-a;s.length<u;){var c=s.length,p=u-c;s+=c>p?i(s,0,p):s}var h=s.length>u?i(s,0,u):s;return h+r}},{"es-abstract/es7":166,"function-bind":177}],162:[function(t,e,n){"use strict";var r=t("function-bind"),o=t("define-properties"),i=t("es-abstract/es7"),a=t("./implementation"),s=t("./polyfill"),l=t("./shim"),u=r.call(Function.apply,a),c=function(t,e){i.RequireObjectCoercible(t);var n=[e];return arguments.length>2&&n.push(arguments[2]),u(t,n)};o(c,{getPolyfill:s,implementation:a,shim:l}),e.exports=c},{"./implementation":161,"./polyfill":184,"./shim":185,"define-properties":163,"es-abstract/es7":166,"function-bind":177}],163:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:175,"object-keys":182}],164:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{"./helpers/isFinite":168,"./helpers/mod":170,"./helpers/sign":171,dup:16,"es-to-primitive/es5":172,"is-callable":178}],165:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{"./es5":164,"./helpers/assign":167,"./helpers/isFinite":168,"./helpers/isPrimitive":169,"./helpers/mod":170,"./helpers/sign":171,dup:17,"es-to-primitive/es6":173,"function-bind":177,"is-regex":180}],166:[function(t,e,n){arguments[4][42][0].apply(n,arguments)},{"./es6":165,"./helpers/assign":167,dup:42}],167:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],168:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],169:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],170:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],171:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],172:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{"./helpers/isPrimitive":174,dup:23,"is-callable":178}],173:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{"./helpers/isPrimitive":174,dup:24,"is-callable":178,"is-date-object":179,"is-symbol":181}],174:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],175:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],176:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],177:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":176,dup:28}],178:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],179:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{dup:30}],180:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],181:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],182:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":183,dup:33}],183:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],184:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){return"function"==typeof String.prototype.padStart?String.prototype.padStart:r}},{"./implementation":161}],185:[function(t,e,n){"use strict";var r=t("./polyfill"),o=t("define-properties");e.exports=function(){var t=r();return o(String.prototype,{padStart:t},{padStart:function(){return String.prototype.padStart!==t}}),t}},{"./polyfill":184,"define-properties":163}],186:[function(t,e,n){"use strict";var r=t("function-bind"),o=r.call(Function.call,String.prototype.replace),i=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*/;e.exports=function(){return o(this,i,"")}},{"function-bind":191}],187:[function(t,e,n){"use strict";var r=t("function-bind"),o=t("define-properties"),i=t("./implementation"),a=t("./polyfill"),s=t("./shim"),l=r.call(Function.call,a());o(l,{getPolyfill:a,implementation:i,shim:s}),e.exports=l},{"./implementation":186,"./polyfill":194,"./shim":195,"define-properties":188,"function-bind":191}],188:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:189,"object-keys":192}],189:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],190:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],191:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":190,dup:28}],192:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":193,dup:33}],193:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],194:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){if(!String.prototype.trimLeft)return r;var t="​";return t.trimLeft()!==t?r:String.prototype.trimLeft}},{"./implementation":186}],195:[function(t,e,n){"use strict";var r=t("define-properties"),o=t("./polyfill");e.exports=function(){var t=o();return r(String.prototype,{trimLeft:t},{trimLeft:function(){return String.prototype.trimLeft!==t}}),t}},{"./polyfill":194,"define-properties":188}],196:[function(t,e,n){"use strict";var r=t("function-bind"),o=r.call(Function.call,String.prototype.replace),i=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*$/;e.exports=function(){return o(this,i,"")}},{"function-bind":201}],197:[function(t,e,n){arguments[4][187][0].apply(n,arguments)},{"./implementation":196,"./polyfill":204,"./shim":205,"define-properties":198,dup:187,"function-bind":201}],198:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15,foreach:199,"object-keys":202}],199:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],200:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],201:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{"./implementation":200,dup:28}],202:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{"./isArguments":203,dup:33}],203:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],204:[function(t,e,n){"use strict";var r=t("./implementation");e.exports=function(){if(!String.prototype.trimRight)return r;var t="​";return t.trimRight()!==t?r:String.prototype.trimRight}},{"./implementation":196}],205:[function(t,e,n){"use strict";var r=t("define-properties"),o=t("./polyfill");e.exports=function(){var t=o();return r(String.prototype,{trimRight:t},{trimRight:function(){return String.prototype.trimRight!==t}}),t}},{"./polyfill":204,"define-properties":198}],206:[function(t,e,n){"use strict";e.exports=t("./es7-shim").shim()},{"./es7-shim":12}]},{},[206]),function(t){"use strict";function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function n(t){return"string"!=typeof t&&(t=String(t)),t}function r(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return g.iterable&&(e[Symbol.iterator]=function(){return e}),e}function o(t){this.map={},t instanceof o?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function i(t){return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function a(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function s(t){var e=new FileReader;return e.readAsArrayBuffer(t),a(e)}function l(t){var e=new FileReader;return e.readAsText(t),a(e)}function u(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,"string"==typeof t)this._bodyText=t;else if(g.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(g.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(g.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(t){if(!g.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t))throw new Error("unsupported BodyInit type")}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob?(this.blob=function(){var t=i(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(s)},this.text=function(){var t=i(this);if(t)return t;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var t=i(this);return t?t:Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(h)}),this.json=function(){return this.text().then(JSON.parse)},this}function c(t){var e=t.toUpperCase();return m.indexOf(e)>-1?e:t}function p(t,e){e=e||{};var n=e.body;if(p.prototype.isPrototypeOf(t)){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new o(t.headers)),this.method=t.method,this.mode=t.mode,n||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=t;if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new o(e.headers)),this.method=c(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function h(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(o))}}),e}function f(t){var e=new o,n=(t.getAllResponseHeaders()||"").trim().split("\n");return n.forEach(function(t){var n=t.trim().split(":"),r=n.shift().trim(),o=n.join(":").trim();e.append(r,o)}),e}function d(t,e){e||(e={}),this.type="default",this.status=e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof o?e.headers:new o(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var g={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};o.prototype.append=function(t,r){t=e(t),r=n(r);var o=this.map[t];o||(o=[],this.map[t]=o),o.push(r)},o.prototype.delete=function(t){delete this.map[e(t)]},o.prototype.get=function(t){var n=this.map[e(t)];return n?n[0]:null},o.prototype.getAll=function(t){return this.map[e(t)]||[]},o.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},o.prototype.set=function(t,r){this.map[e(t)]=[n(r)]},o.prototype.forEach=function(t,e){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(r){t.call(e,r,n,this)},this)},this)},o.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),r(t)},o.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),r(t)},o.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),r(t)},g.iterable&&(o.prototype[Symbol.iterator]=o.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];p.prototype.clone=function(){return new p(this)},u.call(p.prototype),u.call(d.prototype),d.prototype.clone=function(){return new d(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},d.error=function(){var t=new d(null,{status:0,statusText:""});return t.type="error",t};var b=[301,302,303,307,308];d.redirect=function(t,e){if(b.indexOf(e)===-1)throw new RangeError("Invalid status code");return new d(null,{status:e,headers:{location:t}})},t.Headers=o,t.Request=p,t.Response=d,t.fetch=function(t,e){return new Promise(function(n,r){function o(){return"responseURL"in a?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):void 0}var i;i=p.prototype.isPrototypeOf(t)&&!e?t:new p(t,e);var a=new XMLHttpRequest;a.onload=function(){var t={status:a.status,statusText:a.statusText,headers:f(a),url:o()},e="response"in a?a.response:a.responseText;n(new d(e,t))},a.onerror=function(){r(new TypeError("Network request failed"))},a.ontimeout=function(){r(new TypeError("Network request failed"))},a.open(i.method,i.url,!0),"include"===i.credentials&&(a.withCredentials=!0),"responseType"in a&&g.blob&&(a.responseType="blob"),i.headers.forEach(function(t,e){a.setRequestHeader(e,t)}),a.send("undefined"==typeof i._bodyInit?null:i._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:this),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.ketcher=t()}}(function(){var t;return function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return o(n?n:t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(t){if(p===setTimeout)return setTimeout(t,0);if((p===r||!p)&&setTimeout)return p=setTimeout,setTimeout(t,0);try{return p(t,0)}catch(e){try{return p.call(null,t,0)}catch(e){return p.call(this,t,0)}}}function a(t){if(h===clearTimeout)return clearTimeout(t);if((h===o||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function s(){m&&d&&(m=!1,d.length?g=d.concat(g):b=-1,g.length&&l())}function l(){if(!m){var t=i(s);m=!0;for(var e=g.length;e;){for(d=g,g=[];++b<e;)d&&d[b].run();b=-1,e=g.length}d=null,m=!1,a(t)}}function u(t,e){this.fun=t,this.array=e}function c(){}var p,h,f=e.exports={};!function(){try{p="function"==typeof setTimeout?setTimeout:r}catch(t){p=r}try{h="function"==typeof clearTimeout?clearTimeout:o}catch(t){h=o}}();var d,g=[],m=!1,b=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];g.push(new u(t,e)),1!==g.length||m||i(l)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=c,f.addListener=c,f.once=c,f.off=c,f.removeListener=c,f.removeAllListeners=c,f.emit=c,f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],2:[function(e,n,r){var o=o||function(t){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,n=function(){return t.URL||t.webkitURL||t},r=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,i=function(t){var e=new MouseEvent("click");t.dispatchEvent(e)},a=t.webkitRequestFileSystem,s=t.requestFileSystem||a||t.mozRequestFileSystem,l=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},u="application/octet-stream",c=0,p=500,h=function(e){var r=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};t.chrome?r():setTimeout(r,p)},f=function(t,e,n){e=[].concat(e);for(var r=e.length;r--;){var o=t["on"+e[r]];if("function"==typeof o)try{o.call(t,n||t)}catch(t){l(t)}}},d=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t},g=function(e,l,p){p||(e=d(e));var g,m,b,v=this,y=e.type,w=!1,x=function(){f(v,"writestart progress write writeend".split(" "))},S=function(){if(!w&&g||(g=n().createObjectURL(e)),m)m.location.href=g;else{var r=t.open(g,"_blank");void 0==r&&"undefined"!=typeof safari&&(t.location.href=g)}v.readyState=v.DONE,x(),h(g)},O=function(t){return function(){if(v.readyState!==v.DONE)return t.apply(this,arguments)}},T={create:!0,exclusive:!1};return v.readyState=v.INIT,l||(l="download"),o?(g=n().createObjectURL(e),r.href=g,r.download=l,void setTimeout(function(){i(r),x(),h(g),v.readyState=v.DONE})):(t.chrome&&y&&y!==u&&(b=e.slice||e.webkitSlice,e=b.call(e,0,e.size,u),w=!0),a&&"download"!==l&&(l+=".download"),(y===u||a)&&(m=t),s?(c+=e.size,void s(t.TEMPORARY,c,O(function(t){t.root.getDirectory("saved",T,O(function(t){var n=function(){t.getFile(l,T,O(function(t){t.createWriter(O(function(n){n.onwriteend=function(e){m.location.href=t.toURL(),v.readyState=v.DONE,f(v,"writeend",e),h(t)},n.onerror=function(){var t=n.error;t.code!==t.ABORT_ERR&&S()},"writestart progress write abort".split(" ").forEach(function(t){n["on"+t]=v["on"+t]}),n.write(e),v.abort=function(){n.abort(),v.readyState=v.DONE},v.readyState=v.WRITING}),S)}),S)};t.getFile(l,{create:!1},O(function(t){t.remove(),n()}),O(function(t){t.code===t.NOT_FOUND_ERR?n():S()}))}),S)}),S)):void S())},m=g.prototype,b=function(t,e,n){return new g(t,e,n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,n){return n||(t=d(t)),navigator.msSaveOrOpenBlob(t,e||"download")}:(m.abort=function(){var t=this;t.readyState=t.DONE,f(t,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,b)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof n&&n.exports?n.exports.saveAs=o:"undefined"!=typeof t&&null!==t&&null!=t.amd&&t([],function(){return o})},{}],3:[function(t,e,n){"use strict";e.exports=t("./lib/core.js"),t("./lib/done.js"),t("./lib/es6-extensions.js"),t("./lib/node-extensions.js")},{"./lib/core.js":4,"./lib/done.js":5,"./lib/es6-extensions.js":6,"./lib/node-extensions.js":7}],4:[function(t,e,n){"use strict";function r(t){function e(t){return null===l?void c.push(t):void a(function(){var e=l?t.onFulfilled:t.onRejected;if(null===e)return void(l?t.resolve:t.reject)(u);var n;try{n=e(u)}catch(e){return void t.reject(e)}t.resolve(n)})}function n(t){try{if(t===p)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var e=t.then;if("function"==typeof e)return void i(e.bind(t),n,r)}l=!0,u=t,s()}catch(t){r(t)}}function r(t){l=!1,u=t,s()}function s(){for(var t=0,n=c.length;t<n;t++)e(c[t]);c=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");var l=null,u=null,c=[],p=this;this.then=function(t,n){return new p.constructor(function(r,i){e(new o(t,n,r,i))})},i(t,n,r)}function o(t,e,n,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=r}function i(t,e,n){var r=!1;try{t(function(t){r||(r=!0,e(t))},function(t){r||(r=!0,n(t))})}catch(t){if(r)return;r=!0,n(t)}}var a=t("asap");e.exports=r},{asap:8}],5:[function(t,e,n){"use strict";var r=t("./core.js"),o=t("asap");e.exports=r,r.prototype.done=function(t,e){var n=arguments.length?this.then.apply(this,arguments):this;n.then(null,function(t){o(function(){throw t})})}},{"./core.js":4,asap:8}],6:[function(t,e,n){"use strict";function r(t){this.then=function(e){return"function"!=typeof e?this:new o(function(n,r){i(function(){try{n(e(t))}catch(t){r(t)}})})}}var o=t("./core.js"),i=t("asap");e.exports=o,r.prototype=o.prototype;var a=new r((!0)),s=new r((!1)),l=new r(null),u=new r((void 0)),c=new r(0),p=new r("");o.resolve=function(t){if(t instanceof o)return t;if(null===t)return l;if(void 0===t)return u;if(t===!0)return a;if(t===!1)return s;if(0===t)return c;if(""===t)return p;if("object"==typeof t||"function"==typeof t)try{var e=t.then;if("function"==typeof e)return new o(e.bind(t))}catch(t){return new o(function(e,n){n(t)})}return new r(t)},o.all=function(t){var e=Array.prototype.slice.call(t);return new o(function(t,n){function r(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(t){r(i,t)},n)}e[i]=a,0===--o&&t(e)}catch(t){n(t)}}if(0===e.length)return t([]);for(var o=e.length,i=0;i<e.length;i++)r(i,e[i])})},o.reject=function(t){return new o(function(e,n){n(t)})},o.race=function(t){return new o(function(e,n){t.forEach(function(t){o.resolve(t).then(e,n)})})},o.prototype.catch=function(t){return this.then(null,t)}},{"./core.js":4,asap:8}],7:[function(t,e,n){"use strict";var r=t("./core.js"),o=t("asap");e.exports=r,r.denodeify=function(t,e){return e=e||1/0,function(){var n=this,o=Array.prototype.slice.call(arguments);return new r(function(r,i){for(;o.length&&o.length>e;)o.pop();o.push(function(t,e){t?i(t):r(e)});var a=t.apply(n,o);!a||"object"!=typeof a&&"function"!=typeof a||"function"!=typeof a.then||r(a)})}},r.nodeify=function(t){return function(){var e=Array.prototype.slice.call(arguments),n="function"==typeof e[e.length-1]?e.pop():null,i=this;try{return t.apply(this,arguments).nodeify(n,i)}catch(t){if(null===n||"undefined"==typeof n)return new r(function(e,n){n(t)});o(function(){n.call(i,t)})}}},r.prototype.nodeify=function(t,e){return"function"!=typeof t?this:void this.then(function(n){o(function(){t.call(e,null,n)})},function(n){o(function(){t.call(e,n)})})}},{"./core.js":4,asap:8}],8:[function(t,e,n){(function(t){function n(){for(;o.next;){o=o.next;var t=o.task;o.task=void 0;var e=o.domain;e&&(o.domain=void 0,e.enter());try{t()}catch(t){if(l)throw e&&e.exit(),setTimeout(n,0),e&&e.enter(),t;setTimeout(function(){throw t},0)}e&&e.exit()}a=!1}function r(e){i=i.next={task:e,domain:l&&t.domain,next:null},a||(a=!0,s())}var o={task:void 0,next:null},i=o,a=!1,s=void 0,l=!1;if("undefined"!=typeof t&&t.nextTick)l=!0,s=function(){t.nextTick(n)};else if("function"==typeof setImmediate)s="undefined"!=typeof window?setImmediate.bind(window,n):function(){setImmediate(n)};else if("undefined"!=typeof MessageChannel){var u=new MessageChannel;u.port1.onmessage=n,s=function(){u.port2.postMessage(0)}}else s=function(){setTimeout(n,0)};e.exports=r}).call(this,t("_process"))},{_process:1}],9:[function(t,e,n){var r={};
e.exports=r,r.createElement=function(t){return document.createElement(t)},r.createText=function(t){return document.createTextNode(t)},r.style=function(t,e){t.style.cssText=e},r.append=function(t,e){t.appendChild(e)},r.remove=function(t,e){t.removeChild(e)}},{}],10:[function(t,e,n){var r=t("promise"),o=t("./dom"),i=t("./ruler"),a=function(t,e){e=e||{weight:"normal"},this.family=t,this.style=e.style||"normal",this.variant=e.variant||"normal",this.weight=e.weight||"normal",this.stretch=e.stretch||"stretch",this.featureSettings=e.featureSettings||"normal"};e.exports=a,a.HAS_WEBKIT_FALLBACK_BUG=null,a.DEFAULT_TIMEOUT=3e3,a.getUserAgent=function(){return window.navigator.userAgent},a.hasWebKitFallbackBug=function(){if(null===a.HAS_WEBKIT_FALLBACK_BUG){var t=/AppleWeb[kK]it\/([0-9]+)(?:\.([0-9]+))/.exec(a.getUserAgent());a.HAS_WEBKIT_FALLBACK_BUG=!!t&&(parseInt(t[1],10)<536||536===parseInt(t[1],10)&&parseInt(t[2],10)<=11)}return a.HAS_WEBKIT_FALLBACK_BUG},a.prototype.getStyle=function(){return"font-style:"+this.style+";font-variant:"+this.variant+";font-weight:"+this.weight+";font-stretch:"+this.stretch+";font-feature-settings:"+this.featureSettings+";-moz-font-feature-settings:"+this.featureSettings+";-webkit-font-feature-settings:"+this.featureSettings+";"},a.prototype.check=function(t,e){var n=t||"BESbswy",s=e||a.DEFAULT_TIMEOUT,l=this.getStyle(),u=o.createElement("div"),c=new i(n),p=new i(n),h=new i(n),f=-1,d=-1,g=-1,m=-1,b=-1,v=-1,y=this;return c.setFont('"Times New Roman", sans-serif',l),p.setFont("serif",l),h.setFont("monospace",l),o.append(u,c.getElement()),o.append(u,p.getElement()),o.append(u,h.getElement()),o.append(document.body,u),m=c.getWidth(),b=p.getWidth(),v=h.getWidth(),new r(function(t,e){function n(){null!==u.parentNode&&o.remove(document.body,u)}function r(){f!==-1&&d!==-1&&g!==-1&&f===d&&d===g&&(a.hasWebKitFallbackBug()?f===m&&d===m&&g===m||f===b&&d===b&&g===b||f===v&&d===v&&g===v||(n(),t(y)):(n(),t(y)))}setTimeout(function(){n(),e(y)},s),c.onResize(function(t){f=t,r()}),c.setFont(y.family+",sans-serif",l),p.onResize(function(t){d=t,r()}),p.setFont(y.family+",serif",l),h.onResize(function(t){g=t,r()}),h.setFont(y.family+",monospace",l)})}},{"./dom":9,"./ruler":11,promise:3}],11:[function(t,e,n){var r=t("./dom"),o=function(t){var e="display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;";this.element=r.createElement("div"),this.element.setAttribute("aria-hidden","true"),r.append(this.element,r.createText(t)),this.collapsible=r.createElement("span"),this.expandable=r.createElement("span"),this.collapsibleInner=r.createElement("span"),this.expandableInner=r.createElement("span"),this.lastOffsetWidth=-1,r.style(this.collapsible,e),r.style(this.expandable,e),r.style(this.expandableInner,e),r.style(this.collapsibleInner,"display:inline-block;width:200%;height:200%;"),r.append(this.collapsible,this.collapsibleInner),r.append(this.expandable,this.expandableInner),r.append(this.element,this.collapsible),r.append(this.element,this.expandable)};e.exports=o,o.prototype.getElement=function(){return this.element},o.prototype.setFont=function(t,e){r.style(this.element,"min-width:20px;min-height:20px;display:inline-block;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font-size:100px;font-family:"+t+";"+e)},o.prototype.getWidth=function(){return this.element.offsetWidth},o.prototype.setWidth=function(t){this.element.style.width=t+"px"},o.prototype.reset=function(){var t=this.getWidth(),e=t+100;return this.expandableInner.style.width=e+"px",this.expandable.scrollLeft=e,this.collapsible.scrollLeft=this.collapsible.scrollWidth+100,this.lastOffsetWidth!==t&&(this.lastOffsetWidth=t,!0)},o.prototype.onScroll=function(t){this.reset()&&null!==this.element.parentNode&&t(this.lastOffsetWidth)},o.prototype.onResize=function(t){var e=this;this.collapsible.addEventListener("scroll",function(){e.onScroll(t)},!1),this.expandable.addEventListener("scroll",function(){e.onScroll(t)},!1),this.reset()}},{"./dom":9}],12:[function(t,e,n){"use strict";function r(t,e){function n(r,i){if(t(r,i))return!0;if(Array.isArray(r)){if(!Array.isArray(i)||r.length!==i.length)return!1;for(var a=0;a<r.length;a++)if(!n(r[a],i[a]))return!1;return!0}if(Array.isArray(i))return!1;if("object"==typeof r){if("object"!=typeof i)return!1;var s=null===r,l=null===i;if(s||l)return s===l;var u=Object.keys(r),c=Object.keys(i);if(u.length!==c.length)return!1;for(var a=0;a<u.length;a++){var p=u[a];if(o.call(r,p)&&(!o.call(i,p)||!(e?n:t)(r[p],i[p])))return!1}return!0}return!1}return n}n.__esModule=!0,n.default=r;var o=Object.prototype.hasOwnProperty;e.exports=n.default},{}],13:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var o=t("./memoize"),i=r(o);n.default=i.default,e.exports=n.default},{"./memoize":15}],14:[function(t,e,n){"use strict";function r(t,e){function n(t){for(var n=0;n<o.length;n++){var r=o[n];if(e(t,r.key))return n>0&&(o.splice(n,1),o.unshift(r)),r.value}}function r(e,r){n(e)||(o.unshift({key:e,value:r}),o.length>t&&o.pop())}var o=[];return{get:n,put:r}}n.__esModule=!0,n.default=r,e.exports=n.default},{}],15:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){return 1===t?s.default(e):u.default(t,e)}function i(){for(var t=1,e=function(t,e){return t===e},n=!1,r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];"number"==typeof i[0]&&(t=i.shift()),"function"==typeof i[0]&&(e=i.shift()),"boolean"==typeof i[0]&&(n=i[0]);var s=o(t,p.default(e,n));return function(t){return function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var o=s.get(n);return void 0===o&&(o=t.apply(t,n),s.put(n,o)),o}}}n.__esModule=!0,n.default=i;var a=t("./singletonCache"),s=r(a),l=t("./lruCache"),u=r(l),c=t("./deepEquals"),p=r(c);e.exports=n.default},{"./deepEquals":12,"./lruCache":14,"./singletonCache":16}],16:[function(t,e,n){"use strict";function r(t){var e=void 0;return{get:function(n){if(e&&t(n,e.key))return e.value},put:function(t,n){e={key:t,value:n}}}}n.__esModule=!0,n.default=r,e.exports=n.default},{}],17:[function(e,n,r){!function(e,o){"object"==typeof r&&"undefined"!=typeof n?o(r):"function"==typeof t&&t.amd?t(["exports"],o):o(e.preact=e.preact||{})}(this,function(t){function e(t,e,n){this.nodeName=t,this.attributes=e,this.children=n,this.key=e&&e.key}function n(t,n){var r,o,i,a,s=[];for(a=arguments.length;a-- >2;)G.push(arguments[a]);for(n&&n.children&&(G.length||G.push(n.children),delete n.children);G.length;)if((o=G.pop())instanceof Array)for(a=o.length;a--;)G.push(o[a]);else null!=o&&o!==!1&&("number"!=typeof o&&o!==!0||(o=String(o)),i="string"==typeof o,i&&r?s[s.length-1]+=o:(s.push(o),r=i));var l=new e(t,n||void 0,s);return F.vnode&&F.vnode(l),l}function r(t,e){if(e)for(var n in e)t[n]=e[n];return t}function o(t){return r({},t)}function i(t,e){for(var n=e.split("."),r=0;r<n.length&&t;r++)t=t[n[r]];return t}function a(t){return"function"==typeof t}function s(t){return"string"==typeof t}function l(t){var e="";for(var n in t)t[n]&&(e&&(e+=" "),e+=n);return e}function u(t,e){return n(t.nodeName,r(o(t.attributes),e),arguments.length>2?[].slice.call(arguments,2):t.children)}function c(t,e,n){var r=e.split("."),o=r[0];return function(e){var a,l,u=e&&e.currentTarget||this,c=t.state,p=c,h=s(n)?i(e,n):u.nodeName?(u.nodeName+u.type).match(/^input(che|rad)/i)?u.checked:u.value:e;if(r.length>1){for(l=0;l<r.length-1;l++)p=p[r[l]]||(p[r[l]]={});p[r[l]]=h,h=c[o]}t.setState((a={},a[o]=h,a))}}function p(t){!t._dirty&&(t._dirty=!0)&&1==K.push(t)&&(F.debounceRendering||V)(h)}function h(){var t,e=K;for(K=[];t=e.pop();)t._dirty&&_(t)}function f(t){var e=t&&t.nodeName;return e&&a(e)&&!(e.prototype&&e.prototype.render)}function d(t,e){return t.nodeName(b(t),e||W)}function g(t,e){return s(e)?t instanceof Text:s(e.nodeName)?m(t,e.nodeName):a(e.nodeName)?t._componentConstructor===e.nodeName||f(e):void 0}function m(t,e){return t.normalizedNodeName===e||H(t.nodeName)===H(e)}function b(t){var e=o(t.attributes);e.children=t.children;var n=t.nodeName.defaultProps;if(n)for(var r in n)void 0===e[r]&&(e[r]=n[r]);return e}function v(t){var e=t.parentNode;e&&e.removeChild(t)}function y(t,e,n,r,o){if("className"===e&&(e="class"),"class"===e&&r&&"object"==typeof r&&(r=l(r)),"key"===e);else if("class"!==e||o)if("style"===e){if((!r||s(r)||s(n))&&(t.style.cssText=r||""),r&&"object"==typeof r){if(!s(n))for(var i in n)i in r||(t.style[i]="");for(var i in r)t.style[i]="number"!=typeof r[i]||Y[i]?r[i]:r[i]+"px"}}else if("dangerouslySetInnerHTML"===e)r&&(t.innerHTML=r.__html);else if("o"==e[0]&&"n"==e[1]){var u=t._listeners||(t._listeners={});e=H(e.substring(2)),r?u[e]||t.addEventListener(e,x,!!q[e]):u[e]&&t.removeEventListener(e,x,!!q[e]),u[e]=r}else if("list"!==e&&"type"!==e&&!o&&e in t)w(t,e,null==r?"":r),null!=r&&r!==!1||t.removeAttribute(e);else{var c=o&&e.match(/^xlink\:?(.+)/);null==r||r===!1?c?t.removeAttributeNS("http://www.w3.org/1999/xlink",H(c[1])):t.removeAttribute(e):"object"==typeof r||a(r)||(c?t.setAttributeNS("http://www.w3.org/1999/xlink",H(c[1]),r):t.setAttribute(e,r))}else t.className=r||""}function w(t,e,n){try{t[e]=n}catch(t){}}function x(t){return this._listeners[t.type](F.event&&F.event(t)||t)}function S(t){if(v(t),t instanceof Element){t._component=t._componentConstructor=null;var e=t.normalizedNodeName||H(t.nodeName);(X[e]||(X[e]=[])).push(t)}}function O(t,e){var n=H(t),r=X[n]&&X[n].pop()||(e?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t));return r.normalizedNodeName=n,r}function T(){for(var t;t=Z.pop();)t.componentDidMount&&t.componentDidMount()}function E(t,e,n,r,o,i){J++||(Q=o instanceof SVGElement);var a=A(t,e,n,r);return o&&a.parentNode!==o&&o.appendChild(a),--J||i||T(),a}function A(t,e,n,r){for(var o=e&&e.attributes;f(e);)e=d(e,n);if(null==e&&(e=""),s(e)){if(t){if(t instanceof Text&&t.parentNode)return t.nodeValue=e,t;N(t)}return document.createTextNode(e)}if(a(e.nodeName))return I(t,e,n,r);var i=t,l=e.nodeName,u=Q;if(s(l)||(l=String(l)),Q="svg"===l||"foreignObject"!==l&&Q,t){if(!m(t,l)){for(i=O(l,Q);t.firstChild;)i.appendChild(t.firstChild);N(t)}}else i=O(l,Q);e.children&&1===e.children.length&&"string"==typeof e.children[0]&&1===i.childNodes.length&&i.firstChild instanceof Text?i.firstChild.nodeValue=e.children[0]:(e.children&&e.children.length||i.firstChild)&&C(i,e.children,n,r);var c=i[$];if(!c){i[$]=c={};for(var p=i.attributes,h=p.length;h--;)c[p[h].name]=p[h].value}return j(i,e.attributes,c),o&&"function"==typeof o.ref&&(c.ref=o.ref)(i),Q=u,i}function C(t,e,n,r){var o,i,s,l,u=t.childNodes,c=[],p={},h=0,f=0,d=u.length,m=0,b=e&&e.length;if(d)for(var v=0;v<d;v++){var y=u[v],w=b?(i=y._component)?i.__key:(i=y[$])?i.key:null:null;w||0===w?(h++,p[w]=y):c[m++]=y}if(b)for(var v=0;v<b;v++){s=e[v],l=null;var w=s.key;if(null!=w)h&&w in p&&(l=p[w],p[w]=void 0,h--);else if(!l&&f<m){for(o=f;o<m;o++)if(i=c[o],i&&g(i,s)){l=i,c[o]=void 0,o===m-1&&m--,o===f&&f++;break}!l&&f<m&&a(s.nodeName)&&r&&(l=c[f],c[f++]=void 0)}l=A(l,s,n,r),l&&l!==t&&l!==u[v]&&t.insertBefore(l,u[v]||null)}if(h)for(var v in p)p[v]&&N(p[v]);f<m&&P(c)}function P(t,e){for(var n=t.length;n--;)t[n]&&N(t[n],e)}function N(t,e){var n=t._component;n?k(n,!e):(t[$]&&t[$].ref&&t[$].ref(null),e||S(t),t.childNodes&&t.childNodes.length&&P(t.childNodes,e))}function j(t,e,n){for(var r in n)e&&r in e||null==n[r]||y(t,r,n[r],n[r]=void 0,Q);if(e)for(var o in e)"children"===o||"innerHTML"===o||o in n&&e[o]===("value"===o||"checked"===o?t[o]:n[o])||y(t,o,n[o],n[o]=e[o],Q)}function R(t){var e=t.constructor.name,n=tt[e];n?n.push(t):tt[e]=[t]}function B(t,e,n){var r=new t(e,n),o=tt[t.name];if(D.call(r,e,n),o)for(var i=o.length;i--;)if(o[i].constructor===t){r.nextBase=o[i].nextBase,o.splice(i,1);break}return r}function M(t,e,n,r,o){t._disable||(t._disable=!0,(t.__ref=e.ref)&&delete e.ref,(t.__key=e.key)&&delete e.key,!t.base||o?t.componentWillMount&&t.componentWillMount():t.componentWillReceiveProps&&t.componentWillReceiveProps(e,r),r&&r!==t.context&&(t.prevContext||(t.prevContext=t.context),t.context=r),t.prevProps||(t.prevProps=t.props),t.props=e,t._disable=!1,0!==n&&(1!==n&&F.syncComponentUpdates===!1&&t.base?p(t):_(t,1,o)),t.__ref&&t.__ref(t))}function _(t,e,n,i){if(!t._disable){var s,l,u,c,p=t.props,h=t.state,g=t.context,m=t.prevProps||p,v=t.prevState||h,y=t.prevContext||g,w=t.base,x=t.nextBase,S=w||x,O=t._component;if(w&&(t.props=m,t.state=v,t.context=y,2!==e&&t.shouldComponentUpdate&&t.shouldComponentUpdate(p,h,g)===!1?s=!0:t.componentWillUpdate&&t.componentWillUpdate(p,h,g),t.props=p,t.state=h,t.context=g),t.prevProps=t.prevState=t.prevContext=t.nextBase=null,t._dirty=!1,!s){for(t.render&&(l=t.render(p,h,g)),t.getChildContext&&(g=r(o(g),t.getChildContext()));f(l);)l=d(l,g);var A,C,P=l&&l.nodeName;if(a(P)){u=O;var j=b(l);u&&u.constructor===P?M(u,j,1,g):(A=u,u=B(P,j,g),u.nextBase=u.nextBase||x,u._parentComponent=t,t._component=u,M(u,j,0,g),_(u,1,n,!0)),C=u.base}else c=S,A=O,A&&(c=t._component=null),(S||1===e)&&(c&&(c._component=null),C=E(c,l,g,n||!w,S&&S.parentNode,!0));if(S&&C!==S&&u!==O){var R=S.parentNode;R&&C!==R&&R.replaceChild(C,S),c||A||!t._parentComponent||(S._component=null,N(S))}if(A&&k(A,C!==S),t.base=C,C&&!i){for(var I=t,D=t;D=D._parentComponent;)I=D;C._component=I,C._componentConstructor=I.constructor}}!w||n?Z.unshift(t):!s&&t.componentDidUpdate&&t.componentDidUpdate(m,v,y);var L,F=t._renderCallbacks;if(F)for(;L=F.pop();)L.call(t);J||i||T()}}function I(t,e,n,r){for(var o=t&&t._component,i=t,a=o&&t._componentConstructor===e.nodeName,s=a,l=b(e);o&&!s&&(o=o._parentComponent);)s=o.constructor===e.nodeName;return o&&s&&(!r||o._component)?(M(o,l,3,n,r),t=o.base):(o&&!a&&(k(o,!0),t=i=null),o=B(e.nodeName,l,n),t&&!o.nextBase&&(o.nextBase=t),M(o,l,1,n,r),t=o.base,i&&t!==i&&(i._component=null,N(i))),t}function k(t,e){var n=t.base;t._disable=!0,t.componentWillUnmount&&t.componentWillUnmount(),t.base=null;var r=t._component;r?k(r,e):n&&(n[$]&&n[$].ref&&n[$].ref(null),t.nextBase=n,e&&(v(n),R(t)),P(n.childNodes,!e)),t.__ref&&t.__ref(null),t.componentDidUnmount&&t.componentDidUnmount()}function D(t,e){this._dirty=!0,this.context=e,this.props=t,this.state||(this.state={})}function L(t,e,n){return E(n,t,{},!1,e)}var F={},G=[],U={},H=function(t){return U[t]||(U[t]=t.toLowerCase())},z="undefined"!=typeof Promise&&Promise.resolve(),V=z?function(t){z.then(t)}:setTimeout,W={},$="undefined"!=typeof Symbol?Symbol.for("preactattr"):"__preactattr_",Y={boxFlex:1,boxFlexGroup:1,columnCount:1,fillOpacity:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,fontWeight:1,lineClamp:1,lineHeight:1,opacity:1,order:1,orphans:1,strokeOpacity:1,widows:1,zIndex:1,zoom:1},q={blur:1,error:1,focus:1,load:1,resize:1,scroll:1},K=[],X={},Z=[],J=0,Q=!1,tt={};r(D.prototype,{linkState:function(t,e){var n=this._linkedStates||(this._linkedStates={});return n[t+e]||(n[t+e]=c(this,t,e))},setState:function(t,e){var n=this.state;this.prevState||(this.prevState=o(n)),r(n,a(t)?t(n,this.props):t),e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),p(this)},forceUpdate:function(){_(this,2)},render:function(){}}),t.h=n,t.cloneElement=u,t.Component=D,t.render=L,t.rerender=h,t.options=F})},{}],18:[function(t,e,n){"use strict";var r=t("strict-uri-encode");n.extract=function(t){return t.split("?")[1]||""},n.parse=function(t){return"string"!=typeof t?{}:(t=t.trim().replace(/^(\?|#|&)/,""),t?t.split("&").reduce(function(t,e){var n=e.replace(/\+/g," ").split("="),r=n.shift(),o=n.length>0?n.join("="):void 0;return r=decodeURIComponent(r),o=void 0===o?null:decodeURIComponent(o),t.hasOwnProperty(r)?Array.isArray(t[r])?t[r].push(o):t[r]=[t[r],o]:t[r]=o,t},{}):{})},n.stringify=function(t){return t?Object.keys(t).sort().map(function(e){var n=t[e];return Array.isArray(n)?n.sort().map(function(t){return r(e)+"="+r(t)}).join("&"):r(e)+"="+r(n)}).filter(function(t){return t.length>0}).join("&"):""}},{"strict-uri-encode":19}],19:[function(t,e,n){"use strict";e.exports=function(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}},{}],20:[function(t,e,n){function r(t){return(!a||!t.ctrlKey&&!t.altKey&&!t.metaKey)&&t.key||(t.shiftKey?i:o)[t.keyCode]||t.key||"Unidentified"}var o={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},i={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:";",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"};const a="undefined"!=typeof navigator&&/Chrome\//.test(navigator.userAgent);for(var s=0;s<10;s++)o[48+s]=o[96+s]=String(s);for(var s=1;s<=24;s++)o[s+111]="F"+s;for(var s=65;s<=90;s++)o[s]=String.fromCharCode(s+32),i[s]=String.fromCharCode(s);for(var l in o)i.hasOwnProperty(l)||(i[l]=o[l]);e.exports=r,r.base=o,r.shift=i},{}],21:[function(t,e,n){function r(t,e,n,r){return new Promise(function(o,i){function a(){t().then(function(t){try{var r=e(t);r?o(t):setTimeout(a,n)}catch(t){i(t)}},function(t){return i(t)})}setTimeout(a,r||0)})}function o(t,e){return t.replace(/:(\w+)/g,function(t,n){return e[n]})}function i(t,e){function n(t,e,n,r){return n&&"GET"==t&&(e=o(e,n)),fetch(a+e,{method:t,headers:Object.assign({Accept:"application/json"},r),body:"GET"!=t?n:null,credentials:"same-origin"}).then(function(t){return t.json().then(function(e){return t.ok?e:Promise.reject(e.error)})}).catch(function(t){throw"Cannot parse result\n"+t})}function i(t,r,o){return function(i,a){var l=Object.assign({},o,i);return l.options=Object.assign(l.options||{},e,a),s.then(function(){return n(t,r,JSON.stringify(l),{"Content-Type":"application/json"})})}}var a=!t||/\/$/.test(t)?t:t+"/",s=n("GET","indigo/info").then(function(t){return{indigoVersion:t.Indigo.version}}).catch(function(){throw Error("Server is not compatible")});return Object.assign(s,{convert:i("POST","indigo/convert"),layout:i("POST","indigo/layout"),clean:i("POST","indigo/clean"),aromatize:i("POST","indigo/aromatize"),dearomatize:i("POST","indigo/dearomatize"),calculateCip:i("POST","indigo/calculate_cip"),automap:i("POST","indigo/automap"),check:i("POST","indigo/check"),calculate:i("POST","indigo/calculate"),recognize:function(t){var e=n("POST","imago/uploads",t,{"Content-Type":t.type||"application/octet-stream"}),o=n.bind(null,"GET","imago/uploads/:id");return e.then(function(t){return r(o.bind(null,{id:t.upload_id}),function(t){if("FAILURE"===t.state)throw t;return"SUCCESS"===t.state},500,300)}).then(function(t){return{struct:t.metadata.mol_str}})}})}e.exports=i},{}],22:[function(t,e,n){function r(t,e,n,r,o){return{label:t,period:e,group:n,putHydrogenOnTheLeft:r,color:o||"#000000"}}var o=[null,r("H",1,1,!1,"#000000"),r("He",1,8,!1,"#d9ffff"),r("Li",2,1,!1,"#cc80ff"),r("Be",2,2,!1,"#c2ff00"),r("B",2,3,!1,"#ffb5b5"),r("C",2,4,!1,"#000000"),r("N",2,5,!1,"#304ff7"),r("O",2,6,!0,"#ff0d0d"),r("F",2,7,!0,"#8fe04f"),r("Ne",2,8,!1,"#b3e3f5"),r("Na",3,1,!1,"#ab5cf2"),r("Mg",3,2,!1,"#8aff00"),r("Al",3,3,!1,"#bfa6a6"),r("Si",3,4,!1,"#f0c7a1"),r("P",3,5,!1,"#ff8000"),r("S",3,6,!0,"#d9a61a"),r("Cl",3,7,!0,"#1fd01f"),r("Ar",3,8,!1,"#80d1e3"),r("K",4,1,!1,"#8f40d4"),r("Ca",4,2,!1,"#3dff00"),r("Sc",4,3,!1,"#e6e6e6"),r("Ti",4,4,!1,"#bfc2c7"),r("V",4,5,!1,"#a6a6ab"),r("Cr",4,6,!1,"#8a99c7"),r("Mn",4,7,!1,"#9c7ac7"),r("Fe",4,8,!1,"#e06633"),r("Co",4,8,!1,"#f08fa1"),r("Ni",4,8,!1,"#4fd14f"),r("Cu",4,1,!1,"#c78033"),r("Zn",4,2,!1,"#7d80b0"),r("Ga",4,3,!1,"#c28f8f"),r("Ge",4,4,!1,"#668f8f"),r("As",4,5,!1,"#bd80e3"),r("Se",4,6,!0,"#ffa100"),r("Br",4,7,!0,"#a62929"),r("Kr",4,8,!1,"#5cb8d1"),r("Rb",5,1,!1,"#702eb0"),r("Sr",5,2,!1,"#00ff00"),r("Y",5,3,!1,"#94ffff"),r("Zr",5,4,!1,"#94e0e0"),r("Nb",5,5,!1,"#73c2c9"),r("Mo",5,6,!1,"#54b5b5"),r("Tc",5,7,!1,"#3b9e9e"),r("Ru",5,8,!1,"#248f8f"),r("Rh",5,8,!1,"#0a7d8c"),r("Pd",5,8,!1,"#006985"),r("Ag",5,1,!1,"#bfbfbf"),r("Cd",5,2,!1,"#ffd98f"),r("In",5,3,!1,"#a67573"),r("Sn",5,4,!1,"#668080"),r("Sb",5,5,!1,"#9e63b5"),r("Te",5,6,!1,"#d47a00"),r("I",5,7,!0,"#940094"),r("Xe",5,8,!1,"#429eb0"),r("Cs",6,1,!1,"#57178f"),r("Ba",6,2,!1,"#00c900"),r("La",6,3,!1,"#70d4ff"),r("Ce",6,3,!1,"#ffffc7"),r("Pr",6,3,!1,"#d9ffc7"),r("Nd",6,3,!1,"#c7ffc7"),r("Pm",6,3,!1,"#a3ffc7"),r("Sm",6,3,!1,"#8fffc7"),r("Eu",6,3,!1,"#61ffc7"),r("Gd",6,3,!1,"#45ffc7"),r("Tb",6,3,!1,"#30ffc7"),r("Dy",6,3,!1,"#1fffc7"),r("Ho",6,3,!1,"#00ff9c"),r("Er",6,3,!1,"#00e675"),r("Tm",6,3,!1,"#00d452"),r("Yb",6,3,!1,"#00bf38"),r("Lu",6,3,!1,"#00ab24"),r("Hf",6,4,!1,"#4dc2ff"),r("Ta",6,5,!1,"#4da6ff"),r("W",6,6,!1,"#2194d6"),r("Re",6,7,!1,"#267dab"),r("Os",6,8,!1,"#266696"),r("Ir",6,8,!1,"#175487"),r("Pt",6,8,!1,"#d1d1e0"),r("Au",6,1,!1,"#ffd124"),r("Hg",6,2,!1,"#b8b8d1"),r("Tl",6,3,!1,"#a6544d"),r("Pb",6,4,!1,"#575961"),r("Bi",6,5,!1,"#9e4fb5"),r("Po",6,6,!1,"#ab5c00"),r("At",6,7,!1,"#754f45"),r("Rn",6,8,!1,"#428296"),r("Fr",7,1,!1,"#420066"),r("Ra",7,2,!1,"#007d00"),r("Ac",7,3,!1,"#70abfa"),r("Th",7,3,!1,"#00baff"),r("Pa",7,3,!1,"#00a1ff"),r("U",7,3,!1,"#008fff"),r("Np",7,3,!1,"#0080ff"),r("Pu",7,3,!1,"#006bff"),r("Am",7,3,!1,"#545cf2"),r("Cm",7,3,!1,"#785ce3"),r("Bk",7,3,!1,"#8a4fe3"),r("Cf",7,3,!1,"#a136d4"),r("Es",7,3,!1,"#b31fd4"),r("Fm",7,3,!1,"#000000"),r("Md",7,3,!1,"#000000"),r("No",7,3,!1,"#000000"),r("Lr",7,3,!1,"#000000"),r("Rf",7,4,!1,"#4dc2ff"),r("Db",7,5,!1,"#4da6ff"),r("Sg",7,6,!1,"#2194d6"),r("Bh",7,7,!1,"#267dab"),r("Hs",7,8,!1,"#266696"),r("Mt",7,8,!1,"#175487"),r("Ds",7,8,!1,"#d1d1e0"),r("Rg",7,1,!1,"#ffd124"),r("Cn",7,2,!1,"#b8b8d1"),r("Uut",7,3,!1),r("Fl",7,4,!1),r("Uup",7,5,!1),r("Lv",7,6,!1),r("Uus",7,7,!1),r("Uuo",7,8,!1)],i=o.reduce(function(t,e,n){return e&&(t[e.label]=n),t},{});o.getElementByLabel=function(t){return i[t]||null},e.exports=o},{}],23:[function(t,e,n){var r=[{label:"A"},{label:"Q"},{label:"X"},{label:"M"}];e.exports=r},{}],24:[function(t,e,n){function r(t){this.molecule=null,this.molfile=null,this.v3000=t||!1}function o(t){var e=parseInt(t,10);return isNaN(e)?0:e}function i(t,e,n){for(var r=[],o=0,i=0;o<e.length;++o)r.push(t.slice(i,i+e[o])),n&&i++,i+=e[o];return r}function a(t,e,n){for(var r=[],o=0;o<t.length;o+=e)r.push(t.slice(o,o+e)),n&&o++;return r}function s(t,e){var n=new r,o=mt(t);try{return n.parseCTFile(o)}catch(t){if(e.badHeaderRecover){try{return n.parseCTFile(o.slice(1))}catch(t){}try{return n.parseCTFile([""].concat(o))}catch(t){}}throw t}}function l(t){var e=i(t,Tt.atomLinePartition),n={pp:new yt(parseFloat(e[0]),(-parseFloat(e[1])),parseFloat(e[2])),label:e[4].strip(),explicitValence:Tt.valenceMap[o(e[10])],massDifference:o(e[5]),charge:Tt.chargeMap[o(e[6])],hCount:o(o(e[8])),stereoCare:0!=o(e[9]),aam:o(e[14]),invRet:o(e[15]),exactChangeFlag:0!=o(e[16])};return new St.Atom(n)}function u(t){if("M  V30 "!=t.slice(0,7))throw Error("Prefix invalid");return t.slice(7)}function c(t){var e,n,r,i,a;e=F(t);var s={pp:new yt(parseFloat(e[2]),(-parseFloat(e[3])),parseFloat(e[4])),aam:e[5].strip()},l=e[1].strip();if('"'==l.charAt(0)&&'"'==l.charAt(l.length-1)&&(l=l.substr(1,l.length-2)),"]"==l.charAt(l.length-1)){l=l.substr(0,l.length-1);var u={};if(u.notList=!1,"NOT ["==l.substr(0,5))u.notList=!0,l=l.substr(5);else{if("["!=l.charAt(0))throw"Error: atom list expected, found '"+l+"'";l=l.substr(1)}u.ids=m(l.split(",")),s.atomList=new St.AtomList(u),s.label="L#"}else s.label=l;for(e.splice(0,6),a=0;a<e.length;++a)if(n=G(e[a],"="),r=n[0],i=n[1],r in Tt.v30atomPropMap){var c=o(i);if("VAL"==r){if(0==c)continue;c==-1&&(c=0)}s[Tt.v30atomPropMap[r]]=c}else if("RGROUPS"==r){i=i.strip().substr(1,i.length-2);var p=i.split(" ").slice(1);s.rglabel=0;for(var h=0;h<p.length;++h)s.rglabel|=1<<p[h]-1}else"ATTCHPT"==r&&(s.attpnt=i.strip()-0);return new St.Atom(s)}function p(t){var e,n,r,i,a;e=F(t);var s={begin:o(e[2])-1,end:o(e[3])-1,type:Tt.bondTypeMap[o(e[1])]};for(e.splice(0,4),a=0;a<e.length;++a)n=G(e[a],"="),r=n[0],i=n[1],"CFG"==r?(s.stereo=Tt.v30bondStereoMap[o(i)],s.type==St.Bond.PATTERN.TYPE.DOUBLE&&s.stereo==St.Bond.PATTERN.STEREO.EITHER&&(s.stereo=St.Bond.PATTERN.STEREO.CIS_TRANS)):"TOPO"==r?s.topology=Tt.bondTopologyMap[o(i)]:"RXCTR"==r?s.reactingCenterStatus=o(i):"STBOX"==r&&(s.stereoCare=o(i));return new St.Bond(s)}function h(t){var e=i(t,Tt.bondLinePartition),n={begin:o(e[0])-1,end:o(e[1])-1,type:Tt.bondTypeMap[o(e[2])],stereo:Tt.bondStereoMap[o(e[3])],topology:Tt.bondTopologyMap[o(e[5])],reactingCenterStatus:o(e[6])};return new St.Bond(n)}function f(t){for(var e=i(t,Tt.atomListHeaderPartition),n=o(e[0])-1,r="T"==e[2].strip(),a=o(e[4].strip()),s=t.slice(Tt.atomListHeaderLength),l=[],u=Tt.atomListHeaderItemLength,c=0;c<a;++c)l[c]=o(s.slice(c*u,(c+1)*u-1));return{aid:n,atomList:new St.AtomList({notList:r,ids:l})}}function d(t,e){for(var n={},r=a(t,3,!0),i=o(r[0]),s=0;s<i;++s)n[o(r[2*s+1])-1]=e?r[2*s+2].strip():o(r[2*s+2]);return n}function g(t,e){for(var n=[],r=a(t,3,!0),i=o(r[0]),s=0;s<i;++s)n.push([o(r[2*s+1])-1,e?r[2*s+2].strip():o(r[2*s+2])]);return n}function m(t){for(var e=[],n=0;n<t.length;++n)e.push(xt.getElementByLabel(t[n].strip()));return e}function b(t,e){var n=o(t[1])-1,r=o(t[2]),i="T"==t[4].strip(),a=m(e.slice(0,r)),s={};return s[n]=new St.AtomList({notList:i,ids:a}),s}function v(t,e,n){t.data.mul=t.data.subscript-0;var r={};t.atoms=St.SGroup.filterAtoms(t.atoms,n),t.patoms=St.SGroup.filterAtoms(t.patoms,n);for(var o=1;o<t.data.mul;++o)for(var i=0;i<t.patoms.length;++i){var a=t.atoms[o*t.patoms.length+i];if(!(a<0)){if(t.patoms[i]<0)throw new Error("parent atom missing");r[a]=t.patoms[i]}}t.patoms=St.SGroup.removeNegative(t.patoms);var s=dt(t.patoms),l=[];e.bonds.each(function(t,e){var n=e.begin in r,o=e.end in r;n&&o||n&&e.end in s||o&&e.begin in s?l.push(t):n?e.begin=r[e.begin]:o&&(e.end=r[e.end])},t);for(var u=0;u<l.length;++u)e.bonds.remove(l[u]);for(var c in r)e.atoms.remove(c),n[c]=-1;t.atoms=t.patoms,t.patoms=null}function y(t){t.data.connectivity=(t.data.connectivity||"EU").strip().toLowerCase()}function w(t){t.data.name=(t.data.subscript||"").strip(),t.data.subscript=""}function x(t,e,n){}function S(t,e){t.data.absolute||(t.pp=t.pp.add(St.SGroup.getMassCentre(e,t.atoms)))}function O(t,e,n){var r={MUL:v,SRU:y,SUP:w,DAT:S,GEN:x};e.id=t.sgroups.add(e),r[e.type](e,t,n);for(var o=0;o<e.atoms.length;++o)t.atoms.has(e.atoms[o])&&vt.add(t.atoms.get(e.atoms[o]).sgs,e.id);return"DAT"==e.type?t.sGroupForest.insert(e.id,-1,[]):t.sGroupForest.insert(e.id),e.id}function T(t,e){var n=d(e,!0);for(var r in n){var o=n[r];if(!(o in St.SGroup.TYPES))throw new Error("Unsupported S-group type");var i=new St.SGroup(o);i.number=r,t[r]=i}}function E(t,e,n,r,o){var i=d(n,!r);for(var a in i)(o?t[a]:t[a].data)[e]=i[a]}function A(t){for(var e=[],n=0;n<t.length;++n)e[n]=o(t[n]);return e}function C(t,e,n,r){var i=o(n.slice(1,4))-1,s=o(n.slice(4,8)),l=A(a(n.slice(8),3,!0));if(l.length!=s)throw new Error("File format invalid");r&&(l=l.map(function(t){return t+r})),t[i][e]=t[i][e].concat(l)}function P(t,e){t.data.fieldName=e}function N(t,e){t.data.query=e}function j(t,e){t.data.queryOp=e}function R(t,e){var n=i(e,[4,31,2,20,2,3],!1),r=o(n[0])-1,a=n[1].strip(),s=n[2].strip(),l=n[3].strip(),u=n[4].strip(),c=n[5].strip(),p=t[r];p.data.fieldType=s,p.data.fieldName=a,p.data.units=l,p.data.query=u,p.data.queryOp=c}function B(t,e){var n=i(e,[10,10,4,1,1,1,3,3,3,3,2,3,2],!1),r=parseFloat(n[0]),a=parseFloat(n[1]),s="A"==n[3].strip(),l="A"==n[4].strip(),u="U"==n[5].strip(),c=n[7].strip();c="ALL"==c?-1:o(c);var p=n[10].strip(),h=o(n[11].strip());t.pp=new yt(r,(-a)),t.data.attached=s,t.data.absolute=l,t.data.showUnits=u,t.data.nCharsToDisplay=c,t.data.tagChar=p,t.data.daspPos=h}function M(t,e){var n=o(e.substr(0,4))-1,r=t[n];B(r,e.substr(5))}function _(t,e,n){t.data.fieldValue=(t.data.fieldValue||"")+e,n&&(t.data.fieldValue=t.data.fieldValue.trimRight(),t.data.fieldValue.startsWith('"')&&t.data.fieldValue.endsWith('"')&&(t.data.fieldValue=t.data.fieldValue.substr(1,t.data.fieldValue.length-2)))}function I(t,e,n){var r=o(e.substr(0,5))-1,i=e.substr(5),a=t[r];_(a,i,n)}function k(t,e,n,r,s,l){for(var u=new bt;n<r;){var c=e[n];if("A"==c.charAt(0))u.get("label")||u.set("label",new bt),u.get("label").set(o(c.slice(3,6))-1,e[++n]);else if("M"==c.charAt(0)){var p=c.slice(3,6),h=c.slice(6);if("END"==p)break;if("CHG"==p)u.get("charge")||u.set("charge",new bt),u.get("charge").update(d(h));else if("RAD"==p)u.get("radical")||u.set("radical",new bt),u.get("radical").update(d(h));else if("ISO"==p)u.get("isotope")||u.set("isotope",new bt),u.get("isotope").update(d(h));else if("RBC"==p)u.get("ringBondCount")||u.set("ringBondCount",new bt),u.get("ringBondCount").update(d(h));else if("SUB"==p)u.get("substitutionCount")||u.set("substitutionCount",new bt),u.get("substitutionCount").update(d(h));else if("UNS"==p)u.get("unsaturatedAtom")||u.set("unsaturatedAtom",new bt),u.get("unsaturatedAtom").update(d(h));else if("RGP"==p){u.get("rglabel")||u.set("rglabel",new bt);for(var f=u.get("rglabel"),m=g(h),v=0;v<m.length;v++){var y=m[v];f.set(y[0],(f.get(y[0])||0)|1<<y[1]-1)}}else if("LOG"==p){h=h.slice(4);var w=o(h.slice(0,3).strip()),x=o(h.slice(4,7).strip()),S=o(h.slice(8,11).strip()),O=h.slice(12).strip(),A={};x>0&&(A.ifthen=x),A.resth=1==S,A.range=O,l[w]=A}else if("APO"==p)u.get("attpnt")||u.set("attpnt",new bt),u.get("attpnt").update(d(h));else if("ALS"==p){u.get("atomList")||u.set("atomList",new bt);var P=b(i(h,[1,3,3,1,1,1]),a(h.slice(10),4,!1));u.get("atomList").update(P),u.get("label")||u.set("label",new bt);for(var N in P)u.get("label").set(N,"L#")}else if("STY"==p)T(s,h);else if("SST"==p)E(s,"subtype",h);else if("SLB"==p)E(s,"label",h,!0);else if("SPL"==p)E(s,"parent",h,!0,!0);else if("SCN"==p)E(s,"connectivity",h);else if("SAL"==p)C(s,"atoms",h,-1);else if("SBL"==p)C(s,"bonds",h,-1);else if("SPA"==p)C(s,"patoms",h,-1);else if("SMT"==p){var j=o(h.slice(0,4))-1;s[j].data.subscript=h.slice(4).strip()}else"SDT"==p?R(s,h):"SDD"==p?M(s,h):"SCD"==p?I(s,h,!1):"SED"==p&&I(s,h,!0)}++n}return u}function D(t,e,n){e.each(function(e,r){t.get(e)[n]=r})}function L(t,e){var n,r=new St,i=o(e[0]),a=o(e[1]),s=o(e[2]);r.isChiral=0!=o(e[4]);var u=o(e[5]),c=o(e[10]),p=0,d=t.slice(p,p+i);p+=i;var g=t.slice(p,p+a);p+=a;var m=t.slice(p,p+s);p+=s+u;var b=d.map(l);for(n=0;n<b.length;++n)r.atoms.add(b[n]);var v=g.map(h);for(n=0;n<v.length;++n)r.bonds.add(v[n]);var y=m.map(f);y.each(function(t){r.atoms.get(t.aid).atomList=t.atomList,r.atoms.get(t.aid).label="L#"});var w={},x={},S=k(r,t,p,Math.min(t.length,p+c),w,x);S.each(function(t,e){D(r.atoms,e,t)});var T,E={};for(T in w){var A=w[T];if("DAT"===A.type&&0===A.atoms.length){var C=w[T].parent;if(C>=0){var P=w[C-1];"GEN"===P.type&&(A.atoms=[].slice.call(P.atoms))}}}for(T in w)O(r,w[T],E);var N=[];for(T in w)St.SGroup.filter(r,w[T],E),0!=w[T].atoms.length||w[T].allAtoms||N.push(T);for(n=0;n<N.length;++n)r.sGroupForest.remove(N[n]),r.sgroups.remove(N[n]);for(var j in x)r.rgroups.set(j,new St.RGroup(x[j]));return r}function F(t){var e,n,r=[],o=0,i=-1,a=t.toArray(),s=!1;for(n=0;n<t.length;++n)e=a[n],"("==e?o++:")"==e&&o--,'"'==e&&(s=!s),s||" "!=a[n]||0!=o||(n>i+1&&r.push(t.slice(i+1,n)),i=n);return n>i+1&&r.push(t.slice(i+1,n)),i=n,r}function G(t,e){var n=t.indexOf(e);return[t.slice(0,n),t.slice(n+1)]}function U(t){for(var e=[],n=0,r=!1,o=0;o<t.length;++o){var i=t.charAt(o);'"'==i?r=!r:r||("("==i?n++:")"==i?n--:" "==i&&0==n&&(e.push(t.slice(0,o)),t=t.slice(o+1).strip(),o=0))}if(0!=n)throw"Brace balance broken. S-group properies invalid!";return t.length>0&&e.push(t.strip()),e}function H(t,e){if(!t)return null;var n=[];t=t.strip(),t=t.substr(1,t.length-2);
var r=t.split(" ");e=e||0;for(var o=1;o<r.length;++o)n.push(r[o]-0+e);return n}function z(t,e,n){for(n++;"M  V30 END COLLECTION"!=e[n].strip();)n++;return n++,n}function V(t,e,n,r,o){var i="";for(o++;o<e.length;){if(i=u(e[o++]).strip(),"END SGROUP"==i.strip())return o;for(;"-"==i.charAt(i.length-1);)i=(i.substr(0,i.length-1)+u(e[o++])).strip();var a=U(i),s=a[1],l=new St.SGroup(s);l.number=a[0]-0,l.type=s,l.label=a[2]-0,n[l.number]=l;for(var c={},p=3;p<a.length;++p){var h=G(a[p],"=");if(2!=h.length)throw"A record of form AAA=BBB or AAA=(...) expected, got '"+a[p]+"'";var f=h[0];f in c||(c[f]=[]),c[f].push(h[1])}l.atoms=H(c.ATOMS[0],-1),c.PATOMS&&(l.patoms=H(c.PATOMS[0],-1)),l.bonds=c.BONDS?H(c.BONDS[0],-1):[];var d=c.BRKXYZ;if(l.brkxyz=[],d)for(var g=0;g<d.length;++g)l.brkxyz.push(H(d[g]));c.MULT&&(l.data.subscript=c.MULT[0]-0),c.LABEL&&(l.data.subscript=c.LABEL[0].strip()),c.CONNECT&&(l.data.connectivity=c.CONNECT[0].toLowerCase()),c.FIELDDISP&&B(l,ft(c.FIELDDISP[0])),c.FIELDDATA&&_(l,c.FIELDDATA[0],!0),c.FIELDNAME&&P(l,c.FIELDNAME[0]),c.QUERYTYPE&&N(l,c.QUERYTYPE[0]),c.QUERYOP&&j(l,c.QUERYOP[0]),O(t,l,r)}throw new Error("S-group declaration incomplete.")}function W(t,e){var n=new St,r=0;if("M  V30 BEGIN CTAB"!=t[r++].strip())throw Error("CTAB V3000 invalid");if("M  V30 COUNTS"!=t[r].slice(0,13))throw Error("CTAB V3000 invalid");var i=t[r].slice(14).split(" ");if(n.isChiral=1==o(i[4]),r++,"M  V30 BEGIN ATOM"==t[r].strip()){r++;for(var a;r<t.length&&(a=u(t[r++]).strip(),"END ATOM"!=a);){for(;"-"==a.charAt(a.length-1);)a=(a.substring(0,a.length-1)+u(t[r++])).strip();n.atoms.add(c(a))}if("M  V30 BEGIN BOND"==t[r].strip())for(r++;r<t.length&&(a=u(t[r++]).strip(),"END BOND"!=a);){for(;"-"==a.charAt(a.length-1);)a=(a.substring(0,a.length-1)+u(t[r++])).strip();n.bonds.add(p(a))}for(var s={},l={};"M  V30 END CTAB"!=t[r].strip();)if("M  V30 BEGIN COLLECTION"==t[r].strip())r=z(n,t,r);else{if("M  V30 BEGIN SGROUP"!=t[r].strip())throw Error("CTAB V3000 invalid");r=V(n,t,s,l,r)}}if("M  V30 END CTAB"!=t[r++].strip())throw Error("CTAB V3000 invalid");return e||$(n,t.slice(r)),n}function $(t,e){for(var n={},r={},i=0;i<e.length&&0==e[i].search("M  V30 BEGIN RGROUP");){var a=e[i++].split(" ").pop();for(n[a]=[],r[a]={};;){var s=e[i].strip();if(0!=s.search("M  V30 RLOGIC")){if("M  V30 BEGIN CTAB"!=s)throw Error("CTAB V3000 invalid");for(var l=0;l<e.length&&"M  V30 END CTAB"!=e[i+l].strip();++l);var u=e.slice(i,i+l+1),c=W(u,!0);if(n[a].push(c),i=i+l+1,"M  V30 END RGROUP"==e[i].strip()){i++;break}}else{s=s.slice(13);var p=s.strip().split(/\s+/g),h=o(p[0]),f=o(p[1]),d=p.slice(2).join(" "),g={};h>0&&(g.ifthen=h),g.resth=1==f,g.range=d,r[a]=g,i++}}}for(var m in n)for(var b=0;b<n[m].length;++b){var v=n[m][b];v.rgroups.set(m,new St.RGroup(r[m]));var y=v.frags.add({});v.rgroups.get(m).frags.add(y),v.atoms.each(function(t,e){e.fragment=y}),v.mergeInto(t)}}function Y(t){if(0==t[0].search("\\$MDL"))return pt(t);var e=q(t.slice(3));return e.name=t[0].strip(),e}function q(t){var e=i(t[0],Tt.countsLinePartition),n=e[11].strip();if(t=t.slice(1),"V2000"==n)return L(t,e);if("V3000"==n)return W(t,!r.loadRGroupFragments);throw Error("Molfile version unknown: "+n)}function K(t,e){var n=[];if(e.bonds.each(function(r,o){var i=e.atoms.get(o.begin),a=e.atoms.get(o.end);(vt.contains(i.sgs,t.id)&&!vt.contains(a.sgs,t.id)||vt.contains(a.sgs,t.id)&&!vt.contains(i.sgs,t.id))&&n.push(r)},t),0!=n.length&&2!=n.length)throw{id:t.id,"error-type":"cross-bond-number",message:"Unsupported cross-bonds number"};t.bonds=n}function X(t,e){var n=[];e.bonds.each(function(r,o){var i=e.atoms.get(o.begin),a=e.atoms.get(o.end);(vt.contains(i.sgs,t.id)&&!vt.contains(a.sgs,t.id)||vt.contains(a.sgs,t.id)&&!vt.contains(i.sgs,t.id))&&n.push(r)},t),t.bonds=n}function Z(t,e){}function J(t,e){t.atoms=St.SGroup.getAtoms(e,t)}function Q(t,e,n,r){if(!n)return[];for(var o=[],i=0;i<Math.floor((n.length+14)/15);++i){for(var a=Math.min(n.length-15*i,15),s="M  "+t+" "+e+" "+ht(a,2),l=0;l<a;++l)s+=" "+ht(r[n[15*i+l]],3);o.push(s)}return o}function tt(t,e,n){var r=[],o=[],i=vt.fromList(e.atoms);St.SGroup.getCrossBonds(r,o,t,i),St.SGroup.bracketPos(e,null,t,o);for(var a=e.bracketBox,s=e.bracketDir,l=s.rotateSC(1,0),u=St.SGroup.getBracketParameters(t,o,i,a,s,l,null,e.id),c=[],p=0;p<u.length;++p){for(var h=u[p],f=h.c.addScaled(h.n,-.5*h.h).yComplement(),d=h.c.addScaled(h.n,.5*h.h).yComplement(),g="M  SDI "+n+ht(4,3),m=[f.x,f.y,d.x,d.y],b=0;b<m.length;++b)g+=ht(m[b],10,4);c.push(g)}return c}function et(t,e,n,r,o){var i=(n[t.id]+"").padStart(3),a=[];a=a.concat(Q("SAL",i,Object.keys(t.atomSet),r)),a=a.concat(Q("SPA",i,Object.keys(t.parentAtomSet),r)),a=a.concat(Q("SBL",i,t.bonds,o));var s="M  SMT "+i+" "+t.data.mul;return a.push(s),a=a.concat(tt(e,t,i)),a.join("\n")}function nt(t,e,n,r,o){var i=(n[t.id]+"").padStart(3),a=[];return a=a.concat(Q("SAL",i,t.atoms,r)),a=a.concat(Q("SBL",i,t.bonds,o)),a=a.concat(tt(e,t,i)),a.join("\n")}function rt(t,e,n,r,o){var i=(n[t.id]+"").padStart(3),a=[];return a=a.concat(Q("SAL",i,t.atoms,r)),a=a.concat(Q("SBL",i,t.bonds,o)),t.data.name&&""!=t.data.name&&a.push("M  SMT "+i+" "+t.data.name),a.join("\n")}function ot(t,e,n,r){var o=(n[t.id]+"").padStart(3),i=t.data,a=t.pp;i.absolute||(a=a.sub(St.SGroup.getMassCentre(e,t.atoms)));var s=[];s=s.concat(Q("SAL",o,t.atoms,r));var l="M  SDT "+o+" "+(i.fieldName||"").padEnd(30)+(i.fieldType||"").padStart(2)+(i.units||"").padEnd(20)+(i.query||"").padStart(2);i.queryOp&&(l+=i.queryOp.padEnd(15)),s.push(l);var u="M  SDD "+o+" "+ht(a.x,10,4)+ht(-a.y,10,4)+"    "+(i.attached?"A":"D")+(i.absolute?"A":"R")+(i.showUnits?"U":" ")+"   "+(i.nCharnCharsToDisplay>=0?ht(i.nCharnCharsToDisplay,3):"ALL")+"  1   "+(i.tagChar||" ")+"  "+ht(i.daspPos,1)+"  ";s.push(u);var c=gt(i.fieldValue).replace(/\n*$/,""),p=69;return c.split("\n").each(function(t){for(;t.length>p;)s.push("M  SCD "+o+" "+t.slice(0,p)),t=t.slice(p);s.push("M  SED "+o+" "+t)}),s.join("\n")}function it(t,e,n,r,o){var i=(n[t.id]+"").padStart(3),a=[];return a=a.concat(Q("SAL",i,t.atoms,r)),a=a.concat(Q("SBL",i,t.bonds,o)),a=a.concat(tt(e,t,i)),a.join("\n")}function at(t){var e=t[0].strip().split(" ");return e.length>1&&"V3000"==e[1]?lt(t):st(t)}function st(t){t=t.slice(4);var e=i(t[0],Tt.rxnItemsPartition),n=e[0]-0,r=e[1]-0,o=e[2]-0;t=t.slice(1);for(var a=[];t.length>0&&"$MOL"==t[0].substr(0,4);){t=t.slice(1);for(var s=0;s<t.length&&"$MOL"!=t[s].substr(0,4);)s++;a.push(Y(t.slice(0,s))),t=t.slice(s)}return ut(a,n,r,o)}function lt(t){function e(t){wt.assert(t,"CTab format invalid")}function n(n){for(var r=n;r<t.length;++r)if("M  V30 END CTAB"==t[r].strip())return r;e(!1)}function r(n){for(var r=n;r<t.length;++r)if("M  V30 END RGROUP"==t[r].strip())return r;e(!1)}t=t.slice(4);for(var o=t[0].split(/\s+/g).slice(3),i=o[0]-0,a=o[1]-0,s=o.length>2?o[2]-0:0,l=[],u=[],c=null,p=[],h=0;h<t.length;++h){var f,d=t[h].strip();if(d.startsWith("M  V30 COUNTS"));else{if("M  END"==d)break;if("M  V30 BEGIN PRODUCT"==d)e(null==c),c=u;else if("M  V30 END PRODUCT"==d)e(c===u),c=null;else if("M  V30 BEGIN REACTANT"==d)e(null==c),c=l;else if("M  V30 END REACTANT"==d)e(c===l),c=null;else if(d.startsWith("M  V30 BEGIN RGROUP"))e(null==c),f=r(h),p.push(t.slice(h,f+1)),h=f;else{if("M  V30 BEGIN CTAB"!=d)throw new Error("line unrecognized: "+d);f=n(h),c.push(t.slice(h,f+1)),h=f}}}var g=[],m=l.concat(u);for(f=0;f<m.length;++f){var b=W(m[f],o);g.push(b)}var v=ut(g,i,a,s);return $(v,function(t){for(var e=[],n=0;n<t.length;++n)e=e.concat(t[n]);return e}(p)),v}function ut(t,e,n){function r(t,e,n,r,o){var i=new yt(r-n.min.x,o?1-n.min.y:-(n.min.y+n.max.y)/2);return e.atoms.each(function(t,e){e.pp.add_(i)}),e.sgroups.each(function(t,e){e.pp&&e.pp.add_(i)}),n.min.add_(i),n.max.add_(i),e.mergeInto(t),n.max.x-n.min.x}var o,i=new St,a=[],s=[],l=[],u=[],c=[],p=[],h={cnt:0,totalLength:0};for(o=0;o<t.length;++o){var f=t[o],d=f.getBondLengthData();h.cnt+=d.cnt,h.totalLength+=d.totalLength}var g=1/(0==h.cnt?1:h.totalLength/h.cnt);for(o=0;o<t.length;++o)f=t[o],f.scale(g);for(o=0;o<t.length;++o){f=t[o];var m=f.getCoordBoundingBoxObj();if(m){var b=o<e?Ot.REACTANT:o<e+n?Ot.PRODUCT:Ot.AGENT;b==Ot.REACTANT?(a.push(m),u.push(f)):b==Ot.AGENT?(s.push(m),c.push(f)):b==Ot.PRODUCT&&(l.push(m),p.push(f)),f.atoms.each(function(t,e){e.rxnFragmentType=b})}}var v=0;for(o=0;o<u.length;++o)v+=r(i,u[o],a[o],v,!1)+2;for(v+=2,o=0;o<c.length;++o)v+=r(i,c[o],s[o],v,!0)+2;for(v+=2,o=0;o<p.length;++o)v+=r(i,p[o],l[o],v,!1)+2;var y,w,x,S,O=null,T=null;for(o=0;o<a.length-1;++o)y=a[o],w=a[o+1],x=(y.max.x+w.min.x)/2,S=(y.max.y+y.min.y+w.max.y+w.min.y)/4,i.rxnPluses.add(new St.RxnPlus({pp:new yt(x,S)}));for(o=0;o<a.length;++o)0==o?(O={},O.max=new yt(a[o].max),O.min=new yt(a[o].min)):(O.max=yt.max(O.max,a[o].max),O.min=yt.min(O.min,a[o].min));for(o=0;o<l.length-1;++o)y=l[o],w=l[o+1],x=(y.max.x+w.min.x)/2,S=(y.max.y+y.min.y+w.max.y+w.min.y)/4,i.rxnPluses.add(new St.RxnPlus({pp:new yt(x,S)}));for(o=0;o<l.length;++o)0==o?(T={},T.max=new yt(l[o].max),T.min=new yt(l[o].min)):(T.max=yt.max(T.max,l[o].max),T.min=yt.min(T.min,l[o].min));if(y=O,w=T,y||w){var E=y?new yt(y.max.x,(y.max.y+y.min.y)/2):null,A=w?new yt(w.min.x,(w.max.y+w.min.y)/2):null,C=3;E||(E=new yt(A.x-C,A.y)),A||(A=new yt(E.x+C,E.y)),i.rxnArrows.add(new St.RxnArrow({pp:yt.lc2(E,.5,A,.5)}))}else i.rxnArrows.add(new St.RxnArrow({pp:new yt(0,0)}));return i.isReaction=!0,i}function ct(t,e){var n=new St;t.mergeInto(n,null,null,!1,!0);for(var r in e)for(var o=0;o<e[r].length;++o){var i=e[r][o];i.rgroups.set(r,new St.RGroup);var a={},s=i.frags.add(a);i.rgroups.get(r).frags.add(s),i.atoms.each(function(t,e){e.fragment=s}),i.mergeInto(n)}return n}function pt(t){if(t=t.slice(7),"$CTAB"!=t[0].strip())throw new Error("RGFile format invalid");for(var e=1;"$"!=t[e].charAt(0);)e++;if("$END CTAB"!=t[e].strip())throw new Error("RGFile format invalid");var n=t.slice(1,e);t=t.slice(e+1);for(var o={};;){if(0==t.length)throw new Error("Unexpected end of file");var i=t[0].strip();if("$END MOL"==i){t=t.slice(1);break}if("$RGP"!=i)throw new Error("RGFile format invalid");var a=t[1].strip()-0;for(o[a]=[],t=t.slice(2);;){if(0==t.length)throw new Error("Unexpected end of file");if(i=t[0].strip(),"$END RGP"==i){t=t.slice(1);break}if("$CTAB"!=i)throw new Error("RGFile format invalid");for(e=1;"$"!=t[e].charAt(0);)e++;if("$END CTAB"!=t[e].strip())throw new Error("RGFile format invalid");o[a].push(t.slice(1,e)),t=t.slice(e+1)}}var s=q(n),l={};if(r.loadRGroupFragments)for(var u in o){l[u]=[];for(var c=0;c<o[u].length;++c)l[u].push(q(o[u][c]))}return ct(s,l)}function ht(t,e,n){var r=t.toFixed(n||0).replace(",",".");if(r.length>e)throw new Error("number does not fit");return r.padStart(e)}function ft(t){return'"'===t[0]&&'"'===t[t.length-1]?t.substr(1,t.length-2):t}function dt(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=t[n];return e}function gt(t){return t.replace(Ct,"\n")}function mt(t){return t.split(Ct)}var bt=t("../util/map"),vt=t("../util/set"),yt=t("../util/vec2"),wt=t("../util"),xt=t("./element"),St=t("./struct"),Ot={NONE:0,REACTANT:1,PRODUCT:2,AGENT:3};r.loadRGroupFragments=!0,r.prototype.parseCTFile=function(t){var e=null;return e=0==t[0].search("\\$RXN")?at(t):Y(t),e.initHalfBonds(),e.initNeighbors(),e.markFragments(),e};var Tt={bondTypeMap:{1:St.Bond.PATTERN.TYPE.SINGLE,2:St.Bond.PATTERN.TYPE.DOUBLE,3:St.Bond.PATTERN.TYPE.TRIPLE,4:St.Bond.PATTERN.TYPE.AROMATIC,5:St.Bond.PATTERN.TYPE.SINGLE_OR_DOUBLE,6:St.Bond.PATTERN.TYPE.SINGLE_OR_AROMATIC,7:St.Bond.PATTERN.TYPE.DOUBLE_OR_AROMATIC,8:St.Bond.PATTERN.TYPE.ANY},bondStereoMap:{0:St.Bond.PATTERN.STEREO.NONE,1:St.Bond.PATTERN.STEREO.UP,4:St.Bond.PATTERN.STEREO.EITHER,6:St.Bond.PATTERN.STEREO.DOWN,3:St.Bond.PATTERN.STEREO.CIS_TRANS},v30bondStereoMap:{0:St.Bond.PATTERN.STEREO.NONE,1:St.Bond.PATTERN.STEREO.UP,2:St.Bond.PATTERN.STEREO.EITHER,3:St.Bond.PATTERN.STEREO.DOWN},bondTopologyMap:{0:St.Bond.PATTERN.TOPOLOGY.EITHER,1:St.Bond.PATTERN.TOPOLOGY.RING,2:St.Bond.PATTERN.TOPOLOGY.CHAIN},countsLinePartition:[3,3,3,3,3,3,3,3,3,3,3,6],atomLinePartition:[10,10,10,1,3,2,3,3,3,3,3,3,3,3,3,3,3],bondLinePartition:[3,3,3,3,3,3,3],atomListHeaderPartition:[3,1,1,4,1,1],atomListHeaderLength:11,atomListHeaderItemLength:4,chargeMap:[0,3,2,1,0,-1,-2,-3],valenceMap:[void 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,0],implicitHydrogenMap:[void 0,0,1,2,3,4],v30atomPropMap:{CHG:"charge",RAD:"radical",MASS:"isotope",VAL:"explicitValence",HCOUNT:"hCount",INVRET:"invRet",SUBST:"substitutionCount",UNSAT:"unsaturatedAtom",RBCNT:"ringBondCount"},rxnItemsPartition:[3,3,3]},Et={MUL:St.SGroup.prepareMulForSaving,SRU:K,SUP:X,DAT:J,GEN:Z};r.prototype.prepareSGroups=function(t,e){var n=this.molecule,r=[],o=0;this.molecule.sGroupForest.getSGroupsBFS().reverse().forEach(function(i){var a=n.sgroups.get(i),s=!1;try{Et[a.type](a,n)}catch(e){if(!t||"number"!=typeof e.id)throw e;s=!0}(s||!e&&/^INDIGO_.+_DESC$/i.test(a.data.fieldName))&&(o+=s,r.push(a.id))},this),o&&alert("WARNING: "+o+" invalid S-groups were detected. They will be omitted.");for(var i=0;i<r.length;++i)n.sGroupDelete(r[i]);return n},r.prototype.getCTab=function(t,e){return this.molecule=t.clone(),this.molfile="",this.writeCTab2000(e),this.molfile},r.prototype.saveMolecule=function(t,e,n,o){if(this.reaction=t.rxnArrows.count()>0,t.rxnArrows.count()>1)throw new Error("Reaction may not contain more than one arrow");if(this.molfile="",this.reaction){if(t.rgroups.count()>0)throw new Error("Unable to save the structure - reactions with r-groups are not supported at the moment");var i=t.getComponents(),a=i.reactants,s=i.products,l=a.concat(s);this.molfile="$RXN\n\n\n\n"+ht(a.length,3)+ht(s.length,3)+ht(0,3)+"\n";for(var u=0;u<l.length;++u){var c=new r((!1)),p=t.clone(l[u],null,!0),h=c.saveMolecule(p,!1,!0);this.molfile+="$MOL\n"+h}return this.molfile}if(t.rgroups.count()>0){if(!n){var f=new r((!1)).getCTab(t.getScaffold(),t.rgroups);return this.molfile="$MDL  REV  1\n$MOL\n$HDR\n\n\n\n$END HDR\n",this.molfile+="$CTAB\n"+f+"$END CTAB\n",t.rgroups.each(function(e,n){this.molfile+="$RGP\n",this.writePaddedNumber(e,3),this.molfile+="\n",n.frags.each(function(e,n){var o=new r((!1)).getCTab(t.getFragment(n));this.molfile+="$CTAB\n"+o+"$END CTAB\n"},this),this.molfile+="$END RGP\n"},this),this.molfile+="$END MOL\n",this.molfile}t=t.getScaffold()}return this.molecule=t.clone(),this.prepareSGroups(e,o),this.writeHeader(),this.writeCTab2000(),this.molfile},r.prototype.writeHeader=function(){var t=new Date;this.writeCR(),this.writeWhiteSpace(2),this.write("Ketcher"),this.writeWhiteSpace(),this.writeCR((t.getMonth()+1).toPaddedString(2)+t.getDate().toPaddedString(2)+(t.getFullYear()%100).toPaddedString(2)+t.getHours().toPaddedString(2)+t.getMinutes().toPaddedString(2)+"2D 1   1.00000     0.00000     0"),this.writeCR()},r.prototype.write=function(t){this.molfile+=t},r.prototype.writeCR=function(t){0==arguments.length&&(t=""),this.molfile+=t+"\n"},r.prototype.writeWhiteSpace=function(t){0==arguments.length&&(t=1),t.times(function(){this.write(" ")},this)},r.prototype.writePadded=function(t,e){this.write(t),this.writeWhiteSpace(e-t.length)},r.prototype.writePaddedNumber=function(t,e){var n=(t-0).toString();this.writeWhiteSpace(e-n.length),this.write(n)},r.prototype.writePaddedFloat=function(t,e,n){this.write(ht(t,e,n))},r.prototype.writeCTab2000Header=function(){this.writePaddedNumber(this.molecule.atoms.count(),3),this.writePaddedNumber(this.molecule.bonds.count(),3),this.writePaddedNumber(0,3),this.writeWhiteSpace(3),this.writePaddedNumber(this.molecule.isChiral?1:0,3),this.writePaddedNumber(0,3),this.writeWhiteSpace(12),this.writePaddedNumber(999,3),this.writeCR(" V2000")};var At={MUL:et,SRU:nt,SUP:rt,DAT:ot,GEN:it};r.prototype.writeCTab2000=function(t){function e(t,e){for(;e.length>0;){for(var n=[];e.length>0&&n.length<8;)n.push(e[0]),e.splice(0,1);this.write(t),this.writePaddedNumber(n.length,3),n.each(function(t){this.writeWhiteSpace(),this.writePaddedNumber(this.mapping[t[0]],3),this.writeWhiteSpace(),this.writePaddedNumber(t[1],3)},this),this.writeCR()}}this.writeCTab2000Header(),this.mapping={};var n=1,r=[],o=[];for(this.molecule.atoms.each(function(t,e){this.writePaddedFloat(e.pp.x,10,4),this.writePaddedFloat(-e.pp.y,10,4),this.writePaddedFloat(e.pp.z,10,4),this.writeWhiteSpace();var i=e.label;null!=e.atomList?(i="L",r.push(t)):null==xt.getElementByLabel(i)&&["A","Q","X","*","R#"].indexOf(i)==-1&&(i="C",o.push(t)),this.writePadded(i,3),this.writePaddedNumber(0,2),this.writePaddedNumber(0,3),this.writePaddedNumber(0,3),Object.isUndefined(e.hCount)&&(e.hCount=0),this.writePaddedNumber(e.hCount,3),Object.isUndefined(e.stereoCare)&&(e.stereoCare=0),this.writePaddedNumber(e.stereoCare,3),this.writePaddedNumber(e.explicitValence<0?0:0==e.explicitValence?15:e.explicitValence,3),this.writePaddedNumber(0,3),this.writePaddedNumber(0,3),this.writePaddedNumber(0,3),Object.isUndefined(e.aam)&&(e.aam=0),this.writePaddedNumber(e.aam,3),Object.isUndefined(e.invRet)&&(e.invRet=0),this.writePaddedNumber(e.invRet,3),Object.isUndefined(e.exactChangeFlag)&&(e.exactChangeFlag=0),this.writePaddedNumber(e.exactChangeFlag,3),this.writeCR(),this.mapping[t]=n,n++},this),this.bondMapping={},n=1,this.molecule.bonds.each(function(t,e){this.bondMapping[t]=n++,this.writePaddedNumber(this.mapping[e.begin],3),this.writePaddedNumber(this.mapping[e.end],3),this.writePaddedNumber(e.type,3),Object.isUndefined(e.stereo)&&(e.stereo=0),this.writePaddedNumber(e.stereo,3),this.writeWhiteSpace(3),Object.isUndefined(e.topology)&&(e.topology=0),this.writePaddedNumber(e.topology,3),Object.isUndefined(e.reactingCenterStatus)&&(e.reactingCenterStatus=0),this.writePaddedNumber(e.reactingCenterStatus,3),this.writeCR()},this);o.length>0;)this.write("A  "),this.writePaddedNumber(o[0]+1,3),this.writeCR(),this.writeCR(this.molecule.atoms.get(o[0]).label),o.splice(0,1);var i=[],a=[],s=[],l=[],u=[],c=[],p=[],h=[],f=[];this.molecule.atoms.each(function(t,e){if(0!=e.charge&&i.push([t,e.charge]),0!=e.isotope&&a.push([t,e.isotope]),0!=e.radical&&s.push([t,e.radical]),null!=e.rglabel&&"R#"==e.label)for(var n=0;n<32;n++)e.rglabel&1<<n&&l.push([t,n+1]);null!=e.attpnt&&c.push([t,e.attpnt]),0!=e.ringBondCount&&p.push([t,e.ringBondCount]),0!=e.substitutionCount&&f.push([t,e.substitutionCount]),0!=e.unsaturatedAtom&&h.push([t,e.unsaturatedAtom])}),t&&t.each(function(t,e){if(e.resth||e.ifthen>0||e.range.length>0){var n="  1 "+ht(t,3)+" "+ht(e.ifthen,3)+" "+ht(e.resth?1:0,3)+"   "+e.range;u.push(n)}}),e.call(this,"M  CHG",i),e.call(this,"M  ISO",a),e.call(this,"M  RAD",s),e.call(this,"M  RGP",l);for(var d=0;d<u.length;++d)this.write("M  LOG"+u[d]+"\n");if(e.call(this,"M  APO",c),e.call(this,"M  RBC",p),e.call(this,"M  SUB",f),e.call(this,"M  UNS",h),r.length>0)for(d=0;d<r.length;++d){var g=r[d],m=this.molecule.atoms.get(g).atomList;this.write("M  ALS"),this.writePaddedNumber(g+1,4),this.writePaddedNumber(m.ids.length,3),this.writeWhiteSpace(),this.write(m.notList?"T":"F");for(var b=m.labelList(),v=0;v<b.length;++v)this.writeWhiteSpace(),this.writePadded(b[v],3);this.writeCR()}var y={},w=1,x={},S=this.molecule.sGroupForest.getSGroupsBFS();S.forEach(function(t){x[w]=t,y[t]=w++},this);for(var O=1;O<w;++O){var T=x[O],E=this.molecule.sgroups.get(T);this.write("M  STY"),this.writePaddedNumber(1,3),this.writeWhiteSpace(1),this.writePaddedNumber(O,3),this.writeWhiteSpace(1),this.writePadded(E.type,3),this.writeCR(),this.write("M  SLB"),this.writePaddedNumber(1,3),this.writeWhiteSpace(1),this.writePaddedNumber(O,3),this.writeWhiteSpace(1),this.writePaddedNumber(O,3),this.writeCR();var A=this.molecule.sGroupForest.parent.get(T);if(A>=0&&(this.write("M  SPL"),this.writePaddedNumber(1,3),this.writeWhiteSpace(1),this.writePaddedNumber(O,3),this.writeWhiteSpace(1),this.writePaddedNumber(y[A],3),this.writeCR()),"SRU"==E.type&&E.data.connectivity){var C="";C+=" ",C+=O.toString().padStart(3),C+=" ",C+=(E.data.connectivity||"").padEnd(3),this.write("M  SCN"),this.writePaddedNumber(1,3),this.write(C.toUpperCase()),this.writeCR()}"SRU"==E.type&&(this.write("M  SMT "),this.writePaddedNumber(O,3),this.writeWhiteSpace(),this.write(E.data.subscript||"n"),this.writeCR()),this.writeCR(At[E.type](E,this.molecule,y,this.mapping,this.bondMapping))}this.writeCR("M  END")};var Ct=/\r\n|[\n\r]/g;e.exports={stringify:function(t,e){var n=e||{};return new r(n.v3000).saveMolecule(t,n.ignoreErrors,n.noRgroups,n.preserveIndigoDesc)},parse:function(t,e){return s(t,e||{})}}},{"../util":115,"../util/map":116,"../util/set":118,"../util/vec2":119,"./element":22,"./struct":33}],25:[function(t,e,n){function r(t,e){var n=t.split(/^\$\$\$\$$/m);return n.reduce(function(t,n){n=n.replace(/\r/g,""),n=n.trim();var r=n.indexOf("M  END");if(r!=-1){var i={},a=n.substr(r+7).trim().split(/^$\n?/m);i.struct=o.parse(n.substring(0,r+6),e),i.props=a.reduce(function(t,e){var n=e.match(/^> [ \d]*<(\S+)>/);if(n){var r=n[1],o=e.split("\n")[1].trim();t[r]=o}return t},{}),t.push(i)}return t},[])}var o=t("./molfile");e.exports={stringify:function(){throw new Error("Not implemented yet")},parse:r}},{"./molfile":24}],26:[function(t,e,n){function r(t,e,n){this.molecule=t,this.bonds=new i,this.getNeighbors=e,this.context=n}function o(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}var i=t("../../util/map"),a=t("../../util/vec2"),s=t("../struct");r.PARITY={NONE:0,CIS:1,TRANS:2},r.prototype.each=function(t,e){this.bonds.each(t,e)},r.prototype.getParity=function(t){return this.bonds.get(t).parity},r.prototype.getSubstituents=function(t){return this.bonds.get(t).substituents},r.prototype.sameside=function(t,e,n,r){var o=a.diff(t,e),i=new a((-o.y),o.x);if(!i.normalize())return 0;var s=a.diff(n,t),l=a.diff(r,e);if(!s.normalize())return 0;if(!l.normalize())return 0;var u=a.dot(s,i),c=a.dot(l,i);return Math.abs(u)<.001||Math.abs(c)<.001?0:u*c>0?1:-1},r.prototype.sameside=function(t,e,n,r){return this.sameside(this.molecule.atoms.get(t).pp,this.molecule.atoms.get(e).pp,this.molecule.atoms.get(n).pp,this.molecule.atoms.get(r).pp)},r.prototype.sortSubstituents=function(t){var e=this.molecule.atoms.get(t[0]).pureHydrogen(),n=t[1]<0||this.molecule.atoms.get(t[1]).pureHydrogen(),r=this.molecule.atoms.get(t[2]).pureHydrogen(),i=t[3]<0||this.molecule.atoms.get(t[3]).pureHydrogen();return(!e||!n)&&((!r||!i)&&(n?t[1]=-1:e?(t[0]=t[1],t[1]=-1):t[0]>t[1]&&o(t,0,1),i?t[3]=-1:r?(t[2]=t[3],t[3]=-1):t[2]>t[3]&&o(t,2,3),!0))},r.prototype.isGeomStereoBond=function(t,e){var n=this.molecule.bonds.get(t);if(n.type!=s.Bond.PATTERN.TYPE.DOUBLE)return!1;var r=this.molecule.atoms.get(n.begin).label,o=this.molecule.atoms.get(n.end).label;if("C"!=r&&"N"!=r&&"Si"!=r&&"Ge"!=r)return!1;if("C"!=o&&"N"!=o&&"Si"!=o&&"Ge"!=o)return!1;var i=this.getNeighbors.call(this.context,n.begin),a=this.getNeighbors.call(this.context,n.end);if(i.length<2||i.length>3||a.length<2||a.length>3)return!1;e[0]=-1,e[1]=-1,e[2]=-1,e[3]=-1;var l,u;for(l=0;l<i.length;l++)if(u=i[l],u.bid!=t){if(this.molecule.bonds.get(u.bid).type!=s.Bond.PATTERN.TYPE.SINGLE)return!1;e[0]==-1?e[0]=u.aid:e[1]=u.aid}for(l=0;l<a.length;l++)if(u=a[l],u.bid!=t){if(this.molecule.bonds.get(u.bid).type!=s.Bond.PATTERN.TYPE.SINGLE)return!1;e[2]==-1?e[2]=u.aid:e[3]=u.aid}return(e[1]==-1||this.sameside(n.begin,n.end,e[0],e[1])==-1)&&(e[3]==-1||this.sameside(n.begin,n.end,e[2],e[3])==-1)},r.prototype.build=function(t){this.molecule.bonds.each(function(e,n){var o=this.bonds.set(e,{parity:0,substituents:new Array(4)});if((!Object.isArray(t)||!t[e])&&this.isGeomStereoBond(e,o.substituents)&&this.sortSubstituents(o.substituents)){var i=this.sameside(n.begin,n.end,o.substituents[0],o.substituents[2]);1==i?o.parity=r.PARITY.CIS:i==-1&&(o.parity=r.PARITY.TRANS)}},this)},e.exports=r},{"../../util/map":116,"../../util/vec2":119,"../struct":33}],27:[function(t,e,n){function r(t,e,n,o){this.molecule=t,this.atom_data=e,this.components=n,this.nComponentsInReactants=-1,this.nReactants=o,this.vertices=new Array(this.molecule.atoms.count()),this.molecule.atoms.each(function(t){this.vertices[t]=new r.VertexDesc},this),this.edges=new Array(this.molecule.bonds.count()),this.molecule.bonds.each(function(t){this.edges[t]=new r.EdgeDesc},this),this.v_seq=[]}var o=t("../../util/set");r.VertexDesc=function(){this.dfs_state=0,this.parent_vertex=0,this.parent_edge=0,this.branches=0},r.EdgeDesc=function(){this.opening_cycles=0,this.closing_cycle=0},r.SeqElem=function(t,e,n){this.idx=t,this.parent_vertex=e,this.parent_edge=n},r.prototype.walk=function(){for(var t,e,n=[],i=0,a=0;;){if(n.length<1){for(var s=-1,l=function(t){return 0==this.vertices[t].dfs_state&&(s=t,!0)};i<this.components.length&&s==-1;)s=o.find(this.components[i],l,this),null===s&&(s=-1,i++),i==this.nReactants&&(this.nComponentsInReactants=a);if(s<-1&&this.molecule.atoms.find(l,this),s==-1)break;this.vertices[s].parent_vertex=-1,this.vertices[s].parent_edge=-1,n.push(s),a++}var u=n.pop(),c=this.vertices[u].parent_vertex,p=new r.SeqElem(u,c,this.vertices[u].parent_edge);this.v_seq.push(p),this.vertices[u].dfs_state=2;var h=this.atom_data[u];for(t=0;t<h.neighbours.length;t++){var f=h.neighbours[t].aid,d=h.neighbours[t].bid;if(f!=c)if(2==this.vertices[f].dfs_state){for(this.edges[d].closing_cycle=1,e=u;e!=-1&&this.vertices[e].parent_vertex!=f;)e=this.vertices[e].parent_vertex;if(e==-1)throw new Error("cycle unwind error");this.edges[this.vertices[e].parent_edge].opening_cycles++,this.vertices[u].branches++,p=new r.SeqElem(f,u,d),this.v_seq.push(p)}else{if(1==this.vertices[f].dfs_state){if(e=n.indexOf(f),e==-1)throw new Error("internal: removing vertex from stack");n.splice(e,1);var g=this.vertices[f].parent_vertex;g>=0&&this.vertices[g].branches--}this.vertices[u].branches++,this.vertices[f].parent_vertex=u,this.vertices[f].parent_edge=d,this.vertices[f].dfs_state=1,n.push(f)}}}},r.prototype.edgeClosingCycle=function(t){return 0!=this.edges[t].closing_cycle},r.prototype.numBranches=function(t){return this.vertices[t].branches},r.prototype.numOpeningCycles=function(t){return this.edges[t].opening_cycles},r.prototype.toString=function(){var t="";return this.v_seq.each(function(e){t+=e.idx+" -> "}),t+="*"},e.exports=r},{"../../util/set":118}],28:[function(t,e,n){function r(){this.smiles="",this.writtenAtoms=[],this.writtenComponents=0,this.ignore_errors=!1}var o=t("../../util/set"),i=t("../../util"),a=t("../struct"),s=t("./cis_trans"),l=t("./dfs"),u=t("./stereocenters");r._Atom=function(t){this.neighbours=[],this.aromatic=!1,this.lowercase=!1,this.chirality=0,this.branch_cnt=0,this.paren_written=!1,this.h_count=t,this.parent=-1},r.prototype.isBondInRing=function(t){if(i.isUndefined(this.inLoop)||i.isNull(this.inLoop))throw new Error("Init this.inLoop prior to calling this method");return this.inLoop[t]},r.prototype.saveMolecule=function(t,e){var n,i,s;Object.isUndefined(e)||(this.ignore_errors=e),t=t.clone(),t.initHalfBonds(),t.initNeighbors(),t.sortNeighbors(),t.setImplicitHydrogen(),t.sgroups.each(function(e,n){if("MUL"==n.type)try{a.SGroup.prepareMulForSaving(n,t)}catch(t){throw{message:"Bad s-group ("+t.message+")"}}else if(!this.ignore_errors)throw new Error("SMILES data format doesn't support s-groups")},this),this.atoms=new Array(t.atoms.count()),t.atoms.each(function(t,e){this.atoms[t]=new r._Atom(e.implicitH)},this);var c=["B","C","N","O","P","S","Se","As"];t.bonds.each(function(e,n){n.type==a.Bond.PATTERN.TYPE.AROMATIC&&(this.atoms[n.begin].aromatic=!0,c.indexOf(t.atoms.get(n.begin).label)!=-1&&(this.atoms[n.begin].lowercase=!0),this.atoms[n.end].aromatic=!0,c.indexOf(t.atoms.get(n.end).label)!=-1&&(this.atoms[n.end].lowercase=!0)),this.atoms[n.begin].neighbours.push({aid:n.end,bid:e}),this.atoms[n.end].neighbours.push({aid:n.begin,bid:e})},this),this.inLoop=function(){t.prepareLoopStructure();var e=o.empty();t.loops.each(function(n,r){r.hbs.length<=6&&o.mergeIn(e,o.fromList(r.hbs.map(function(e){return t.halfBonds.get(e).bid})))});var n={};return o.each(e,function(t){n[t]=1},this),n}(),this.touchedCistransbonds=0,this.markCisTrans(t);var p=t.getComponents(),h=p.reactants.concat(p.products),f=new l(t,this.atoms,h,p.reactants.length);for(f.walk(),this.atoms.each(function(t){t.neighbours.clear()},this),n=0;n<f.v_seq.length;n++){var d=f.v_seq[n],g=d.idx,m=d.parent_edge,b=d.parent_vertex;if(m>=0){var v=this.atoms[g],y=f.numOpeningCycles(m);for(i=0;i<y;i++)this.atoms[b].neighbours.push({aid:-1,bid:-1});if(f.edgeClosingCycle(m)){for(s=0;s<v.neighbours.length;s++)if(v.neighbours[s].aid==-1){v.neighbours[s].aid=b,v.neighbours[s].bid=m;break}if(s==v.neighbours.length)throw new Error("internal: can not put closing bond to its place")}else v.neighbours.push({aid:b,bid:m}),v.parent=b;this.atoms[b].neighbours.push({aid:g,bid:m})}}try{var w=new u(t,function(t){return this.atoms[t].neighbours},this);w.buildFromBonds(this.ignore_errors),w.each(function(t,e){var n=-1;e.pyramid[3]==-1&&(n=3);var r=new Array(4),o=0,a=this.atoms[t];if(a.parent!=-1)for(s=0;s<4;s++)if(e.pyramid[s]==a.parent){r[o++]=s;break}for(n!=-1&&(r[o++]=n),i=0;i!=a.neighbours.length;i++)if(a.neighbours[i].aid!=a.parent)for(s=0;s<4;s++)if(a.neighbours[i].aid==e.pyramid[s]){if(o>=4)throw new Error("internal: pyramid overflow");r[o++]=s;break}if(4==o)o=r[0],r[0]=r[1],r[1]=r[2],r[2]=r[3],r[3]=o;else if(3!=o)throw new Error("cannot calculate chirality");u.isPyramidMappingRigid(r)?this.atoms[t].chirality=1:this.atoms[t].chirality=2},this)}catch(t){alert("Warning: "+t.message)}var x=[];x.push(0);var S=!0;for(n=0;n<f.v_seq.length;n++){d=f.v_seq[n],g=d.idx,m=d.parent_edge,b=d.parent_vertex;var O=!0;if(b>=0){for(f.numBranches(b)>1&&this.atoms[b].branch_cnt>0&&this.atoms[b].paren_written&&(this.smiles+=")"),y=f.numOpeningCycles(m),i=0;i<y;i++){for(s=1;s<x.length&&x[s]!=-1;s++);s==x.length?x.push(b):x[s]=b,this.writeCycleNumber(s)}if(b>=0){var T=f.numBranches(b);if(T>1&&this.atoms[b].branch_cnt<T-1&&(f.edgeClosingCycle(m)?this.atoms[b].paren_written=!1:(this.smiles+="(",this.atoms[b].paren_written=!0)),this.atoms[b].branch_cnt++,this.atoms[b].branch_cnt>T)throw new Error("unexpected branch")}var E=t.bonds.get(m),A=0;if(E.type==a.Bond.PATTERN.TYPE.SINGLE&&(A=this.calcBondDirection(t,m,b)),1==A&&g==E.end||2==A&&g==E.begin?this.smiles+="/":2==A&&g==E.end||1==A&&g==E.begin?this.smiles+="\\":E.type==a.Bond.PATTERN.TYPE.ANY?this.smiles+="~":E.type==a.Bond.PATTERN.TYPE.DOUBLE?this.smiles+="=":E.type==a.Bond.PATTERN.TYPE.TRIPLE?this.smiles+="#":E.type!=a.Bond.PATTERN.TYPE.AROMATIC||this.atoms[E.begin].lowercase&&this.atoms[E.end].lowercase&&this.isBondInRing(m)?E.type==a.Bond.PATTERN.TYPE.SINGLE&&this.atoms[E.begin].aromatic&&this.atoms[E.end].aromatic&&(this.smiles+="-"):this.smiles+=":",f.edgeClosingCycle(m)){for(i=1;i<x.length&&x[i]!=g;i++);if(i==x.length)throw new Error("cycle number not found");this.writeCycleNumber(i),x[i]=-1,O=!1}}else S||(this.smiles+=this.writtenComponents==f.nComponentsInReactants?">>":"."),S=!1,this.writtenComponents++;O&&(this.writeAtom(t,g,this.atoms[g].aromatic,this.atoms[g].lowercase,this.atoms[g].chirality),this.writtenAtoms.push(d.idx))}return this.comma=!1,this.writeRadicals(t),this.comma&&(this.smiles+="|"),this.smiles},r.prototype.writeCycleNumber=function(t){if(t>0&&t<10)this.smiles+=t;else if(t>=10&&t<100)this.smiles+="%"+t;else{if(!(t>=100&&t<1e3))throw new Error("bad cycle number: "+t);this.smiles+="%%"+t}},r.prototype.writeAtom=function(t,e,n,r,o){var i=t.atoms.get(e),a=!1,s=-1,l=0;if("A"==i.label)return void(this.smiles+="*");if("R"==i.label||"R#"==i.label)return void(this.smiles+="[*]");l=i.aam,"C"!=i.label&&"P"!=i.label&&"N"!=i.label&&"S"!=i.label&&"O"!=i.label&&"Cl"!=i.label&&"F"!=i.label&&"Br"!=i.label&&"B"!=i.label&&"I"!=i.label&&(a=!0),(i.explicitValence>=0||0!=i.radical||o>0||n&&"C"!=i.label&&"O"!=i.label||n&&"C"==i.label&&this.atoms[e].neighbours.length<3&&0==this.atoms[e].h_count)&&(s=this.atoms[e].h_count);var u=i.label;if(i.atomList&&!i.atomList.notList?(u=i.atomList.label(),a=!1):i.isPseudo()||i.atomList&&i.atomList.notList?(u="*",a=!0):(o||0!=i.charge||i.isotope>0||s>=0||l>0)&&(a=!0),a&&(s==-1&&(s=this.atoms[e].h_count),this.smiles+="["),i.isotope>0&&(this.smiles+=i.isotope),
r?this.smiles+=u.toLowerCase():this.smiles+=u,o>0&&(1==o?this.smiles+="@":this.smiles+="@@",i.implicitH>1))throw new Error(i.implicitH+" implicit H near stereocenter");"H"!=i.label&&(s>1||0==s&&!a?this.smiles+="H"+s:1==s&&(this.smiles+="H")),i.charge>1?this.smiles+="+"+i.charge:i.charge<-1?this.smiles+=i.charge:1==i.charge?this.smiles+="+":i.charge==-1&&(this.smiles+="-"),l>0&&(this.smiles+=":"+l),a&&(this.smiles+="]")},r.prototype.markCisTrans=function(t){this.cis_trans=new s(t,function(t){return this.atoms[t].neighbours},this),this.cis_trans.build(),this.dbonds=new Array(t.bonds.count()),t.bonds.each(function(t){this.dbonds[t]={ctbond_beg:-1,ctbond_end:-1,saved:0}},this),this.cis_trans.each(function(e,n){var r=t.bonds.get(e);if(0!=n.parity&&!this.isBondInRing(e)){var o=this.atoms[r.begin].neighbours,i=this.atoms[r.end].neighbours,s=!0,l=!0;if(o.each(function(n){n.bid!=e&&t.bonds.get(n.bid).type==a.Bond.PATTERN.TYPE.SINGLE&&(s=!1)},this),i.each(function(n){n.bid!=e&&t.bonds.get(n.bid).type==a.Bond.PATTERN.TYPE.SINGLE&&(l=!1)},this),s||l)return;o.each(function(n){n.bid!=e&&(t.bonds.get(n.bid).begin==r.begin?this.dbonds[n.bid].ctbond_beg=e:this.dbonds[n.bid].ctbond_end=e)},this),i.each(function(n){n.bid!=e&&(t.bonds.get(n.bid).begin==r.end?this.dbonds[n.bid].ctbond_beg=e:this.dbonds[n.bid].ctbond_end=e)},this)}},this)},r.prototype.updateSideBonds=function(t,e){var n=t.bonds.get(e),r=this.cis_trans.getSubstituents(e),o=this.cis_trans.getParity(e),i=[-1,-1,-1,-1];i[0]=t.findBondId(r[0],n.begin),r[1]!=-1&&(i[1]=t.findBondId(r[1],n.begin)),i[2]=t.findBondId(r[2],n.end),r[3]!=-1&&(i[3]=t.findBondId(r[3],n.end));var a=0,l=0,u=0,c=0;if(0!=this.dbonds[i[0]].saved&&(1==this.dbonds[i[0]].saved&&t.bonds.get(i[0]).begin==n.begin||2==this.dbonds[i[0]].saved&&t.bonds.get(i[0]).end==n.begin?a++:l++),i[1]!=-1&&0!=this.dbonds[i[1]].saved&&(2==this.dbonds[i[1]].saved&&t.bonds.get(i[1]).begin==n.begin||1==this.dbonds[i[1]].saved&&t.bonds.get(i[1]).end==n.begin?a++:l++),0!=this.dbonds[i[2]].saved&&(1==this.dbonds[i[2]].saved&&t.bonds.get(i[2]).begin==n.end||2==this.dbonds[i[2]].saved&&t.bonds.get(i[2]).end==n.end?u++:c++),i[3]!=-1&&0!=this.dbonds[i[3]].saved&&(2==this.dbonds[i[3]].saved&&t.bonds.get(i[3]).begin==n.end||1==this.dbonds[i[3]].saved&&t.bonds.get(i[3]).end==n.end?u++:c++),o==s.PARITY.CIS?(a+=u,l+=c):(a+=c,l+=u),a>0&&l>0)throw new Error("incompatible cis-trans configuration");return(0!=a||0!=l)&&(a>0&&(this.dbonds[i[0]].saved=t.bonds.get(i[0]).begin==n.begin?1:2,i[1]!=-1&&(this.dbonds[i[1]].saved=t.bonds.get(i[1]).begin==n.begin?2:1),this.dbonds[i[2]].saved=t.bonds.get(i[2]).begin==n.end==(o==s.PARITY.CIS)?1:2,i[3]!=-1&&(this.dbonds[i[3]].saved=t.bonds.get(i[3]).begin==n.end==(o==s.PARITY.CIS)?2:1)),l>0&&(this.dbonds[i[0]].saved=t.bonds.get(i[0]).begin==n.begin?2:1,i[1]!=-1&&(this.dbonds[i[1]].saved=t.bonds.get(i[1]).begin==n.begin?1:2),this.dbonds[i[2]].saved=t.bonds.get(i[2]).begin==n.end==(o==s.PARITY.CIS)?2:1,i[3]!=-1&&(this.dbonds[i[3]].saved=t.bonds.get(i[3]).begin==n.end==(o==s.PARITY.CIS)?1:2)),!0)},r.prototype.calcBondDirection=function(t,e,n){var r;if(this.dbonds[e].ctbond_beg==-1&&this.dbonds[e].ctbond_end==-1)return 0;if(t.bonds.get(e).type!=a.Bond.PATTERN.TYPE.SINGLE)throw new Error("internal: directed bond type "+t.bonds.get(e).type);for(;;){if(r=0,this.cis_trans.each(function(e,n){0==n.parity||this.isBondInRing(e)||this.updateSideBonds(t,e)&&r++},this),r==this.touchedCistransbonds)break;this.touchedCistransbonds=r}return 0==this.dbonds[e].saved&&(n==t.bonds.get(e).begin?this.dbonds[e].saved=1:this.dbonds[e].saved=2),this.dbonds[e].saved},r.prototype.writeRadicals=function(t){var e,n,r=new Array(this.writtenAtoms.length);for(e=0;e<this.writtenAtoms.size();e++)if(!r[e]){var o=t.atoms.get(this.writtenAtoms[e]).radical;if(0!=o)for(this.comma?this.smiles+=",":(this.smiles+=" |",this.comma=!0),o==a.Atom.PATTERN.RADICAL.SINGLET?this.smiles+="^3:":o==a.Atom.PATTERN.RADICAL.DOUPLET?this.smiles+="^1:":this.smiles+="^4:",this.smiles+=e,n=e+1;n<this.writtenAtoms.length;n++)t.atoms.get(this.writtenAtoms[n]).radical==o&&(r[n]=!0,this.smiles+=","+n)}},e.exports={stringify:function(t,e){var n=e||{};return(new r).saveMolecule(t,n.ignoreErrors)}}},{"../../util":115,"../../util/set":118,"../struct":33,"./cis_trans":26,"./dfs":27,"./stereocenters":29}],29:[function(t,e,n){function r(t,e,n){this.molecule=t,this.atoms=new i,this.getNeighbors=e,this.context=n}function o(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}var i=t("../../util/map"),a=t("../../util/set"),s=t("../../util/vec2"),l=t("../struct");r.prototype.each=function(t,e){this.atoms.each(t,e)},r.prototype.buildFromBonds=function(t){var e=this.molecule.atoms,n=this.molecule.bonds,r=a.empty();e.each(function(t){var o=this.getNeighbors.call(this.context,t);if(2!=o.length)return!1;var i=o[0],s=o[1];if([t,i.aid,s.aid].findIndex(function(t){return["C","Si"].indexOf(e.get(t).label)<0},this)>=0)return!1;if([i.bid,s.bid].findIndex(function(t){return n.get(t).type!=l.Bond.PATTERN.TYPE.DOUBLE},this)>=0)return!1;var u=this.getNeighbors.call(this.context,i.aid).filter(function(e){return e.aid!=t}),c=this.getNeighbors.call(this.context,s.aid).filter(function(e){return e.aid!=t});return!(u.length<1||u.length>2||c.length<1||c.length>2)&&(!(u.concat(c).findIndex(function(t){return n.get(t.bid).type!=l.Bond.PATTERN.TYPE.SINGLE},this)>=0)&&(!(u.concat(c).findIndex(function(t){return n.get(t.bid).stereo==l.Bond.PATTERN.STEREO.EITHER},this)>=0)&&(a.add(r,i.aid),void a.add(r,s.aid))))},this),a.size(r)>0&&alert("This structure may contain allenes, which cannot be represented in the SMILES notation. Relevant stereo-information will be discarded."),e.each(function(e){if(!a.contains(r,e)){var n=this.getNeighbors.call(this.context,e),o=!1;n.find(function(t){var n=this.molecule.bonds.get(t.bid);return n.type==l.Bond.PATTERN.TYPE.SINGLE&&n.begin==e&&(n.stereo==l.Bond.PATTERN.STEREO.UP||n.stereo==l.Bond.PATTERN.STEREO.DOWN)&&(o=!0,!0)},this),o&&(t?this.buildOneCenter(e):this.buildOneCenter(e))}},this)},r.allowed_stereocenters=[{elem:"C",charge:0,degree:3,n_double_bonds:0,implicit_degree:4},{elem:"C",charge:0,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"Si",charge:0,degree:3,n_double_bonds:0,implicit_degree:4},{elem:"Si",charge:0,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"N",charge:1,degree:3,n_double_bonds:0,implicit_degree:4},{elem:"N",charge:1,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"N",charge:0,degree:3,n_double_bonds:0,implicit_degree:3},{elem:"S",charge:0,degree:4,n_double_bonds:2,implicit_degree:4},{elem:"S",charge:1,degree:3,n_double_bonds:0,implicit_degree:3},{elem:"S",charge:0,degree:3,n_double_bonds:1,implicit_degree:3},{elem:"P",charge:0,degree:3,n_double_bonds:0,implicit_degree:3},{elem:"P",charge:1,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"P",charge:0,degree:4,n_double_bonds:1,implicit_degree:4}],r.prototype.buildOneCenter=function(t){var e=this.molecule.atoms.get(t),n=this.getNeighbors.call(this.context,t),i=n.length,a=-1,u={group:0,type:0,pyramid:new Array(4)},c=0,p=new Array(4),h=0,f=0;u.pyramid[0]=-1,u.pyramid[1]=-1,u.pyramid[2]=-1,u.pyramid[3]=-1;var d=0;if(i>4)throw new Error("stereocenter with %d bonds are not supported"+i);if(n.each(function(t){var n=this.molecule.atoms.get(t.aid),r=this.molecule.bonds.get(t.bid);if(p[c]={edge_idx:t.bid,nei_idx:t.aid,rank:t.aid,vec:s.diff(n.pp,e.pp).yComplement()},n.pureHydrogen()?(d++,p[c].rank=1e4):"H"==n.label&&(p[c].rank=5e3),!p[c].vec.normalize())throw new Error("zero bond length");if(r.type==l.Bond.PATTERN.TYPE.TRIPLE)throw new Error("non-single bonds not allowed near stereocenter");if(r.type==l.Bond.PATTERN.TYPE.AROMATIC)throw new Error("aromatic bonds not allowed near stereocenter");r.type==l.Bond.PATTERN.TYPE.DOUBLE&&f++,c++},this),r.allowed_stereocenters.find(function(t){return t.elem==e.label&&t.charge==e.charge&&t.degree==i&&t.n_double_bonds==f&&(a=t.implicit_degree,!0)},this),a==-1)throw new Error("unknown stereocenter configuration: "+e.label+", charge "+e.charge+", "+i+" bonds ("+f+" double)");if(4==i&&d>1)throw new Error(d+" hydrogens near stereocenter");if(3==i&&4==a&&d>0)throw new Error("have hydrogen(s) besides implicit hydrogen near stereocenter");if(4==i){p[0].rank>p[1].rank&&o(p,0,1),p[1].rank>p[2].rank&&o(p,1,2),p[2].rank>p[3].rank&&o(p,2,3),p[1].rank>p[2].rank&&o(p,1,2),p[0].rank>p[1].rank&&o(p,0,1),p[1].rank>p[2].rank&&o(p,1,2);var g=-1,m=-1,b=-1,v=-1,y=0;for(c=0;c<4;c++){var w=this.getBondStereo(t,p[c].edge_idx);if(w==l.Bond.PATTERN.STEREO.UP||w==l.Bond.PATTERN.STEREO.DOWN){g=c,y=w;break}}if(g==-1)throw new Error("none of 4 bonds going from stereocenter is stereobond");var x,S;if(m==-1&&(x=r.xyzzy(p[g].vec,p[(g+1)%4].vec,p[(g+2)%4].vec),S=r.xyzzy(p[g].vec,p[(g+1)%4].vec,p[(g+3)%4].vec),x+S!=3&&x+S!=12||(m=(g+1)%4,b=(g+2)%4,v=(g+3)%4)),m==-1&&(x=r.xyzzy(p[g].vec,p[(g+2)%4].vec,p[(g+1)%4].vec),S=r.xyzzy(p[g].vec,p[(g+2)%4].vec,p[(g+3)%4].vec),x+S!=3&&x+S!=12||(m=(g+2)%4,b=(g+1)%4,v=(g+3)%4)),m==-1&&(x=r.xyzzy(p[g].vec,p[(g+3)%4].vec,p[(g+1)%4].vec),S=r.xyzzy(p[g].vec,p[(g+3)%4].vec,p[(g+2)%4].vec),x+S!=3&&x+S!=12||(m=(g+3)%4,b=(g+2)%4,v=(g+1)%4)),m==-1)throw new Error("internal error: can not find opposite bond");if(y==l.Bond.PATTERN.STEREO.UP&&this.getBondStereo(t,p[m].edge_idx)==l.Bond.PATTERN.STEREO.DOWN)throw new Error("stereo types of the opposite bonds mismatch");if(y==l.Bond.PATTERN.STEREO.DOWN&&this.getBondStereo(t,p[m].edge_idx)==l.Bond.PATTERN.STEREO.UP)throw new Error("stereo types of the opposite bonds mismatch");if(y==this.getBondStereo(t,p[b].edge_idx))throw new Error("stereo types of non-opposite bonds match");if(y==this.getBondStereo(t,p[v].edge_idx))throw new Error("stereo types of non-opposite bonds match");h=3==g||3==m?y:y==l.Bond.PATTERN.STEREO.UP?l.Bond.PATTERN.STEREO.DOWN:l.Bond.PATTERN.STEREO.UP,N=r.sign(p[0].vec,p[1].vec,p[2].vec),h==l.Bond.PATTERN.STEREO.UP&&N>0||h==l.Bond.PATTERN.STEREO.DOWN&&N<0?(u.pyramid[0]=p[0].nei_idx,u.pyramid[1]=p[1].nei_idx,u.pyramid[2]=p[2].nei_idx):(u.pyramid[0]=p[0].nei_idx,u.pyramid[1]=p[2].nei_idx,u.pyramid[2]=p[1].nei_idx),u.pyramid[3]=p[3].nei_idx}else if(3==i){p[0].rank>p[1].rank&&o(p,0,1),p[1].rank>p[2].rank&&o(p,1,2),p[0].rank>p[1].rank&&o(p,0,1);var O=this.getBondStereo(t,t[0].edge_idx),T=this.getBondStereo(t,t[1].edge_idx),E=this.getBondStereo(t,t[2].edge_idx),A=0,C=0;if(A+=O==l.Bond.PATTERN.STEREO.UP?1:0,A+=T==l.Bond.PATTERN.STEREO.UP?1:0,A+=E==l.Bond.PATTERN.STEREO.UP?1:0,C+=O==l.Bond.PATTERN.STEREO.DOWN?1:0,C+=T==l.Bond.PATTERN.STEREO.DOWN?1:0,C+=E==l.Bond.PATTERN.STEREO.DOWN?1:0,4==a){if(3==A)throw new Error("all 3 bonds up near stereoatom");if(3==C)throw new Error("all 3 bonds down near stereoatom");if(0==A&&0==C)throw new Error("no up/down bonds near stereoatom -- indefinite case");if(1==A&&1==C)throw new Error("one bond up, one bond down -- indefinite case");if(y=0,2==A)h=l.Bond.PATTERN.STEREO.DOWN;else if(2==C)h=l.Bond.PATTERN.STEREO.UP;else{for(g=-1,b=-1,v=-1,c=0;c<3;c++)if(j=this.getBondStereo(t,p[c].edge_idx),j==l.Bond.PATTERN.STEREO.UP||j==l.Bond.PATTERN.STEREO.DOWN){g=c,y=j,b=(c+1)%3,v=(c+2)%3;break}if(g==-1)throw new Error("internal error: can not find up or down bond");var P=r.xyzzy(p[b].vec,p[v].vec,p[g].vec);if(3==P||4==P)throw new Error("degenerate case for 3 bonds near stereoatom");h=1==P?y:y==l.Bond.PATTERN.STEREO.UP?l.Bond.PATTERN.STEREO.DOWN:l.Bond.PATTERN.STEREO.UP}var N=r.sign(p[0].vec,p[1].vec,p[2].vec);h==l.Bond.PATTERN.STEREO.UP&&N>0||h==l.Bond.PATTERN.STEREO.DOWN&&N<0?(u.pyramid[0]=p[0].nei_idx,u.pyramid[1]=p[1].nei_idx,u.pyramid[2]=p[2].nei_idx):(u.pyramid[0]=p[0].nei_idx,u.pyramid[1]=p[2].nei_idx,u.pyramid[2]=p[1].nei_idx),u.pyramid[3]=-1}else{var j;if(C>0&&A>0)throw new Error("one bond up, one bond down -- indefinite case");if(0==C&&0==A)throw new Error("no up-down bonds attached to stereocenter");j=A>0?1:-1,1!=r.xyzzy(p[0].vec,p[1].vec,p[2].vec)&&1!=r.xyzzy(p[0].vec,p[2].vec,p[1].vec)&&1!=r.xyzzy(p[2].vec,p[1].vec,p[0].vec)||(j=-j),N=r.sign(p[0].vec,p[1].vec,p[2].vec),N==j?(u.pyramid[0]=p[0].nei_idx,u.pyramid[1]=p[2].nei_idx,u.pyramid[2]=p[1].nei_idx):(u.pyramid[0]=p[0].nei_idx,u.pyramid[1]=p[1].nei_idx,u.pyramid[2]=p[2].nei_idx),u.pyramid[3]=-1}}this.atoms.set(t,u)},r.prototype.getBondStereo=function(t,e){var n=this.molecule.bonds.get(e);return t!=n.begin?0:n.stereo},r.xyzzy=function(t,e,n){var r=.001,o=s.cross(t,e),i=s.dot(t,e),a=s.cross(t,n),l=s.dot(t,n);if(Math.abs(o)<r){if(Math.abs(a)<r)throw new Error("degenerate case -- bonds overlap");return a>0?4:8}return o*a<-r*r?2:l<i?2:1},r.sign=function(t,e,n){var r=(t.x-n.x)*(e.y-n.y)-(t.y-n.y)*(e.x-n.x),o=.001;if(r>o)return 1;if(r<-o)return-1;throw new Error("degenerate triangle")},r.isPyramidMappingRigid=function(t){var e=t.clone(),n=!0;return e[0]>e[1]&&(o(e,0,1),n=!n),e[1]>e[2]&&(o(e,1,2),n=!n),e[2]>e[3]&&(o(e,2,3),n=!n),e[1]>e[2]&&(o(e,1,2),n=!n),e[0]>e[1]&&(o(e,0,1),n=!n),e[1]>e[2]&&(o(e,1,2),n=!n),n},e.exports=r},{"../../util/map":116,"../../util/set":118,"../../util/vec2":119,"../struct":33}],30:[function(t,e,n){function r(t){var e=r.attrGetDefault;if(!(t&&"label"in t))throw new Error("label must be specified!");this.label=t.label,this.fragment=Object.isUndefined(t.fragment)?-1:t.fragment,a.ifDef(this,t,"isotope",e("isotope")),a.ifDef(this,t,"radical",e("radical")),a.ifDef(this,t,"charge",e("charge")),a.ifDef(this,t,"rglabel",e("rglabel")),a.ifDef(this,t,"attpnt",e("attpnt")),a.ifDef(this,t,"explicitValence",e("explicitValence")),this.valence=0,this.implicitH=0,Object.isUndefined(t.pp)?this.pp=new i:this.pp=new i(t.pp),this.sgs={},a.ifDef(this,t,"ringBondCount",e("ringBondCount")),a.ifDef(this,t,"substitutionCount",e("substitutionCount")),a.ifDef(this,t,"unsaturatedAtom",e("unsaturatedAtom")),a.ifDef(this,t,"hCount",e("hCount")),a.ifDef(this,t,"aam",e("aam")),a.ifDef(this,t,"invRet",e("invRet")),a.ifDef(this,t,"exactChangeFlag",e("exactChangeFlag")),a.ifDef(this,t,"rxnFragmentType",-1),this.atomList=Object.isUndefined(t.atomList)||null==t.atomList?null:new l(t.atomList),this.neighbors=[],this.badConn=!1}function o(t){if(t-=0,t==r.PATTERN.RADICAL.NONE)return 0;if(t==r.PATTERN.RADICAL.DOUPLET)return 1;if(t==r.PATTERN.RADICAL.SINGLET||t==r.PATTERN.RADICAL.TRIPLET)return 2;throw new Error("Unknown radical value")}var i=t("../../util/vec2"),a=t("../../util"),s=t("../element"),l=t("./atomlist");r.getAttrHash=function(t){var e=new Hash;for(var n in r.attrlist)"undefined"!=typeof t[n]&&e.set(n,t[n]);return e},r.attrGetDefault=function(t){if(t in r.attrlist)return r.attrlist[t];throw new Error("Attribute unknown")},r.PATTERN={RADICAL:{NONE:0,SINGLET:1,DOUPLET:2,TRIPLET:3}},r.attrlist={label:"C",isotope:0,radical:0,charge:0,explicitValence:-1,ringBondCount:0,substitutionCount:0,unsaturatedAtom:0,hCount:0,atomList:null,invRet:0,exactChangeFlag:0,rglabel:null,attpnt:null,aam:0},r.prototype.clone=function(t){var e=new r(this);return t&&this.fragment in t&&(e.fragment=t[this.fragment]),e},r.prototype.isQuery=function(){return null!=this.atomList||"A"==this.label||this.attpnt||this.hCount},r.prototype.pureHydrogen=function(){return"H"==this.label&&0==this.isotope},r.prototype.isPlainCarbon=function(){return"C"==this.label&&0==this.isotope&&0==this.radical&&0==this.charge&&this.explicitValence<0&&0==this.ringBondCount&&0==this.substitutionCount&&0==this.unsaturatedAtom&&0==this.hCount&&!this.atomList},r.prototype.isPseudo=function(){return!this.atomList&&!this.rglabel&&!s.getElementByLabel(this.label)},r.prototype.hasRxnProps=function(){return!(!this.invRet&&!this.exactChangeFlag&&a.isNull(this.attpnt)&&!this.aam)},r.prototype.calcValence=function(t){var e=this,n=e.charge,r=e.label;if(e.isQuery())return this.implicitH=0,!0;var i=s.getElementByLabel(r);if(null==i)return this.implicitH=0,!0;var a=s[i].group,l=o(e.radical),u=t,c=0,p=Math.abs(n);return 1==a?"H"!=r&&"Li"!=r&&"Na"!=r&&"K"!=r&&"Rb"!=r&&"Cs"!=r&&"Fr"!=r||(u=1,c=1-l-t-p):2==a?t+l+p==2||t+l+p==0?u=2:c=-1:3==a?"B"==r||"Al"==r||"Ga"==r||"In"==r?n==-1?(u=4,c=4-l-t):(u=3,c=3-l-t-p):"Tl"==r&&(n==-1?l+t<=2?(u=2,c=2-l-t):(u=4,c=4-l-t):n==-2?l+t<=3?(u=3,c=3-l-t):(u=5,c=5-l-t):l+t+p<=1?(u=1,c=1-l-t-p):(u=3,c=3-l-t-p)):4==a?"C"==r||"Si"==r||"Ge"==r?(u=4,c=4-l-t-p):"Sn"!=r&&"Pb"!=r||(t+l+p<=2?(u=2,c=2-l-t-p):(u=4,c=4-l-t-p)):5==a?"N"==r||"P"==r?1==n?(u=4,c=4-l-t):2==n?(u=3,c=3-l-t):"N"==r||l+t+p<=3?(u=3,c=3-l-t-p):(u=5,c=5-l-t-p):"Bi"!=r&&"Sb"!=r&&"As"!=r||(1==n?l+t<=2&&"As"!=r?(u=2,c=2-l-t):(u=4,c=4-l-t):2==n?(u=3,c=3-l-t):l+t<=3?(u=3,c=3-l-t-p):(u=5,c=5-l-t-p)):6==a?"O"==r?n>=1?(u=3,c=3-l-t):(u=2,c=2-l-t-p):"S"==r||"Se"==r||"Po"==r?1==n?t<=3?(u=3,c=3-l-t):(u=5,c=5-l-t):t+l+p<=2?(u=2,c=2-l-t-p):t+l+p<=4?(u=4,c=4-l-t-p):(u=6,c=6-l-t-p):"Te"==r&&(n==-1?t<=2&&(u=2,c=2-l-t-p):0!=n&&2!=n||(t<=2?(u=2,c=2-l-t-p):t<=4?(u=4,c=4-l-t-p):0==n&&t<=6?(u=6,c=6-l-t-p):c=-1)):7==a?"F"==r?(u=1,c=1-l-t-p):"Cl"!=r&&"Br"!=r&&"I"!=r&&"At"!=r||(1==n?t<=2?(u=2,c=2-l-t):(3==t||5==t||t>=7)&&(c=-1):0==n&&(t<=1?(u=1,c=1-l-t):2==t||4==t||6==t?1==l?(u=t,c=0):c=-1:t>7&&(c=-1))):8==a&&(t+l+p==0?u=1:c=-1),this.valence=u,this.implicitH=c,!(this.implicitH<0)||(this.valence=t,this.implicitH=0,this.badConn=!0,!1)},r.prototype.calcValenceMinusHyd=function(t){var e=this,n=e.charge,r=e.label,i=s.getElementByLabel(r);if(null==i)throw new Error("Element "+r+" unknown");if(i<0)return this.implicitH=0,null;var a=s[i].group,l=o(e.radical);if(3==a){if(("B"==r||"Al"==r||"Ga"==r||"In"==r)&&n==-1&&l+t<=4)return l+t}else if(5==a){if("N"==r||"P"==r){if(1==n)return l+t;if(2==n)return l+t}else if("Sb"==r||"Bi"==r||"As"==r){if(1==n)return l+t;if(2==n)return l+t}}else if(6==a){if("O"==r){if(n>=1)return l+t}else if(("S"==r||"Se"==r||"Po"==r)&&1==n)return l+t}else if(7==a&&("Cl"==r||"Br"==r||"I"==r||"At"==r)&&1==n)return l+t;return l+t+Math.abs(n)},e.exports=r},{"../../util":115,"../../util/vec2":119,"../element":22,"./atomlist":31}],31:[function(t,e,n){function r(t){if(!(t&&"notList"in t&&"ids"in t))throw new Error("'notList' and 'ids' must be specified!");this.notList=t.notList,this.ids=t.ids}var o=t("../element");r.prototype.labelList=function(){for(var t=[],e=0;e<this.ids.length;++e)t.push(o[this.ids[e]].label);return t},r.prototype.label=function(){var t="["+this.labelList().join(",")+"]";return this.notList&&(t="!"+t),t},r.prototype.equals=function(t){return this.notList==t.notList&&(this.ids||[]).sort().toString()==(t.ids||[]).sort().toString()},e.exports=r},{"../element":22}],32:[function(t,e,n){function r(t){if(!(t&&"begin"in t&&"end"in t&&"type"in t))throw new Error("'begin', 'end' and 'type' properties must be specified!");this.begin=t.begin,this.end=t.end,this.type=t.type,this.stereo=r.PATTERN.STEREO.NONE,this.topology=r.PATTERN.TOPOLOGY.EITHER,this.reactingCenterStatus=0,this.hb1=null,this.hb2=null,this.len=0,this.sb=0,this.sa=0,this.angle=0,t.stereo&&(this.stereo=t.stereo),t.topology&&(this.topology=t.topology),t.reactingCenterStatus&&(this.reactingCenterStatus=t.reactingCenterStatus),this.center=new o}var o=t("../../util/vec2");r.PATTERN={TYPE:{SINGLE:1,DOUBLE:2,TRIPLE:3,AROMATIC:4,SINGLE_OR_DOUBLE:5,SINGLE_OR_AROMATIC:6,DOUBLE_OR_AROMATIC:7,ANY:8},STEREO:{NONE:0,UP:1,EITHER:4,DOWN:6,CIS_TRANS:3},TOPOLOGY:{EITHER:0,RING:1,CHAIN:2},REACTING_CENTER:{NOT_CENTER:-1,UNMARKED:0,CENTER:1,UNCHANGED:2,MADE_OR_BROKEN:4,ORDER_CHANGED:8,MADE_OR_BROKEN_AND_CHANGED:12}},r.attrlist={type:r.PATTERN.TYPE.SINGLE,stereo:r.PATTERN.STEREO.NONE,topology:r.PATTERN.TOPOLOGY.EITHER,reactingCenterStatus:0};var i={single:{type:r.PATTERN.TYPE.SINGLE,stereo:r.PATTERN.STEREO.NONE},up:{type:r.PATTERN.TYPE.SINGLE,stereo:r.PATTERN.STEREO.UP},down:{type:r.PATTERN.TYPE.SINGLE,stereo:r.PATTERN.STEREO.DOWN},updown:{type:r.PATTERN.TYPE.SINGLE,stereo:r.PATTERN.STEREO.EITHER},double:{type:r.PATTERN.TYPE.DOUBLE,stereo:r.PATTERN.STEREO.NONE},crossed:{type:r.PATTERN.TYPE.DOUBLE,stereo:r.PATTERN.STEREO.CIS_TRANS},triple:{type:r.PATTERN.TYPE.TRIPLE,stereo:r.PATTERN.STEREO.NONE},aromatic:{type:r.PATTERN.TYPE.AROMATIC,stereo:r.PATTERN.STEREO.NONE},singledouble:{type:r.PATTERN.TYPE.SINGLE_OR_DOUBLE,stereo:r.PATTERN.STEREO.NONE},singlearomatic:{type:r.PATTERN.TYPE.SINGLE_OR_AROMATIC,stereo:r.PATTERN.STEREO.NONE},doublearomatic:{type:r.PATTERN.TYPE.DOUBLE_OR_AROMATIC,stereo:r.PATTERN.STEREO.NONE},any:{type:r.PATTERN.TYPE.ANY,stereo:r.PATTERN.STEREO.NONE}};r.getAttrHash=function(t){var e=new Hash;for(var n in r.attrlist)"undefined"!=typeof t[n]&&e.set(n,t[n]);return e},r.attrGetDefault=function(t){if(t in r.attrlist)return r.attrlist[t];throw new Error("Attribute unknown")},r.type2Caption=function(t,e){for(var n in i)if(i[n].type==t&&i[n].stereo==e)return n;throw"No such bond caption"},r.caption2Type=function(t){return Object.clone(i[t])},r.prototype.hasRxnProps=function(){return!!this.reactingCenterStatus},r.prototype.getCenter=function(t){var e=t.atoms.get(this.begin).pp,n=t.atoms.get(this.end).pp;return o.lc2(e,.5,n,.5)},r.prototype.getDir=function(t){var e=t.atoms.get(this.begin).pp,n=t.atoms.get(this.end).pp;return n.sub(e).normalized()},r.prototype.clone=function(t){var e=new r(this);return t&&(e.begin=t[e.begin],e.end=t[e.end]),e},r.prototype.findOtherEnd=function(t){if(t==this.begin)return this.end;if(t==this.end)return this.begin;throw new Error("bond end not found")},e.exports=r},{"../../util/vec2":119}],33:[function(t,e,n){function r(){this.atoms=new c,this.bonds=new c,this.sgroups=new c,this.halfBonds=new u,this.loops=new c,this.isChiral=!1,this.isReaction=!1,this.rxnArrows=new c,this.rxnPluses=new c,this.frags=new c,this.rgroups=new u,this.name="",this.sGroupForest=new w(this)}function o(t,e,n){if(3!=arguments.length)throw new Error("Invalid parameter number!");this.begin=t-0,this.end=e-0,this.bid=n-0,this.dir=new h,this.norm=new h,this.ang=0,this.p=new h,this.loop=-1,this.contra=-1,this.next=-1,this.leftSin=0,this.leftCos=0,this.leftNeighbor=0,this.rightSin=0,this.rightCos=0,this.rightNeighbor=0}function i(t,e,n){this.hbs=t,this.dblBonds=0,this.aromatic=!0,this.convex=n||!1,t.each(function(t){var n=e.bonds.get(e.halfBonds.get(t).bid);n.type!=b.PATTERN.TYPE.AROMATIC&&(this.aromatic=!1),n.type==b.PATTERN.TYPE.DOUBLE&&this.dblBonds++},this)}function a(t){t=t||{},this.pp=t.pp?new h(t.pp):new h}function s(t){t=t||{},this.pp=t.pp?new h(t.pp):new h}function l(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return!1;return t.push(e),!0}var u=t("../../util/map"),c=t("../../util/pool"),p=t("../../util/set"),h=t("../../util/vec2"),f=t("../../util"),d=t("../element"),g=t("./atom"),m=t("./atomlist"),b=t("./bond"),v=t("./sgroup"),y=t("./rgroup"),w=t("./sgforest");r.prototype.hasRxnProps=function(){return this.atoms.find(function(t,e){return e.hasRxnProps()},this)>=0||this.bonds.find(function(t,e){return e.hasRxnProps()},this)>=0},r.prototype.hasRxnArrow=function(){return this.rxnArrows.count()>0},r.prototype.getSGroupsInAtomSet=function(t){var e=new Hash;t.forEach(function(t){var n=p.list(this.atoms.get(t).sgs);n.each(function(t){var n=e.get(t);Object.isUndefined(n)?n=1:n++,e.set(t,n)},this)},this);var n=[];return e.each(function(t){var e=parseInt(t.key,10),r=this.sgroups.get(e),o=v.getAtoms(this,r);t.value==o.length&&n.push(e)},this),n},r.prototype.isBlank=function(){return 0===this.atoms.count()&&0===this.rxnArrows.count()&&0===this.rxnPluses.count()&&!this.isChiral},r.prototype.toLists=function(){var t={},e=[];this.atoms.each(function(n,r){t[n]=e.length,e.push(r)});var n=[];return this.bonds.each(function(e,r){var o=new b(r);o.begin=t[r.begin],o.end=t[r.end],n.push(o)}),{atoms:e,bonds:n}},r.prototype.clone=function(t,e,n,o){var i=new r;return this.mergeInto(i,t,e,n,!1,o)},r.prototype.getScaffold=function(){var t=p.empty();return this.atoms.each(function(e){p.add(t,e)},this),this.rgroups.each(function(e,n){n.frags.each(function(e,n){this.atoms.each(function(e,r){r.fragment==n&&p.remove(t,e)},this)},this)},this),this.clone(t)},r.prototype.getFragmentIds=function(t){var e=p.empty();return this.atoms.each(function(n,r){r.fragment==t&&p.add(e,n)},this),e},r.prototype.getFragment=function(t){return this.clone(this.getFragmentIds(t))},r.prototype.mergeInto=function(t,e,n,r,o,i){e=e||p.keySetInt(this.atoms),n=n||p.keySetInt(this.bonds),n=p.filter(n,function(t){var n=this.bonds.get(t);return p.contains(e,n.begin)&&p.contains(e,n.end)},this);var a={};this.atoms.each(function(t,n){p.contains(e,t)&&(a[n.fragment]=1)});var s={};this.frags.each(function(e,n){a[e]&&(s[e]=t.frags.add(Object.clone(n)))}),this.rgroups.each(function(e,n){var r=o;if(r||(n.frags.each(function(t,e){a[e]&&(r=!0)}),r)){var i=t.rgroups.get(e);i?n.frags.each(function(t,e){a[e]&&i.frags.add(s[e])}):t.rgroups.set(e,n.clone(s))}}),"undefined"!=typeof i&&null!==i||(i={}),this.atoms.each(function(n,r){p.contains(e,n)&&(i[n]=t.atoms.add(r.clone(s)))});var l={};return this.bonds.each(function(e,r){p.contains(n,e)&&(l[e]=t.bonds.add(r.clone(i)))}),this.sgroups.each(function(n,r){var o;for(o=0;o<r.atoms.length;++o)if(!p.contains(e,r.atoms[o]))return;r=v.clone(r,i,l);var a=t.sgroups.add(r);for(r.id=a,o=0;o<r.atoms.length;++o)p.add(t.atoms.get(r.atoms[o]).sgs,a);"DAT"==r.type?t.sGroupForest.insert(r.id,-1,[]):t.sGroupForest.insert(r.id)}),t.isChiral=this.isChiral,r||(t.isReaction=this.isReaction,this.rxnArrows.each(function(e,n){t.rxnArrows.add(n.clone())}),this.rxnPluses.each(function(e,n){t.rxnPluses.add(n.clone())})),t},r.prototype.findBondId=function(t,e){var n=-1;return this.bonds.find(function(r,o){return(o.begin==t&&o.end==e||o.begin==e&&o.end==t)&&(n=r,!0)},this),n},r.prototype.initNeighbors=function(){this.atoms.each(function(t,e){e.neighbors=[]}),this.bonds.each(function(t,e){var n=this.atoms.get(e.begin),r=this.atoms.get(e.end);n.neighbors.push(e.hb1),r.neighbors.push(e.hb2)},this)},r.prototype.bondInitHalfBonds=function(t,e){e=e||this.bonds.get(t),e.hb1=2*t,e.hb2=2*t+1,this.halfBonds.set(e.hb1,new o(e.begin,e.end,t)),this.halfBonds.set(e.hb2,new o(e.end,e.begin,t));var n=this.halfBonds.get(e.hb1),r=this.halfBonds.get(e.hb2);n.contra=e.hb2,r.contra=e.hb1},r.prototype.halfBondUpdate=function(t){var e=this.halfBonds.get(t),n=this.atoms.get(e.begin).pp,r=this.atoms.get(e.end).pp,o=h.diff(r,n).normalized();e.dir=h.dist(r,n)>1e-4?o:new h(1,0),e.norm=e.dir.turnLeft(),e.ang=e.dir.oxAngle(),e.loop<0&&(e.loop=-1)},r.prototype.initHalfBonds=function(){this.halfBonds.clear(),this.bonds.each(this.bondInitHalfBonds,this)},r.prototype.setHbNext=function(t,e){this.halfBonds.get(this.halfBonds.get(t).contra).next=e},r.prototype.halfBondSetAngle=function(t,e){var n=this.halfBonds.get(t),r=this.halfBonds.get(e);r.rightCos=n.leftCos=h.dot(r.dir,n.dir),r.rightSin=n.leftSin=h.cross(r.dir,n.dir),n.leftNeighbor=e,r.rightNeighbor=t},r.prototype.atomAddNeighbor=function(t){var e=this.halfBonds.get(t),n=this.atoms.get(e.begin),r=0;for(r=0;r<n.neighbors.length&&!(this.halfBonds.get(n.neighbors[r]).ang>e.ang);++r);n.neighbors.splice(r,0,t);var o=n.neighbors[(r+1)%n.neighbors.length],i=n.neighbors[(r+n.neighbors.length-1)%n.neighbors.length];this.setHbNext(i,t),this.setHbNext(t,o),this.halfBondSetAngle(t,i),this.halfBondSetAngle(o,t)},r.prototype.atomSortNeighbors=function(t){var e=this.atoms.get(t);e.neighbors=e.neighbors.sortBy(function(t){return this.halfBonds.get(t).ang},this);var n;for(n=0;n<e.neighbors.length;++n)this.halfBonds.get(this.halfBonds.get(e.neighbors[n]).contra).next=e.neighbors[(n+1)%e.neighbors.length];for(n=0;n<e.neighbors.length;++n)this.halfBondSetAngle(e.neighbors[(n+1)%e.neighbors.length],e.neighbors[n])},r.prototype.sortNeighbors=function(t){function e(t){this.atomSortNeighbors(t)}f.isNullOrUndefined(t)?this.atoms.each(e,this):t.forEach(e,this)},r.prototype.atomUpdateHalfBonds=function(t){for(var e=this.atoms.get(t).neighbors,n=0;n<e.length;++n){var r=e[n];this.halfBondUpdate(r),this.halfBondUpdate(this.halfBonds.get(r).contra)}},r.prototype.updateHalfBonds=function(t){function e(t){this.atomUpdateHalfBonds(t)}f.isNullOrUndefined(t)?this.atoms.each(e,this):t.forEach(e,this)},r.prototype.sGroupsRecalcCrossBonds=function(){this.sgroups.each(function(t,e){e.xBonds=[],e.neiAtoms=[]},this),this.bonds.each(function(t,e){var n=this.atoms.get(e.begin),r=this.atoms.get(e.end);p.each(n.sgs,function(n){if(!p.contains(r.sgs,n)){var o=this.sgroups.get(n);o.xBonds.push(t),l(o.neiAtoms,e.end)}},this),p.each(r.sgs,function(r){if(!p.contains(n.sgs,r)){var o=this.sgroups.get(r);o.xBonds.push(t),l(o.neiAtoms,e.begin)}},this)},this)},r.prototype.sGroupDelete=function(t){for(var e=this.sgroups.get(t),n=0;n<e.atoms.length;++n)p.remove(this.atoms.get(e.atoms[n]).sgs,t);this.sGroupForest.remove(t),this.sgroups.remove(t)},r.prototype.atomSetPos=function(t,e){var n=this.atoms.get(t);n.pp=e},r.prototype.rxnPlusSetPos=function(t,e){var n=this.rxnPluses.get(t);n.pp=e},r.prototype.rxnArrowSetPos=function(t,e){var n=this.rxnArrows.get(t);n.pp=e},r.prototype.getCoordBoundingBox=function(t){function e(t){n?(n.min=h.min(n.min,t),n.max=h.max(n.max,t)):n={min:t,max:t}}var n=null,r="undefined"==typeof t;return this.atoms.each(function(n,o){(r||p.contains(t,n))&&e(o.pp)}),r&&(this.rxnPluses.each(function(t,n){e(n.pp)}),this.rxnArrows.each(function(t,n){e(n.pp)})),!n&&r&&(n={min:new h(0,0),max:new h(1,1)}),n},r.prototype.getCoordBoundingBoxObj=function(){function t(t){e?(e.min=h.min(e.min,t),e.max=h.max(e.max,t)):e={min:new h(t),max:new h(t)}}var e=null;return this.atoms.each(function(e,n){t(n.pp)}),e},r.prototype.getBondLengthData=function(){var t=0,e=0;return this.bonds.each(function(n,r){t+=h.dist(this.atoms.get(r.begin).pp,this.atoms.get(r.end).pp),e++},this),{cnt:e,totalLength:t}},r.prototype.getAvgBondLength=function(){var t=this.getBondLengthData();return t.cnt>0?t.totalLength/t.cnt:-1},r.prototype.getAvgClosestAtomDistance=function(){var t,e,n,r=0,o=0,i=this.atoms.keys();for(e=0;e<i.length;++e){for(t=-1,n=0;n<i.length;++n)n!=e&&(o=h.dist(this.atoms.get(i[n]).pp,this.atoms.get(i[e]).pp),(t<0||t>o)&&(t=o));r+=t}return i.length>0?r/i.length:-1},r.prototype.checkBondExists=function(t,e){var n=!1;return this.bonds.each(function(r,o){(o.begin==t&&o.end==e||o.end==t&&o.begin==e)&&(n=!0)},this),n},r.prototype.findConnectedComponent=function(t){for(var e={},n=[t],r=p.empty();n.length>0;)(function(){var t=n.pop();e[t]=1,p.add(r,t);for(var o=this.atoms.get(t),i=0;i<o.neighbors.length;++i){var a=this.halfBonds.get(o.neighbors[i]).end;p.contains(r,a)||n.push(a)}}).apply(this);return r},r.prototype.findConnectedComponents=function(t){this.halfBonds.count()||(this.initHalfBonds(),this.initNeighbors(),this.updateHalfBonds(this.atoms.keys()),this.sortNeighbors(this.atoms.keys()));var e={};this.atoms.each(function(t){e[t]=-1},this);var n=[];return this.atoms.each(function(r,o){if((t||o.fragment<0)&&e[r]<0){var i=this.findConnectedComponent(r);n.push(i),p.each(i,function(t){e[t]=1},this)}},this),n},r.prototype.markFragment=function(t){var e={},n=this.frags.add(e);p.each(t,function(t){this.atoms.get(t).fragment=n},this)},r.prototype.markFragmentByAtomId=function(t){this.markFragment(this.findConnectedComponent(t))},r.prototype.markFragments=function(){for(var t=this.findConnectedComponents(),e=0;e<t.length;++e)this.markFragment(t[e])},r.prototype.scale=function(t){1!=t&&(this.atoms.each(function(e,n){n.pp=n.pp.scaled(t)},this),this.rxnPluses.each(function(e,n){n.pp=n.pp.scaled(t)},this),this.rxnArrows.each(function(e,n){n.pp=n.pp.scaled(t)},this),this.sgroups.each(function(e,n){n.pp=n.pp?n.pp.scaled(t):null},this))},r.prototype.rescale=function(){var t=this.getAvgBondLength();t<0&&!this.isReaction&&(t=this.getAvgClosestAtomDistance()),t<.001&&(t=1);var e=1/t;this.scale(e)},r.prototype.loopHasSelfIntersections=function(t){for(var e=0;e<t.length;++e)for(var n=this.halfBonds.get(t[e]),r=this.atoms.get(n.begin).pp,o=this.atoms.get(n.end).pp,i=p.fromList([n.begin,n.end]),a=e+2;a<t.length;++a){var s=this.halfBonds.get(t[a]);if(!p.contains(i,s.begin)&&!p.contains(i,s.end)){var l=this.atoms.get(s.begin).pp,u=this.atoms.get(s.end).pp;if(h.segmentIntersection(r,o,l,u))return!0}}return!1},r.prototype.partitionLoop=function(t){var e=[],n=!0;t:for(;n;){for(var r={},o=0;o<t.length;++o){
var i=t[o],a=this.halfBonds.get(i).begin,s=this.halfBonds.get(i).end;if(s in r){var l=r[s],u=t.slice(l,o+1);e.push(u),o<t.length&&t.splice(l,o-l+1);continue t}r[a]=o}n=!1,e.push(t)}return e},r.prototype.halfBondAngle=function(t,e){var n=this.halfBonds.get(t),r=this.halfBonds.get(e);return Math.atan2(h.cross(n.dir,r.dir),h.dot(n.dir,r.dir))},r.prototype.loopIsConvex=function(t){for(var e=0;e<t.length;++e){var n=this.halfBondAngle(t[e],t[(e+1)%t.length]);if(n>0)return!1}return!0},r.prototype.loopIsInner=function(t){for(var e=2*Math.PI,n=0;n<t.length;++n){var r=t[n],o=t[(n+1)%t.length],i=this.halfBonds.get(o),a=this.halfBondAngle(r,o);e+=i.contra==t[n]?Math.PI:a}return Math.abs(e)<Math.PI},r.prototype.findLoops=function(){var t,e,n,r,o=[],a=p.empty();return this.halfBonds.each(function(s,l){if(l.loop==-1)for(t=s,e=0,n=[];e<=this.halfBonds.count();t=this.halfBonds.get(t).next,++e){if(e>0&&t==s){var u=this.partitionLoop(n);u.forEach(function(t){this.loopIsInner(t)&&!this.loopHasSelfIntersections(t)?(r=Math.min.apply(Math,t),this.loops.set(r,new i(t,this,this.loopIsConvex(t)))):r=-2,t.each(function(t){this.halfBonds.get(t).loop=r,p.add(a,this.halfBonds.get(t).bid)},this),r>=0&&o.push(r)},this);break}n.push(t)}},this),{newLoops:o,bondsToMark:p.list(a)}},r.prototype.prepareLoopStructure=function(){this.initHalfBonds(),this.initNeighbors(),this.updateHalfBonds(this.atoms.keys()),this.sortNeighbors(this.atoms.keys()),this.findLoops()},r.prototype.atomAddToSGroup=function(t,e){v.addAtom(this.sgroups.get(t),e),p.add(this.atoms.get(e).sgs,t)},r.prototype.calcConn=function(t){for(var e=0,n=this.atoms.get(t),r=!1,o=!1,i=0;i<n.neighbors.length;++i){var a=this.halfBonds.get(n.neighbors[i]),s=this.bonds.get(a.bid);switch(s.type){case b.PATTERN.TYPE.SINGLE:e+=1;break;case b.PATTERN.TYPE.DOUBLE:e+=2;break;case b.PATTERN.TYPE.TRIPLE:e+=3;break;case b.PATTERN.TYPE.AROMATIC:e+=1,o=!0,this.loops.each(function(t,e){e.hbs.indexOf(n.neighbors[i])!=-1&&e.hbs.length%2==1&&(r=!0)},this);break;default:return-1}}return!o||n.hasImplicitH||r||(e+=1),e},r.prototype.calcImplicitHydrogen=function(t){var e=this.calcConn(t),n=this.atoms.get(t);if(n.badConn=!1,e<0||n.isQuery())return void(n.implicitH=0);if(n.explicitValence>=0){var r=d.getElementByLabel(n.label);n.implicitH=0,null!=r&&(n.implicitH=n.explicitValence-n.calcValenceMinusHyd(e),n.implicitH<0&&(n.implicitH=0,n.badConn=!0))}else n.calcValence(e)},r.prototype.setImplicitHydrogen=function(t){function e(t){this.calcImplicitHydrogen(t)}this.sgroups.each(function(t,e){"MRV_IMPLICIT_H"==e.data.fieldName&&(this.atoms.get(e.atoms[0]).hasImplicitH=!0)},this),f.isNullOrUndefined(t)?this.atoms.each(e,this):t.forEach(e,this)},r.prototype.getComponents=function(){var t=this.findConnectedComponents(!0),e=[],n=null;this.rxnArrows.each(function(t,e){n=e.pp.x}),this.rxnPluses.each(function(t,n){e.push(n.pp.x)}),null!=n&&e.push(n),e.sort(function(t,e){return t-e});var r,o=[];for(r=0;r<t.length;++r){for(var i=this.getCoordBoundingBox(t[r]),a=h.lc2(i.min,.5,i.max,.5),s=0;a.x>e[s];)++s;o[s]=o[s]||{},p.mergeIn(o[s],t[r])}var l=[],u=[],c=[];for(r=0;r<o.length;++r)o[r]?(i=this.getCoordBoundingBox(o[r]),a=h.lc2(i.min,.5,i.max,.5),a.x<n?u.push(o[r]):c.push(o[r])):l.push("");return{reactants:u,products:c}},a.prototype.clone=function(){return new a(this)},s.prototype.clone=function(){return new s(this)},e.exports=Object.assign(r,{Atom:g,AtomList:m,Bond:b,SGroup:v,RGroup:y,RxnPlus:a,RxnArrow:s})},{"../../util":115,"../../util/map":116,"../../util/pool":117,"../../util/set":118,"../../util/vec2":119,"../element":22,"./atom":30,"./atomlist":31,"./bond":32,"./rgroup":34,"./sgforest":35,"./sgroup":36}],34:[function(t,e,n){function r(t){t=t||{},this.frags=new o,this.resth=t.resth||!1,this.range=t.range||"",this.ifthen=t.ifthen||0}var o=t("../../util/pool");r.prototype.getAttrs=function(){return{resth:this.resth,range:this.range,ifthen:this.ifthen}},r.findRGroupByFragment=function(t,e){var n;return t.each(function(t,r){Object.isUndefined(r.frags.keyOf(e))||(n=t)}),n},r.prototype.clone=function(t){var e=new r(this);return this.frags.each(function(n,r){e.frags.add(t?t[r]:r)}),e},e.exports=r},{"../../util/pool":117}],35:[function(t,e,n){function r(t){this.parent=new o,this.children=new o,this.children.set(-1,[]),this.molecule=t}var o=t("../../util/map"),i=t("../../util/set"),a=t("../../util");r.prototype.getSGroupsBFS=function(){var t=[],e=[],n=-1;for(e=[].slice.call(this.children.get(-1));e.length>0;)n=e.shift(),e=e.concat(this.children.get(n)),t.push(n);return t},r.prototype.getAtomSets=function(){return this.molecule.sgroups.map(function(t,e){return i.fromList(e.atoms)})},r.prototype.getAtomSetRelations=function(t,e){var n=new o,r=new o,s=this.getAtomSets();s.unset(t),s.each(function(t,o){r.set(t,i.subset(e,o)),n.set(t,i.subset(o,e)&&!i.eq(o,e))},this);var l=s.findAll(function(t){return!!r.get(t)&&!(this.children.get(t).findIndex(function(t){return r.get(t)},this)>=0)},this);a.assert(l.length<=1,"We are here");var u=s.findAll(function(t){return n.get(t)&&!n.get(this.parent.get(t))},this);return{children:u,parent:0===l.length?-1:l[0]}},r.prototype.getPathToRoot=function(t){for(var e=[],n=t;n>=0;n=this.parent.get(n))a.assert(e.indexOf(n)<0,"SGroupForest: loop detected"),e.push(n);return e},r.prototype.validate=function(){var t=this.getAtomSets();this.molecule.sgroups.each(function(t){this.getPathToRoot(t)},this);var e=!0;return this.parent.each(function(n,r){r>=0&&!i.subset(t.get(n),t.get(r))&&(e=!1)},this),this.children.each(function(n){for(var r=this.children.get(n),o=0;o<r.length;++o)for(var a=o+1;a<r.length;++a){var s=r[o],l=r[a],u=this.molecule.sgroups.get(s),c=this.molecule.sgroups.get(l);i.disjoint(t.get(s),t.get(l))||"DAT"==u.type||"DAT"==c.type||(e=!1)}},this),e},r.prototype.insert=function(t,e,n){a.assert(!this.parent.has(t),"sgid already present in the forest"),a.assert(!this.children.has(t),"sgid already present in the forest"),a.assert(this.validate(),"s-group forest invalid");var r=this.getAtomSets(),o=i.fromList(this.molecule.sgroups.get(t).atoms);if(!e||!n){var s=this.getAtomSetRelations(t,o,r);e=s.parent,n=s.children}return n.forEach(function(e){var n=this.children.get(this.parent.get(e)),r=n.indexOf(e);a.assert(r>=0&&n.indexOf(e,r+1)<0),n.splice(r,1),this.parent.set(e,t)},this),this.children.set(t,n),this.parent.set(t,e),this.children.get(e).push(t),a.assert(this.validate(),"s-group forest invalid"),{parent:e,children:n}},r.prototype.remove=function(t){a.assert(this.parent.has(t),"sgid is not in the forest"),a.assert(this.children.has(t),"sgid is not in the forest"),a.assert(this.validate(),"s-group forest invalid");var e=this.parent.get(t);this.children.get(t).forEach(function(t){this.parent.set(t,e),this.children.get(e).push(t)},this);var n=this.children.get(e),r=n.indexOf(t);a.assert(r>=0&&n.indexOf(t,r+1)<0),n.splice(r,1),this.children.unset(t),this.parent.unset(t),a.assert(this.validate(),"s-group forest invalid")},e.exports=r},{"../../util":115,"../../util/map":116,"../../util/set":118}],36:[function(t,e,n){function r(t){if(!(t&&t in r.TYPES))throw new Error("Invalid or unsupported s-group type");this.type=t,this.id=-1,this.label=-1,this.bracketBox=null,this.bracketDir=new a(1,0),this.areas=[],this.highlight=!1,this.highlighting=null,this.selected=!1,this.selectionPlate=null,this.atoms=[],this.patoms=[],this.bonds=[],this.xBonds=[],this.neiAtoms=[],this.pp=null,this.data={mul:1,connectivity:"ht",name:"",subscript:"n",attached:!1,absolute:!0,showUnits:!1,nCharsToDisplay:-1,tagChar:"",daspPos:1,fieldType:"F",fieldName:"",fieldValue:"",units:"",query:"",queryOp:""}}var o=t("../../util/box2abs"),i=t("../../util/set"),a=t("../../util/vec2"),s=t("../../util"),l=t("./atom"),u=t("./bond");r.TYPES={MUL:1,SRU:2,SUP:3,DAT:4,GEN:5},r.prototype.getAttr=function(t){return this.data[t]},r.prototype.getAttrs=function(){var t={};for(var e in this.data)t[e]=this.data[e];return t},r.prototype.setAttr=function(t,e){var n=this.data[t];return this.data[t]=e,n},r.prototype.checkAttr=function(t,e){return this.data[t]==e},r.filterAtoms=function(t,e){for(var n=[],r=0;r<t.length;++r){var o=t[r];"number"!=typeof e[o]?n.push(o):e[o]>=0?n.push(e[o]):n.push(-1)}return n},r.removeNegative=function(t){for(var e=[],n=0;n<t.length;++n)t[n]>=0&&e.push(t[n]);return e},r.filter=function(t,e,n){e.atoms=r.removeNegative(r.filterAtoms(e.atoms,n))},r.clone=function(t,e){var n=new r(t.type);for(var o in t.data)n.data[o]=t.data[o];return n.atoms=t.atoms.map(function(t){return e[t]}),n.pp=t.pp,n.bracketBox=t.bracketBox,n.patoms=null,n.bonds=null,n.allAtoms=t.allAtoms,n},r.addAtom=function(t,e){t.atoms.push(e)},r.removeAtom=function(t,e){for(var n=0;n<t.atoms.length;++n)if(t.atoms[n]===e)return void t.atoms.splice(n,1);throw new Error("The atom is not found in the given s-group")},r.getCrossBonds=function(t,e,n,r){n.bonds.each(function(n,o){i.contains(r,o.begin)&&i.contains(r,o.end)?s.isNull(t)||t.push(n):(i.contains(r,o.begin)||i.contains(r,o.end))&&(s.isNull(e)||e.push(n))},this)},r.bracketPos=function(t,e,n,r){var i=t.atoms;if(r&&2===r.length){var l=n.bonds.get(r[0]),u=n.bonds.get(r[1]),c=l.getCenter(n),p=u.getCenter(n);t.bracketDir=a.diff(p,c).normalized()}else t.bracketDir=new a(1,0);var h=t.bracketDir,f=h.rotateSC(1,0),d=null,g=[];i.forEach(function(t){var r=n.atoms.get(t),i=e?e.ctab.atoms.get(t).visel.boundingBox:null,l=new a(r.pp);if(s.isNull(i)){i=new o(l,l);var u=new a(.05*3,.05*3);i=i.extend(u,u)}else i=i.translate((e.offset||new a).negated()).transform(e.scaled2obj,e);g.push(i)},this),n.sGroupForest.children.get(t.id).forEach(function(t){var n=e?e.ctab.sgroups.get(t).visel.boundingBox:null;s.isNull(n)||(n=n.translate((e.offset||new a).negated()).transform(e.scaled2obj,e),g.push(n))},this),g.forEach(function(t){var e=null;[t.p0.x,t.p1.x].forEach(function(n){[t.p0.y,t.p1.y].forEach(function(t){var r=new a(n,t),i=new a(a.dot(r,h),a.dot(r,f));e=s.isNull(e)?new o(i,i):e.include(i)},this)},this),d=s.isNull(d)?e:o.union(d,e)},this);var m=new a(.2,.4);s.isNull(d)||(d=d.extend(m,m)),t.bracketBox=d},r.getBracketParameters=function(t,e,n,r,o,l,u,c){function p(t,e,n,r){this.c=t,this.d=e,this.n=e.rotateSC(1,0),this.w=n,this.h=r}var h=[];return e.length<2?!function(){o=o||new a(1,0),l=l||o.rotateSC(1,0);var t=Math.min(.25,.3*r.sz().x),e=a.lc2(o,r.p0.x,l,.5*(r.p0.y+r.p1.y)),n=a.lc2(o,r.p1.x,l,.5*(r.p0.y+r.p1.y)),i=r.sz().y;h.push(new p(e,o.negated(),t,i),new p(n,o,t,i))}():2===e.length?!function(){var n=t.bonds.get(e[0]),r=t.bonds.get(e[1]),o=n.getCenter(t),i=r.getCenter(t),l=-1,f=-1,d=-1,g=-1,m=a.centre(o,i),b=a.diff(i,o).normalized(),v=b.negated(),y=b.rotateSC(1,0),w=y.negated();t.sGroupForest.children.get(c).forEach(function(t){var e=u?u.ctab.sgroups.get(t).visel.boundingBox:null;s.isNull(e)||(e=e.translate((u.offset||new a).negated()).transform(u.scaled2obj,u),l=Math.max(l,a.shiftRayBox(o,v,e)),f=Math.max(f,a.shiftRayBox(i,b,e)),d=Math.max(d,a.shiftRayBox(m,y,e)),g=Math.max(g,a.shiftRayBox(m,w,e)))},this),l=Math.max(l+.2,0),f=Math.max(f+.2,0),d=Math.max(Math.max(d,g)+.1,0);var x=.25,S=1.5+d;h.push(new p(o.addScaled(v,l),v,x,S),new p(i.addScaled(b,f),b,x,S))}():!function(){for(var r=0;r<e.length;++r){var o=t.bonds.get(e[r]),a=o.getCenter(t),s=i.contains(n,o.begin)?o.getDir(t):o.getDir(t).negated();h.push(new p(a,s,.2,1))}}(),h},r.getObjBBox=function(t,e){if(0==t.length)throw new Error("Atom list is empty");for(var n=e.atoms.get(t[0]).pp,r=new o(n,n),i=1;i<t.length;++i){var a=t[i],s=e.atoms.get(a),l=s.pp;r=r.include(l)}return r},r.getAtoms=function(t,e){if(!e.allAtoms)return e.atoms;var n=[];return t.atoms.each(function(t){n.push(t)}),n},r.getBonds=function(t,e){var n=r.getAtoms(t,e),o=[];return t.bonds.each(function(t,e){n.indexOf(e.begin)>=0&&n.indexOf(e.end)>=0&&o.push(t)}),o},r.prepareMulForSaving=function(t,e){var n;t.atoms.sort(),t.atomSet=i.fromList(t.atoms),t.parentAtomSet=i.clone(t.atomSet);var r=[],o=[];if(e.bonds.each(function(e,n){i.contains(t.parentAtomSet,n.begin)&&i.contains(t.parentAtomSet,n.end)?r.push(e):(i.contains(t.parentAtomSet,n.begin)||i.contains(t.parentAtomSet,n.end))&&o.push(e)},t),0!=o.length&&2!=o.length)throw{id:t.id,"error-type":"cross-bond-number",message:"Unsupported cross-bonds number"};var a=-1,s=-1,c=null;if(2==o.length){var p=e.bonds.get(o[0]);a=i.contains(t.parentAtomSet,p.begin)?p.begin:p.end;var h=e.bonds.get(o[1]);s=i.contains(t.parentAtomSet,h.begin)?h.begin:h.end,c=h}var f=null,d=a,g=[];for(n=0;n<t.data.mul-1;++n)if(f={},t.atoms.forEach(function(n){var r=e.atoms.get(n),o=e.atoms.add(new l(r));g.push(o),t.atomSet[o]=1,f[n]=o}),r.forEach(function(t){var n=e.bonds.get(t),r=new u(n);r.begin=f[r.begin],r.end=f[r.end],e.bonds.add(r)}),null!=c){var m=new u(c);m.begin=d,m.end=f[s],e.bonds.add(m),d=f[a]}if(g.forEach(function(n){e.sGroupForest.getPathToRoot(t.id).reverse().forEach(function(t){e.atomAddToSGroup(t,n)})}),d>=0){var b=e.bonds.get(o[0]);b.begin==a?b.begin=d:b.end=d}t.bonds=o},r.getMassCentre=function(t,e){for(var n=new a,r=0;r<e.length;++r)n=n.addScaled(t.atoms.get(e[r]).pp,1/e.length);return n},r.setPos=function(t,e,n){e.pp=n},r.packDataGroup=function(t,e,n,o){var s=i.fromList(o),l=i.empty();n.loops.each(function(t,e){e.hbs.findIndex(function(t){return i.contains(s,n.halfBonds.get(t).begin)})>=0&&e.hbs.forEach(function(t){i.add(l,n.halfBonds.get(t).begin)},this)},this),i.mergeIn(l,s),o=i.list(l);var u={},c=n.clone(null,null,!1,u);return o.forEach(function(n){n=u[n];var o=new r("DAT"),i=c.sgroups.add(o);o.id=i,o.pp=new a,o.data.fieldName=t,o.data.fieldValue=e,c.atomAddToSGroup(i,n)}),c},e.exports=r},{"../../util":115,"../../util/box2abs":114,"../../util/set":118,"../../util/vec2":119,"./atom":30,"./bond":32}],37:[function(t,e,n){(function(n){function r(){this.operations=[]}function o(t,e){e=new q(e);var n,o=new r,i=J.render.ctab,a=i.molecule,s=[],l=Y.empty(),u=Y.empty();if(t.atoms){var c=Y.fromList(t.atoms);for(i.bonds.each(function(t,e){Y.contains(c,e.b.begin)&&Y.contains(c,e.b.end)?(s.push(t),["hb1","hb2"].forEach(function(t){var n=a.halfBonds.get(e.b[t]).loop;n>=0&&Y.add(l,n)},this)):Y.contains(c,e.b.begin)?Y.add(u,e.b.begin):Y.contains(c,e.b.end)&&Y.add(u,e.b.end)},this),n=0;n<s.length;++n)o.addOp(new K.BondMove(s[n],e));for(Y.each(l,function(t){i.reloops.get(t)&&i.reloops.get(t).visel&&o.addOp(new K.LoopMove(t,e))},this),n=0;n<t.atoms.length;++n){var p=t.atoms[n];o.addOp(new K.AtomMove(p,e,(!Y.contains(u,p))))}}if(t.rxnArrows)for(n=0;n<t.rxnArrows.length;++n)o.addOp(new K.RxnArrowMove(t.rxnArrows[n],e,(!0)));if(t.rxnPluses)for(n=0;n<t.rxnPluses.length;++n)o.addOp(new K.RxnPlusMove(t.rxnPluses[n],e,(!0)));if(t.sgroupData)for(n=0;n<t.sgroupData.length;++n)o.addOp(new K.SGroupDataMove(t.sgroupData[n],e));if(t.chiralFlags)for(n=0;n<t.chiralFlags.length;++n)o.addOp(new K.ChiralFlagMove(e));return o.perform()}function i(t,e,n){var o=new r;return("number"==typeof t?[t]:t).each(function(t){for(var r in X.Atom.attrlist){var i;if(r in e)i=e[r];else{if(!n)continue;i=X.Atom.attrGetDefault(r)}o.addOp(new K.AtomAttr(t,r,i))}!n&&"label"in e&&null!=e.label&&"L#"!=e.label&&!e.atomList&&o.addOp(new K.AtomAttr(t,"atomList",null))},this),o.perform()}function a(t,e,n,o){var i=new r;for(var a in X.Bond.attrlist){var s;if(a in e)s=e[a];else{if(!o)continue;s=X.Bond.attrGetDefault(a)}i.addOp(new K.BondAttr(t,a,s))}return n&&i.mergeWith(x(t)),i.perform()}function s(t,e){e=Object.clone(e);var n=new r;return e.fragment=n.addOp((new K.FragmentAdd).perform(J.editor)).frid,n.addOp(new K.AtomAdd(e,t).perform(J.editor)),n}function l(t,e,n){if(n!=e&&Object.isNumber(n)){var r=X.RGroup.findRGroupByFragment(J.render.ctab.molecule.rgroups,n);Object.isUndefined(r)||t.mergeWith(I(null,n)),J.render.ctab.molecule.atoms.each(function(r,o){o.fragment==n&&t.addOp(new K.AtomAttr(r,"fragment",e).perform(J.editor))}),t.addOp(new K.FragmentDelete(n).perform(J.editor))}}function u(t){var e=[],n=$(J.render.ctab,t);V(J.render.ctab,t).each(function(t){var r=$(J.render.ctab,t.aid);q.dist(n,r)<.1||e.push({id:t.aid,v:q.diff(r,n)})}),e.sort(function(t,e){return Math.atan2(t.v.y,t.v.x)-Math.atan2(e.v.y,e.v.x)});var r,o,i=0,a=0;for(r=0;r<e.length;r++)o=q.angle(e[r].v,e[(r+1)%e.length].v),o<0&&(o+=2*Math.PI),o>a&&(i=r,a=o);var s=new q(1,0);if(e.length>0){if(1==e.length){a=-(4*Math.PI/3);var l=V(J.render.ctab,t)[0];if(z(J.render.ctab,l.aid)>1){var u=[],c=$(J.render.ctab,l.aid),p=q.diff(n,c),h=Math.atan2(p.y,p.x);V(J.render.ctab,l.aid).each(function(t){var e=$(J.render.ctab,t.aid);if(!(t.bid==l.bid||q.dist(c,e)<.1)){var n=q.diff(e,c),r=Math.atan2(n.y,n.x)-h;r<0&&(r+=2*Math.PI),u.push(r)}}),u.sort(function(t,e){return t-e}),u[0]<=1.01*Math.PI&&u[u.length-1]<=1.01*Math.PI&&(a*=-1)}}o=a/2+Math.atan2(e[i].v.y,e[i].v.x),s=s.rotate(o)}s.add_(n);var f=Z.atom(J.render.ctab,s,.1);return f=null==f?{label:"C"}:f.id,{atom:f,pos:s}}function c(t,e,n,o,i){if(void 0===n){var a=u(e);n=a.atom,o=a.pos}var s=new r,c=null;if(Object.isNumber(e)){if(c=H(J.render.ctab,e,"fragment"),Object.isNumber(n)){var p=H(J.render.ctab,n,"fragment");l(s,c,p)}}else Object.isNumber(n)&&(c=H(J.render.ctab,n,"fragment"));null==c&&(c=s.addOp((new K.FragmentAdd).perform(J.editor)).frid),Object.isNumber(e)?"*"==H(J.render.ctab,e,"label")&&s.addOp(new K.AtomAttr(e,"label","C").perform(J.editor)):(e.fragment=c,e=s.addOp(new K.AtomAdd(e,o).perform(J.editor)).data.aid,o=i),Object.isNumber(n)?"*"==H(J.render.ctab,n,"label")&&s.addOp(new K.AtomAttr(n,"label","C").perform(J.editor)):(n.fragment=c,n=s.addOp(new K.AtomAdd(n,o).perform(J.editor)).data.aid,Object.isNumber(e)&&W(J.render.ctab,e).each(function(t){s.addOp(new K.SGroupAtomAdd(t,n).perform(J.editor))},this));var h=s.addOp(new K.BondAdd(e,n,t).perform(J.editor)).data.bid;return s.operations.reverse(),[s,e,n,h]}function p(t){var e=new r;return J.render.ctab.molecule.rxnArrows.count()<1&&e.addOp(new K.RxnArrowAdd(t).perform(J.editor)),e}function h(t){var e=new r;return e.addOp(new K.RxnArrowDelete(t)),e.perform()}function f(){var t=new r;return t.addOp(new K.ChiralFlagDelete),t.perform()}function d(t){var e=new r;return e.addOp(new K.RxnPlusAdd(t).perform(J.editor)),e}function g(t){var e=new r;return e.addOp(new K.RxnPlusDelete(t)),e.perform()}function m(t){var e=new r,n=[],o=J.render.ctab.molecule.atoms.get(t).fragment;return V(J.render.ctab,t).each(function(t){e.addOp(new K.BondDelete(t.bid)),1==z(J.render.ctab,t.aid)&&(e.removeAtomFromSgroupIfNeeded(t.aid)&&n.push(t.aid),e.addOp(new K.AtomDelete(t.aid)))},this),e.removeAtomFromSgroupIfNeeded(t)&&n.push(t),e.addOp(new K.AtomDelete(t)),e.removeSgroupIfNeeded(n),e=e.perform(),e.mergeWith(new v(o)),e}function b(t){var e=new r,n=J.render.ctab.molecule.bonds.get(t),o=J.render.ctab.molecule.atoms.get(n.begin).fragment,i=[];return e.addOp(new K.BondDelete(t)),1==z(J.render.ctab,n.begin)&&(e.removeAtomFromSgroupIfNeeded(n.begin)&&i.push(n.begin),e.addOp(new K.AtomDelete(n.begin))),1==z(J.render.ctab,n.end)&&(e.removeAtomFromSgroupIfNeeded(n.end)&&i.push(n.end),e.addOp(new K.AtomDelete(n.end))),e.removeSgroupIfNeeded(i),e=e.perform(),e.mergeWith(new v(o)),e}function v(t){var e=new r,n=X.RGroup.findRGroupByFragment(J.render.ctab.molecule.rgroups,t);return J.render.ctab.molecule.atoms.each(function(r,o){if(o.fragment==t){var i=e.addOp((new K.FragmentAdd).perform(J.editor)).frid,a=function(n){e.addOp(new K.AtomAttr(n,"fragment",i).perform(J.editor)),V(J.render.ctab,n).each(function(e){J.render.ctab.molecule.atoms.get(e.aid).fragment==t&&a(e.aid)})};a(r),n&&e.mergeWith(I(n,i))}}),t!=-1&&(e.mergeWith(I(0,t)),e.addOp(new K.FragmentDelete(t).perform(J.editor))),e}function y(t){t=t||J.editor.getSelection();var e=new r,n=[],o=[],i=new r;for(t.sgroupData&&t.sgroupData.each(function(t){i.mergeWith(B(t))},this),t.atoms.each(function(e){V(J.render.ctab,e).each(function(e){t.bonds.indexOf(e.bid)==-1&&(t.bonds=t.bonds.concat([e.bid]))},this)},this),t.bonds.each(function(r){e.addOp(new K.BondDelete(r));var i=J.render.ctab.molecule.bonds.get(r),a=J.render.ctab.molecule.atoms.get(i.begin).fragment;o.indexOf(a)<0&&o.push(a),t.atoms.indexOf(i.begin)==-1&&1==z(J.render.ctab,i.begin)&&(e.removeAtomFromSgroupIfNeeded(i.begin)&&n.push(i.begin),e.addOp(new K.AtomDelete(i.begin))),t.atoms.indexOf(i.end)==-1&&1==z(J.render.ctab,i.end)&&(e.removeAtomFromSgroupIfNeeded(i.end)&&n.push(i.end),e.addOp(new K.AtomDelete(i.end)))},this),t.atoms.each(function(t){var r=J.render.ctab.molecule.atoms.get(t).fragment;o.indexOf(r)<0&&o.push(r),e.removeAtomFromSgroupIfNeeded(t)&&n.push(t),e.addOp(new K.AtomDelete(t))},this),e.removeSgroupIfNeeded(n),t.rxnArrows.each(function(t){e.addOp(new K.RxnArrowDelete(t))},this),t.rxnPluses.each(function(t){e.addOp(new K.RxnPlusDelete(t))},this),t.chiralFlags.each(function(t){e.addOp(new K.ChiralFlagDelete(t))},this),e=e.perform();o.length>0;)e.mergeWith(new v(o.pop()));return e.mergeWith(i),e}function w(t,e){var n=new r,o=H(J.render.ctab,t,"fragment"),i=H(J.render.ctab,e,"fragment");o!=i&&l(n,o,i);var a=new r;V(J.render.ctab,t).each(function(t){var n,r,o=J.render.ctab.molecule.bonds.get(t.bid);o.begin==t.aid?(n=t.aid,r=e):(n=e,r=t.aid),e!=o.begin&&e!=o.end&&J.render.ctab.molecule.findBondId(n,r)==-1&&a.addOp(new K.BondAdd(n,r,o)),a.addOp(new K.BondDelete(t.bid))},this);var s=X.Atom.getAttrHash(J.render.ctab.molecule.atoms.get(t));1==z(J.render.ctab,t)&&"*"==s.get("label")&&s.set("label","C"),s.each(function(t){a.addOp(new K.AtomAttr(e,t.key,t.value))},this);var u=a.removeAtomFromSgroupIfNeeded(t);return a.addOp(new K.AtomDelete(t)),u&&a.removeSgroupIfNeeded([t]),a.perform().mergeWith(n)}function x(t){var e=J.render.ctab.molecule.bonds.get(t),n=new r;return n.addOp(new K.BondDelete(t)),n.addOp(new K.BondAdd(e.end,e.begin,e)).data.bid=t,n}function S(t){return x(t).perform()}function O(t,e,n){var o=new r,i=n.molecule,a=(new K.FragmentAdd).perform(J.editor),s={};return i.atoms.each(function(r,i){var l,u=X.Atom.getAttrHash(i).toObject();u.fragment=a.frid,o.addOp(l=new K.AtomAdd(u,q.diff(i.pp,n.xy0).rotate(e).add(t)).perform(J.editor)),s[r]=l.data.aid}),i.bonds.each(function(t,e){o.addOp(new K.BondAdd(s[e.begin],s[e.end],e).perform(J.editor))}),o.operations.reverse(),o.addOp(a),o}function T(t,e){var n=new r;return t.forEach(function(t){n.addOp(new K.SGroupAtomAdd(t,e).perform(J.editor))},this),n}function E(t,e,n,o,a){var s=new r,l=o.molecule,p=J.render.ctab,h=p.molecule,f=h.atoms.get(t),d=t,g=null,m=W(p,t),b=H(p,t,"fragment"),v={},y=l.atoms.get(o.aid).pp;if(n){if(null==e){var w=u(t),x=c({type:1},t,w.atom,w.pos.get_xy0());s=x[0],s.operations.reverse(),g=t=x[2]}else{var S;s.addOp(S=new K.AtomAdd({label:"C",fragment:b},new q(1,0).rotate(e).add(f.pp).get_xy0()).perform(J.editor)),s.addOp(new K.BondAdd(t,S.data.aid,{type:1}).perform(J.editor)),g=t=S.data.aid,s.mergeWith(T(m,t))}var O=f;f=h.atoms.get(t);var E=a(O.pp,f.pp)-o.angle0}else null==e&&(w=u(t),e=a(f.pp,w.pos)),E=e-o.angle0;return l.atoms.each(function(e,n){var r=X.Atom.getAttrHash(n).toObject();if(r.fragment=b,e==o.aid)s.mergeWith(i(t,r,!0)),v[e]=t;else{var a;a=q.diff(n.pp,y).rotate(E).add(f.pp),s.addOp(S=new K.AtomAdd(r,a.get_xy0()).perform(J.editor)),v[e]=S.data.aid}v[e]-0!==d-0&&v[e]-0!==g-0&&s.mergeWith(T(m,v[e]))}),l.bonds.each(function(t,e){s.addOp(new K.BondAdd(v[e.begin],v[e.end],e).perform(J.editor))}),s.operations.reverse(),s}function A(t,e,n,o){var s,l,u=new r,c=e.molecule,p=J.render.ctab,h=p.molecule,f=h.bonds.get(t),d=h.atoms.get(f.begin),g=h.atoms.get(f.end),m=Y.list(Y.intersection(Y.fromList(W(p,f.begin)),Y.fromList(W(p,f.end)))),b=c.bonds.get(e.bid),v=H(p,f.begin,"fragment"),y={};o?(s=c.atoms.get(b.end),l=c.atoms.get(b.begin),y[b.end]=f.begin,y[b.begin]=f.end):(s=c.atoms.get(b.begin),l=c.atoms.get(b.end),y[b.begin]=f.begin,y[b.end]=f.end);var w=n(d.pp,g.pp)-n(s.pp,l.pp),x=q.dist(d.pp,g.pp)/q.dist(s.pp,l.pp);return c.atoms.each(function(t,e){var n=X.Atom.getAttrHash(e).toObject();if(n.fragment=v,t==b.begin||t==b.end)return void u.mergeWith(i(y[t],n,!0));var r;r=q.diff(e.pp,s.pp).rotate(w).scaled(x).add(d.pp);var o=Z.atom(p,r,.1);if(null==o){var a;u.addOp(a=new K.AtomAdd(n,r).perform(J.editor)),y[t]=a.data.aid,u.mergeWith(T(m,y[t]))}else y[t]=o.id,u.mergeWith(i(y[t],n,!0))}),c.bonds.each(function(t,e){var n=h.findBondId(y[e.begin],y[e.end]);n==-1?u.addOp(new K.BondAdd(y[e.begin],y[e.end],e).perform(J.editor)):u.mergeWith(a(n,b,!1,!0))}),u.operations.reverse(),u}function C(t,e,n,o){var i,a=Math.PI/6,s=Math.cos(a),l=Math.sin(a),u=new r;i=null!=o?H(J.render.ctab,o,"fragment"):u.addOp((new K.FragmentAdd).perform(J.editor)).frid;var p=-1;return p=null!=o?o:u.addOp(new K.AtomAdd({label:"C",fragment:i},t).perform(J.editor)).data.aid,u.operations.reverse(),n.times(function(n){var r=new q(s*(n+1),1&n?0:l).rotate(e).add(t),o=Z.atom(J.render.ctab,r,.1),i=c({},p,o?o.id:{},r);u=i[0].mergeWith(u),p=i[2]},this),u}function P(t){var e=new r;return e.addOp(new K.CanvasLoad(t)),e.perform()}function N(t,e){var n=J.render.ctab,o=n.sgroups.get(t).item,i=o.type;if(e&&e!=i){var a=[].slice.call(X.SGroup.getAtoms(n.molecule,o)),s=o.getAttrs(),l=B(t),u=M(e,a,s,t);return u.mergeWith(l)}return new r}function j(t,e){var n=new r;return new Hash(e).each(function(e){n.addOp(new K.SGroupAttr(t,e.key,e.value))},this),n.perform()}function R(t,e){var n=new r;return new Hash(e).each(function(e){n.addOp(new K.SGroupAttr(t,e.key,e.value))},this),n}function B(t){var e=new r,n=J.render.ctab,o=n.molecule,i=n.sgroups.get(t).item;if("SRU"==i.type){o.sGroupsRecalcCrossBonds();var a=i.neiAtoms;a.each(function(t){"*"==H(n,t,"label")&&e.addOp(new K.AtomAttr(t,"label","C"))},this)}var s=o.sgroups.get(t),l=X.SGroup.getAtoms(o,s),u=s.getAttrs();e.addOp(new K.SGroupRemoveFromHierarchy(t));for(var c=0;c<l.length;++c)e.addOp(new K.SGroupAtomRemove(t,l[c]));return e.addOp(new K.SGroupDelete(t)),e=e.perform(),e.mergeWith(R(t,u)),e}function M(t,e,n,o,i){var a,s=new r;for(o=o-0===o?o:J.render.ctab.molecule.sgroups.newId(),s.addOp(new K.SGroupCreate(o,t,i)),a=0;a<e.length;a++)s.addOp(new K.SGroupAtomAdd(o,e[a]));s.addOp("DAT"!=t?new K.SGroupAddToHierarchy(o):new K.SGroupAddToHierarchy(o,(-1),[])),s=s.perform();var l=J.render.ctab;if("SRU"==t){l.molecule.sGroupsRecalcCrossBonds();var u=new r;l.sgroups.get(o).item.neiAtoms.each(function(t){var e=l.atoms.get(t).a.isPlainCarbon();1==z(J.render.ctab,t)&&e&&u.addOp(new K.AtomAttr(t,"label","*"))},this),u=u.perform(),u.mergeWith(s),s=u}return j(o,n).mergeWith(s)}function _(t,e){var n=new r;return new Hash(e).each(function(e){n.addOp(new K.RGroupAttr(t,e.key,e.value))},this),n.perform()}function I(t,e){var n=new r;return n.addOp(new K.RGroupFragment(t,e)),n.perform()}function k(t){if(t.atoms.length){for(var e=1e50,n=e,r=-e,o=-n,i=0;i<t.atoms.length;i++)e=Math.min(e,t.atoms[i].pp.x),n=Math.min(n,t.atoms[i].pp.y),r=Math.max(r,t.atoms[i].pp.x),o=Math.max(o,t.atoms[i].pp.y);return new q((e+r)/2,(n+o)/2)}return t.rxnArrows.length?t.rxnArrows[0].pp:t.rxnPluses.length?t.rxnPluses[0].pp:t.chiralFlags.length?t.chiralFlags[0].pp:null}function D(t,e){var n=[];return t.atoms.each(function(t,r){r.fragment==e&&n.push(t)},this),n}function L(t){console.assert(!t.isBlank(),"Empty struct");var e={atoms:t.atoms.keys(),bonds:t.bonds.keys(),rxnArrows:t.rxnArrows.keys(),rxnPluses:t.rxnPluses.keys()},n={atoms:[],bonds:[],sgroups:[],rxnArrows:[],rxnPluses:[],chiralFlags:[],rgmap:{},rgroups:{}},r={};e.atoms.each(function(e){var o=new X.Atom(t.atoms.get(e));o.pos=o.pp,r[e]=n.atoms.push(new X.Atom(o))-1}),e.bonds.each(function(e){var o=new X.Bond(t.bonds.get(e));o.begin=r[o.begin],o.end=r[o.end],n.bonds.push(new X.Bond(o))});var o=t.getSGroupsInAtomSet(e.atoms);o.forEach(function(e){for(var o=t.sgroups.get(e),i=X.SGroup.getAtoms(t,o),a={type:o.type,attrs:o.getAttrs(),atoms:[].slice.call(i),pp:o.pp},s=0;s<a.atoms.length;s++)a.atoms[s]=r[a.atoms[s]];n.sgroups.push(a)},this),e.rxnArrows.each(function(e){var r=new X.RxnArrow(t.rxnArrows.get(e));r.pos=r.pp,n.rxnArrows.push(r)}),e.rxnPluses.each(function(e){var r=new X.RxnPlus(t.rxnPluses.get(e));r.pos=r.pp,n.rxnPluses.push(r)});var i={},a=Y.empty();e.atoms.each(function(e){var n=t.atoms.get(e),r=n.fragment;i[e]=r,Y.add(a,r)});var s=Y.empty();return Y.each(a,function(e){for(var r=D(t,e),o=0;o<r.length;++o)if(!Y.contains(i,r[o]))return;var a=X.RGroup.findRGroupByFragment(t.rgroups,e);n.rgmap[e]=a,Y.add(s,a)},this),Y.each(s,function(e){n.rgroups[e]=t.rgroups.get(e).getAttrs()},this),n}function F(t,e){for(var n=L(t),o=e?q.diff(e,k(n)):new q,i=new r,a={},s={},l=0;l<n.atoms.length;l++){var u=Object.clone(n.atoms[l]);u.fragment in s||(s[u.fragment]=i.addOp((new K.FragmentAdd).perform(J.editor)).frid),u.fragment=s[u.fragment],a[l]=i.addOp(new K.AtomAdd(u,u.pp.add(o)).perform(J.editor)).data.aid}var c=[];for(var p in n.rgroups)J.render.ctab.molecule.rgroups.has(p)||c.push(p);for(var h in n.rgmap)i.addOp(new K.RGroupFragment(n.rgmap[h],s[h]).perform(J.editor));for(var f=0;f<c.length;++f)i.mergeWith(_(c[f],n.rgroups[c[f]]));for(var d=0;d<n.bonds.length;d++){var g=Object.clone(n.bonds[d]);i.addOp(new K.BondAdd(a[g.begin],a[g.end],g).perform(J.editor))}for(var m=0;m<n.sgroups.length;m++){for(var b=n.sgroups[m],v=b.atoms,y=[],w=0;w<v.length;w++)y.push(a[v[w]]);for(var x=J.render.ctab.molecule.sgroups.newId(),S=M(b.type,y,b.attrs,x,b.pp?b.pp.add(o):null),O=S.operations.length-1;O>=0;O--)i.addOp(S.operations[O])}if(J.editor.render.ctab.rxnArrows.count()<1)for(var T=0;T<n.rxnArrows.length;T++)i.addOp(new K.RxnArrowAdd(n.rxnArrows[T].pp.add(o)).perform(J.editor));for(var E=0;E<n.rxnPluses.length;E++)i.addOp(new K.RxnPlusAdd(n.rxnPluses[E].pp.add(o)).perform(J.editor));if(t.isChiral){var A=t.getCoordBoundingBox(),C=new q(A.max.x,A.min.y-1);i.addOp(new K.ChiralFlagAdd(C.add(o))).perform(J.editor)}return i.operations.reverse(),i}function G(t,e){var n,o=J.render.ctab,i=o.molecule,a=new r,s={};if(t.atoms){for(n=0;n<t.atoms.length;n++){var l=t.atoms[n],u=i.atoms.get(l);u.fragment in s?s[u.fragment].push(l):s[u.fragment]=[l]}if(Object.keys(s).find(function(t){return!Y.eq(i.getFragmentIds(t),Y.fromList(s[t]))}))return a;if(Object.keys(s).forEach(function(t){var n=Y.fromList(s[t]),r=i.getCoordBoundingBox(n);Y.each(n,function(t){var n=i.atoms.get(t),o=new q;"horizontal"==e?o.x=r.min.x+r.max.x-2*n.pp.x:o.y=r.min.y+r.max.y-2*n.pp.y,a.addOp(new K.AtomMove(t,o))})}),t.bonds)for(n=0;n<t.bonds.length;n++){var c=t.bonds[n],p=i.bonds.get(c);p.type==X.Bond.PATTERN.TYPE.SINGLE&&(p.stereo==X.Bond.PATTERN.STEREO.UP?a.addOp(new K.BondAttr(c,"stereo",X.Bond.PATTERN.STEREO.DOWN)):p.stereo==X.Bond.PATTERN.STEREO.DOWN&&a.addOp(new K.BondAttr(c,"stereo",X.Bond.PATTERN.STEREO.UP)))}}return a.perform()}function U(t,e,n){function o(t){var r=t.sub(e);return r=r.rotate(n),r.add_(e),r.sub(t)}var i=J.render.ctab,a=i.molecule,s=new r;return t.atoms&&t.atoms.each(function(t){var e=a.atoms.get(t);s.addOp(new K.AtomMove(t,o(e.pp)))}),t.rxnArrows&&t.rxnArrows.each(function(t){var e=a.rxnArrows.get(t);s.addOp(new K.RxnArrowMove(t,o(e.pp)))}),t.rxnPluses&&t.rxnPluses.each(function(t){var e=a.rxnPluses.get(t);s.addOp(new K.RxnPlusMove(t,o(e.pp)))}),t.sgroupData&&t.sgroupData.each(function(t){var e=a.sgroups.get(t);s.addOp(new K.SGroupDataMove(t,o(e.pp)))}),t.chiralFlags&&t.chiralFlags.each(function(t){var e=a.chiralFlags.get(t);s.addOp(new K.ChiralFlagMove(t,o(e.pp)))}),s.perform()}function H(t,e,n){return t.molecule.atoms.get(e)[n]}function z(t,e){return t.atoms.get(e).a.neighbors.length}function V(t,e){for(var n=t.atoms.get(e),r=[],o=0;o<n.a.neighbors.length;++o){var i=t.molecule.halfBonds.get(n.a.neighbors[o]);r.push({aid:i.end-0,bid:i.bid-0})}return r}function W(t,e){var n=t.atoms.get(e);return Y.list(n.a.sgs)}function $(t,e){return t.molecule.atoms.get(e).pp}var Y=t("../util/set"),q=t("../util/vec2"),K=t("./op"),X=t("../chem/struct"),Z=t("./closest"),J=n.ui;r.prototype.addOp=function(t){return t.isDummy(J.editor)||this.operations.push(t),t},r.prototype.mergeWith=function(t){return this.operations=this.operations.concat(t.operations),this},r.prototype.perform=function(){var t=new r,e=0;return this.operations.each(function(n){t.addOp(n.perform(J.editor)),e++},this),t.operations.reverse(),
t},r.prototype.isDummy=function(){return null==this.operations.find(function(t){return!t.isDummy(J.editor)})},r.prototype.removeAtomFromSgroupIfNeeded=function(t){var e=W(J.render.ctab,t);return e.length>0&&(e.each(function(e){this.addOp(new K.SGroupAtomRemove(e,t))},this),!0)},r.prototype.removeSgroupIfNeeded=function(t){var e=J.render.ctab,n=e.molecule,r=new Hash;t.each(function(t){var n=W(e,t);n.each(function(t){var e=r.get(t);Object.isUndefined(e)?e=1:e++,r.set(t,e)},this)},this),r.each(function(t){var r=parseInt(t.key),o=e.sgroups.get(r).item,i=X.SGroup.getAtoms(e.molecule,o);if(i.length==t.value){var a=n.sgroups.get(r);this.mergeWith(R(r,a.getAttrs())),this.addOp(new K.SGroupRemoveFromHierarchy(r)),this.addOp(new K.SGroupDelete(r))}},this)},e.exports=Object.assign(r,{fromMultipleMove:o,fromAtomAddition:s,fromArrowAddition:p,fromArrowDeletion:h,fromChiralFlagDeletion:f,fromPlusAddition:d,fromPlusDeletion:g,fromAtomDeletion:m,fromBondDeletion:b,fromFragmentDeletion:y,fromAtomMerge:w,fromBondFlipping:S,fromTemplateOnCanvas:O,fromTemplateOnAtom:E,fromTemplateOnBond:A,fromAtomsAttrs:i,fromBondAttrs:a,fromChain:C,fromBondAddition:c,fromNewCanvas:P,fromSgroupType:N,fromSgroupDeletion:B,fromSgroupAttrs:j,fromRGroupFragment:I,fromPaste:F,fromRGroupAttrs:_,fromSgroupAddition:M,fromFlip:G,fromRotate:U})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../chem/struct":33,"../util/set":118,"../util/vec2":119,"./closest":38,"./op":40}],38:[function(t,e,n){(function(n){function r(t,e,n,r){var o=null,i=g;return n=n||i,n=Math.min(n,i),t.atoms.each(function(t,i){if(t!=r){var a=d.dist(e,i.a.pp);a<n&&(o=t,n=a)}}),null!=o?{id:o,dist:n}:null}function o(t,e,n){var r=null,o=null,i=g;n=n||i,n=Math.min(n,i);var a=n;return t.bonds.each(function(n,r){var i=t.atoms.get(r.b.begin).a.pp,s=t.atoms.get(r.b.end).a.pp,l=d.lc2(i,.5,s,.5),u=d.dist(e,l);u<a&&(a=u,o=n)}),t.bonds.each(function(o,i){var a=t.molecule.halfBonds.get(i.b.hb1),s=a.dir,l=a.norm,u=t.atoms.get(i.b.begin).a.pp,c=t.atoms.get(i.b.end).a.pp,p=d.dot(e.sub(u),s)*d.dot(e.sub(c),s)<0;if(p){var h=Math.abs(d.dot(e.sub(u),l));h<n&&(r=o,n=h)}}),null!==r||null!==o?{id:r,dist:n,cid:o,cdist:a}:null}function i(t,e){var n,r;return t.chiralFlags.each(function(t,o){var i=o.pp;if(Math.abs(e.x-i.x)<1){var a=Math.abs(e.y-i.y);a<.3&&(!r||a<n)&&(n=a,r={id:t,dist:n})}}),r}function a(t,e){var n=null,r=null;return t.sgroupData.each(function(t,o){if("DAT"!=o.sgroup.type)throw new Error("Data group expected");if("MRV_IMPLICIT_H"!=o.sgroup.data.fieldName){var i=o.sgroup.dataArea,a=i.p0.y<e.y&&i.p1.y>e.y&&i.p0.x<e.x&&i.p1.x>e.x,s=Math.min(Math.abs(i.p0.x-e.x),Math.abs(i.p1.x-e.x));a&&(null==r||s<n)&&(r={id:t,dist:s},n=s)}}),r}function s(t,e,n,r){r=Math.min(r||g,g);var o;return t.frags.each(function(i,a){if(i!=n){var s=a.calcBBox(t,i);if(s.p0.y<e.y&&s.p1.y>e.y&&s.p0.x<e.x&&s.p1.x>e.x){var l=Math.min(Math.abs(s.p0.x-e.x),Math.abs(s.p1.x-e.x));(!o||l<r)&&(r=l,o={id:i,dist:r})}}}),o}function l(t,e,n,r){r=Math.min(r||g,g);var o;return t.rgroups.each(function(t,i){if(t!=n&&i.labelBox&&i.labelBox.contains(e,.5)){var a=d.dist(i.labelBox.centre(),e);(!o||a<r)&&(r=a,o={id:t,dist:r})}}),o}function u(t,e){var n,r;return t.rxnArrows.each(function(t,o){var i=o.item.pp;if(Math.abs(e.x-i.x)<1){var a=Math.abs(e.y-i.y);a<.3&&(!r||a<n)&&(n=a,r={id:t,dist:n})}}),r}function c(t,e){var n,r;return t.rxnPluses.each(function(t,o){var i=o.item.pp,a=Math.max(Math.abs(e.x-i.x),Math.abs(e.y-i.y));a<.5&&(!r||a<n)&&(n=a,r={id:t,dist:n})}),r}function p(t,e){var n=null,r=g;return t.molecule.sgroups.each(function(t,o){for(var i=o.bracketDir,a=i.rotateSC(1,0),s=new d(d.dot(e,i),d.dot(e,a)),l=0;l<o.areas.length;++l){var u=o.areas[l],c=u.p0.y<s.y&&u.p1.y>s.y&&u.p0.x<s.x&&u.p1.x>s.x,p=Math.min(Math.abs(u.p0.x-s.x),Math.abs(u.p1.x-s.x));c&&(null==n||p<r)&&(n=t,r=p)}}),null!=n?{id:n,dist:r}:null}function h(t,e,n,r){return null!=n&&(null==t||t.dist>n.dist||r)?{type:e,id:n.id,dist:n.dist}:t}function f(t,e,n,f){var d=null;if(!n||n.indexOf("atoms")>=0){var g=r(t,e,void 0,Object.isUndefined(f)||"atoms"!=f.map?void 0:f.id);d=h(d,"Atom",g)}if(!n||n.indexOf("bonds")>=0){var b=o(t,e);b&&(null!==b.cid&&(d=h(d,"Bond",{id:b.cid,dist:b.cdist})),(null==d||d.dist>.4*m.render.scale)&&(d=h(d,"Bond",b)))}if(!n||n.indexOf("chiralFlags")>=0){var v=i(t,e);d=h(d,"ChiralFlag",v)}if(!n||n.indexOf("sgroupData")>=0){var y=a(t,e);d=h(d,"DataSGroupData",y)}if(!n||n.indexOf("sgroups")>=0){var w=p(t,e);d=h(d,"SGroup",w)}if(!n||n.indexOf("rxnArrows")>=0){var x=u(t,e);d=h(d,"RxnArrow",x)}if(!n||n.indexOf("rxnPluses")>=0){var S=c(t,e);d=h(d,"RxnPlus",S)}if(!n||n.indexOf("frags")>=0){var O=s(t,e,f&&"atoms"==f.map?f.id:void 0);d=h(d,"Fragment",O)}if(!n||n.indexOf("rgroups")>=0){var T=l(t,e);d=h(d,"RGroup",T)}return d||{type:"Canvas",id:-1}}var d=t("../util/vec2"),g=.4,m=n.ui;e.exports={atom:r,bond:o,frag:s,rGroup:l,sGroup:p,dataSGgroupData:a,rxnArrow:u,rxnPlus:c,chiralFlag:i,item:f}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util/vec2":119}],39:[function(t,e,n){(function(n){function r(t,e){this.render=new u(t,f,Object.assign({atomColoring:!0},e)),this.selection={},this._tool=null,this.setupEvents(this.render.clientArea)}function o(t,e){var n=t.getVBoxObj(e);return l.lc2(n.p0,.5,n.p1,.5)}function i(t){var e=0,n=0;do e+=t.offsetTop||0,n+=t.offsetLeft||0,t=t.offsetParent;while(t);return new l(n,e)}var a=t("../util"),s=t("../util/set"),l=t("../util/vec2"),u=t("../render"),c=t("../render/restruct"),p=t("./closest"),h={base:t("./tool/base"),rgroupatom:t("./tool/rgroupatom"),select:t("./tool/select"),sgroup:t("./tool/sgroup"),eraser:t("./tool/eraser"),atom:t("./tool/atom"),bond:t("./tool/bond"),chain:t("./tool/chain"),template:t("./tool/template"),charge:t("./tool/charge"),rgroupfragment:t("./tool/rgroupfragment"),apoint:t("./tool/apoint"),reactionarrow:t("./tool/reactionarrow"),reactionplus:t("./tool/reactionplus"),reactionmap:t("./tool/reactionmap"),reactionunmap:t("./tool/reactionunmap"),paste:t("./tool/paste"),rotate:t("./tool/rotate")},f=40,d=n.ui;r.prototype.tool=function(t,e){return arguments.length>0&&(this._tool&&this._tool.OnCancel(),this._tool=new h[t](this,e)),this._tool},r.prototype.struct=function(t){return arguments.length>0&&(this.setSelection(null),this.render.ctab.clearVisels(),this.render.setMolecule(t),this.render.update(),this.recoordinate(o(this.render.ctab))),this.render.ctab.molecule},r.prototype.options=function(t){if(arguments.length>0){var e=this.render.ctab.molecule,n=this.render.zoom;this.render.clientArea.innerHTML="",this.render=new u(this.render.clientArea,f,t),this.render.setMolecule(e),this.render.setZoom(n),this.render.update()}return this.render.options},r.prototype.zoom=function(t){return arguments.length>0&&(this.render.setZoom(t),this.recoordinate(o(this.render.ctab,this.getSelection())),this.render.update()),this.render.zoom},r.prototype.setupEvents=function(t){var e=this,n=this.render;this.longTapFlag=!1,this.longTapTimeout=null,this.longTapTouchstart=null,e.setLongTapTimeout=function(t){e.longTapFlag=!1,e.longTapTouchstart=t,e.longTapTimeout=setTimeout(function(){e.longTapFlag=!0,e.longTapTimeout=null},500)},e.resetLongTapTimeout=function(t){clearTimeout(e.longTapTimeout),e.longTapTimeout=null,t&&(e.longTapTouchstart=null,e.longTapFlag=!1)},t.observe("selectstart",function(t){return a.stopEventPropagation(t),a.preventDefault(t)});var r=null;t.observe("touchstart",function(t){e.resetLongTapTimeout(!0),2==t.touches.length?(this._tui=this._tui||{},this._tui.center={pageX:(t.touches[0].pageX+t.touches[1].pageX)/2,pageY:(t.touches[0].pageY+t.touches[1].pageY)/2},r=new l(n.page2obj(this._tui.center))):1==t.touches.length&&e.setLongTapTimeout(t)}),t.observe("touchmove",function(t){e.resetLongTapTimeout(!0),"_tui"in this&&2==t.touches.length&&(this._tui.center={pageX:(t.touches[0].pageX+t.touches[1].pageX)/2,pageY:(t.touches[0].pageY+t.touches[1].pageY)/2})}),t.observe("gesturestart",function(t){this._tui=this._tui||{},this._tui.scale0=n.zoom,t.preventDefault()}),t.observe("gesturechange",function(e){n.setZoom(this._tui.scale0*e.scale);var o=t.cumulativeOffset(),i=new l(this._tui.center.pageX-o.left,this._tui.center.pageY-o.top);this.recoordinate(i,r),n.update(),e.preventDefault()}),t.observe("gestureend",function(t){delete this._tui,t.preventDefault()}),t.observe("onresize",function(){console.info("resize")}),["Click","DblClick","MouseDown","MouseMove","MouseUp","MouseLeave"].each(function(n){var r=n.toLowerCase();t.observe(r,function(o){if(!("MouseLeave"==n||d&&d.is_touch)){var i=t.cumulativeOffset();i=new l(i[0],i[1]);var s=new l(o.clientX,o.clientY).sub(i),u=new l(t.clientWidth,t.clientHeight);if(!(s.x>0&&s.y>0&&s.x<u.x&&s.y<u.y))return"MouseMove"==n&&e._tool.processEvent("OnMouseLeave",o),a.preventDefault(o)}if(e._tool.processEvent("On"+n,o),"MouseUp"!=n&&a.stopEventPropagation(o),"touchstart"!=r&&("touchmove"!=r||2!=o.touches.length))return a.preventDefault(o)})},this)},r.prototype.findItem=function(t,e,n){var r="ui"in window?new l(this.render.page2obj(t)):new l(t.pageX,t.pageY).sub(i(this.render.clientArea)),o=p.item(this.render.ctab,r,e,n);return"Atom"==o.type?o.map="atoms":"Bond"==o.type?o.map="bonds":"SGroup"==o.type?o.map="sgroups":"DataSGroupData"==o.type?o.map="sgroupData":"RxnArrow"==o.type?o.map="rxnArrows":"RxnPlus"==o.type?o.map="rxnPluses":"Fragment"==o.type?o.map="frags":"RGroup"==o.type?o.map="rgroups":"ChiralFlag"==o.type&&(o.map="chiralFlags"),o},r.prototype.hasSelection=function(t){for(var e in this.selection)if(this.selection[e].length>0&&(!t||"sgroupData"!==e))return!0;return!1},r.prototype.getSelection=function(t){var e={};for(var n in this.selection)e[n]=this.selection[n].slice();if(t){var r=this.render.ctab.molecule;"bonds"in e&&e.bonds.each(function(t){var n=r.bonds.get(t);e.atoms=e.atoms||[],e.atoms.indexOf(n.begin)<0&&e.atoms.push(n.begin),e.atoms.indexOf(n.end)<0&&e.atoms.push(n.end)}),"atoms"in e&&"bonds"in e&&r.bonds.each(function(t){if(!("bonds"in e)||e.bonds.indexOf(t)<0){var n=r.bonds.get(t);e.atoms.indexOf(n.begin)>=0&&e.atoms.indexOf(n.end)>=0&&(e.bonds=e.bonds||[],e.bonds.push(t))}})}return e},r.prototype.setSelection=function(t,e){if(!e){this.selection={};for(var n in c.maps)this.selection[n]=[]}if(t){"id"in t&&"map"in t&&(t[t.map]=t[t.map]||[]).push(t.id);for(var r in this.selection)if(r in t)for(var o=0;o<t[r].length;o++)this.selection[r].indexOf(t[r][o])<0&&this.selection[r].push(t[r][o])}console.assert(this.selection,"Selection cannot be null"),this.render.ctab.setSelection(this.selection),this.render.update(),d.updateClipboardButtons()},r.prototype.selectAll=function(){var t={};for(var e in c.maps)t[e]=this.render.ctab[e].ikeys();this.setSelection(t)},r.prototype.selectedStruct=function(){var t=this.render.ctab.molecule,e=this.getSelection(!0),n=t.clone(s.fromList(e.atoms),s.fromList(e.bonds),!0);return t.rxnArrows.each(function(t,r){e.rxnArrows.indexOf(t)!=-1&&n.rxnArrows.add(r.clone())}),t.rxnPluses.each(function(t,r){e.rxnPluses.indexOf(t)!=-1&&n.rxnPluses.add(r.clone())}),n.isChiral=e.chiralFlags.length>0,n.isReaction=t.isReaction&&(n.rxnArrows.count()||n.rxnPluses.count()),n},r.prototype.recoordinate=function(t){console.assert(t,"Reference point not specified"),this.render.setScrollOffset(0,0)},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../render":66,"../render/restruct":68,"../util":115,"../util/set":118,"../util/vec2":119,"./closest":38,"./tool/apoint":41,"./tool/atom":42,"./tool/base":43,"./tool/bond":44,"./tool/chain":45,"./tool/charge":46,"./tool/eraser":47,"./tool/paste":52,"./tool/reactionarrow":53,"./tool/reactionmap":54,"./tool/reactionplus":55,"./tool/reactionunmap":56,"./tool/rgroupatom":57,"./tool/rgroupfragment":58,"./tool/rotate":59,"./tool/select":60,"./tool/sgroup":61,"./tool/template":62}],40:[function(t,e,n){function r(){this.type="OpBase",this.execute=function(){throw new Error("Operation.execute() is not implemented")},this.invert=function(){throw new Error("Operation.invert() is not implemented")},this.perform=function(t){return this.execute(t),this._inverted||(this._inverted=this.invert(),this._inverted._inverted=this),this._inverted},this.isDummy=function(t){return!!this._isDummy&&this._isDummy(t)}}function o(t,e){this.data={aid:null,atom:t,pos:e},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule,o={};if(this.data.atom)for(var i in this.data.atom)o[i]=this.data.atom[i];o.label=o.label||"C",Object.isNumber(this.data.aid)?r.atoms.set(this.data.aid,new U.Atom(o)):this.data.aid=r.atoms.add(new U.Atom(o));var a=new H.Atom(n.molecule.atoms.get(this.data.aid));a.component=n.connectedComponents.add(G.single(this.data.aid)),n.atoms.set(this.data.aid,a),n.markAtom(this.data.aid,1),r.atomSetPos(this.data.aid,new F(this.data.pos))},this.invert=function(){var t=new i;return t.data=this.data,t}}function i(t){this.data={aid:t,atom:null,pos:null},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule;this.data.atom||(this.data.atom=r.atoms.get(this.data.aid),this.data.pos=this.data.atom.pp);var o=n.atoms.get(this.data.aid),i=n.connectedComponents.get(o.component);G.remove(i,this.data.aid),0==G.size(i)&&n.connectedComponents.remove(o.component),n.clearVisel(o.visel),n.atoms.unset(this.data.aid),n.markItemRemoved(),r.atoms.remove(this.data.aid)},this.invert=function(){var t=new o;return t.data=this.data,t}}function a(t,e,n){this.data={aid:t,attribute:e,value:n},this.data2=null,this.execute=function(t){var e=t.render.ctab.molecule.atoms.get(this.data.aid);this.data2||(this.data2={aid:this.data.aid,attribute:this.data.attribute,value:e[this.data.attribute]}),e[this.data.attribute]=this.data.value,I(t.render.ctab,this.data.aid)},this._isDummy=function(t){return t.render.ctab.molecule.atoms.get(this.data.aid)[this.data.attribute]==this.data.value},this.invert=function(){var t=new a;return t.data=this.data2,t.data2=this.data,t}}function s(t,e,n){this.data={aid:t,d:e,noinvalidate:n},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule,o=this.data.aid,i=this.data.d;r.atoms.get(o).pp.add_(i),n.atoms.get(o).visel.translate(e.obj2scaled(i)),this.data.d=i.negated(),this.data.noinvalidate||I(n,o,1)},this._isDummy=function(){return 0==this.data.d.x&&0==this.data.d.y},this.invert=function(){var t=new s;return t.data=this.data,t}}function l(t,e){this.data={bid:t,d:e},this.execute=function(t){var e=t.render,n=e.ctab;n.bonds.get(this.data.bid).visel.translate(e.obj2scaled(this.data.d)),this.data.d=this.data.d.negated()},this.invert=function(){var t=new l;return t.data=this.data,t}}function u(t,e){this.data={id:t,d:e},this.execute=function(t){var e=t.render,n=e.ctab;n.reloops.get(this.data.id)&&n.reloops.get(this.data.id).visel&&n.reloops.get(this.data.id).visel.translate(e.obj2scaled(this.data.d)),this.data.d=this.data.d.negated()},this.invert=function(){var t=new u;return t.data=this.data,t}}function c(t,e){this.type="OpSGroupAtomAdd",this.data={aid:e,sgid:t},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule,o=this.data.aid,i=this.data.sgid,a=r.atoms.get(o),s=r.sgroups.get(i);if(s.atoms.indexOf(o)>=0)throw new Error("The same atom cannot be added to an S-group more than once");if(!a)throw new Error("OpSGroupAtomAdd: Atom "+o+" not found");r.atomAddToSGroup(i,o),I(n,o)},this.invert=function(){var t=new p;return t.data=this.data,t}}function p(t,e){this.type="OpSGroupAtomRemove",this.data={aid:e,sgid:t},this.execute=function(t){var e=this.data.aid,n=this.data.sgid,r=t.render,o=r.ctab,i=o.molecule,a=i.atoms.get(e),s=i.sgroups.get(n);U.SGroup.removeAtom(s,e),G.remove(a.sgs,n),I(o,e)},this.invert=function(){var t=new c;return t.data=this.data,t}}function h(t,e,n){this.type="OpSGroupAttr",this.data={sgid:t,attr:e,value:n},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule,o=this.data.sgid,i=r.sgroups.get(o);"DAT"==i.type&&n.sgroupData.has(o)&&(n.clearVisel(n.sgroupData.get(o).visel),n.sgroupData.unset(o)),this.data.value=i.setAttr(this.data.attr,this.data.value)},this.invert=function(){var t=new h;return t.data=this.data,t}}function f(t,e,n){this.type="OpSGroupCreate",this.data={sgid:t,type:e,pp:n},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule,o=new U.SGroup(this.data.type),i=this.data.sgid;o.id=i,r.sgroups.set(i,o),this.data.pp&&(r.sgroups.get(i).pp=new F(this.data.pp)),n.sgroups.set(i,new H.SGroup(r.sgroups.get(i))),this.data.sgid=i},this.invert=function(){var t=new d;return t.data=this.data,t}}function d(t){this.type="OpSGroupDelete",this.data={sgid:t},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule,o=this.data.sgid,i=n.sgroups.get(o);if(this.data.type=i.item.type,this.data.pp=i.item.pp,"DAT"==i.item.type&&n.sgroupData.has(o)&&(n.clearVisel(n.sgroupData.get(o).visel),n.sgroupData.unset(o)),n.clearVisel(i.visel),0!=i.item.atoms.length)throw new Error("S-Group not empty!");n.sgroups.unset(o),r.sgroups.remove(o)},this.invert=function(){var t=new f;return t.data=this.data,t}}function g(t,e,n){this.type="OpSGroupAddToHierarchy",this.data={sgid:t,parent:e,children:n},this.execute=function(t){var r=t.render,o=r.ctab,i=o.molecule,a=this.data.sgid,s=i.sGroupForest.insert(a,e,n);this.data.parent=s.parent,this.data.children=s.children},this.invert=function(){var t=new m;return t.data=this.data,t}}function m(t){this.type="OpSGroupRemoveFromHierarchy",this.data={sgid:t},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule,o=this.data.sgid;this.data.parent=r.sGroupForest.parent.get(o),this.data.children=r.sGroupForest.children.get(o),r.sGroupForest.remove(o)},this.invert=function(){var t=new g;return t.data=this.data,t}}function b(t,e,n){this.data={bid:null,bond:n,begin:t,end:e},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule;if(this.data.begin==this.data.end)throw new Error("Distinct atoms expected");if(z.debug&&this.molecule.checkBondExists(this.data.begin,this.data.end))throw new Error("Bond already exists");I(n,this.data.begin,1),I(n,this.data.end,1);var o={};if(this.data.bond)for(var i in this.data.bond)o[i]=this.data.bond[i];o.type=o.type||U.Bond.PATTERN.TYPE.SINGLE,o.begin=this.data.begin,o.end=this.data.end,Object.isNumber(this.data.bid)?r.bonds.set(this.data.bid,new U.Bond(o)):this.data.bid=r.bonds.add(new U.Bond(o)),r.bondInitHalfBonds(this.data.bid),r.atomAddNeighbor(r.bonds.get(this.data.bid).hb1),r.atomAddNeighbor(r.bonds.get(this.data.bid).hb2),n.bonds.set(this.data.bid,new H.Bond(n.molecule.bonds.get(this.data.bid))),n.markBond(this.data.bid,1)},this.invert=function(){var t=new v;return t.data=this.data,t}}function v(t){this.data={bid:t,bond:null,begin:null,end:null},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule;this.data.bond||(this.data.bond=r.bonds.get(this.data.bid),this.data.begin=this.data.bond.begin,this.data.end=this.data.bond.end),D(n,this.data.bid);var o=n.bonds.get(this.data.bid);[o.b.hb1,o.b.hb2].each(function(t){var e=n.molecule.halfBonds.get(t);e.loop>=0&&n.loopRemove(e.loop)},n),n.clearVisel(o.visel),n.bonds.unset(this.data.bid),n.markItemRemoved();var i=r.bonds.get(this.data.bid);[i.hb1,i.hb2].each(function(t){var e=r.halfBonds.get(t),n=r.atoms.get(e.begin),o=n.neighbors.indexOf(t),i=(o+n.neighbors.length-1)%n.neighbors.length,a=(o+1)%n.neighbors.length;r.setHbNext(n.neighbors[i],n.neighbors[a]),n.neighbors.splice(o,1)},this),r.halfBonds.unset(i.hb1),r.halfBonds.unset(i.hb2),r.bonds.remove(this.data.bid)},this.invert=function(){var t=new b;return t.data=this.data,t}}function y(t,e,n){this.data={bid:t,attribute:e,value:n},this.data2=null,this.execute=function(t){var e=t.render.ctab.molecule.bonds.get(this.data.bid);this.data2||(this.data2={bid:this.data.bid,attribute:this.data.attribute,value:e[this.data.attribute]}),e[this.data.attribute]=this.data.value,D(t.render.ctab,this.data.bid),"type"==this.data.attribute&&k(t.render.ctab,this.data.bid)},this._isDummy=function(t){return t.render.ctab.molecule.bonds.get(this.data.bid)[this.data.attribute]==this.data.value},this.invert=function(){var t=new y;return t.data=this.data2,t.data2=this.data,t}}function w(t){this.frid=Object.isUndefined(t)?null:t,this.execute=function(t){var e=t.render.ctab,n=e.molecule,r={};null==this.frid?this.frid=n.frags.add(r):n.frags.set(this.frid,r),e.frags.set(this.frid,new H.Frag(r))},this.invert=function(){return new x(this.frid)}}function x(t){this.frid=t,this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule;L(n,"frags",this.frid,1),n.frags.unset(this.frid),r.frags.remove(this.frid)},this.invert=function(){return new w(this.frid)}}function S(t,e,n){this.data={rgid:t,attribute:e,value:n},this.data2=null,this.execute=function(t){var e=t.render.ctab.molecule.rgroups.get(this.data.rgid);this.data2||(this.data2={rgid:this.data.rgid,attribute:this.data.attribute,value:e[this.data.attribute]}),e[this.data.attribute]=this.data.value,L(t.render.ctab,"rgroups",this.data.rgid)},this._isDummy=function(t){return t.render.ctab.molecule.rgroups.get(this.data.rgid)[this.data.attribute]==this.data.value},this.invert=function(){var t=new S;return t.data=this.data2,t.data2=this.data,t}}function O(t,e,n){this.rgid_new=t,this.rg_new=n,this.rgid_old=null,this.rg_old=null,this.frid=e,this.execute=function(t){var e=t.render.ctab,n=e.molecule;if(this.rgid_old=this.rgid_old||U.RGroup.findRGroupByFragment(n.rgroups,this.frid),this.rg_old=this.rgid_old?n.rgroups.get(this.rgid_old):null,this.rg_old&&(this.rg_old.frags.remove(this.rg_old.frags.keyOf(this.frid)),e.clearVisel(e.rgroups.get(this.rgid_old).visel),0==this.rg_old.frags.count()?(e.rgroups.unset(this.rgid_old),n.rgroups.unset(this.rgid_old),e.markItemRemoved()):e.markItem("rgroups",this.rgid_old,1)),this.rgid_new){var r=n.rgroups.get(this.rgid_new);r?e.markItem("rgroups",this.rgid_new,1):(r=this.rg_new||new U.RGroup,n.rgroups.set(this.rgid_new,r),e.rgroups.set(this.rgid_new,new H.RGroup(r))),r.frags.add(this.frid)}},this.invert=function(){return new O(this.rgid_old,this.frid,this.rg_old)}}function T(t){this.data={arid:null,pos:t},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule;Object.isNumber(this.data.arid)?r.rxnArrows.set(this.data.arid,new U.RxnArrow):this.data.arid=r.rxnArrows.add(new U.RxnArrow),n.rxnArrows.set(this.data.arid,new H.RxnArrow(n.molecule.rxnArrows.get(this.data.arid))),r.rxnArrowSetPos(this.data.arid,new F(this.data.pos)),L(n,"rxnArrows",this.data.arid,1)},this.invert=function(){var t=new E;return t.data=this.data,t}}function E(t){this.data={arid:t,pos:null},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule;this.data.pos||(this.data.pos=r.rxnArrows.get(this.data.arid).pp),n.markItemRemoved(),n.clearVisel(n.rxnArrows.get(this.data.arid).visel),n.rxnArrows.unset(this.data.arid),r.rxnArrows.remove(this.data.arid)},this.invert=function(){var t=new T;return t.data=this.data,t}}function A(t,e,n){this.data={id:t,d:e,noinvalidate:n},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule,o=this.data.id,i=this.data.d;r.rxnArrows.get(o).pp.add_(i),n.rxnArrows.get(o).visel.translate(e.obj2scaled(i)),this.data.d=i.negated(),this.data.noinvalidate||L(n,"rxnArrows",o,1)},this.invert=function(){var t=new A;return t.data=this.data,t}}function C(t){this.data={plid:null,pos:t},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule;Object.isNumber(this.data.plid)?r.rxnPluses.set(this.data.plid,new U.RxnPlus):this.data.plid=r.rxnPluses.add(new U.RxnPlus),n.rxnPluses.set(this.data.plid,new H.RxnPlus(n.molecule.rxnPluses.get(this.data.plid))),r.rxnPlusSetPos(this.data.plid,new F(this.data.pos)),L(n,"rxnPluses",this.data.plid,1)},this.invert=function(){var t=new P;return t.data=this.data,t}}function P(t){this.data={plid:t,pos:null},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule;this.data.pos||(this.data.pos=r.rxnPluses.get(this.data.plid).pp),n.markItemRemoved(),n.clearVisel(n.rxnPluses.get(this.data.plid).visel),n.rxnPluses.unset(this.data.plid),r.rxnPluses.remove(this.data.plid)},this.invert=function(){var t=new C;return t.data=this.data,t}}function N(t,e,n){this.data={id:t,d:e,noinvalidate:n},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule,o=this.data.id,i=this.data.d;r.rxnPluses.get(o).pp.add_(i),n.rxnPluses.get(o).visel.translate(e.obj2scaled(i)),this.data.d=i.negated(),this.data.noinvalidate||L(n,"rxnPluses",o,1)},this.invert=function(){var t=new N;return t.data=this.data,t}}function j(t,e){this.data={id:t,d:e},this.execute=function(t){var e=t.render.ctab.molecule;e.sgroups.get(this.data.id).pp.add_(this.data.d),this.data.d=this.data.d.negated(),L(t.render.ctab,"sgroupData",this.data.id,1)},this.invert=function(){var t=new j;return t.data=this.data,t}}function R(t){this.data={ctab:t},this.execute=function(t){var e=t.render,n=e.ctab.molecule;t.struct(this.data.ctab),this.data.ctab=n},this.invert=function(){var t=new R;return t.data=this.data,t}}function B(t){this.data={pos:t},this.execute=function(e){var n=e.render,r=n.ctab,o=r.molecule;r.chiralFlags.count()>0&&(r.clearVisel(r.chiralFlags.get(0).visel),r.chiralFlags.unset(0)),r.chiralFlags.set(0,new H.ChiralFlag(t)),o.isChiral=!0,L(r,"chiralFlags",0,1)},this.invert=function(){var t=new M;return t.data=this.data,t}}function M(){this.data={pos:null},this.execute=function(t){var e=t.render,n=e.ctab,r=n.molecule;if(n.chiralFlags.count()<1)throw new Error("Cannot remove chiral flag");n.clearVisel(n.chiralFlags.get(0).visel),this.data.pos=n.chiralFlags.get(0).pp,n.chiralFlags.unset(0),r.isChiral=!1},this.invert=function(){var t=new B(this.data.pos);return t.data=this.data,t}}function _(t){this.data={d:t},this.execute=function(t){var e=t.render,n=e.ctab;n.chiralFlags.get(0).pp.add_(this.data.d),this.data.d=this.data.d.negated(),L(n,"chiralFlags",0,1)},this.invert=function(){var t=new _;return t.data=this.data,t}}function I(t,e,n){var r=t.atoms.get(e);t.markAtom(e,n?1:0);for(var o=t.molecule.halfBonds,i=0;i<r.a.neighbors.length;++i){var a=r.a.neighbors[i];if(o.has(a)){var s=o.get(a);t.markBond(s.bid,1),t.markAtom(s.end,0),n&&k(t,s.bid)}}}function k(t,e){var n=t.bonds.get(e),r=t.molecule.halfBonds.get(n.b.hb1).loop,o=t.molecule.halfBonds.get(n.b.hb2).loop;r>=0&&t.loopRemove(r),o>=0&&t.loopRemove(o)}function D(t,e){var n=t.bonds.get(e);k(t,e),I(t,n.b.begin,0),I(t,n.b.end,0)}function L(t,e,n,r){"atoms"==e?I(t,n,r):"bonds"==e?(D(t,n),r>0&&k(t,n)):t.markItem(e,n,r)}var F=t("../util/vec2"),G=t("../util/set"),U=t("../chem/struct"),H=t("../render/restruct"),z={debug:!1,logcnt:0,logmouse:!1,hl:!1};z.logMethod=function(){},o.prototype=new r,i.prototype=new r,a.prototype=new r,s.prototype=new r,l.prototype=new r,u.prototype=new r,c.prototype=new r,p.prototype=new r,h.prototype=new r,f.prototype=new r,d.prototype=new r,g.prototype=new r,m.prototype=new r,b.prototype=new r,v.prototype=new r,y.prototype=new r,w.prototype=new r,x.prototype=new r,S.prototype=new r,O.prototype=new r,T.prototype=new r,E.prototype=new r,A.prototype=new r,C.prototype=new r,P.prototype=new r,N.prototype=new r,j.prototype=new r,R.prototype=new r,B.prototype=new r,M.prototype=new r,_.prototype=new r,e.exports={AtomAdd:o,AtomDelete:i,AtomAttr:a,AtomMove:s,BondMove:l,LoopMove:u,SGroupAtomAdd:c,SGroupAtomRemove:p,SGroupAttr:h,SGroupCreate:f,SGroupDelete:d,SGroupAddToHierarchy:g,SGroupRemoveFromHierarchy:m,BondAdd:b,BondDelete:v,BondAttr:y,FragmentAdd:w,FragmentDelete:x,RGroupAttr:S,RGroupFragment:O,RxnArrowAdd:T,RxnArrowDelete:E,RxnArrowMove:A,RxnPlusAdd:C,RxnPlusDelete:P,RxnPlusMove:N,SGroupDataMove:j,CanvasLoad:R,ChiralFlagAdd:B,ChiralFlagDelete:M,ChiralFlagMove:_}},{"../chem/struct":33,"../render/restruct":68,"../util/set":118,"../util/vec2":119}],41:[function(t,e,n){(function(n){function r(t){this.editor=t,this.hoverHelper=new i(this)}var o=t("../action"),i=t("./helper/hover"),a=t("./base"),s=n.ui;r.prototype=new a,r.prototype.OnMouseMove=function(t){this.hoverHelper.hover(this.editor.findItem(t,["atoms"]))},r.prototype.OnMouseUp=function(t){var e=this.editor.render,n=this.editor.findItem(t,["atoms"]);if(n&&"atoms"==n.map){this.hoverHelper.hover(null);var r=e.ctab.molecule.atoms.get(n.id).attpnt;return s.showAtomAttachmentPoints({primary:(1&(r||0))>0,secondary:(2&(r||0))>0,onOk:function(t){var i=(t.primary&&1)+(t.secondary&&2);r!=i&&(s.addUndoAction(o.fromAtomsAttrs(n.id,{attpnt:i}),!0),e.update())}}),!0}},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../action":37,"./base":43,"./helper/hover":48}],42:[function(t,e,n){(function(n){function r(t,e){this.editor=t,this.atomProps=e,this.bondProps={type:1,stereo:o.Bond.PATTERN.STEREO.NONE},this.hoverHelper=new a(this)}var o=t("../../chem/struct"),i=t("../action"),a=t("./helper/hover"),s=t("./base"),l=n.ui;r.prototype=new s,r.prototype.OnMouseDown=function(t){this.hoverHelper.hover(null);var e=this.editor.render,n=this.editor.findItem(t,["atoms"]);n&&"Canvas"!=n.type?"atoms"==n.map&&(this.dragCtx={item:n,xy0:e.page2obj(t)}):this.dragCtx={xy0:e.page2obj(t)}},r.prototype.OnMouseMove=function(t){var e=this.editor,n=e.render;if("dragCtx"in this&&"item"in this.dragCtx){var r=this.dragCtx,o=n.ctab.molecule.atoms.get(r.item.id),a=this.calcNewAtomPos(o.pp,n.page2obj(t));"action"in r&&r.action.perform();var s=i.fromBondAddition(this.bondProps,r.item.id,Object.clone(this.atomProps),a,a);r.action=s[0],r.aid2=s[2],n.update()}else this.hoverHelper.hover(this.editor.findItem(t,["atoms"]))},r.prototype.OnMouseUp=function(t){if("dragCtx"in this){var e=this.dragCtx,n=this.editor.render;l.addUndoAction("action"in e?e.action:"item"in e?i.fromAtomsAttrs(e.item.id,this.atomProps,!0):i.fromAtomAddition(n.page2obj(t),this.atomProps),!0),n.update(),delete this.dragCtx}},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../chem/struct":33,"../action":37,"./base":43,"./helper/hover":48}],43:[function(t,e,n){function r(t){this.editor=t}var o=t("../../util/vec2");r.prototype.processEvent=function(t,e,n){if("touches"in e&&1!=e.touches.length){if("lastEvent"in this.OnMouseDown0)return this.OnMouseUp0(e,n)}else{if(t+"0"in this)return this[t+"0"](e,n);if(t in this)return this[t](e,n);console.log("EditorTool.dispatchEvent: event '"+t+"' is not handled.")}},r.prototype.OnMouseDown=function(){},r.prototype.OnMouseMove=function(){},r.prototype.OnMouseUp=function(){},r.prototype.OnClick=function(){},r.prototype.OnDblClick=function(){},r.prototype.OnMouseLeave=function(){this.OnCancel()},r.prototype.OnCancel=function(){},r.prototype.OnMouseDown0=function(t){if(this.OnMouseDown0.lastEvent=t,this.OnMouseMove0.lastEvent=t,"OnMouseDown"in this)return this.OnMouseDown(t)},r.prototype.OnMouseMove0=function(t){if(this.OnMouseMove0.lastEvent=t,"OnMouseMove"in this)return this.OnMouseMove(t)},r.prototype.OnMouseUp0=function(t){if(!("lastEvent"in this.OnMouseDown0))return!0;"lastEvent"in this.OnMouseMove0&&(t=Object.clone(t),t.pageX=this.OnMouseMove0.lastEvent.pageX,t.pageY=this.OnMouseMove0.lastEvent.pageY);try{if("OnMouseUp"in this)return this.OnMouseUp(t)}finally{delete this.OnMouseDown0.lastEvent}},r.prototype.calcAngle=function(t,e){var n=o.diff(e,t),r=Math.atan2(n.y,n.x),i=r<0?-1:1,a=Math.floor(Math.abs(r)/(Math.PI/12))*(Math.PI/12);return r=i*(a+(Math.abs(r)-a<Math.PI/24?0:Math.PI/12))},r.prototype.calcNewAtomPos=function(t,e){var n=new o(1,0).rotate(this.calcAngle(t,e));return n.add_(t),n},e.exports=r},{"../../util/vec2":119}],44:[function(t,e,n){(function(n){function r(t,e){this.editor=t,this.atomProps={label:"C"},this.bondProps=a.Bond.caption2Type(e),this.plainBondTypes=[a.Bond.PATTERN.TYPE.SINGLE,a.Bond.PATTERN.TYPE.DOUBLE,a.Bond.PATTERN.TYPE.TRIPLE],this.hoverHelper=new l(this)}function o(t,e,n){return n.type==a.Bond.PATTERN.TYPE.SINGLE&&e.stereo==a.Bond.PATTERN.STEREO.NONE&&n.stereo!=a.Bond.PATTERN.STEREO.NONE&&t.atoms.get(e.begin).neighbors.length<t.atoms.get(e.end).neighbors.length;
}var i=t("../../util/vec2"),a=t("../../chem/struct"),s=t("../action"),l=t("./helper/hover"),u=t("./base"),c=n.ui;r.prototype=new u,r.prototype.OnMouseDown=function(t){var e=this.editor.render;return this.hoverHelper.hover(null),this.dragCtx={xy0:e.page2obj(t),item:this.editor.findItem(t,["atoms","bonds"])},this.dragCtx.item&&"Canvas"!=this.dragCtx.item.type||delete this.dragCtx.item,!0},r.prototype.OnMouseMove=function(t){var e=this.editor,n=e.render;if("dragCtx"in this){var r=this.dragCtx;if(!("item"in r)||"atoms"==r.item.map){"action"in r&&r.action.perform();var o,a,l,u;"item"in r&&"atoms"==r.item.map?(o=r.item.id,a=e.findItem(t,["atoms"],r.item)):(o=this.atomProps,l=r.xy0,a=e.findItem(t,["atoms"]));var c=Number.MAX_VALUE;if(a&&"atoms"==a.map)a=a.id;else{a=this.atomProps;var p=n.page2obj(t);if(c=i.dist(r.xy0,p),l)u=this.calcNewAtomPos(l,p);else{var h=n.ctab.molecule.atoms.get(o);l=this.calcNewAtomPos(h.pp.get_xy0(),p)}}return c>.3?r.action=s.fromBondAddition(this.bondProps,o,a,l,u)[0]:delete r.action,n.update(),!0}}return this.hoverHelper.hover(this.editor.findItem(t,["atoms","bonds"])),!0},r.prototype.OnMouseUp=function(t){if("dragCtx"in this){var e=this.dragCtx,n=this.editor.render,r=n.ctab.molecule;if("action"in e)c.addUndoAction(e.action);else if("item"in e){if("atoms"==e.item.map)c.addUndoAction(s.fromBondAddition(this.bondProps,e.item.id)[0]);else if("bonds"==e.item.map){var l=Object.clone(this.bondProps),u=r.bonds.get(e.item.id);if(l.stereo!=a.Bond.PATTERN.STEREO.NONE&&u.type==a.Bond.PATTERN.TYPE.SINGLE&&l.type==a.Bond.PATTERN.TYPE.SINGLE&&u.stereo==l.stereo)c.addUndoAction(s.fromBondFlipping(e.item.id));else{var p=this.plainBondTypes.indexOf(l.type)>=0?this.plainBondTypes:null;l.type===a.Bond.PATTERN.TYPE.SINGLE&&u.stereo===a.Bond.PATTERN.STEREO.NONE&&l.stereo===a.Bond.PATTERN.STEREO.NONE&&p&&(l.type=p[(p.indexOf(u.type)+1)%p.length]),c.addUndoAction(s.fromBondAttrs(e.item.id,l,o(r,u,l)),!0)}}}else{var h=n.page2obj(t),f=new i(.5,0).rotate(this.bondProps.type==a.Bond.PATTERN.TYPE.SINGLE?-Math.PI/6:0),d=s.fromBondAddition(this.bondProps,{label:"C"},{label:"C"},i.diff(h,f),i.sum(h,f));c.addUndoAction(d[0])}n.update(),delete this.dragCtx}return!0},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../chem/struct":33,"../../util/vec2":119,"../action":37,"./base":43,"./helper/hover":48}],45:[function(t,e,n){(function(n){function r(t){this.editor=t,this.hoverHelper=new a(this)}var o=t("../../util/vec2"),i=t("../action"),a=t("./helper/hover"),s=t("./base"),l=n.ui;r.prototype=new s,r.prototype.OnMouseDown=function(t){var e=this.editor.render;return this.hoverHelper.hover(null),this.dragCtx={xy0:e.page2obj(t),item:this.editor.findItem(t,["atoms"])},this.dragCtx.item&&"Canvas"!=this.dragCtx.item.type||delete this.dragCtx.item,!0},r.prototype.OnMouseMove=function(t){var e=this.editor,n=e.render;if("dragCtx"in this){var r=this.dragCtx;"action"in r&&r.action.perform();var a=n.ctab.molecule.atoms,s="item"in r?a.get(r.item.id).pp:r.xy0,l=n.page2obj(t);return r.action=i.fromChain(s,this.calcAngle(s,l),Math.ceil(o.diff(l,s).length()),"item"in r?r.item.id:null),n.update(),!0}return this.hoverHelper.hover(this.editor.findItem(t,["atoms"])),!0},r.prototype.OnMouseUp=function(){return"dragCtx"in this&&("action"in this.dragCtx&&l.addUndoAction(this.dragCtx.action),delete this.dragCtx),!0},r.prototype.OnCancel=function(){this.OnMouseUp()},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util/vec2":119,"../action":37,"./base":43,"./helper/hover":48}],46:[function(t,e,n){(function(n){function r(t,e){this.editor=t,this.charge=e,this.hoverHelper=new i(this)}var o=t("../action"),i=t("./helper/hover"),a=t("./base"),s=t("../../chem/element"),l=n.ui;r.prototype=new a,r.prototype.OnMouseMove=function(t){var e=this.editor.render,n=this.editor.findItem(t,["atoms"]),r=e.ctab.molecule;return n&&"atoms"==n.map&&null!=s.getElementByLabel(r.atoms.get(n.id).label)?this.hoverHelper.hover(n):this.hoverHelper.hover(null),!0},r.prototype.OnMouseUp=function(t){var e=this.editor,n=e.render,r=n.ctab.molecule,i=e.findItem(t,["atoms"]);return i&&"atoms"==i.map&&null!=s.getElementByLabel(r.atoms.get(i.id).label)&&(this.hoverHelper.hover(null),l.addUndoAction(o.fromAtomsAttrs(i.id,{charge:r.atoms.get(i.id).charge+this.charge})),n.update()),!0},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../chem/element":22,"../action":37,"./base":43,"./helper/hover":48}],47:[function(t,e,n){(function(n){function r(t,e){this.editor=t,this.maps=["atoms","bonds","rxnArrows","rxnPluses","sgroups","sgroupData","chiralFlags"],this.hoverHelper=new a(this),this.lassoHelper=new s(e||0,t)}var o=t("../action"),i=t("./base"),a=t("./helper/hover"),s=t("./helper/lasso"),l=n.ui;r.prototype=new i,r.prototype.OnMouseDown=function(t){var e=this.editor.findItem(t,this.maps);e&&"Canvas"!=e.type||this.lassoHelper.begin(t)},r.prototype.OnMouseMove=function(t){this.lassoHelper.running()?this.editor.setSelection(this.lassoHelper.addPoint(t)):this.hoverHelper.hover(this.editor.findItem(t,this.maps))},r.prototype.OnMouseUp=function(t){var e=this.editor.render;if(this.lassoHelper.running())l.addUndoAction(o.fromFragmentDeletion(this.lassoHelper.end(t))),this.editor.setSelection(null),e.update();else{var n=this.editor.findItem(t,this.maps);if(n&&"Canvas"!=n.type){if(this.hoverHelper.hover(null),"atoms"==n.map)l.addUndoAction(o.fromAtomDeletion(n.id));else if("bonds"==n.map)l.addUndoAction(o.fromBondDeletion(n.id));else if("sgroups"==n.map||"sgroupData"==n.map)l.addUndoAction(o.fromSgroupDeletion(n.id));else if("rxnArrows"==n.map)l.addUndoAction(o.fromArrowDeletion(n.id));else if("rxnPluses"==n.map)l.addUndoAction(o.fromPlusDeletion(n.id));else{if("chiralFlags"!=n.map)return void console.log("EraserTool: unable to delete the object "+n.map+"["+n.id+"]");l.addUndoAction(o.fromChiralFlagDeletion())}this.editor.setSelection(null),e.update()}}},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../action":37,"./base":43,"./helper/hover":48,"./helper/lasso":49}],48:[function(t,e,n){function r(t){this.editorTool=t}function o(t,e,n){if(!(["atoms","bonds","rxnArrows","rxnPluses","chiralFlags","frags","rgroups","sgroups","sgroupData"].indexOf(e.map)>-1))return!1;var r=t.ctab[e.map].get(e.id);if(null==r)return!0;if("sgroups"==e.map&&"DAT"==r.item.type||"sgroupData"==e.map){var o=t.ctab.sgroups.get(e.id),i=t.ctab.sgroupData.get(e.id);null!=o&&o.setHighlight(n,t),null!=i&&i.setHighlight(n,t)}else r.setHighlight(n,t);return!0}r.prototype.hover=function(t){t&&"Canvas"==t.type&&(t=null);var e=this.editorTool.editor.render;"ci"in this&&(!t||this.ci.type!=t.type||this.ci.id!=t.id)&&(o(e,this.ci,!1),delete this.ci),t&&o(e,t,!0)&&(this.ci=t)},e.exports=r},{}],49:[function(t,e,n){function r(t,e,n){this.mode=t,this.fragment=n,this.editor=e}var o=t("./locate"),i=t("../../../render/draw");r.prototype.getSelection=function(){var t=this.editor.render;if(0==this.mode)return o.inPolygon(t.ctab,this.points);if(1==this.mode)return o.inRectangle(t.ctab,this.points[0],this.points[1]);throw new Error("Selector mode unknown")},r.prototype.begin=function(t){var e=this.editor.render;this.points=[e.page2obj(t)],1==this.mode&&this.points.push(this.points[0])},r.prototype.running=function(){return!!this.points},r.prototype.addPoint=function(t){if(this.points){var e=this.editor.render;return 0==this.mode?this.points.push(e.page2obj(t)):1==this.mode&&(this.points=[this.points[0],e.page2obj(t)]),this.update(),this.getSelection()}return null},r.prototype.update=function(){if(this.selection&&(this.selection.remove(),this.selection=null),this.points&&this.points.length>1){var t=this.editor.render,e=this.points.map(function(e){return t.obj2scaled(e).add(t.offset)});this.selection=0==this.mode?i.selectionPolygon(t,e):i.selectionRectangle(t,e[0],e[1])}},r.prototype.end=function(){var t=this.getSelection();return this.points=null,this.update(null),t},e.exports=r},{"../../../render/draw":65,"./locate":50}],50:[function(t,e,n){function r(t,e,n){var r=[],o=[],i=Math.min(e.x,n.x),s=Math.max(e.x,n.x),l=Math.min(e.y,n.y),u=Math.max(e.y,n.y);t.bonds.each(function(e,n){var o=a.lc2(t.atoms.get(n.b.begin).a.pp,.5,t.atoms.get(n.b.end).a.pp,.5);o.x>i&&o.x<s&&o.y>l&&o.y<u&&r.push(e)}),t.atoms.each(function(t,e){e.a.pp.x>i&&e.a.pp.x<s&&e.a.pp.y>l&&e.a.pp.y<u&&o.push(t)});var c=[],p=[];t.rxnArrows.each(function(t,e){e.item.pp.x>i&&e.item.pp.x<s&&e.item.pp.y>l&&e.item.pp.y<u&&c.push(t)}),t.rxnPluses.each(function(t,e){e.item.pp.x>i&&e.item.pp.x<s&&e.item.pp.y>l&&e.item.pp.y<u&&p.push(t)});var h=[];t.chiralFlags.each(function(t,e){e.pp.x>i&&e.pp.x<s&&e.pp.y>l&&e.pp.y<u&&h.push(t)});var f=[];return t.sgroupData.each(function(t,e){e.sgroup.pp.x>i&&e.sgroup.pp.x<s&&e.sgroup.pp.y>l&&e.sgroup.pp.y<u&&f.push(t)}),{atoms:o,bonds:r,rxnArrows:c,rxnPluses:p,chiralFlags:h,sgroupData:f}}function o(t,e){for(var n=[],r=[],o=[],s=0;s<e.length;++s)o[s]=new a(e[s].x,e[s].y);t.bonds.each(function(e,r){var s=a.lc2(t.atoms.get(r.b.begin).a.pp,.5,t.atoms.get(r.b.end).a.pp,.5);i(o,s)&&n.push(e)}),t.atoms.each(function(t,e){i(o,e.a.pp)&&r.push(t)});var l=[],u=[];t.rxnArrows.each(function(t,e){i(o,e.item.pp)&&l.push(t)}),t.rxnPluses.each(function(t,e){i(o,e.item.pp)&&u.push(t)});var c=[];t.chiralFlags.each(function(t,e){i(o,e.pp)&&c.push(t)});var p=[];return t.sgroupData.each(function(t,e){i(o,e.sgroup.pp)&&p.push(t)}),{atoms:r,bonds:n,rxnArrows:l,rxnPluses:u,chiralFlags:c,sgroupData:p}}function i(t,e){for(var n=new a(0,1),r=n.rotate(Math.PI/2),o=a.diff(t[t.length-1],e),i=a.dot(r,o),s=a.dot(n,o),l=null,u=0,c=1e-5,p=!1,h=!1,f=0;f<t.length;++f){var d=a.diff(t[f],e),g=a.diff(d,o),m=a.dot(r,d),b=a.dot(n,d);p=!1,m*i<0&&(b*s>-c?s>-c&&(p=!0):(Math.abs(i)*Math.abs(b)-Math.abs(m)*Math.abs(s))*b>0&&(p=!0)),p&&h&&a.dot(g,r)*a(l,r)>=0&&(p=!1),p&&u++,o=d,i=m,s=b,l=g,h=p}return u%2!=0}var a=t("../../../util/vec2");e.exports={inRectangle:r,inPolygon:o}},{"../../../util/vec2":119}],51:[function(t,e,n){(function(n){function r(t,e){this.editor=t,this.selection=null,this.defaultType=e||null}function o(t,e,n){var r={},o={};return e.atoms.each(function(t){o[t]=!0}),0<=e.atoms.findIndex(function(t){var i=n.atoms.get(t),l=s.list(i.a.sgs);return 0<=l.findIndex(function(t){var i=n.sgroups.get(t).item;if("DAT"==i.type||t in r)return!1;var s=a.SGroup.getAtoms(n.molecule,i);if(s.length<e.atoms.length){if(0<=s.findIndex(function(t){return!(t in o)}))return!0}else if(0<=e.atoms.findIndex(function(t){return s.indexOf(t)==-1}))return!0;return!1})})}var i=t("../../action"),a=t("../../../chem/struct"),s=t("../../../util/set"),l=n.ui;r.prototype.showPropertiesDialog=function(t,e){this.selection=e;var n=this.editor.render,r=null!=t&&n.ctab.sgroups.get(t).item;l.showSGroupProperties({type:r?r.type:this.defaultType,attrs:r?r.getAttrs():{},onCancel:function(){this.editor.setSelection(null)}.bind(this),onOk:function(r){null!=t?l.addUndoAction(i.fromSgroupType(t,r.type).mergeWith(i.fromSgroupAttrs(t,r.attrs)),!0):"DAT"!=r.type&&o(t,e,n.ctab)?alert("Partial S-group overlapping is not allowed."):(t=n.ctab.molecule.sgroups.newId(),l.addUndoAction(i.fromSgroupAddition(r.type,this.selection.atoms,r.attrs,t),!0)),this.editor.setSelection(null),n.update()}.bind(this)})},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../chem/struct":33,"../../../util/set":118,"../../action":37}],52:[function(t,e,n){(function(n){function r(t,e){this.editor=t,this.struct=e;var n=t.render;this.action=o.fromPaste(this.struct,"lastEvent"in this.OnMouseMove0?n.page2obj(this.OnMouseMove0.lastEvent):void 0),n.update()}var o=t("../action"),i=t("./base"),a=n.ui;r.prototype=new i,r.prototype.OnMouseMove=function(t){"action"in this&&this.action.perform(this.editor);var e=this.editor.render;this.action=o.fromPaste(this.struct,e.page2obj(t)),e.update()},r.prototype.OnMouseUp=function(){a.addUndoAction(this.action),delete this.action,a.selectAction(null)},r.prototype.OnCancel=function(){"action"in this&&(this.action.perform(this.editor),delete this.action)},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../action":37,"./base":43}],53:[function(t,e,n){(function(n){function r(t){this.editor=t,this.hoverHelper=new i(this)}var o=t("../action"),i=t("./helper/hover"),a=t("./base"),s=n.ui;r.prototype=new a,r.prototype.OnMouseDown=function(t){var e=this.editor.render,n=this.editor.findItem(t,["rxnArrows"]);n&&"rxnArrows"==n.map&&(this.hoverHelper.hover(null),this.editor.setSelection(n),this.dragCtx={xy0:e.page2obj(t)})},r.prototype.OnMouseMove=function(t){var e=this.editor.render;"dragCtx"in this?(this.dragCtx.action&&this.dragCtx.action.perform(),this.dragCtx.action=o.fromMultipleMove(this.editor.selection,e.page2obj(t).sub(this.dragCtx.xy0)),e.render.update()):this.hoverHelper.hover(this.editor.findItem(t,["rxnArrows"]))},r.prototype.OnMouseUp=function(t){var e=this.editor.render;"dragCtx"in this?(s.addUndoAction(this.dragCtx.action,!1),e.update(),delete this.dragCtx):e.ctab.molecule.rxnArrows.count()<1&&(s.addUndoAction(o.fromArrowAddition(e.page2obj(t))),e.update())},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../action":37,"./base":43,"./helper/hover":48}],54:[function(t,e,n){(function(n){function r(t){this.editor=t,this.hoverHelper=new s(this),this.editor.setSelection(null),this.rcs=this.editor.render.ctab.molecule.getComponents()}function o(t,e,n){for(var r,o,a=0;(!r||!o)&&a<t.reactants.length;a++){var s=i.list(t.reactants[a]);!r&&s.indexOf(e)>=0&&(r="r"),!o&&s.indexOf(n)>=0&&(o="r")}for(var l=0;(!r||!o)&&l<t.products.length;l++){var u=i.list(t.products[l]);!r&&u.indexOf(e)>=0&&(r="p"),!o&&u.indexOf(n)>=0&&(o="p")}return r&&o&&r!=o}var i=t("../../util/set"),a=t("../action"),s=t("./helper/hover"),l=t("./base"),u=t("../../render/draw"),c=n.ui;r.prototype=new l,r.prototype.OnMouseDown=function(t){var e=this.editor.render,n=this.editor.findItem(t,["atoms"]);n&&"atoms"==n.map&&(this.hoverHelper.hover(null),this.dragCtx={item:n,xy0:e.page2obj(t)})},r.prototype.OnMouseMove=function(t){var e=this.editor.render;if("dragCtx"in this){var n=this.editor.findItem(t,["atoms"],this.dragCtx.item),r=e.ctab.molecule.atoms;n&&"atoms"==n.map&&o(this.rcs,this.dragCtx.item.id,n.id)?(this.hoverHelper.hover(n),this.updateLine(r.get(this.dragCtx.item.id).pp,r.get(n.id).pp)):(this.hoverHelper.hover(null),this.updateLine(r.get(this.dragCtx.item.id).pp,e.page2obj(t)))}else this.hoverHelper.hover(this.editor.findItem(t,["atoms"]))},r.prototype.updateLine=function(t,e){if(this.line&&(this.line.remove(),this.line=null),t&&e){var n=this.editor.render;this.line=u.selectionLine(n,n.obj2scaled(t).add(n.offset),n.obj2scaled(e).add(n.offset))}},r.prototype.OnMouseUp=function(t){if("dragCtx"in this){var e=this.editor.render,n=this.editor.findItem(t,["atoms"],this.dragCtx.item);if(n&&"atoms"==n.map&&o(this.rcs,this.dragCtx.item.id,n.id)){var r=new a,i=e.ctab.molecule.atoms,s=i.get(this.dragCtx.item.id),l=i.get(n.id),u=s.aam,p=l.aam;if(!u||u!=p){if((u&&u!=p||!u&&p)&&i.each(function(t,e){t!=this.dragCtx.item.id&&(u&&e.aam==u||p&&e.aam==p)&&r.mergeWith(a.fromAtomsAttrs(t,{aam:0}))},this),u)r.mergeWith(a.fromAtomsAttrs(n.id,{aam:u}));else{var h=0;i.each(function(t,e){h=Math.max(h,e.aam||0)}),r.mergeWith(a.fromAtomsAttrs(this.dragCtx.item.id,{aam:h+1})),r.mergeWith(a.fromAtomsAttrs(n.id,{aam:h+1}))}c.addUndoAction(r,!0),e.update()}}this.updateLine(null),delete this.dragCtx}this.hoverHelper.hover(null)},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../render/draw":65,"../../util/set":118,"../action":37,"./base":43,"./helper/hover":48}],55:[function(t,e,n){(function(n){function r(t){this.editor=t,this.hoverHelper=new i(this)}var o=t("../action"),i=t("./helper/hover"),a=t("./base"),s=n.ui;r.prototype=new a,r.prototype.OnMouseDown=function(t){var e=this.editor.render,n=this.editor.findItem(t,["rxnPluses"]);n&&"rxnPluses"==n.map&&(this.hoverHelper.hover(null),this.editor.setSelection(n),this.dragCtx={xy0:e.page2obj(t)})},r.prototype.OnMouseMove=function(t){var e=this.editor.render;"dragCtx"in this?(this.dragCtx.action&&this.dragCtx.action.perform(),this.dragCtx.action=o.fromMultipleMove(this.editor.selection,e.page2obj(t).sub(this.dragCtx.xy0)),e.update()):this.hoverHelper.hover(this.editor.findItem(t,["rxnPluses"]))},r.prototype.OnMouseUp=function(t){var e=this.editor.render;"dragCtx"in this?(s.addUndoAction(this.dragCtx.action,!1),e.update(),delete this.dragCtx):(s.addUndoAction(o.fromPlusAddition(e.page2obj(t))),e.update())},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../action":37,"./base":43,"./helper/hover":48}],56:[function(t,e,n){(function(n){function r(t){this.editor=t,this.hoverHelper=new i(this),this.editor.setSelection(null)}var o=t("../action"),i=t("./helper/hover"),a=t("./base"),s=n.ui;r.prototype=new a,r.prototype.OnMouseMove=function(t){var e=this.editor.findItem(t,["atoms"]);e&&"atoms"==e.map?this.hoverHelper.hover(this.editor.render.ctab.molecule.atoms.get(e.id).aam?e:null):this.hoverHelper.hover(null)},r.prototype.OnMouseUp=function(t){var e=this.editor.findItem(t,["atoms"]),n=this.editor.render.ctab.molecule.atoms;if(e&&"atoms"==e.map&&n.get(e.id).aam){var r=new o,i=n.get(e.id).aam;n.each(function(t,e){e.aam==i&&r.mergeWith(o.fromAtomsAttrs(t,{aam:0}))},this),s.addUndoAction(r,!0),this.editor.render.update()}this.hoverHelper.hover(null)},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../action":37,"./base":43,"./helper/hover":48}],57:[function(t,e,n){(function(n){function r(t){this.editor=t,this.hoverHelper=new u(this)}function o(t){for(var e=[],n=0;n<32;n++)if(t&1<<n){var r="R"+(n+1);e.push(r)}return e}function i(t){var e=0;return t.values.forEach(function(t){var n=t.substr(1)-1;e|=1<<n}),e}var a=t("../../chem/struct"),s=t("../action"),l=t("./base"),u=t("./helper/hover"),c=n.ui;r.prototype=new l,r.prototype.OnMouseMove=function(t){this.hoverHelper.hover(this.editor.findItem(t,["atoms"]))},r.prototype.OnMouseUp=function(t){var e=this.editor.render,n=this.editor.findItem(t,["atoms"]);if(!n||"Canvas"==n.type)return this.hoverHelper.hover(null),c.showRGroupTable({mode:"multiple",onOk:function(t){t=i(t),t&&(c.addUndoAction(s.fromAtomAddition(e.page2obj(this.OnMouseMove0.lastEvent),{label:"R#",rglabel:t}),!0),e.update())}.bind(this)}),!0;if(n&&"atoms"==n.map){this.hoverHelper.hover(null);var r=e.ctab.molecule.atoms.get(n.id),l=r.label,u=r.rglabel;return c.showRGroupTable({mode:"multiple",values:o(u),onOk:function(t){if(t=i(t),u!=t||"R#"!=l){var o=Object.clone(a.Atom.attrlist);t?(o.label="R#",o.rglabel=t,o.aam=r.aam):(o.label="C",o.aam=r.aam),c.addUndoAction(s.fromAtomsAttrs(n.id,o),!0),e.update()}}.bind(this)}),!0}},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../chem/struct":33,"../action":37,"./base":43,"./helper/hover":48}],58:[function(t,e,n){(function(n){function r(t){this.editor=t,this.hoverHelper=new a(this)}var o=t("../../chem/struct"),i=t("../action"),a=t("./helper/hover"),s=t("./base"),l=n.ui;r.prototype=new s,r.prototype.OnMouseMove=function(t){this.hoverHelper.hover(this.editor.findItem(t,["frags","rgroups"]))},r.prototype.OnMouseUp=function(t){var e=this.editor.render,n=this.editor.findItem(t,["frags","rgroups"]);if(n&&"frags"==n.map){this.hoverHelper.hover(null);var r=o.RGroup.findRGroupByFragment(e.ctab.molecule.rgroups,n.id);return l.showRGroupTable({values:r&&["R"+r],onOk:function(t){console.assert(t.values.length<=1,"Too much elements"),t=t.values.length?t.values[0].substr(1)-0:0,r!=t&&(l.addUndoAction(i.fromRGroupFragment(t,n.id),!0),e.update())}.bind(this)}),!0}if(n&&"rgroups"==n.map){this.hoverHelper.hover(null);var a=e.ctab.molecule.rgroups.get(n.id),s=[];return e.ctab.molecule.rgroups.each(function(t){s.push(t)}),l.showRLogicTable({label:n.id,rgroupLabels:s,range:a.range||">0",resth:a.resth,ifthen:a.ifthen,onOk:function(t){var r={};if(a.range!=t.range){var o=t.range.split(",").all(function(t){return t.match(/^[>,<,=]?[0-9]+$/g)||t.match(/^[0-9]+\-[0-9]+$/g)});if(!o)return alert("Bad occurrence value"),!1;r.range=t.range}return a.resth!=t.resth&&(r.resth=t.resth),a.ifthen!=t.ifthen&&(r.ifthen=t.ifthen),("range"in r||"resth"in r||"ifthen"in r)&&(l.addUndoAction(i.fromRGroupAttrs(n.id,r)),e.update()),!0}.bind(this)}),!0}},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../chem/struct":33,"../action":37,"./base":43,"./helper/hover":48}],59:[function(t,e,n){(function(n){function r(t){this.editor=t,this.lassoHelper=new a(1,t);var e=this.editor.selection;e.atoms&&e.atoms.length||this.editor.setSelection(null)}var o=t("../../util/vec2"),i=t("../action"),a=t("./helper/lasso"),s=t("./base"),l=n.ui;r.prototype=new s,r.prototype.OnMouseDown=function(t){var e=this.editor.selection;if(e.atoms&&e.atoms.length){var n=this.editor.render,r=n.ctab.molecule,i=new o;if(!e.atoms||!e.atoms.length)return!0;var a=null,s=!1;e.atoms.each(function(t){var n=r.atoms.get(t);i.add_(n.pp),s||n.neighbors.find(function(n){var o=r.halfBonds.get(n);if(e.atoms.indexOf(o.end)==-1){if(o.loop>=0){var i=r.atoms.get(t);if(!Object.isUndefined(i.neighbors.find(function(t){var n=r.halfBonds.get(t);return n.loop>=0&&e.atoms.indexOf(n.end)!=-1})))return s=!0,!0}if(null==a)a=t;else if(a!=t)return s=!0,!0}return!1})}),i=a||null==a?i.scaled(1/e.atoms.length):r.atoms.get(a).pp,this.dragCtx={xy0:i,angle1:this.calcAngle(i,n.page2obj(t)),all:s}}else this.lassoHelper.begin(t);return!0},r.prototype.OnMouseMove=function(t){if(this.lassoHelper.running())this.editor.setSelection(this.lassoHelper.addPoint(t));else if("dragCtx"in this){var e=this.editor,n=e.render,r=this.dragCtx,o=n.page2obj(t),a=this.calcAngle(r.xy0,o)-r.angle1,s=Math.round(a/Math.PI*180);if(s>180?s-=360:s<=-180&&(s+=360),"angle"in r&&r.angle==s)return!0;"action"in r&&r.action.perform(),r.angle=s,r.action=i.fromRotate(r.all?n.ctab.molecule:this.editor.getSelection(),r.xy0,a),$("toolText").update(s+"º"),n.update()}return!0},r.prototype.OnMouseUp=function(t){var e=null;return this.lassoHelper.running()?e=this.lassoHelper.end(t):"dragCtx"in this&&("action"in this.dragCtx?(l.addUndoAction(this.dragCtx.action,!0),$("toolText").update("")):this.editor.setSelection(),delete this.dragCtx),!0},r.prototype.OnCancel=function(){"dragCtx"in this&&("action"in this.dragCtx&&(l.addUndoAction(this.dragCtx.action,!0),$("toolText").update("")),delete this.dragCtx)},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util/vec2":119,"../action":37,"./base":43,"./helper/lasso":49}],60:[function(t,e,n){(function(n){function r(t,e){this.editor=t,this.hoverHelper=new c(this),this.lassoHelper=new p("lasso"==e?0:1,t,"fragment"==e),this.sGroupHelper=new h(t)}function o(t,e,n){var r=t.ctab;if("frags"==n.map||"rgroups"==n.map){var o="frags"==n.map?r.frags.get(n.id).fragGetAtoms(t,n.id):r.rgroups.get(n.id).getAtoms(t);return!!e.atoms&&i.subset(i.fromList(o),i.fromList(e.atoms))}return!!e[n.map]&&e[n.map].indexOf(n.id)>-1}var i=t("../../util/set"),a=t("../action"),s=t("../../chem/element"),l=t("../../chem/struct"),u=t("./base"),c=t("./helper/hover"),p=t("./helper/lasso"),h=t("./helper/sgroup"),f=t("./rgroupatom"),d=n.ui;r.prototype=new u,r.prototype.OnMouseDown=function(t){var e=this.editor.render,n=e.ctab,r=n.molecule;this.hoverHelper.hover(null);var i=this.lassoHelper.fragment||t.ctrlKey,s=this.editor.findItem(t,i?["frags","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","chiralFlags"]:["atoms","bonds","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","chiralFlags"]);if(s&&"Canvas"!=s.type){if(this.hoverHelper.hover(null),!o(e,this.editor.selection,s))if("frags"==s.map){var u=n.frags.get(s.id);this.editor.setSelection({atoms:u.fragGetAtoms(e,s.id),bonds:u.fragGetBonds(e,s.id)},t.shiftKey)}else if("sgroups"==s.map){var c=n.sgroups.get(s.id).item;this.editor.setSelection({atoms:l.SGroup.getAtoms(r,c),bonds:l.SGroup.getBonds(r,c)},t.shiftKey)}else if("rgroups"==s.map){var p=n.rgroups.get(s.id);this.editor.setSelection({atoms:p.getAtoms(e),bonds:p.getBonds(e)},t.shiftKey)}else this.editor.setSelection(s,t.shiftKey);if(this.dragCtx={item:s,xy0:e.page2obj(t)},"atoms"==s.map&&!d.is_touch){var h=this;this.dragCtx.timeout=setTimeout(function(){delete h.dragCtx,h.editor.setSelection(null);var t=e.ctab.molecule.atoms.get(s.id);d.showLabelEditor({label:t.label,charge:t.charge,isotope:t.isotope,radical:t.radical,onOk:function(t){d.addUndoAction(a.fromAtomsAttrs(s.id,t),!0),e.update()}})},750),this.dragCtx.stopTapping=function(){"timeout"in h.dragCtx&&(clearTimeout(h.dragCtx.timeout),delete h.dragCtx.timeout)}}}else this.lassoHelper.fragment||this.lassoHelper.begin(t);return!0},r.prototype.OnMouseMove=function(t){var e=this.editor.render;if("dragCtx"in this){if("stopTapping"in this.dragCtx&&this.dragCtx.stopTapping(),this.dragCtx.action&&(this.dragCtx.action.perform(),e.update()),this.dragCtx.action=a.fromMultipleMove(this.editor.getSelection(!0),e.page2obj(t).sub(this.dragCtx.xy0)),["atoms"].indexOf(this.dragCtx.item.map)>=0){var n=this.editor.findItem(t,[this.dragCtx.item.map],this.dragCtx.item);this.hoverHelper.hover(n.map==this.dragCtx.item.map?n:null)}e.update()}else this.lassoHelper.running()?this.editor.setSelection(this.lassoHelper.addPoint(t),t.shiftKey):this.hoverHelper.hover(this.editor.findItem(t,this.lassoHelper.fragment||t.ctrlKey?["frags","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","chiralFlags"]:["atoms","bonds","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","chiralFlags"]));return!0},r.prototype.OnMouseUp=function(t){if("dragCtx"in this){if("stopTapping"in this.dragCtx&&this.dragCtx.stopTapping(),["atoms"].indexOf(this.dragCtx.item.map)>=0){var e=this.editor.findItem(t,[this.dragCtx.item.map],this.dragCtx.item);e.map==this.dragCtx.item.map&&(this.hoverHelper.hover(null),this.editor.setSelection(),this.dragCtx.action=this.dragCtx.action?a.fromAtomMerge(this.dragCtx.item.id,e.id).mergeWith(this.dragCtx.action):a.fromAtomMerge(this.dragCtx.item.id,e.id))}d.addUndoAction(this.dragCtx.action,!0),this.editor.render.update(),delete this.dragCtx}else this.lassoHelper.running()?this.editor.setSelection(this.lassoHelper.end(),t.shiftKey):this.lassoHelper.fragment&&this.editor.setSelection(null);return!0},r.prototype.OnDblClick=function(t){var e=this.editor.render,n=this.editor.findItem(t),r=e.ctab.molecule;if("atoms"==n.map){this.editor.setSelection(n);var o=r.atoms.get(n.id);if("R#"==o.label)f.prototype.OnMouseUp.call(this,t);else if("L#"==o.label)d.showElemTable({selection:o,onOk:function(t){return o.label==t.label&&o.atomList.equals(t.atomList)||(d.addUndoAction(a.fromAtomsAttrs(n.id,t)),e.update()),!0}});else if(s.getElementByLabel(o.label)){var i=e.ctab.molecule.atoms.get(n.id),u=i.charge-0,c=i.isotope-0,p=i.explicitValence-0;d.showAtomProperties({label:i.label,charge:0==u?"":u,isotope:0==c?"":c,explicitValence:p<0?"":p,radical:i.radical,invRet:i.invRet,exactChangeFlag:i.exactChangeFlag,ringBondCount:i.ringBondCount,substitutionCount:i.substitutionCount,unsaturatedAtom:i.unsaturatedAtom,hCount:i.hCount,onOk:function(t){d.addUndoAction(a.fromAtomsAttrs(n.id,{label:t.label,charge:""==t.charge?0:parseInt(t.charge,10),isotope:""==t.isotope?0:parseInt(t.isotope,10),explicitValence:""==t.explicitValence?-1:parseInt(t.explicitValence,10),radical:parseInt(t.radical,10),invRet:parseInt(t.invRet,10),exactChangeFlag:t.exactChangeFlag,ringBondCount:parseInt(t.ringBondCount,10),substitutionCount:parseInt(t.substitutionCount,10),unsaturatedAtom:t.unsaturatedAtom,hCount:parseInt(t.hCount,10)}),!0),e.update()}})}else d.showReaGenericsTable({values:[o.label],onOk:function(t){var r=t.values[0];return o.label!=r&&(d.addUndoAction(a.fromAtomsAttrs(n.id,{label:r})),e.update()),!0}})}else if("bonds"==n.map){this.editor.setSelection(n);var h=e.ctab.bonds.get(n.id).b,g=h.type,m=h.stereo;d.showBondProperties({type:l.Bond.type2Caption(g,m),topology:h.topology||0,center:h.reactingCenterStatus||0,onOk:function(t){var r=Object.assign(l.Bond.caption2Type(t.type),{topology:parseInt(t.topology,10),reactingCenterStatus:parseInt(t.center,10)});d.addUndoAction(a.fromBondAttrs(n.id,r),!0),e.update()}})}else"sgroups"==n.map&&(this.editor.setSelection(n),this.sGroupHelper.showPropertiesDialog(n.id));return!0},r.prototype.OnCancel=function(){var t=this.editor.render;"dragCtx"in this?("stopTapping"in this.dragCtx&&this.dragCtx.stopTapping(),d.addUndoAction(this.dragCtx.action,!0),t.update(),delete this.dragCtx):this.lassoHelper.running()&&this.editor.setSelection(this.lassoHelper.end()),this.hoverHelper.hover(null)},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../chem/element":22,"../../chem/struct":33,"../../util/set":118,"../action":37,"./base":43,"./helper/hover":48,"./helper/lasso":49,"./helper/sgroup":51,"./rgroupatom":57}],61:[function(t,e,n){function r(t,e){this.editor=t,this.maps=["atoms","bonds","sgroups","sgroupData"],this.hoverHelper=new i(this),this.lassoHelper=new a(1,t),this.sGroupHelper=new s(t,e);var n=this.editor.getSelection();n.atoms&&n.atoms.length>0?this.sGroupHelper.showPropertiesDialog(null,n):this.editor.setSelection(null)}var o=t("./base"),i=t("./helper/hover"),a=t("./helper/lasso"),s=t("./helper/sgroup");r.prototype=new o,r.prototype.OnMouseDown=function(t){var e=this.editor.findItem(t,this.maps);e&&"Canvas"!=e.type||this.lassoHelper.begin(t)},r.prototype.OnMouseMove=function(t){this.lassoHelper.running()?this.editor.setSelection(this.lassoHelper.addPoint(t)):this.hoverHelper.hover(this.editor.findItem(t,this.maps))},r.prototype.OnMouseUp=function(t){var e=null,n=null;if(this.lassoHelper.running())n=this.lassoHelper.end(t);else{var r=this.editor.findItem(t,this.maps);if(!r||"Canvas"==r.type)return;if(this.hoverHelper.hover(null),"atoms"==r.map)n={atoms:[r.id]};else if("bonds"==r.map){var o=this.editor.render.ctab.bonds.get(r.id);n={atoms:[o.b.begin,o.b.end]}}else{if("sgroups"!=r.map)return;e=r.id}}(null!=e||n&&n.atoms&&n.atoms.length>0)&&this.sGroupHelper.showPropertiesDialog(e,n)},e.exports=r},{"./base":43,"./helper/hover":48,"./helper/lasso":49,"./helper/sgroup":51}],62:[function(t,e,n){(function(n){function r(t,e){this.editor=t,this.template={aid:(e.aid||1)-1,bid:(e.bid||1)-1};var n=e.struct;n.rescale();var r=new i;n.atoms.each(function(t,e){r.add_(e.pp)}),this.template.molecule=n,this.template.xy0=r.scaled(1/n.atoms.count()),this.template.angle0=this.calcAngle(n.atoms.get(this.template.aid).pp,this.template.xy0);var o=n.bonds.get(this.template.bid);this.template.sign=this.getSign(n,o,this.template.xy0),this.hoverHelper=new s(this)}var o=t("../../util/set"),i=t("../../util/vec2"),a=t("../action"),s=t("./helper/hover"),l=t("./base"),u=n.ui;r.prototype=new l,r.prototype.getSign=function(t,e,n){var r=t.atoms.get(e.begin).pp,o=t.atoms.get(e.end).pp,a=i.cross(i.diff(r,o),i.diff(n,o));return a>0?1:a<0?-1:0},r.prototype.OnMouseDown=function(t){var e=this.editor,n=e.render;this.hoverHelper.hover(null),this.dragCtx={xy0:n.page2obj(t),item:e.findItem(t,["atoms","bonds"])};var r=this.dragCtx,a=r.item;if(a&&"Canvas"!=a.type){if("bonds"==a.map){var s=n.ctab.molecule,l=new i,u=s.bonds.get(a.id),c=s.atoms.get(u.begin).fragment,p=s.getFragmentIds(c),h=0,f=s.halfBonds.get(u.hb1).loop;
if(f<0&&(f=s.halfBonds.get(u.hb2).loop),f>=0){var d=s.loops.get(f).hbs;d.each(function(t){l.add_(s.atoms.get(s.halfBonds.get(t).begin).pp),h++})}else o.each(p,function(t){l.add_(s.atoms.get(t).pp),h++});r.v0=l.scaled(1/h);var g=this.getSign(s,u,r.v0);r.sign1=g||1,r.sign2=this.template.sign}}else delete r.item;return!0},r.prototype.OnMouseMove=function(t){var e=this.editor,n=e.render;if("dragCtx"in this){var r,o,s,l=this.dragCtx,u=l.item,c=n.page2obj(t);l.mouse_moved=!0;var p=n.ctab.molecule;if(u&&"Canvas"!=u.type){if("atoms"==u.map)r=p.atoms.get(u.id).pp,s=i.dist(r,c)>1;else if("bonds"==u.map){var h=p.bonds.get(u.id),f=this.getSign(p,h,c);return l.sign1*this.template.sign>0&&(f=-f),f==l.sign2&&l.action||("action"in l&&l.action.perform(),l.sign2=f,l.action=a.fromTemplateOnBond(u.id,this.template,this.calcAngle,l.sign1*l.sign2>0),n.update()),!0}}else r=l.xy0;o=this.calcAngle(r,c);var d=Math.round(180/Math.PI*o);if("angle"in l&&l.angle==d){if(!("extra_bond"in l))return!0;if(l.extra_bond==s)return!0}return"action"in l&&l.action.perform(),l.angle=d,u&&"Canvas"!=u.type?"atoms"==u.map&&(l.action=a.fromTemplateOnAtom(u.id,o,s,this.template,this.calcAngle),l.extra_bond=s):l.action=a.fromTemplateOnCanvas(r,o,this.template),n.update(),!0}return this.hoverHelper.hover(this.editor.findItem(t,["atoms","bonds"])),!0},r.prototype.OnMouseUp=function(){var t=this.editor,e=t.render;if("dragCtx"in this){var n=this.dragCtx,r=n.item,o=e.ctab,i=o.molecule;if(!n.action){if(r&&"Canvas"!=r.type)if("atoms"==r.map){var s=o.atoms.get(r.id).a.neighbors.length;if(s>1)n.action=a.fromTemplateOnAtom(r.id,null,!0,this.template,this.calcAngle);else if(1==s){var l=i.halfBonds.get(i.atoms.get(r.id).neighbors[0]).end,c=i.atoms.get(r.id),p=i.atoms.get(l);n.action=a.fromTemplateOnAtom(r.id,this.calcAngle(p.pp,c.pp),!1,this.template,this.calcAngle)}else n.action=a.fromTemplateOnAtom(r.id,0,!1,this.template,this.calcAngle)}else"bonds"==r.map&&(n.action=a.fromTemplateOnBond(r.id,this.template,this.calcAngle,n.sign1*n.sign2>0));else n.action=a.fromTemplateOnCanvas(n.xy0,0,this.template);e.update()}"action"in this.dragCtx&&(this.dragCtx.action.isDummy()||u.addUndoAction(this.dragCtx.action)),delete this.dragCtx}},r.prototype.OnCancel=function(){this.OnMouseUp()},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util/set":118,"../../util/vec2":119,"../action":37,"./base":43,"./helper/hover":48}],63:[function(t,e,n){(function(n){function r(){return f.stringify(d.editor.struct(),{ignoreErrors:!0})}function o(){return h.stringify(d.editor.struct(),{ignoreErrors:!0})}function i(t){Object.isString(t)&&d.load(t,{rescale:!0})}function a(t){Object.isString(t)&&d.load(t,{rescale:!0,fragment:!0})}function s(t,e,n){var r=new g(t,n.bondLength||75,n);if(e){var o=h.parse(e);r.setMolecule(o)}return r.update(),r}function l(t){c.assert(t),d.render.addStructChangeHandler(t)}var u=t("query-string"),c=t("./util"),p=t("./api.js"),h=t("./chem/molfile"),f=t("./chem/smiles");t("./ui");var d=n.ui,g=t("./render");window.onload=function(){var t=u.parse(document.location.search);t.api_path&&(b.apiPath=t.api_path);var e=b.server=p(b.apiPath,{"smart-layout":!0,"ignore-stereochemistry-errors":!0,"mass-skip-error-on-pseudoatoms":!1,"gross-formula-add-rsites":!0});e.then(function(){t.mol&&d.load(t.mol)},function(){document.title+=" (standalone)"}),d.init(Object.assign({},t,m),e)};var m={version:"2.0.0-alpha.6+r380",apiPath:"",buildDate:"Fri Dec 30 2016 13:56:56 GMT+0300 (MSK)",buildNumber:null,buildOptions:"__BUILD_OPTIONS__"},b=e.exports=Object.assign({getSmiles:r,getMolfile:o,setMolecule:i,addFragment:a,showMolfile:s,onStructChange:l},m)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./api.js":21,"./chem/molfile":24,"./chem/smiles":28,"./render":66,"./ui":91,"./util":115,"query-string":18}],64:[function(t,e,n){(function(n){var r="undefined"!=typeof window?window.Raphael:"undefined"!=typeof n?n.Raphael:null,o=t("./util/vec2");r.el.translateAbs=function(t,e){this.delta=this.delta||new o,this.delta.x+=t-0,this.delta.y+=e-0,this.transform("t"+this.delta.x.toString()+","+this.delta.y.toString())},r.st.translateAbs=function(t,e){this.forEach(function(n){n.translateAbs(t,e)})},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./util/vec2":119}],65:[function(t,e,n){function r(t,e,n){var r=5,o=7,i=t.paper,a=t.options;return i.path("M{0},{1}L{2},{3}L{4},{5}M{2},{3}L{4},{6}",I(e.x),I(e.y),I(n.x),I(n.y),I(n.x-o),I(n.y-r),I(n.y+r)).attr(a.lineattr)}function o(t,e){var n=t.scale/5,r=t.paper,o=t.options;return r.path("M{0},{4}L{0},{5}M{2},{1}L{3},{1}",I(e.x),I(e.y),I(e.x-n),I(e.x+n),I(e.y-n),I(e.y+n)).attr(o.lineattr)}function i(t,e,n){var r=e.p,o=n.p,i=t.paper,a=t.options;return i.path(A(r,o)).attr(a.lineattr)}function a(t,e,n,r,o){var i=e.p,a=n.p,s=e.norm,l=t.paper,u=t.options,c=.7*u.stereoBond,p=a.addScaled(s,c),h=a.addScaled(s,-c);if(r.neihbid2>=0){var f=E(n,r.neihbid2,u.stereoBond,o);p=f[0],h=f[1]}return l.path("M{0},{1}L{2},{3}L{4},{5}Z",I(i.x),I(i.y),I(p.x),I(p.y),I(h.x),I(h.y)).attr(u.lineattr).attr({fill:"#000"})}function s(t,e,n,r,o,i,a,s){var l=t.paper,u=t.options,c=E(e,r.neihbid1,u.stereoBond,i),p=E(n,r.neihbid2,u.stereoBond,i),h=c[0],f=c[1],d=p[0],g=p[1],m=l.path("M{0},{1}L{2},{3}L{4},{5}L{6},{7}Z",I(h.x),I(h.y),I(f.x),I(f.y),I(d.x),I(d.y),I(g.x),I(g.y)).attr(u.lineattr).attr({stroke:"#000",fill:"#000"});if(o){var b=e.p,v=n.p,y=e.norm,w=r.doubleBondShift,x=1.5*u.stereoBond,S=b.addScaled(y,x*w),O=v.addScaled(y,x*w);return w>0?(a&&(S=S.addScaled(e.dir,x*C(e.rightCos,e.rightSin))),s&&(O=O.addScaled(e.dir,-x*C(n.leftCos,n.leftSin)))):w<0&&(a&&(S=S.addScaled(e.dir,x*C(e.leftCos,e.leftSin))),s&&(O=O.addScaled(e.dir,-x*C(n.rightCos,n.rightSin)))),l.set([m,l.path("M{0},{1}L{2},{3}",I(S.x),I(S.y),I(O.x),I(O.y)).attr(u.lineattr)])}return m}function l(t,e,n){var r=e.p,o=n.p,i=e.norm,a=t.paper,s=t.options,l=.7*s.stereoBond,u=o.sub(r),c=u.length()+.2;u=u.normalized();for(var p,h,f=1.2*s.lineWidth,d=Math.max(Math.floor((c-s.lineWidth)/(s.lineWidth+f)),0)+2,g=c/(d-1),m="",b=r,v=0;v<d;++v)b=r.addScaled(u,g*v),p=b.addScaled(i,l*(v+.5)/(d-.5)),h=b.addScaled(i,-l*(v+.5)/(d-.5)),m+=A(p,h);return a.path(m).attr(s.lineattr)}function u(t,e,n){var r=e.p,o=n.p,i=e.norm,a=t.paper,s=t.options,l=.7*s.stereoBond,u=o.sub(r),c=u.length();u=u.normalized();for(var p=.6*s.lineWidth,h=Math.max(Math.floor((c-s.lineWidth)/(s.lineWidth+p)),0)+2,f=c/(h-.5),d="M"+I(r.x)+","+I(r.y),g=r,m=0;m<h;++m)g=r.addScaled(u,f*(m+.5)).addScaled(i,(1&m?-1:1)*l*(m+.5)/(h-.5)),d+="L"+I(g.x)+","+I(g.y);return a.path(d).attr(s.lineattr)}function c(t,e,n,r,o,i,a){var s=e.p,l=n.p,u=e.norm,c=o?0:r.doubleBondShift,p=t.paper,h=t.options,f=h.bondSpace/2,d=f,g=-f;d+=c*f,g+=c*f;var m=s.addScaled(u,d),b=l.addScaled(u,d),v=s.addScaled(u,g),y=l.addScaled(u,g);return c>0?(i&&(m=m.addScaled(e.dir,h.bondSpace*C(e.rightCos,e.rightSin))),a&&(b=b.addScaled(e.dir,-h.bondSpace*C(n.leftCos,n.leftSin)))):c<0&&(i&&(v=v.addScaled(e.dir,h.bondSpace*C(e.leftCos,e.leftSin))),a&&(y=y.addScaled(e.dir,-h.bondSpace*C(n.rightCos,n.rightSin)))),p.path(o?"M{0},{1}L{6},{7}M{4},{5}L{2},{3}":"M{0},{1}L{2},{3}M{4},{5}L{6},{7}",I(m.x),I(m.y),I(b.x),I(b.y),I(v.x),I(v.y),I(y.x),I(y.y)).attr(h.lineattr)}function p(t,e,n){var r=e.p,o=n.p,i=e.norm,a=t.paper,s=t.options,l=s.bondSpace/2,u=(B.dist(r,o)/(s.bondSpace+s.lineWidth)).toFixed()-0;1&u||(u+=1);for(var c="",p=r,h=1;h<=u;++h){var f=B.lc2(r,(u-h)/u,o,h/u);1&h?c+=A(p,f):(c+=A(p.addScaled(i,l),f.addScaled(i,l)),c+=A(p.addScaled(i,-l),f.addScaled(i,-l))),p=f}return a.path(c).attr(s.lineattr)}function h(t,e,n){var r=e.p,o=n.p,i=e.norm,a=t.paper,s=t.options,l=r.addScaled(i,s.bondSpace),u=o.addScaled(i,s.bondSpace),c=r.addScaled(i,-s.bondSpace),p=o.addScaled(i,-s.bondSpace);return a.path(A(r,o)+A(l,u)+A(c,p)).attr(s.lineattr)}function f(t,e,n,r,o,i){var a=t.paper,s=t.options,l=N(e,n,r,o,i,s.bondSpace),u=a.path(l[0]).attr(s.lineattr),c=a.path(l[1]).attr(s.lineattr);return(r>0?u:c).attr({"stroke-dasharray":"- "}),a.set([u,c])}function d(t,e,n,r,o,i){var a=t.paper,s=t.options,l=k.map(function(t){return t*s.scaleFactor}),u=N(e,n,r,o,i,s.bondSpace,r>0?1:2,l),c=a.path(u[0]).attr(s.lineattr),p=a.path(u[1]).attr(s.lineattr);return a.set([c,p])}function g(t,e,n,r,o,i){var a=t.paper,s=t.options,l=k.map(function(t){return t*s.scaleFactor}),u=N(e,n,r,o,i,s.bondSpace,3,l),c=a.path(u[0]).attr(s.lineattr),p=a.path(u[1]).attr(s.lineattr);return a.set([c,p])}function m(t,e,n){var r=e.p,o=n.p,i=t.paper,a=t.options;return i.path(A(r,o)).attr(a.lineattr).attr({"stroke-dasharray":"- "})}function b(t,e,n,r){var o=n.p,i=r.p,a=i.add(o).scaled(.5),s=i.sub(o).normalized(),l=s.rotateSC(1,0),u=t.paper,c=t.options,p=[],h=c.lineWidth,f=c.bondSpace/2,d=h,g=2*h,m=1.5*f,b=1.5*f,v=3*f,y=.2;switch(e.b.reactingCenterStatus){case M.Bond.PATTERN.REACTING_CENTER.NOT_CENTER:p.push(a.addScaled(l,v).addScaled(s,y*v)),p.push(a.addScaled(l,-v).addScaled(s,-y*v)),p.push(a.addScaled(l,v).addScaled(s,-y*v)),p.push(a.addScaled(l,-v).addScaled(s,y*v));break;case M.Bond.PATTERN.REACTING_CENTER.CENTER:p.push(a.addScaled(l,v).addScaled(s,y*v).addScaled(s,d)),p.push(a.addScaled(l,-v).addScaled(s,-y*v).addScaled(s,d)),p.push(a.addScaled(l,v).addScaled(s,y*v).addScaled(s,-d)),p.push(a.addScaled(l,-v).addScaled(s,-y*v).addScaled(s,-d)),p.push(a.addScaled(s,m).addScaled(l,b)),p.push(a.addScaled(s,-m).addScaled(l,b)),p.push(a.addScaled(s,m).addScaled(l,-b)),p.push(a.addScaled(s,-m).addScaled(l,-b));break;case M.Bond.PATTERN.REACTING_CENTER.MADE_OR_BROKEN:p.push(a.addScaled(l,v).addScaled(s,g)),p.push(a.addScaled(l,-v).addScaled(s,g)),p.push(a.addScaled(l,v).addScaled(s,-g)),p.push(a.addScaled(l,-v).addScaled(s,-g));break;case M.Bond.PATTERN.REACTING_CENTER.ORDER_CHANGED:p.push(a.addScaled(l,v)),p.push(a.addScaled(l,-v));break;case M.Bond.PATTERN.REACTING_CENTER.MADE_OR_BROKEN_AND_CHANGED:p.push(a.addScaled(l,v).addScaled(s,g)),p.push(a.addScaled(l,-v).addScaled(s,g)),p.push(a.addScaled(l,v).addScaled(s,-g)),p.push(a.addScaled(l,-v).addScaled(s,-g)),p.push(a.addScaled(l,v)),p.push(a.addScaled(l,-v));break;default:return null}for(var w="",x=0;x<p.length/2;++x)w+=A(p[2*x],p[2*x+1]);return u.path(w).attr(c.lineattr)}function v(t,e,n,r){var o=null;if(e.b.topology==M.Bond.PATTERN.TOPOLOGY.RING)o="rng";else{if(e.b.topology!=M.Bond.PATTERN.TOPOLOGY.CHAIN)return null;o="chn"}var i=t.paper,a=t.options,s=n.p,l=r.p,u=l.add(s).scaled(.5),c=l.sub(s).normalized(),p=c.rotateSC(1,0),h=a.lineWidth;e.doubleBondShift>0?p=p.scaled(-e.doubleBondShift):0==e.doubleBondShift&&(h+=a.bondSpace/2);var f=new B(2,1).scaled(a.bondSpace);e.b.type==M.Bond.PATTERN.TYPE.TRIPLE&&(h+=a.bondSpace);var d=u.add(new B(p.x*(f.x+h),p.y*(f.y+h))),g=i.text(d.x,d.y,o).attr({font:a.font,"font-size":a.fontszsub,fill:"#000"}),m=R.relBox(g.getBBox());return j(g,m),g}function y(t,e){var n=t.options,r=t.paper,o=.9*n.lineWidth,i=o,a=2*o;return r.path("M{0},{1}L{2},{3}L{4},{5}",I(e.x-i),I(e.y+a),I(e.x),I(e.y),I(e.x+i),I(e.y+a)).attr({stroke:"#000","stroke-width":.7*n.lineWidth,"stroke-linecap":"square","stroke-linejoin":"miter"})}function w(t,e){var n=t.options,r=t.paper;return r.circle(I(e.x),I(e.y),n.lineWidth).attr({stroke:null,fill:"#000"})}function x(t,e,n,r,o,i){var a=t.paper,s=t.options;o=o||.25,i=i||1;var l=r.addScaled(n,-.5*i),u=r.addScaled(n,.5*i),c=l.addScaled(e,-o),p=u.addScaled(e,-o);return a.path("M{0},{1}L{2},{3}L{4},{5}L{6},{7}",I(c.x),I(c.y),I(l.x),I(l.y),I(u.x),I(u.y),I(p.x),I(p.y)).attr(s.sgroupBracketStyle)}function S(t,e,n){var r=t.paper,o=t.options;return r.rect(I(Math.min(e.x,n.x)),I(Math.min(e.y,n.y)),I(Math.abs(n.x-e.x)),I(Math.abs(n.y-e.y))).attr(o.lassoStyle)}function O(t,e){for(var n=t.paper,r=t.options,o=e[e.length-1],i="M"+I(o.x)+","+I(o.y),a=0;a<e.length;++a)i+="L"+I(e[a].x)+","+I(e[a].y);return n.path(i).attr(r.lassoStyle)}function T(t,e,n){var r=t.paper,o=t.options;return r.path(A(e,n)).attr(o.lassoStyle)}function E(t,e,n,r){var o=r.halfBonds.get(e),i=B.dot(t.dir,o.dir),a=B.cross(t.dir,o.dir),s=Math.sqrt(.5*(1-i)),l=o.dir.rotateSC((a>=0?-1:1)*s,Math.sqrt(.5*(1+i))),u=.3,c=.7,p=t.p.addScaled(l,c*n/(s+u)),h=t.p.addScaled(l.negated(),c*n/(s+u));return a>0?[p,h]:[h,p]}function A(t,e){return"M"+I(t.x)+","+I(t.y)+"L"+I(e.x)+","+I(e.y)+"\t"}function C(t,e){return e<0||Math.abs(t)>.9?0:e/(1-t)}function P(t,e,n){for(var r=0,o=B.dist(t,e),i=B.diff(e,t).normalized(),a=!0,s="",l=0;r<o;){var u=n[l%n.length],c=r+Math.min(u,o-r);a&&(s+="M "+t.addScaled(i,r).coordStr()+" L "+t.addScaled(i,c).coordStr()),r+=u,a=!a,l++}return s}function N(t,e,n,r,o,i,a,s){var l=t.p,u=e.p,c=t.norm,p=i/2,h=p,f=-p;h+=n*p,f+=n*p;var d=l.addScaled(c,h),g=u.addScaled(c,h),m=l.addScaled(c,f),b=u.addScaled(c,f);n>0?(r&&(d=d.addScaled(t.dir,i*C(t.rightCos,t.rightSin))),o&&(g=g.addScaled(t.dir,-i*C(e.leftCos,e.leftSin)))):n<0&&(r&&(m=m.addScaled(t.dir,i*C(t.leftCos,t.leftSin))),o&&(b=b.addScaled(t.dir,-i*C(e.rightCos,e.rightSin))));var v=s&&1&a?P(d,g,s):A(d,g),y=s&&2&a?P(m,b,s):A(m,b);return[v,y]}function j(t,e){if(_.vml){console.assert(null,"Souldn't go here!");var n=.16*e.height;t.translateAbs(0,n),e.y+=n}}var R=t("../util"),B=t("../util/vec2"),M=t("../chem/struct"),_=t("../raphael-ext"),I=R.tfx,k=[.125,.125,.005,.125];e.exports={recenterText:j,arrow:r,plus:o,bondSingle:i,bondSingleUp:a,bondSingleStereoBold:s,bondSingleDown:l,bondSingleEither:u,bondDouble:c,bondSingleOrDouble:p,bondTriple:h,bondAromatic:f,bondSingleOrAromatic:d,bondDoubleOrAromatic:g,bondAny:m,reactingCenter:b,topologyMark:v,radicalCap:y,radicalBullet:w,bracket:x,selectionRectangle:S,selectionPolygon:O,selectionLine:T}},{"../chem/struct":33,"../raphael-ext":64,"../util":115,"../util/vec2":119}],66:[function(t,e,n){function r(t,e,n){this.userOpts=n,this.useOldZoom=Prototype.Browser.IE,this.scale=e||100,this.baseScale=this.scale,this.zoom=1,this.offset=new s,this.clientArea=t=$(t),this.paper=new i(t),this.dirty=!0,this.structChangeHandlers=[],this.ctab=new u(new l,this),this.options=c(e,this.userOpts)}function o(t,e,n,r,o){var i=e<0?-e:0,a=n<0?-n:0;return t.x<r&&(i+=r-t.x),t.y<o&&(a+=o-t.y),new s(i,a)}var i=t("../raphael-ext"),a=t("../util/box2abs"),s=t("../util/vec2"),l=t("../chem/struct"),u=t("./restruct"),c=t("./options"),p={debug:!1,logcnt:0,logmouse:!1,hl:!1};p.logMethod=function(){},r.prototype.addStructChangeHandler=function(t){if(t in this.structChangeHandlers)throw new Error("handler already present");this.structChangeHandlers.push(t)},r.prototype.scaled2obj=function(t){return t.scaled(1/this.options.scaleFactor)},r.prototype.obj2scaled=function(t){return t.scaled(this.options.scaleFactor)},r.prototype.view2obj=function(t,e){var n=this.scrollPos();return this.useOldZoom||(t=t.scaled(1/this.zoom),n=n.scaled(1/this.zoom)),t=e?t:t.add(n).sub(this.offset),this.scaled2obj(t)},r.prototype.obj2view=function(t,e){var n=this.obj2scaled(t);return n=e?n:n.add(this.offset).sub(this.scrollPos().scaled(1/this.zoom)),this.useOldZoom||(n=n.scaled(this.zoom)),n},r.prototype.scrollPos=function(){return new s(this.clientArea.scrollLeft,this.clientArea.scrollTop)},r.prototype.page2obj=function(t){var e=this.clientArea.cumulativeOffset(),n=new s(t.pageX-e.left,t.pageY-e.top);return this.view2obj(n)},r.prototype.setPaperSize=function(t){p.logMethod("setPaperSize"),this.sz=t,this.paper.setSize(t.x*this.zoom,t.y*this.zoom),this.setViewBox(this.zoom)},r.prototype.setOffset=function(t){p.logMethod("setOffset");var e=new s(t.x-this.offset.x,t.y-this.offset.y);this.clientArea.scrollLeft+=e.x,this.clientArea.scrollTop+=e.y,this.offset=t},r.prototype.setZoom=function(t){console.info("set zoom",t),this.zoom=t,this.paper.setSize(this.sz.x*t,this.sz.y*t),this.setViewBox(t)},r.prototype.setScrollOffset=function(t,e){var n=this.clientArea,r=n.clientWidth,i=n.clientHeight,a=o(this.sz.scaled(this.zoom),t,e,r+t,i+e).scaled(1/this.zoom);if(a.x>0||a.y>0){this.setPaperSize(this.sz.add(a));var l=new s(t<0?-t:0,e<0?-e:0).scaled(1/this.zoom);(l.x>0||l.y>0)&&(this.ctab.translate(l),this.setOffset(this.offset.add(l)))}n.scrollLeft=t,n.scrollTop=e,this.update(!1)},r.prototype.setScale=function(t){this.offset&&(this.offset=this.offset.scaled(1/t).scaled(this.zoom)),this.scale=this.baseScale*this.zoom,this.options=null,this.update(!0)},r.prototype.setViewBox=function(t){this.useOldZoom?this.setScale(t):this.paper.canvas.setAttribute("viewBox","0 0 "+this.sz.x+" "+this.sz.y)},r.prototype.setMolecule=function(t){p.logMethod("setMolecule"),this.paper.clear(),this.ctab=new u(t,this),this.offset=null,this.update(!1)},r.prototype.update=function(t,e){if(p.logMethod("update"),e=e||new s(this.clientArea.clientWidth||100,this.clientArea.clientHeight||100),this.dirty){if(this.options.autoScale){var n=this.ctab.molecule.getCoordBoundingBox(),r=n.max.y-n.min.y>0?.8*e.y/(n.max.y-n.min.y):100,o=n.max.x-n.min.x>0?.8*e.x/(n.max.x-n.min.x):100;this.scale=Math.min(r,o),this.options.maxBondLength>0&&this.scale>this.options.maxBondLength&&(this.scale=this.options.maxBondLength)}this.options=c(this.scale,this.userOpts),this.dirty=!1,t=!0}var i=(new Date).getTime(),l=this.ctab.update(t);this.ctab.setSelection(null);var u=(new Date).getTime()-i;if(t&&$("log")&&($("log").innerHTML=u.toString()+"\n"),l){var h=this.options.scaleFactor,f=this.ctab.getVBoxObj().transform(this.obj2scaled,this).translate(this.offset||new s);if(this.options.autoScale){var d=f.sz(),g=this.options.autoScaleMargin,m=new s(g,g),b=e;if(b.x<2*g+1||b.y<2*g+1)throw new Error("View box too small for the given margin");var v=Math.max(d.x/(b.x-2*g),d.y/(b.y-2*g));this.options.maxBondLength/v>1&&(v=1);var y=d.add(m.scaled(2*v));this.paper.setViewBox(f.pos().x-g*v-(b.x*v-y.x)/2,f.pos().y-g*v-(b.y*v-y.y)/2,b.x*v,b.y*v)}else{var w=s.UNIT.scaled(h),x=f.sz().length()>0?f.extend(w,w):f,S=new a(this.scrollPos(),e.scaled(1/this.zoom).sub(s.UNIT.scaled(20))),O=a.union(S,x);this.oldCb||(this.oldCb=new a);var T=O.sz().floor(),E=this.oldCb.p0.sub(O.p0).ceil();this.oldBb=f,this.sz&&T.x==this.sz.x&&T.y==this.sz.y||this.setPaperSize(T),this.offset=this.offset||new s,0==E.x&&0==E.y||(this.setOffset(this.offset.add(E)),this.ctab.translate(E))}}},e.exports=r},{"../chem/struct":33,"../raphael-ext":64,"../util/box2abs":114,"../util/vec2":119,"./options":67,"./restruct":68}],67:[function(t,e,n){function r(t,e){var n=t,r=Math.ceil(1.9*(n/6)),o=Math.ceil(.7*r),i={showAtomIds:!1,showBondIds:!1,showHalfBondIds:!1,showLoopIds:!1,hideChiralFlag:!1,showValenceWarnings:!0,autoScale:!1,autoScaleMargin:0,maxBondLength:0,atomColoring:!0,hideImplicitHydrogen:!1,hideTerminalLabels:!1,carbonExplicitly:!1,showCharge:!0,showHydrogenLabels:"on",showValence:!0,aromaticCircle:!0,scaleFactor:n,lineWidth:n/20,bondSpace:e.doubleBondWidth||n/7,stereoBond:e.stereoBondWidth||n/7,subFontSize:o,font:"30px Arial",fontsz:r,fontszsub:o,fontRLabel:1.2*r,fontRLogic:.7*r,lineattr:{stroke:"#000","stroke-width":e.bondThickness||n/20,"stroke-linecap":"round","stroke-linejoin":"round"},selectionStyle:{fill:"#7f7",stroke:"none"},highlightStyle:{stroke:"#0c0","stroke-width":.6*n/20},sgroupBracketStyle:{stroke:"darkgray","stroke-width":.5*n/20},lassoStyle:{stroke:"gray","stroke-width":"1px"},atomSelectionPlateRadius:1.2*r};return Object.assign({},i,e)}e.exports=r},{}],68:[function(t,e,n){function r(t,e){this.render=e,this.atoms=new f,this.bonds=new f,this.reloops=new f,this.rxnPluses=new f,this.rxnArrows=new f,this.frags=new f,this.rgroups=new f,this.sgroups=new f,this.sgroupData=new f,this.chiralFlags=new f,this.molecule=t||new y,this.initialized=!1,this.layers=[],this.initLayers(),this.connectedComponents=new d,this.ccFragmentType=new f;for(var n in r.maps)this[n+"Changed"]={};if(this.structChanged=!1,t.atoms.each(function(t,e){this.atoms.set(t,new x(e))},this),t.bonds.each(function(t,e){this.bonds.set(t,new S(e))},this),t.loops.each(function(t,e){this.reloops.set(t,new j(e))},this),t.rxnPluses.each(function(t,e){this.rxnPluses.set(t,new O(e))},this),t.rxnArrows.each(function(t,e){this.rxnArrows.set(t,new T(e))},this),t.frags.each(function(t,e){this.frags.set(t,new E(e))},this),t.rgroups.each(function(t,e){this.rgroups.set(t,new A(e))},this),t.sgroups.each(function(t,e){this.sgroups.set(t,new N(e)),"DAT"!=e.type||e.data.attached||this.sgroupData.set(t,new C(e))},this),t.isChiral&&!this.render.options.hideChiralFlag){var o=t.getCoordBoundingBox();this.chiralFlags.set(0,new P(new m(o.max.x,o.min.y-1)))}}function o(t){if(t)for(var e in r.maps)if(t[e]&&t[e].length>0)return!1;return!0}function i(t,e){if("set"==t.type)for(var n=0;n<t.length;++n)i(t[n],e);else Object.isUndefined(t.attrs)||("font-size"in t.attrs?t.attr("font-size",t.attrs["font-size"]*e):"stroke-width"in t.attrs&&t.attr("stroke-width",t.attrs["stroke-width"]*e)),t.scale(e,e,0,0)}function a(t,e){for(var n=0;n<t.paths.length;++n)i(t.paths[n],e)}function s(t,e,n,r){t.translateAbs(n,r),e.x+=n,e.y+=r}function l(t,e){var n=[];t.a.neighbors.each(function(t){var r=e.halfBonds.get(t);n.push(r.ang)}),n=n.sort(function(t,e){return t-e});for(var r=[],o=0;o<n.length-1;++o)r.push(n[(o+1)%n.length]-n[o]);r.push(n[0]-n[n.length-1]+2*Math.PI);var i=0,a=-Math.PI/2;for(o=0;o<n.length;++o)r[o]>i&&(i=r[o],a=n[o]+r[o]/2);return new m(Math.cos(a),Math.sin(a))}function u(t,e,n,r){for(var o=0,i=t.visel,a=0;a<i.exts.length;++a){var s=i.exts[a].translate(e);o=Math.max(o,m.shiftRayBox(e,n,s))}return o>0&&(e=e.addScaled(n,o+r)),e}function c(t,e,n,r){return 6==t&&6!=e&&(n>1||1==r)?-1:6==e&&6!=t&&(r>1||1==n)?1:e*n>t*r?-1:e*n<t*r?1:e>t?-1:1}function p(t,e){var n=t.halfBonds.get(e.b.hb1),r=t.halfBonds.get(e.b.hb2),o=(n.leftSin>.3?1:0)+(r.rightSin>.3?1:0),i=(r.leftSin>.3?1:0)+(n.rightSin>.3?1:0);return o>i?-1:o<i?1:(n.leftSin>.3?1:0)+(n.rightSin>.3?1:0)==1?1:0}var h=t("../../util/box2abs"),f=t("../../util/map"),d=t("../../util/pool"),g=t("../../util/set"),m=t("../../util/vec2"),b=t("../../util"),v=t("../../chem/element"),y=t("../../chem/struct"),w=t("../draw"),x=t("./reatom"),S=t("./rebond"),O=t("./rerxnplus"),T=t("./rerxnarrow"),E=t("./refrag"),A=t("./rergroup"),C=t("./redatasgroupdata"),P=t("./rechiralflag"),N=t("./resgroup"),j=t("./reloop"),R=b.tfx,B={background:0,selectionPlate:1,highlighting:2,warnings:3,data:4,indices:5};r.prototype.connectedComponentRemoveAtom=function(t,e){if(e=e||this.atoms.get(t),!(e.component<0)){var n=this.connectedComponents.get(e.component);g.remove(n,t),g.size(n)<1&&this.connectedComponents.remove(e.component),e.component=-1}},r.prototype.clearConnectedComponents=function(){this.connectedComponents.clear(),this.atoms.each(function(t,e){e.component=-1})},r.prototype.getConnectedComponent=function(t,e){for(var n="number"==typeof t.length?[].slice.call(t):[t],r=g.empty();n.length>0;)(function(){var t=n.pop();g.add(r,t);var o=this.atoms.get(t);o.component>=0&&g.add(e,o.component);for(var i=0;i<o.a.neighbors.length;++i){var a=this.molecule.halfBonds.get(o.a.neighbors[i]).end;g.contains(r,a)||n.push(a)}}).apply(this);return r},r.prototype.addConnectedComponent=function(t){var e=this.connectedComponents.add(t),n=g.empty(),r=this.getConnectedComponent(g.list(t),n);g.remove(n,e);var o=-1;return g.each(r,function(t){var n=this.atoms.get(t);if(n.component=e,n.a.rxnFragmentType!=-1){if(o!=-1&&n.a.rxnFragmentType!=o)throw new Error("reaction fragment type mismatch");o=n.a.rxnFragmentType}},this),this.ccFragmentType.set(e,o),e},r.prototype.removeConnectedComponent=function(t){return g.each(this.connectedComponents.get(t),function(t){this.atoms.get(t).component=-1},this),this.connectedComponents.remove(t)},r.prototype.connectedComponentMergeIn=function(t,e){g.each(e,function(e){this.atoms.get(e).component=t},this),g.mergeIn(this.connectedComponents.get(t),e)},r.prototype.assignConnectedComponents=function(){this.atoms.each(function(t,e){if(!(e.component>=0)){var n=g.empty(),r=this.getConnectedComponent(t,n);g.each(n,function(t){this.removeConnectedComponent(t)},this),this.addConnectedComponent(r)}},this)},r.prototype.connectedComponentGetBoundingBox=function(t,e,n){return e=e||this.connectedComponents.get(t),n=n||{min:null,max:null},g.each(e,function(t){var e=this.render.obj2scaled(this.atoms.get(t).a.pp);null==n.min?n.min=n.max=e:(n.min=n.min.min(e),n.max=n.max.max(e))},this),n},r.prototype.initLayers=function(){for(var t in B)this.layers[B[t]]=this.render.paper.rect(0,0,10,10).attr({class:t+"Layer",fill:"#000",opacity:"0.0"}).toFront()},r.prototype.addReObjectPath=function(t,e,n,r,o){if(n){var i=this.render.offset,a=o?h.fromRelBox(b.relBox(n.getBBox())):null,s=r&&a?a.translate(r.negated()):null;null!==i&&(n.translateAbs(i.x,i.y),a=a?a.translate(i):null),e.add(n,a,s),n.insertBefore(this.layers[B[t]])}},r.prototype.clearMarks=function(){for(var t in r.maps)this[t+"Changed"]={};this.structChanged=!1},r.prototype.markItemRemoved=function(){this.structChanged=!0},r.prototype.markBond=function(t,e){this.markItem("bonds",t,e)},r.prototype.markAtom=function(t,e){this.markItem("atoms",t,e)},r.prototype.markItem=function(t,e,n){var r=this[t+"Changed"];r[e]="undefined"!=typeof r[e]?Math.max(n,r[e]):n,this[t].has(e)&&this.clearVisel(this[t].get(e).visel)},r.prototype.clearVisel=function(t){for(var e=0;e<t.paths.length;++e)t.paths[e].remove();t.clear()},r.prototype.eachItem=function(t,e){for(var n in r.maps)this[n].each(function(n,r){t.call(e,r)})},r.prototype.getVBoxObj=function(t){if(t=t||{},o(t))for(var e in r.maps)t[e]=this[e].keys();var n=null;for(e in r.maps)t[e]&&t[e].forEach(function(t){var r=this[e].get(t).getVBoxObj(this.render);r&&(n=n?h.union(n,r):r.clone())},this);return n=n||new h(0,0,0,0)},r.prototype.translate=function(t){this.eachItem(function(e){e.visel.translate(t)})},r.prototype.scale=function(t){this.eachItem(function(e){a(e.visel,t)})},r.prototype.clearVisels=function(){this.eachItem(function(t){this.clearVisel(t.visel)},this)},r.prototype.checkStereoBold=function(t,e){var n=[e.b.begin,e.b.end].map(function(n){var r=this.molecule.atoms.get(n),o=e.findIncomingStereoUpBond(r,t,!1,this);return o<0?-1:r.neighbors[o]},this);b.assert(2===n.length),e.boldStereo=n[0]>=0&&n[1]>=0},r.prototype.checkStereoBoldBonds=function(){this.bonds.each(this.checkStereoBold,this)},r.prototype.update=function(t){t=t||!this.initialized;var e;t?function(){for(var t in r.maps){var e=this[t+"Changed"];this[t].each(function(t){e[t]=1},this)}}.call(this):function(){for(var t in r.maps){var n=this[t+"Changed"];for(e in n)this[t].has(e)||delete n[e]}}.call(this);for(e in this.atomsChanged)this.connectedComponentRemoveAtom(e);for(var n=this.frags.findAll(function(t,e){return!e.calcBBox(this.render.ctab,t,this.render)},this),o=0;o<n.length;++o){var i=n[o];this.clearVisel(this.frags.get(i).visel),this.frags.unset(i),this.molecule.frags.remove(i)}(function(){for(var t in r.maps){var n=this[t+"Changed"];for(e in n)this.clearVisel(this[t].get(e).visel),this.structChanged|=n[e]>0}}).call(this),this.structChanged&&this.render.structChangeHandlers.forEach(function(t){t.call()}),this.sgroups.each(function(t,e){this.clearVisel(e.visel),e.highlighting=null,e.selectionPlate=null},this),this.frags.each(function(t,e){this.clearVisel(e.visel)},this),this.rgroups.each(function(t,e){this.clearVisel(e.visel)},this),t&&(this.clearConnectedComponents(),this.molecule.initHalfBonds(),this.molecule.initNeighbors()),this.molecule.updateHalfBonds(new f(this.atomsChanged).findAll(function(t,e){return e>=0},this)),this.molecule.sortNeighbors(new f(this.atomsChanged).findAll(function(t,e){return e>=1},this)),this.assignConnectedComponents(),this.setHydrogenPos(),this.initialized=!0,this.verifyLoops();var a=t||this.structChanged;return a&&this.updateLoops(),this.setImplicitHydrogen(),this.setDoubleBondShift(),this.checkLabelsToShow(),this.checkStereoBoldBonds(),this.showLabels(),this.showBonds(),a&&this.showLoops(),this.showReactionSymbols(),this.showSGroups(),this.showFragments(),this.showRGroups(),this.chiralFlags.each(function(t,e){this.chiralFlagsChanged[t]>0&&e.draw(this.render)},this),this.clearMarks(),!0},r.prototype.setDoubleBondShift=function(){var t=this.molecule;for(var e in this.bondsChanged){var n,r,o=this.bonds.get(e);if(n=t.halfBonds.get(o.b.hb1).loop,r=t.halfBonds.get(o.b.hb2).loop,n>=0&&r>=0){var i=t.loops.get(n).dblBonds,a=t.loops.get(r).dblBonds,s=t.loops.get(n).hbs.length,l=t.loops.get(r).hbs.length;o.doubleBondShift=c(s,l,i,a)}else n>=0?o.doubleBondShift=-1:r>=0?o.doubleBondShift=1:o.doubleBondShift=p(t,o)}},r.prototype.updateLoops=function(){this.reloops.each(function(t,e){this.clearVisel(e.visel)},this);var t=this.molecule.findLoops();t.bondsToMark.forEach(function(t){this.markBond(t,1)},this),t.newLoops.forEach(function(t){this.reloops.set(t,new j(this.molecule.loops.get(t)))},this)},r.prototype.showLoops=function(){var t=this.render,e=t.options,n=t.paper,r=this.molecule;this.reloops.each(function(o,i){var a=i.loop;i.centre=new m,a.hbs.each(function(e){var n=r.halfBonds.get(e),o=this.bonds.get(n.bid),s=t.obj2scaled(this.atoms.get(n.begin).a.pp);o.b.type!=y.Bond.PATTERN.TYPE.AROMATIC&&(a.aromatic=!1),i.centre.add_(s)},this),a.convex=!0;for(var s=0;s<i.loop.hbs.length;++s){var l=r.halfBonds.get(a.hbs[s]),u=r.halfBonds.get(a.hbs[(s+1)%a.hbs.length]),c=Math.atan2(m.cross(l.dir,u.dir),m.dot(l.dir,u.dir));c>0&&(a.convex=!1)}if(i.centre=i.centre.scaled(1/a.hbs.length),i.radius=-1,a.hbs.each(function(e){var n=r.halfBonds.get(e),o=t.obj2scaled(this.atoms.get(n.begin).a.pp),a=t.obj2scaled(this.atoms.get(n.end).a.pp),s=m.diff(a,o).rotateSC(1,0).normalized(),l=m.dot(m.diff(o,i.centre),s);i.radius<0?i.radius=l:i.radius=Math.min(i.radius,l)},this),i.radius*=.7,a.aromatic){var p=null;if(a.convex&&e.aromaticCircle)p=n.circle(i.centre.x,i.centre.y,i.radius).attr({stroke:"#000","stroke-width":e.lineattr["stroke-width"]});else{var h="";for(s=0;s<a.hbs.length;++s){l=r.halfBonds.get(a.hbs[s]),u=r.halfBonds.get(a.hbs[(s+1)%a.hbs.length]),c=Math.atan2(m.cross(l.dir,u.dir),m.dot(l.dir,u.dir));var f=(Math.PI-c)/2,d=u.dir.rotate(f),g=t.obj2scaled(this.atoms.get(u.begin).a.pp),b=Math.sin(f),v=.1;Math.abs(b)<v&&(b=b*v/Math.abs(b));var w=e.bondSpace/b,x=g.addScaled(d,-w);h+=0==s?"M":"L",h+=R(x.x)+","+R(x.y)}h+="Z",p=n.path(h).attr({stroke:"#000","stroke-width":e.lineattr["stroke-width"],"stroke-dasharray":"- "})}this.addReObjectPath("data",i.visel,p,null,!0)}},this)},r.prototype.showReactionSymbols=function(){var t,e;for(e in this.rxnArrowsChanged)t=this.rxnArrows.get(e),this.showReactionArrow(e,t);for(e in this.rxnPlusesChanged)t=this.rxnPluses.get(e),this.showReactionPlus(e,t)},r.prototype.showReactionArrow=function(t,e){var n=this.render.obj2scaled(e.item.pp),r=w.arrow(this.render,new m(n.x-this.render.scale,n.y),new m(n.x+this.render.scale,n.y));e.visel.add(r,h.fromRelBox(b.relBox(r.getBBox())));var o=this.render.offset;null!=o&&r.translateAbs(o.x,o.y)},r.prototype.showReactionPlus=function(t,e){var n=this.render.obj2scaled(e.item.pp),r=w.plus(this.render,n);e.visel.add(r,h.fromRelBox(b.relBox(r.getBBox())));var o=this.render.offset;null!=o&&r.translateAbs(o.x,o.y)},r.prototype.showSGroups=function(){this.molecule.sGroupForest.getSGroupsBFS().reverse().forEach(function(t){var e=this.sgroups.get(t),n=e.item;if("MRV_IMPLICIT_H"!=n.data.fieldName){var r=this.render.ctab,o=e.draw(r,n);this.addReObjectPath("data",e.visel,o,null,!0),e.setHighlight(e.highlight,this.render)}},this)},r.prototype.showFragments=function(){this.frags.each(function(t,e){var n=e.draw(this.render,t);n&&this.addReObjectPath("data",e.visel,n,null,!0)},this)},r.prototype.showRGroups=function(){this.rgroups.each(function(t,e){var n=e.draw(this.render);for(var r in n)for(;n[r].length>0;)this.addReObjectPath(r,e.visel,n[r].shift(),null,!0)},this)},r.prototype.eachCC=function(t,e,n){this.connectedComponents.each(function(r,o){e&&this.ccFragmentType.get(r)!=e||t.call(n||this,r,o)},this)},r.prototype.getGroupBB=function(t){var e={min:null,max:null};return this.eachCC(function(t,n){e=this.connectedComponentGetBoundingBox(t,n,e)},t,this),e},
r.prototype.setHydrogenPos=function(){for(var t in this.atomsChanged){var e=this.atoms.get(t);if(0!=e.a.neighbors.length){for(var n=1,r=1,o=0,i=0,a=0;a<e.a.neighbors.length;++a){var s=this.molecule.halfBonds.get(e.a.neighbors[a]).dir;s.x<=0?(n=Math.min(n,Math.abs(s.y)),o++):(r=Math.min(r,Math.abs(s.y)),i++)}n<.51||r<.51?e.hydrogenOnTheLeft=r<n:e.hydrogenOnTheLeft=i>o}else{var l=v.getElementByLabel(e.a.label);null!=l&&(e.hydrogenOnTheLeft=v[l].putHydrogenOnTheLeft)}}},r.prototype.setImplicitHydrogen=function(){this.molecule.setImplicitHydrogen(Object.keys(this.atomsChanged))},r.prototype.loopRemove=function(t){if(this.reloops.has(t)){var e=this.reloops.get(t);this.clearVisel(e.visel);for(var n=[],r=0;r<e.loop.hbs.length;++r){var o=e.loop.hbs[r];if(this.molecule.halfBonds.has(o)){var i=this.molecule.halfBonds.get(o);i.loop=-1,this.markBond(i.bid,1),this.markAtom(i.begin,1),n.push(i.bid)}}this.reloops.unset(t),this.molecule.loops.remove(t)}},r.prototype.loopIsValid=function(t,e){var n=this.molecule.halfBonds,r=e.loop,o=!1;return r.hbs.each(function(e){n.has(e)&&n.get(e).loop===t||(o=!0)},this),!o},r.prototype.verifyLoops=function(){var t=[];this.reloops.each(function(e,n){this.loopIsValid(e,n)||t.push(e)},this);for(var e=0;e<t.length;++e)this.loopRemove(t[e])},r.prototype.showLabels=function(){var t=this.render,e=t.options;for(var n in this.atomsChanged){var r=this.atoms.get(n),o=t.obj2scaled(r.a.pp);if(r.showLabel&&r.show(t,n,this.addReObjectPath.bind(this)),r.a.attpnt){var i=l(r,this.molecule);r.attpnt(t,i,this.addReObjectPath.bind(this),u)}var a=r.aamText(),c=r.queryAttrsText();if(a=(c.length>0?c+"\n":"")+(a.length>0?"."+a+".":""),a.length>0){var p=t.paper.text(o.x,o.y,a).attr({font:e.font,"font-size":e.fontszsub,fill:"#000000"}),f=b.relBox(p.getBBox());w.recenterText(p,f);for(var d=l(r,this.molecule),g=r.visel,v=3,y=0;y<g.exts.length;++y)v=Math.max(v,m.shiftRayBox(o,d,g.exts[y].translate(o)));v+=m.shiftRayBox(o,d.negated(),h.fromRelBox(f)),d=d.scaled(8+v),s(p,f,d.x,d.y),this.addReObjectPath("data",r.visel,p,o,!0)}}},r.prototype.showBonds=function(){var t=this.render,e=t.options,n=t.paper;for(var r in this.bondsChanged){var o=this.bonds.get(r),i=this.molecule.halfBonds.get(o.b.hb1),a=this.molecule.halfBonds.get(o.b.hb2);this.bondRecalc(e,o),o.show(this),o.rbb=b.relBox(o.path.getBBox()),this.addReObjectPath("data",o.visel,o.path,null,!0);var s={};s.path=w.reactingCenter(this.render,o,i,a),s.path&&(s.rbb=b.relBox(s.path.getBBox()),this.addReObjectPath("data",o.visel,s.path,null,!0));var l={};l.path=w.topologyMark(this.render,o,i,a),l.path&&(l.rbb=b.relBox(l.path.getBBox()),this.addReObjectPath("data",o.visel,l.path,null,!0)),o.setHighlight(o.highlight,t);var u=.6*e.subFontSize,c=null,p=null;if(e.showBondIds){var h=m.lc(i.p,.5,a.p,.5,i.norm,u);c=n.text(h.x,h.y,r.toString()),p=b.relBox(c.getBBox()),w.recenterText(c,p),this.addReObjectPath("indices",o.visel,c)}if(e.showHalfBondIds){var f=m.lc(i.p,.8,a.p,.2,i.norm,u);c=n.text(f.x,f.y,o.b.hb1.toString()),p=b.relBox(c.getBBox()),w.recenterText(c,p),this.addReObjectPath("indices",o.visel,c);var d=m.lc(i.p,.2,a.p,.8,a.norm,u);c=n.text(d.x,d.y,o.b.hb2.toString()),p=b.relBox(c.getBBox()),w.recenterText(c,p),this.addReObjectPath("indices",o.visel,c)}if(e.showLoopIds&&!e.showBondIds){var g=m.lc(i.p,.5,a.p,.5,a.norm,u);c=n.text(g.x,g.y,i.loop.toString()),p=b.relBox(c.getBBox()),w.recenterText(c,p),this.addReObjectPath("indices",o.visel,c);var v=m.lc(i.p,.5,a.p,.5,i.norm,u);c=n.text(v.x,v.y,a.loop.toString()),p=b.relBox(c.getBBox()),w.recenterText(c,p),this.addReObjectPath("indices",o.visel,c)}}},r.prototype.setSelection=function(t){for(var e in r.maps)!r.maps[e].isSelectable()||t&&!t[e]||this[e].each(function(n,r){var o=t?t[e].indexOf(n)>-1:r.selected;this.showItemSelection(r,o)},this)},r.prototype.showItemSelection=function(t,e){var n=null!=t.selectionPlate&&!t.selectionPlate.removed;if(t.selected=e,t instanceof C&&(t.sgroup.selected=e),e){if(!n){var r=this.render,o=r.options,i=r.paper;t.selectionPlate=t.makeSelectionPlate(this,i,o),this.addReObjectPath("selectionPlate",t.visel,t.selectionPlate)}t.selectionPlate&&t.selectionPlate.show()}else n&&t.selectionPlate&&t.selectionPlate.hide()},r.prototype.labelIsVisible=function(t,e){var n=this.render.options,r="off"!==n.showHydrogenLabels&&"Hetero"!==n.showHydrogenLabels;if(0==e.a.neighbors.length||e.a.neighbors.length<2&&r||n.carbonExplicitly||"c"!=e.a.label.toLowerCase()||e.a.badConn&&n.showValenceWarnings||0!=e.a.isotope||0!=e.a.radical||0!=e.a.charge||e.a.explicitValence>=0||null!=e.a.atomList||null!=e.a.rglabel)return!0;if(2==e.a.neighbors.length){var o=e.a.neighbors[0],i=e.a.neighbors[1],a=this.molecule.halfBonds.get(o),s=this.molecule.halfBonds.get(i),l=this.bonds.get(a.bid),u=this.bonds.get(s.bid);if(l.b.type==u.b.type&&l.b.stereo==y.Bond.PATTERN.STEREO.NONE&&u.b.stereo==y.Bond.PATTERN.STEREO.NONE&&Math.abs(m.cross(a.dir,s.dir))<.2)return!0}return!1},r.prototype.checkLabelsToShow=function(){for(var t in this.atomsChanged){var e=this.atoms.get(t);e.showLabel=this.labelIsVisible(t,e)}},r.prototype.bondRecalc=function(t,e){var n=this.render,r=this.atoms.get(e.b.begin),o=this.atoms.get(e.b.end),i=n.obj2scaled(r.a.pp),a=n.obj2scaled(o.a.pp),s=this.molecule.halfBonds.get(e.b.hb1),l=this.molecule.halfBonds.get(e.b.hb2);s.p=u(r,i,s.dir,2*t.lineWidth),l.p=u(o,a,l.dir,2*t.lineWidth),e.b.center=m.lc2(r.a.pp,.5,o.a.pp,.5),e.b.len=m.dist(i,a),e.b.sb=5*t.lineWidth,e.b.sa=Math.max(e.b.sb,e.b.len/2-2*t.lineWidth),e.b.angle=180*Math.atan2(s.dir.y,s.dir.x)/Math.PI},r.maps={atoms:x,bonds:S,rxnPluses:O,rxnArrows:T,frags:E,rgroups:A,sgroupData:C,chiralFlags:P,sgroups:N,reloops:j},e.exports=Object.assign(r,{Atom:x,Bond:S,RxnPlus:O,RxnArrow:T,Frag:E,RGroup:A,ChiralFlag:P,SGroup:N})},{"../../chem/element":22,"../../chem/struct":33,"../../util":115,"../../util/box2abs":114,"../../util/map":116,"../../util/pool":117,"../../util/set":118,"../../util/vec2":119,"../draw":65,"./reatom":69,"./rebond":70,"./rechiralflag":71,"./redatasgroupdata":72,"./refrag":73,"./reloop":74,"./rergroup":76,"./rerxnarrow":77,"./rerxnplus":78,"./resgroup":79}],69:[function(t,e,n){function r(t){this.init("atom"),this.a=t,this.showLabel=!1,this.hydrogenOnTheLeft=!1,this.color="#000000",this.component=-1}function o(t,e){return!!("on"==t||"Terminal"==t&&e.a.neighbors.length<2||"Hetero"==t&&"c"!=e.label.text.toLowerCase()||"Terminal and Hetero"==t&&(e.a.neighbors.length<2||"c"!=e.label.text.toLowerCase()))}function i(t,e,n,r){t.translateAbs(n,r),e.x+=n,e.y+=r}var a=t("../../util/box2abs"),s=t("./reobject"),l=t("../../chem/element"),u=t("../draw"),c=t("../../util"),p=t("../../util/vec2");r.prototype=new s,r.isSelectable=function(){return!0},r.prototype.getVBoxObj=function(t){return this.visel.boundingBox?s.prototype.getVBoxObj.call(this,t):new a(this.a.pp,this.a.pp)},r.prototype.drawHighlight=function(t){var e=this.makeHighlightPlate(t);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},r.prototype.makeHighlightPlate=function(t){var e=t.paper,n=t.options,r=t.obj2scaled(this.a.pp);return e.circle(r.x,r.y,n.atomSelectionPlateRadius).attr(n.highlightStyle)},r.prototype.makeSelectionPlate=function(t,e,n){var r=t.render.obj2scaled(this.a.pp);return e.circle(r.x,r.y,n.atomSelectionPlateRadius).attr(n.selectionStyle)},r.prototype.show=function(t,e,n){var r=t.obj2scaled(this.a.pp),a=this.buildLabel(t),s=.5*t.options.lineWidth,l=a.rbb.width/2,p=-a.rbb.width/2,h=Math.floor(this.a.implicitH),f="H"==a.text,d=null;n("data",this.visel,a.path,r,!0);var g=null;if(t.options.showAtomIds&&(g={},g.text=e.toString(),g.path=t.paper.text(r.x,r.y,g.text).attr({font:t.options.font,"font-size":t.options.fontszsub,fill:"#070"}),g.rbb=c.relBox(g.path.getBBox()),u.recenterText(g.path,g.rbb),n("indices",this.visel,g.path,r)),this.setHighlight(this.highlight,t),f&&h>0&&(d=this.hydroIndex(t,h,l),l+=d.rbb.width+s,n("data",this.visel,d.path,r,!0)),0!=this.a.radical){var m=this.radical(t);n("data",this.visel,m.path,r,!0)}if(0!=this.a.isotope){var b=this.isotope(t,p);p-=b.rbb.width+s,n("data",this.visel,b.path,r,!0)}if(!f&&h>0&&o(t.options.showHydrogenLabels,this)){var v=this.hydrogen(t,h,{hydrogen:{},hydroIndex:d,rightMargin:l,leftMargin:p}),y=v.hydrogen;d=v.hydroIndex,l=v.rightMargin,p=v.leftMargin,n("data",this.visel,y.path,r,!0),null!=d&&n("data",this.visel,d.path,r,!0)}if(0!=this.a.charge&&t.options.showCharge){var w=this.charge(t,l);l+=w.rbb.width+s,n("data",this.visel,w.path,r,!0)}if(this.a.explicitValence>=0&&t.options.showValence){var x=this.explicitValence(t,l);l+=x.rbb.width+s,n("data",this.visel,x.path,r,!0)}if(this.a.badConn&&t.options.showValenceWarnings){var S=this.warning(t,p,l);n("warnings",this.visel,S.path,r,!0)}g&&i(g.path,g.rbb,-.5*a.rbb.width-.5*g.rbb.width-s,.3*a.rbb.height)},r.prototype.buildLabel=function(t){var e=t.obj2scaled(this.a.pp),n=t.options,r=t.paper,o={};if(this.color="black",null!=this.a.atomList)o.text=this.a.atomList.label();else if("R#"==this.a.label&&null!=this.a.rglabel){o.text="";for(var a=0;a<32;a++)this.a.rglabel&1<<a&&(o.text+="R"+(a+1).toString());""==o.text&&(o="R#")}else{o.text=this.a.label;var s=l.getElementByLabel(o.text);t.options.atomColoring&&s&&(this.color=l[s].color)}return o.path=r.text(e.x,e.y,o.text).attr({font:n.font,"font-size":n.fontsz,fill:this.color}),o.rbb=c.relBox(o.path.getBBox()),u.recenterText(o.path,o.rbb),null!=this.a.atomList&&i(o.path,o.rbb,(this.hydrogenOnTheLeft?-1:1)*(o.rbb.width-o.rbb.height)/2,0),this.label=o,o},r.prototype.hydroIndex=function(t,e,n){var r=t.obj2scaled(this.a.pp),o=t.options,a=.5*o.lineWidth,s={};return s.text=(e+1).toString(),s.path=t.paper.text(r.x,r.y,s.text).attr({font:o.font,"font-size":o.fontszsub,fill:this.color}),s.rbb=c.relBox(s.path.getBBox()),u.recenterText(s.path,s.rbb),i(s.path,s.rbb,n+.5*s.rbb.width+a,.2*this.label.rbb.height),s},r.prototype.radical=function(t){var e,n=t.obj2scaled(this.a.pp),r=t.options,o={};switch(this.a.radical){case 1:o.path=t.paper.set(),e=1.6*r.lineWidth,o.path.push(u.radicalBullet(t,n.add(new p((-e),0))),u.radicalBullet(t,n.add(new p(e,0)))),o.path.attr("fill",this.color);break;case 2:o.path=u.radicalBullet(t,n).attr("fill",this.color);break;case 3:o.path=t.paper.set(),e=1.6*r.lineWidth,o.path.push(u.radicalCap(t,n.add(new p((-e),0))),u.radicalCap(t,n.add(new p(e,0)))),o.path.attr("stroke",this.color)}o.rbb=c.relBox(o.path.getBBox());var a=-.5*(this.label.rbb.height+o.rbb.height);return 3==this.a.radical&&(a-=r.lineWidth/2),i(o.path,o.rbb,0,a),o},r.prototype.isotope=function(t,e){var n=t.obj2scaled(this.a.pp),r=t.options,o=.5*r.lineWidth,a={};return a.text=this.a.isotope.toString(),a.path=t.paper.text(n.x,n.y,a.text).attr({font:r.font,"font-size":r.fontszsub,fill:this.color}),a.rbb=c.relBox(a.path.getBBox()),u.recenterText(a.path,a.rbb),i(a.path,a.rbb,e-.5*a.rbb.width-o,-.3*this.label.rbb.height),a},r.prototype.charge=function(t,e){var n=t.obj2scaled(this.a.pp),r=t.options,o=.5*r.lineWidth,a={};a.text="";var s=Math.abs(this.a.charge);return 1!=s&&(a.text=s.toString()),this.a.charge<0?a.text+="–":a.text+="+",a.path=t.paper.text(n.x,n.y,a.text).attr({font:r.font,"font-size":r.fontszsub,fill:this.color}),a.rbb=c.relBox(a.path.getBBox()),u.recenterText(a.path,a.rbb),i(a.path,a.rbb,e+.5*a.rbb.width+o,-.3*this.label.rbb.height),a},r.prototype.explicitValence=function(t,e){var n={0:"0",1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI",7:"VII",8:"VIII",9:"IX",10:"X",11:"XI",12:"XII",13:"XIII",14:"XIV"},r=t.obj2scaled(this.a.pp),o=t.options,a=.5*o.lineWidth,s={};if(s.text=n[this.a.explicitValence],!s.text)throw new Error("invalid valence "+this.a.explicitValence.toString());return s.text="("+s.text+")",s.path=t.paper.text(r.x,r.y,s.text).attr({font:o.font,"font-size":o.fontszsub,fill:this.color}),s.rbb=c.relBox(s.path.getBBox()),u.recenterText(s.path,s.rbb),i(s.path,s.rbb,e+.5*s.rbb.width+a,-.3*this.label.rbb.height),s},r.prototype.hydrogen=function(t,e,n){var r=n.hydroIndex,o=this.hydrogenOnTheLeft,a=t.obj2scaled(this.a.pp),s=t.options,l=.5*s.lineWidth,p=n.hydrogen;return p.text="H",p.path=t.paper.text(a.x,a.y,p.text).attr({font:s.font,"font-size":s.fontsz,fill:this.color}),p.rbb=c.relBox(p.path.getBBox()),u.recenterText(p.path,p.rbb),o||(i(p.path,p.rbb,n.rightMargin+.5*p.rbb.width+l,0),n.rightMargin+=p.rbb.width+l),e>1&&(r={},r.text=e.toString(),r.path=t.paper.text(a.x,a.y,r.text).attr({font:s.font,"font-size":s.fontszsub,fill:this.color}),r.rbb=c.relBox(r.path.getBBox()),u.recenterText(r.path,r.rbb),o||(i(r.path,r.rbb,n.rightMargin+.5*r.rbb.width+l,.2*this.label.rbb.height),n.rightMargin+=r.rbb.width+l)),o&&(null!=r&&(i(r.path,r.rbb,n.leftMargin-.5*r.rbb.width-l,.2*this.label.rbb.height),n.leftMargin-=r.rbb.width+l),i(p.path,p.rbb,n.leftMargin-.5*p.rbb.width-l,0),n.leftMargin-=p.rbb.width+l),Object.assign(n,{hydrogen:p,hydroIndex:r})},r.prototype.warning=function(t,e,n){var r=t.obj2scaled(this.a.pp),o=.5*t.options.lineWidth,i=c.tfx,a={},s=r.y+this.label.rbb.height/2+o;return a.path=t.paper.path("M{0},{1}L{2},{3}",i(r.x+e),i(s),i(r.x+n),i(s)).attr(t.options.lineattr).attr({stroke:"#F00"}),a.rbb=c.relBox(a.path.getBBox()),a},r.prototype.attpnt=function(t,e,n,r){var o,i,s,l=Prototype.Browser.IE?"*":"∗",h=t.obj2scaled(this.a.pp),f=t.options,d=c.tfx;for(o=0,i=0;o<4;++o){var g="";if(this.a.attpnt&1<<o){for(g.length>0&&(g+=" "),g+=l,s=0;s<(0==o?0:o+1);++s)g+="'";var m=new p(h),b=h.addScaled(e,.7*f.scaleFactor),v=t.paper.text(b.x,b.y,g).attr({font:f.font,"font-size":f.fontsz,fill:this.color}),y=c.relBox(v.getBBox());u.recenterText(v,y);var w=e.negated();b=b.addScaled(w,p.shiftRayBox(b,w,a.fromRelBox(y))+f.lineWidth/2),m=r(this,m,e,f.lineWidth);var x=e.rotateSC(1,0),S=b.addScaled(x,.05*f.scaleFactor).addScaled(w,.09*f.scaleFactor),O=b.addScaled(x,-.05*f.scaleFactor).addScaled(w,.09*f.scaleFactor),T=t.paper.set();T.push(v,t.paper.path("M{0},{1}L{2},{3}M{4},{5}L{2},{3}L{6},{7}",d(m.x),d(m.y),d(b.x),d(b.y),d(S.x),d(S.y),d(O.x),d(O.y)).attr(t.options.lineattr).attr({"stroke-width":f.lineWidth/2})),n("indices",this.visel,T,h),e=e.rotate(Math.PI/6)}}},r.prototype.aamText=function(){var t="";if(this.a.aam>0&&(t+=this.a.aam),this.a.invRet>0)if(t.length>0&&(t+=","),1==this.a.invRet)t+="Inv";else{if(2!=this.a.invRet)throw new Error("Invalid value for the invert/retain flag");t+="Ret"}if(this.a.exactChangeFlag>0){if(t.length>0&&(t+=","),1!=this.a.exactChangeFlag)throw new Error("Invalid value for the exact change flag");t+="ext"}return t},r.prototype.queryAttrsText=function(){var t="";if(0!=this.a.ringBondCount)if(this.a.ringBondCount>0)t+="rb"+this.a.ringBondCount.toString();else if(this.a.ringBondCount==-1)t+="rb0";else{if(this.a.ringBondCount!=-2)throw new Error("Ring bond count invalid");t+="rb*"}if(0!=this.a.substitutionCount)if(t.length>0&&(t+=","),this.a.substitutionCount>0)t+="s"+this.a.substitutionCount.toString();else if(this.a.substitutionCount==-1)t+="s0";else{if(this.a.substitutionCount!=-2)throw new Error("Substitution count invalid");t+="s*"}if(this.a.unsaturatedAtom>0){if(t.length>0&&(t+=","),1!=this.a.unsaturatedAtom)throw new Error("Unsaturated atom invalid value");t+="u"}return this.a.hCount>0&&(t.length>0&&(t+=","),t+="H"+(this.a.hCount-1).toString()),t},e.exports=r},{"../../chem/element":22,"../../util":115,"../../util/box2abs":114,"../../util/vec2":119,"../draw":65,"./reobject":75}],70:[function(t,e,n){function r(t){this.init("bond"),this.b=t,this.doubleBondShift=0}function o(t,e,n){var r=[e.b.begin,e.b.end].map(function(r){var o=n.molecule.atoms.get(r),i=e.findIncomingStereoUpBond(o,t,!0,n);return i<0?-1:o.neighbors[i]},this);u.assert(2===r.length),e.neihbid1=n.atoms.get(e.b.begin).showLabel?-1:r[0],e.neihbid2=n.atoms.get(e.b.end).showLabel?-1:r[1]}function i(t,e,n){var r=e.molecule,i=null,a=r.halfBonds.get(n.b.hb1),u=r.halfBonds.get(n.b.hb2),c=!e.atoms.get(a.begin).showLabel,p=!e.atoms.get(u.begin).showLabel;switch(n.b.type){case s.Bond.PATTERN.TYPE.SINGLE:switch(n.b.stereo){case s.Bond.PATTERN.STEREO.UP:o(a.bid,n,e),i=n.boldStereo&&n.neihbid1>=0&&n.neihbid2>=0?l.bondSingleStereoBold(t,a,u,n,!1,r,c,p):l.bondSingleUp(t,a,u,n,r);break;case s.Bond.PATTERN.STEREO.DOWN:i=l.bondSingleDown(t,a,u);break;case s.Bond.PATTERN.STEREO.EITHER:i=l.bondSingleEither(t,a,u);break;default:i=l.bondSingle(t,a,u)}break;case s.Bond.PATTERN.TYPE.DOUBLE:o(a.bid,n,e),i=n.b.stereo===s.Bond.PATTERN.STEREO.NONE&&n.boldStereo&&n.neihbid1>=0&&n.neihbid2>=0?l.bondSingleStereoBold(t,a,u,n,!0,r,c,p):l.bondDouble(t,a,u,n,n.b.stereo===s.Bond.PATTERN.STEREO.CIS_TRANS,c,p);break;case s.Bond.PATTERN.TYPE.TRIPLE:i=l.bondTriple(t,a,u);break;case s.Bond.PATTERN.TYPE.AROMATIC:var h=a.loop>=0&&r.loops.get(a.loop).aromatic||u.loop>=0&&r.loops.get(u.loop).aromatic;i=h?l.bondSingle(t,a,u):l.bondAromatic(t,a,u,n.doubleBondShift,c,p);break;case s.Bond.PATTERN.TYPE.SINGLE_OR_DOUBLE:i=l.bondSingleOrDouble(t,a,u);break;case s.Bond.PATTERN.TYPE.SINGLE_OR_AROMATIC:i=l.bondSingleOrAromatic(t,a,u,n.doubleBondShift,c,p);break;case s.Bond.PATTERN.TYPE.DOUBLE_OR_AROMATIC:i=l.bondDoubleOrAromatic(t,a,u,n.doubleBondShift,c,p);break;case s.Bond.PATTERN.TYPE.ANY:i=l.bondAny(t,a,u);break;default:throw new Error("Bond type "+n.b.type+" not supported")}return i}var a=t("./reobject"),s=t("../../chem/struct"),l=t("../draw"),u=t("../../util");r.prototype=new a,r.isSelectable=function(){return!0},r.prototype.drawHighlight=function(t){var e=this.makeHighlightPlate(t);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},r.prototype.makeHighlightPlate=function(t){t.ctab.bondRecalc(t.options,this);var e=t.obj2scaled(this.b.center);return t.paper.circle(e.x,e.y,.8*t.options.atomSelectionPlateRadius).attr(t.options.highlightStyle)},r.prototype.makeSelectionPlate=function(t,e,n){t.bondRecalc(t.render.options,this);var r=t.render.obj2scaled(this.b.center);return e.circle(r.x,r.y,.8*n.atomSelectionPlateRadius).attr(n.selectionStyle)},r.prototype.show=function(t){var e={molecule:t.molecule,atoms:t.atoms,bonds:t.bonds};this.path=i(t.render,e,this)},r.prototype.findIncomingStereoUpBond=function(t,e,n,r){return t.neighbors.findIndex(function(t){var o=r.molecule.halfBonds.get(t),i=o.bid;if(i===e)return!1;var a=r.bonds.get(i);return a.b.type===s.Bond.PATTERN.TYPE.SINGLE&&a.b.stereo===s.Bond.PATTERN.STEREO.UP?a.b.end===o.begin||a.boldStereo&&n:!(a.b.type!==s.Bond.PATTERN.TYPE.DOUBLE||a.b.stereo!==s.Bond.PATTERN.STEREO.NONE||!n||!a.boldStereo)},this)},e.exports=r},{"../../chem/struct":33,"../../util":115,"../draw":65,"./reobject":75}],71:[function(t,e,n){function r(t){this.init("chiralFlag"),this.pp=t}var o=t("../../util/box2abs"),i=t("./reobject");r.prototype=new i,r.isSelectable=function(){return!0},r.prototype.highlightPath=function(t){var e=o.fromRelBox(this.path.getBBox()),n=e.p1.sub(e.p0),r=e.p0.sub(t.offset);return t.paper.rect(r.x,r.y,n.x,n.y)},r.prototype.drawHighlight=function(t){var e=this.highlightPath(t).attr(t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},r.prototype.makeSelectionPlate=function(t,e,n){return this.highlightPath(t.render).attr(n.selectionStyle)},r.prototype.draw=function(t){var e=t.paper,n=t.options,r=t.obj2scaled(this.pp);this.path=e.text(r.x,r.y,"Chiral").attr({font:n.font,"font-size":n.fontsz,fill:"#000"}),t.ctab.addReObjectPath("data",this.visel,this.path,null,!0)},e.exports=r},{"../../util/box2abs":114,"./reobject":75}],72:[function(t,e,n){function r(t){this.init("sgroupData"),this.sgroup=t}var o=t("./reobject");r.prototype=new o,r.isSelectable=function(){return!0},r.prototype.highlightPath=function(t){var e=this.sgroup.dataArea,n=t.obj2scaled(e.p0),r=t.obj2scaled(e.p1).sub(n);return t.paper.rect(n.x,n.y,r.x,r.y)},r.prototype.drawHighlight=function(t){var e=this.highlightPath(t).attr(t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},r.prototype.makeSelectionPlate=function(t,e,n){return this.highlightPath(t.render).attr(n.selectionStyle)},e.exports=r},{"./reobject":75}],73:[function(t,e,n){(function(n){function r(t){this.init("frag"),this.item=t}var o=t("../../util/box2abs"),i=t("../../util/vec2"),a=t("./reobject"),s=n.ui;r.prototype=new a,r.isSelectable=function(){return!1},r.prototype.fragGetAtoms=function(t,e){var n=[];return t.ctab.atoms.each(function(t,r){r.a.fragment==e&&n.push(t)},this),n},r.prototype.fragGetBonds=function(t,e){var n=[];return t.ctab.bonds.each(function(r,o){t.ctab.atoms.get(o.b.begin).a.fragment==e&&t.ctab.atoms.get(o.b.end).a.fragment==e&&n.push(r)},this),n},r.prototype.calcBBox=function(t,e,n){var r;return t.atoms.each(function(t,a){if(a.a.fragment==e){var l=a.visel.boundingBox;if(l)n||(console.warn("No boundingBox fragment precalc"),n=s.render),l=l.translate((n.offset||new i).negated()).transform(n.scaled2obj,n);else{l=new o(a.a.pp,a.a.pp);var u=new i(.05*3,.05*3);l=l.extend(u,u)}r=r?o.union(r,l):l}}),r},r.prototype._draw=function(t,e,n){var r=this.calcBBox(t.ctab,e,t);if(r){var o=t.obj2scaled(new i(r.p0.x,r.p0.y)),a=t.obj2scaled(new i(r.p1.x,r.p1.y));return t.paper.rect(o.x,o.y,a.x-o.x,a.y-o.y,0).attr(n)}console.assert(null,"Empty fragment")},r.prototype.draw=function(t){return null},r.prototype.drawHighlight=function(t){},r.prototype.setHighlight=function(t,e){var n=e.ctab.frags.keyOf(this);Object.isUndefined(n)||(e.ctab.atoms.each(function(r,o){o.a.fragment==n&&o.setHighlight(t,e)},this),e.ctab.bonds.each(function(r,o){e.ctab.atoms.get(o.b.begin).a.fragment==n&&o.setHighlight(t,e)},this))},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util/box2abs":114,"../../util/vec2":119,"./reobject":75}],74:[function(t,e,n){function r(t){this.loop=t,this.visel=new i("loop"),this.centre=new o,this.radius=new o}var o=t("../../util/vec2"),i=t("./visel"),a=t("./reobject");r.prototype=new a,r.isSelectable=function(){return!1},e.exports=r},{"../../util/vec2":119,"./reobject":75,"./visel":80}],75:[function(t,e,n){function r(){}var o=t("./visel"),i=t("../../util");r.prototype.init=function(t){this.visel=new o(t),this.highlight=!1,this.highlighting=null,this.selected=!1,this.selectionPlate=null},r.prototype.getVBoxObj=function(t){var e=this.visel.boundingBox;return i.isNull(e)?null:(t.offset&&(e=e.translate(t.offset.negated())),e.transform(t.scaled2obj,t))},r.prototype.setHighlight=function(t,e){if(t){var n="highlighting"in this&&null!=this.highlighting;n&&(n="set"==this.highlighting.type?!this.highlighting[0].removed:!this.highlighting.removed),n?this.highlighting.show():(e.paper.setStart(),this.drawHighlight(e),this.highlighting=e.paper.setFinish())}else this.highlighting&&this.highlighting.hide();this.highlight=t},r.prototype.drawHighlight=function(){console.assert("ReObject.drawHighlight is not overridden")},r.prototype.makeSelectionPlate=function(){console.assert(null,"ReObject.makeSelectionPlate is not overridden")},e.exports=r},{"../../util":115,"./visel":80}],76:[function(t,e,n){function r(t){this.init("rgroup"),this.labelBox=null,this.item=t}function o(t,e,n,r){r=e.obj2scaled(r||new a(1,0));var o=Math.min(.25,.3*n.sz().x),i=n.p1.y-n.p0.y,s=.5*(n.p1.y+n.p0.y),u=l.bracket(e,r.negated(),r.negated().rotateSC(1,0),e.obj2scaled(new a(n.p0.x,s)),o,i),c=l.bracket(e,r,r.rotateSC(1,0),e.obj2scaled(new a(n.p1.x,s)),o,i);return t.push(u,c)}var i=t("../../util/box2abs"),a=t("../../util/vec2"),s=t("../../util"),l=t("../draw"),u=t("./reobject"),c=new a(.05*3,.05*3);r.prototype=new u,r.isSelectable=function(){return!1},r.prototype.getAtoms=function(t){var e=[];return this.item.frags.each(function(n,r){e=e.concat(t.ctab.frags.get(r).fragGetAtoms(t,r))}),e},r.prototype.getBonds=function(t){var e=[];return this.item.frags.each(function(n,r){e=e.concat(t.ctab.frags.get(r).fragGetBonds(t,r))}),e},r.prototype.calcBBox=function(t){var e;return this.item.frags.each(function(n,r){var o=t.ctab.frags.get(r).calcBBox(t.ctab,r,t);o&&(e=e?i.union(e,o):o)}),e=e.extend(c,c)},r.prototype.draw=function(t){var e=this.calcBBox(t),n=t.options;if(e){var r={data:[]},a=t.obj2scaled(e.p0),l=t.obj2scaled(e.p1),u=t.paper.set();o(u,t,e),r.data.push(u);var c=t.ctab.rgroups.keyOf(this),p=t.paper.set(),h=t.paper.text(a.x,(a.y+l.y)/2,"R"+c+"=").attr({font:n.font,"font-size":n.fontRLabel,fill:"black"}),f=s.relBox(h.getBBox());h.translateAbs(-f.width/2-n.lineWidth,0),p.push(h);var d={font:n.font,"font-size":n.fontRLogic,fill:"black"},g=[];g.push((this.item.ifthen>0?"IF ":"")+"R"+c.toString()+(this.item.range.length>0?this.item.range.startsWith(">")||this.item.range.startsWith("<")||this.item.range.startsWith("=")?this.item.range:"="+this.item.range:">0")+(this.item.resth?" (RestH)":"")+(this.item.ifthen>0?"\nTHEN R"+this.item.ifthen.toString():""));for(var m=f.height/2+n.lineWidth/2,b=0;b<g.length;++b){var v=t.paper.text(a.x,(a.y+l.y)/2,g[b]).attr(d),y=s.relBox(v.getBBox());m+=y.height/2,v.translateAbs(-y.width/2-6*n.lineWidth,m),m+=y.height/2+n.lineWidth/2,r.data.push(v),p.push(v)}return r.data.push(h),this.labelBox=i.fromRelBox(p.getBBox()).transform(t.scaled2obj,t),r}return{}},r.prototype._draw=function(t,e,n){var r=this.getVBoxObj(t).extend(c,c);if(r){var o=t.obj2scaled(r.p0),i=t.obj2scaled(r.p1);return t.paper.rect(o.x,o.y,i.x-o.x,i.y-o.y,0).attr(n)}},r.prototype.drawHighlight=function(t){var e=t.ctab.rgroups.keyOf(this);if(!Object.isUndefined(e)){var n=this._draw(t,e,t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,n),this.item.frags.each(function(e,n){t.ctab.frags.get(n).drawHighlight(t)},this),n}},e.exports=r},{"../../util":115,"../../util/box2abs":114,"../../util/vec2":119,"../draw":65,"./reobject":75}],77:[function(t,e,n){function r(t){this.init("rxnArrow"),this.item=t}var o=t("./reobject");r.prototype=new o,r.isSelectable=function(){return!0},r.prototype.highlightPath=function(t){var e=t.obj2scaled(this.item.pp),n=t.options.scaleFactor;return t.paper.rect(e.x-n,e.y-n/4,2*n,n/2,n/8)},r.prototype.drawHighlight=function(t){var e=this.highlightPath(t).attr(t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},r.prototype.makeSelectionPlate=function(t,e,n){return this.highlightPath(t.render).attr(n.selectionStyle)},e.exports=r},{"./reobject":75}],78:[function(t,e,n){function r(t){this.init("rxnPlus"),this.item=t}var o=t("./reobject");r.prototype=new o,r.isSelectable=function(){return!0},r.prototype.highlightPath=function(t){var e=t.obj2scaled(this.item.pp),n=t.options.scaleFactor;return t.paper.rect(e.x-n/4,e.y-n/4,n/2,n/2,n/8)},r.prototype.drawHighlight=function(t){var e=this.highlightPath(t).attr(t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},r.prototype.makeSelectionPlate=function(t,e,n){return this.highlightPath(t.render).attr(n.selectionStyle)},e.exports=r},{"./reobject":75}],79:[function(t,e,n){function r(t){this.init("sgroup"),this.item=t}function o(t,e,n,r,o,i,a,s,l,u,c){function h(n,r){var o=e.obj2scaled(S.c.addScaled(S.n,r*S.h)),i=e.paper.text(o.x,o.y,n).attr({font:e.options.font,"font-size":e.options.fontszsub});c&&i.attr(c);var a=p.fromRelBox(d.relBox(i.getBBox())),s=Math.max(f.shiftRayBox(o,S.d.negated(),a),3)+2;i.translateAbs(s*S.d.x,s*S.d.y),t.push(i)}for(var b=g.SGroup.getBracketParameters(e.ctab.molecule,r,o,i,a,s,e,n.id),v=-1,y=0;y<b.length;++y){var w=b[y],x=m.bracket(e,e.obj2scaled(w.d),e.obj2scaled(w.n),e.obj2scaled(w.c),w.w,w.h);t.push(x),(v<0||b[v].d.x<w.d.x||b[v].d.x==w.d.x&&b[v].d.y>w.d.y)&&(v=y)}var S=b[v];l&&h(l,.5),u&&h(u,-.5)}function i(t,e){var n=t.render,r=n.paper.set(),i=[],a=[],s=h.fromList(e.atoms);g.SGroup.getCrossBonds(i,a,t.molecule,s),g.SGroup.bracketPos(e,n,t.molecule,a);var l=e.bracketBox,u=e.bracketDir,c=u.rotateSC(1,0);return e.areas=[l],new o(r,n,e,a,s,l,u,c,e.data.mul),r}function a(t,e){var n=t.render,r=n.paper.set(),i=[],a=[],s=h.fromList(e.atoms);g.SGroup.getCrossBonds(i,a,t.molecule,s),g.SGroup.bracketPos(e,n,t.molecule,a);var l=e.bracketBox,u=e.bracketDir,c=u.rotateSC(1,0);e.areas=[l];var p=e.data.connectivity||"eu";"ht"==p&&(p="");var f=e.data.subscript||"n";return new o(r,n,e,a,s,l,u,c,f,p),r}function s(t,e){var n=t.render,r=n.paper.set(),i=[],a=[],s=h.fromList(e.atoms);g.SGroup.getCrossBonds(i,a,t.molecule,s),g.SGroup.bracketPos(e,n,t.molecule,a);var l=e.bracketBox,u=e.bracketDir,c=u.rotateSC(1,0);return e.areas=[l],new o(r,n,e,a,s,l,u,c,e.data.name,null,{"font-style":"italic"}),r}function l(t,e){var n=t.render,r=n.paper,i=r.set(),a=[],s=[],l=h.fromList(e.atoms);g.SGroup.getCrossBonds(a,s,t.molecule,l),g.SGroup.bracketPos(e,n,t.molecule,s);var u=e.bracketBox,c=e.bracketDir,p=c.rotateSC(1,0);return e.areas=[u],new o(i,n,e,s,l,u,c,p),i}function u(t,e,n,r){var o=t.text(e.x,e.y,n.data.fieldValue).attr({font:r.font,"font-size":r.fontsz}),i=o.getBBox(),a=t.rect(i.x-1,i.y-1,i.width+2,i.height+2,3,3);a=n.selected?a.attr(r.selectionStyle):a.attr({fill:"#fff",stroke:"#fff"});var s=t.set();return s.push(a,o.toFront()),s}function c(t,e){var n,r=t.render,o=r.options,i=r.paper,a=i.set(),s=g.SGroup.getAtoms(t,e);g.SGroup.bracketPos(e,r,t.molecule),e.areas=e.bracketBox?[e.bracketBox]:[],null==e.pp&&g.SGroup.setPos(t,e,e.bracketBox.p1.add(new f(.5,.5)));var l=e.pp.scaled(o.scaleFactor);if(e.data.attached)for(n=0;n<s.length;++n){var c=t.atoms.get(s[n]),h=r.obj2scaled(c.a.pp),m=c.visel.boundingBox;null!=m&&(h.x=Math.max(h.x,m.p1.x)),h.x+=o.lineWidth;var v=u(i,h,e,o),y=d.relBox(v.getBBox());v.translateAbs(.5*y.width,-.3*y.height),a.push(v);var w=p.fromRelBox(d.relBox(v.getBBox()));w=w.transform(r.scaled2obj,r),e.areas.push(w)}else{var x=u(i,l,e,o),S=d.relBox(x.getBBox());x.translateAbs(.5*S.width,-.5*S.height),a.push(x);var O=p.fromRelBox(d.relBox(x.getBBox()));e.dataArea=O.transform(r.scaled2obj,r),t.sgroupData.has(e.id)||t.sgroupData.set(e.id,new b(e))}return a}var p=t("../../util/box2abs"),h=t("../../util/set"),f=t("../../util/vec2"),d=t("../../util"),g=t("../../chem/struct"),m=t("../draw"),b=t("./redatasgroupdata"),v=t("./reobject"),y=d.tfx;r.prototype=new v,r.isSelectable=function(){return!1},r.prototype.draw=function(t,e){return w[e.type](t,e)};var w={MUL:i,SRU:a,SUP:s,DAT:c,GEN:l};r.prototype.drawHighlight=function(t){var e=t.options,n=t.paper,r=this.item,o=r.bracketBox.transform(t.obj2scaled,t),i=e.lineWidth,a=new f(4*i,6*i);o=o.extend(a,a);var s=r.bracketDir,l=s.rotateSC(1,0),u=f.lc2(s,o.p0.x,l,o.p0.y),c=f.lc2(s,o.p0.x,l,o.p1.y),p=f.lc2(s,o.p1.x,l,o.p0.y),h=f.lc2(s,o.p1.x,l,o.p1.y),d=n.set();r.highlighting=n.path("M{0},{1}L{2},{3}L{4},{5}L{6},{7}L{0},{1}",y(u.x),y(u.y),y(c.x),y(c.y),y(h.x),y(h.y),y(p.x),y(p.y)).attr(e.highlightStyle),d.push(r.highlighting),g.SGroup.getAtoms(t.ctab.molecule,r).each(function(e){d.push(t.ctab.atoms.get(e).makeHighlightPlate(t))},this),g.SGroup.getBonds(t.ctab.molecule,r).each(function(e){d.push(t.ctab.bonds.get(e).makeHighlightPlate(t))},this),t.ctab.addReObjectPath("highlighting",this.visel,d)},e.exports=r},{"../../chem/struct":33,"../../util":115,"../../util/box2abs":114,"../../util/set":118,"../../util/vec2":119,"../draw":65,"./redatasgroupdata":72,"./reobject":75}],80:[function(t,e,n){function r(t){this.type=t,this.paths=[],this.boxes=[],this.boundingBox=null}var o=t("../../util/box2abs"),i=t("../../util/vec2");r.prototype.add=function(t,e,n){this.paths.push(t),e&&(this.boxes.push(e),this.boundingBox=null==this.boundingBox?e:o.union(this.boundingBox,e)),n&&this.exts.push(n)},r.prototype.clear=function(){this.paths=[],this.boxes=[],this.exts=[],this.boundingBox=null},r.prototype.translate=function(t,e){if(arguments.length>2)throw new Error("One vector or two scalar arguments expected");if(void 0===e)this.translate(t.x,t.y);else{for(var n=new i(t,e),r=0;r<this.paths.length;++r)this.paths[r].translateAbs(t,e);for(var o=0;o<this.boxes.length;++o)this.boxes[o]=this.boxes[o].translate(n);null!==this.boundingBox&&(this.boundingBox=this.boundingBox.translate(n))}},e.exports=r},{"../../util/box2abs":114,"../../util/vec2":119}],81:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){
if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=t("preact"),u=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state.active=t.active?t.active:{},n}return a(e,t),s(e,[{key:"onActive",value:function(t,e){var n={};n[e]=!this.state.active[e],this.setState({active:Object.assign(this.state.active,n)}),this.props.onActive&&this.props.onActive()}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,o=e.captions,i=r(e,["children","captions"]);return(0,l.h)("ul",i,o.map(function(e,r){return(0,l.h)("li",{className:"tab"},(0,l.h)("a",{className:t.state.active[r]?"active":"",onClick:function(e){return t.onActive(e,r)}},e),t.state.active[r]?n[r]:null)}))}}]),e}(l.Component);n.default=u},{preact:17}],82:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=t("preact"),u=t("w3c-keyname"),c=r(u),p=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"exit",value:function(t){var e=this.props,n=e.params,r=e.result,o=void 0===r?function(){return null}:r,i=e.valid,a=void 0===i?function(){return!!o()}:i,s="OK"==t?"onOk":"onCancel";n&&s in n&&("onOk"!=s||a())&&n[s](o())}},{key:"keyDown",value:function(t){var e=(0,c.default)(t),n=document.activeElement,r=n&&"TEXTAREA"==n.tagName;(e.startsWith("Esc")||"Enter"==e&&!r)&&(this.exit("Enter"==e?"OK":"Cancel"),t.preventDefault()),t.stopPropagation()}},{key:"componentDidMount",value:function(){var t=this.base.querySelector(["input:not([type=button])","textarea","[contenteditable]"].join(","))||this.base.querySelector(["select","button:not(.close)","input"].join(","));console.assert(t,"No active buttons"),t.focus()}},{key:"render",value:function(){var t=this;console.info("dialog render");var e=this.props,n=e.children,r=e.caption,o=e.name,i=e.params,a=void 0===i?{}:i,s=e.result,u=void 0===s?function(){return null}:s,c=e.valid,p=void 0===c?function(){return!!u()}:c,h=e.buttons,f=void 0===h?["Cancel","OK"]:h;return(0,l.h)("form",{role:"dialog",className:o,onSubmit:function(t){return t.preventDefault()},onKeyDown:function(e){return t.keyDown(e)}},(0,l.h)("header",null,r,a.onCancel&&r&&(0,l.h)("button",{className:"close",onClick:function(){return t.exit("Cancel")}},"×")),n,(0,l.h)("footer",null,f.map(function(e){return"string"!=typeof e?e:(0,l.h)("input",{type:"button",value:e,disabled:"OK"==e&&!p(),onClick:function(){return t.exit(e)}})})))}}]),e}(l.Component);n.default=p},{preact:17,"w3c-keyname":20}],83:[function(t,e,n){(function(e){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){return new Promise(function(n,r){if(e.FileReader)n(l);else if(e.ActiveXObject)try{var o=new ActiveXObject("Scripting.FileSystemObject");n(function(t){return Promise.resolve(u(o,t))})}catch(t){r(t)}else t?n(t.then(function(){throw"Server doesn't still support echo method"})):r(new Error("Your browser does not support opening files locally"))})}function l(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(n){var o=r.result;t.msClose&&t.msClose(),e(o)},r.onerror=function(t){n(t)},r.readAsText(t,"UTF-8")})}function u(t,e){var n=t.OpenTextFile(e.name,1),r=n.ReadAll();return n.Close(),r}Object.defineProperty(n,"__esModule",{value:!0});var c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},p=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),h=t("preact"),f=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return s(t.server).then(function(t){n.setState({opener:t})}),n}return a(e,t),p(e,[{key:"open",value:function(t){var e=t.target.files,n=function(){return null},r=this.props,o=r.onLoad,i=void 0===o?n:o,a=r.onError,s=void 0===a?n:a;this.state.opener&&e.length&&this.state.opener(e[0]).then(i,s),t.preventDefault()}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,o=e.type,i=r(e,["children","type"]);return(0,h.h)("label",c({disabled:!this.state.opener},i),n,(0,h.h)("input",{onChange:function(e){return t.open(e)},accept:o,type:"file"}))}}]),e}(h.Component);n.default=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{preact:17}],84:[function(t,e,n){(function(e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(t){return new Promise(function(n,r){e.Blob&&f.default.saveAs?n(function(t,e,n){var r=new Blob([t],{type:n});f.default.saveAs(r,e)}):t?n(t.then(function(){throw"Server doesn't still support echo method"})):r(new Error("Your browser does not support opening files locally"))})}Object.defineProperty(n,"__esModule",{value:!0});var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),p=t("preact"),h=t("filesaver.js"),f=r(h),d=function(t){function e(t){var n=t.filename,r=void 0===n?"unnamed":n,s=t.type,c=void 0===s?"text/plain":s,p=t.className,h=void 0===p?"":p,f=o(t,["filename","type","className"]);i(this,e);var d=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,u({filename:r,type:c,className:h},f)));return l(f.server).then(function(t){d.setState({saver:t})}),d}return s(e,t),c(e,[{key:"save",value:function(t){var e=function(){return null},n=this.props,r=n.filename,o=n.data,i=n.type,a=n.onSave,s=void 0===a?e:a,l=n.onError,u=void 0===l?e:l;if(this.state.saver&&o)try{this.state.saver(o,r,i),s()}catch(t){u(t)}t.preventDefault()}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,r=e.filename,i=e.data,a=e.className,s=o(e,["children","filename","data","className"]);return this.state.saver&&i||(a="disabled "+a),(0,p.h)("a",u({download:r,onClick:function(e){return t.save(e)},className:a},s),n)}}]),e}(p.Component);n.default=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"filesaver.js":2,preact:17}],85:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t){var e=(t.children,t.options),n=t.onChange,o=t.value,s=r(t,["children","options","onChange","value"]);return(0,a.h)("ul",i({},s,{tabindex:"0"}),e.map(function(t,e){return(0,a.h)("li",{onClick:function(){return n(t,e)},className:t==o?"selected":""},t)}))}Object.defineProperty(n,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a=t("preact");n.default=o},{preact:17}],86:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t){var e=r(t,[]);return(0,a.h)("div",i({className:"spinner"},e))}Object.defineProperty(n,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a=t("preact");n.default=o},{preact:17}],87:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t)if(e.prerender)t.innerHTML=e.prerender;else{console.info("render!",t.clientWidth,t.clientWidth);var r=new b.default(t,0,c({autoScale:!0},n));r.setMolecule(e),r.update()}}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},p=t("preact"),h=t("../../chem/struct"),f=r(h),d=t("../../chem/molfile"),g=r(d),m=t("../../render"),b=r(m),v=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(!(t.struct instanceof f.default))try{n.props.struct=g.default.parse(t.struct)}catch(t){alert("Could not parse structure\n"+t),n.props.struct=null}return n}return s(e,t),u(e,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"componentDidMount",value:function(){var t=this.refs?this.refs.base:this.base,e=this.props,n=e.struct,r=e.options;l(t,n,r)}},{key:"render",value:function(){var t=this.props,e=t.struct,n=t.Tag,r=void 0===n?"div":n,i=o(t,["struct","Tag"]);return(0,p.h)(r,i,e?null:"No molecule")}}]),e}(p.Component);n.default=v},{"../../chem/molfile":24,"../../chem/struct":33,"../../render":66,preact:17}],88:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(){var t=f.map(function(t){var e=new h.default(t);return e.check().then(function(){return t},function(){return null})});return Promise.all(t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=t("preact"),p=t("font-face-observer"),h=r(p),f=["Arial","Arial Black","Comic Sans MS","Courier New","Georgia","Impact","Charcoal","Lucida Console","Monaco","Palatino Linotype","Book Antiqua","Palatino","Tahoma","Geneva","Times New Roman","Times","Verdana","Symbol","MS Serif","MS Sans Serif","New York","Droid Sans","Droid Serif","Droid Sans Mono","Roboto"],d=null,g=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),r=JSON.parse(localStorage.getItem("ketcher-opts")),o=r?r.font.substring(r.font.indexOf("px ")+3):"Arial";return n.state={availableFonts:[o]},n.setAvailableFonts(),n}return s(e,t),u(e,[{key:"setAvailableFonts",value:function(){var t=this;d?this.setState({availableFonts:d}):l().then(function(e){d=e.filter(function(t){return null!==t}),t.setState({availableFonts:d})})}},{key:"render",value:function(){var t=this.props,e=t.current,n=o(t,["current"]),r=this.state.availableFonts.map(function(t){return"30px "+t==e?(0,c.h)("option",{value:t,selected:!0},t):(0,c.h)("option",{value:t},t)});return(0,c.h)("select",n,r)}}]),e}(c.Component);n.default=g},{"font-face-observer":10,preact:17}],89:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=t("preact"),u=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state.tabIndex=0,n}return a(e,t),s(e,[{key:"changeTab",value:function(t,e){this.setState({tabIndex:e}),this.props.changeTab&&this.props.changeTab(e)}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,o=e.captions,i=r(e,["children","captions"]);return(0,l.h)("ul",i,(0,l.h)("li",{className:"tabs"},o.map(function(e,n){return(0,l.h)("a",{className:t.state.tabIndex==n?"active":"",onClick:function(e){return t.changeTab(e,n)}},e)})),(0,l.h)("li",{className:"tabs-content"},n[this.state.tabIndex]))}}]),e}(l.Component);n.default=u},{preact:17}],90:[function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("preact"),c="position:relative; overflow:hidden; width:100%; min-height:100%;",p="position:absolute; top:0; left:0; height:100%; width:100%; overflow:visible;",h=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.resize=function(t,e){var r=n.base.offsetHeight;n.state.height!==r&&n.setState({height:r}),e&&(n.setState({offset:0}),n.base.scrollTop=0)},n.handleScroll=function(){n.setState({offset:n.base.scrollTop}),n.props.sync&&n.forceUpdate()},n.state={offset:0,height:0},n}return a(e,t),l(e,[{key:"componentDidUpdate",value:function(t){var e=t.data,n=e.length==this.props.data.length&&this.props.data.every(function(t,n){return t===e[n]});this.resize(null,!n)}},{key:"componentDidMount",value:function(){this.resize(),addEventListener("resize",this.resize)}},{key:"componentWillUnmount",value:function(){removeEventListener("resize",this.resize)}},{key:"render",value:function(){var t=this.props,e=t.data,n=t.rowHeight,o=t.children,i=t.Tag,a=void 0===i?"div":i,l=t.overscanCount,h=void 0===l?1:l,f=(t.sync,r(t,["data","rowHeight","children","Tag","overscanCount","sync"])),d=this.state,g=d.offset,m=d.height,b=g/n||0,v=o[0],y=m/n||0;h&&(b=Math.max(0,b-b%h),y+=h);var w=b+1+y,x=e.slice(b,w);return(0,u.h)("div",s({onScroll:this.handleScroll},f),(0,u.h)("div",{style:c+" height:"+e.length*n+"px;"},(0,u.h)(a,{style:p+" top:"+b*n+"px;"},x.map(function(t,e){return v(t,b+e)}))))}}]),e}(u.Component);n.default=h},{preact:17}],91:[function(t,e,n){(function(n){function r(t,e){V=$$("[role=application]")[0]||$$("body")[0],W=V.select("[role=toolbar]")[0],pt=$("canvas"),q=e||Promise.reject("Standalone mode!"),K=t;var n=JSON.parse(localStorage.getItem("ketcher-opts"));Z.editor=new nt(pt,Object.assign(K,n)),Z.render=Z.editor.render,l(W),f(V),N(),b(),m(),v(!0),q.then(function(){v()},function(t){alert(t)}),a("template-lib").disabled=!0,at.templates.init("",$$(".cellar")[0]).then(function(t){ht=t,a("template-lib").disabled=!1}),X="editor";var r=d(W);V.on("keydown",function(t){"editor"==X&&g(W,r,t)}),pt.on("mousedown",function(t){u(W)&&t.stop(),X="editor"}),p("select-lasso"),Event.observe(window,"resize",function(){$$("menu").filter(function(t){return parseFloat(t.style.marginTop)<0}).each(function(t){t.style.marginTop=0}),c(W)})}function o(){if(dt.storage.length>0){var t="<menu>"+dt.storage.reduce(function(t,e){return t+'<li id="atom-'+e.toLowerCase()+'"><button data-number="'+Q.getElementByLabel(e)+'">'+e+"</button></li>"},"")+"</menu>",e=W.select("#freq-atoms")[0];if(!e){var n=W.select("#atom")[0];n.insert({after:'<li id="freq-atoms"/>'}),e=n.nextElementSibling}e.update(t),l(e)}}function i(t){var e=/Mac/.test(navigator.platform);return t.replace(/Mod/g,e?"⌘":"Ctrl").replace(/-(?!$)/g,"+").replace(/\+?([^+]+)$/,function(t){return 1==t.length?t.toUpperCase():t})}function a(t){return $(t).children[0]}function s(t,e){e=e||document.body;for(var n=t.parentNode;"hidden"!=n.getStyle("overflow");){if(n==e)return null;n=n.parentNode}return n}function l(t){t.select("li").each(function(e){e.on("click",function(e){"BUTTON"==e.target.tagName&&e.target.parentNode==this&&(this.hasClassName("selected")||e.stop(),p(this.id)),"hidden"==this.getStyle("overflow")&&(u(t,this),e.stop())})})}function u(t,e){var n=t.select(".opened")[0];return n&&n.removeClassName("opened"),e&&e!=n&&e.addClassName("opened"),!!n&&!e}function c(t,e){var n=e?$(e):t.select(".selected")[0],r=n&&s(n);if(r){var o=a(r);o.style.marginTop=-n.offsetTop+o.offsetTop+"px"}}function p(t){t=t||Y;var e=$(t),n=[].slice.call(arguments,1);if(console.assert(t.startsWith,"id is not a string",t),u(W),gt.indexOf(t)!=-1&&0==n.length)return h(t);if(!e||!a(e).disabled){n.unshift(t);var r=H.apply(null,n);if(r&&r.tool){var o=W.select(".selected")[0];e==o&&e||(Z.editor.tool(r.tool,r.opts),t.startsWith("select-")&&(Y=t),e&&(e.addClassName("selected"),c(W,e)),o&&o.removeClassName("selected"))}return r}return null}function h(t){var e=document.queryCommandSupported(t);if(e)try{document.execCommand(t)}catch(t){e=!1}if(!e){var n=a(t),r=n.dataset?n.dataset.keys:n.getAttribute("data-keys");alert("These action is unavailble via menu.\nInstead, use "+i(r)+" to "+t+".")}return null}function f(t){var e=new Element("input",{type:"text",class:"cliparea",autofocus:!0}),n=window.clipboardData,r=["chemical/x-mdl-molfile","chemical/x-mdl-rxnfile","chemical/x-cml","text/plain","chemical/x-daylight-smiles","chemical/x-inchi"],o=function(){return"editor"==X&&(e.value=" ",e.focus(),e.select(),!0)},i=function(t,e){var r=et.stringify(t);if(!e&&n)n.setData("text",r);else{e.setData("text/plain",r);try{e.setData(t.isReaction?"chemical/x-mdl-rxnfile":"chemical/x-mdl-molfile",r)}catch(t){console.info("Could not write exact type",t)}}},a=function(t){var e="";if(!t&&n)e=n.getData("text");else for(var o=0;o<r.length&&!(e=t.getData(r[o]));o++);return console.info("paste",o>=0&&r[o],e.slice(0,50),".."),e};t.insert(e),t.on("mouseup",o),["copy","cut"].forEach(function(e){t.on(e,function(t){if(o()){var n=p(e,!0);n&&i(n,t.clipboardData),t.preventDefault()}})}),t.on("paste",function(t){if(o()){var e=a(t.clipboardData);e&&_(e,{fragment:!0}),t.preventDefault()}})}function d(t){var e={a:["atom-any"],"Mod-a":["select-all"],"Mod-Shift-a":["deselect-all"],"Ctrl-Shift-r":["force-update"],"Alt-Shift-r":["qs-serialize"]};return t.select("button").each(function(t){var n=t.textContent||t.innerText,r=t.dataset?t.dataset.keys:t.getAttribute("data-keys");if(r){var o=r.split(",").map(function(t){return t.strip()}),a=i(o[0]),s=t.parentNode.id;t.title=(t.title||n)+" ("+a+")",t.innerHTML+=" <kbd>"+a+"</kbd>",o.forEach(function(t){Array.isArray(e[t])?e[t].push(s):e[t]=[s]})}else t.title=t.title||n}),J(e)}function g(t,e,n){var r,o=J(n),i=Z.editor.getSelection().atoms;if(1==o.length&&i.length>0&&o.match(/\w/))S(at.labelEdit,{letter:o}).then(function(t){O(rt.fromAtomsAttrs(Z.editor.getSelection().atoms,t),!0),Z.render.update(),Z.editor.setSelection(null)}),n.preventDefault();else if(r=J.lookup(e,n)){var a=r.index||0,s=t.select(".selected")[0];1!=r.length&&r.indexOf(s&&s.id)!=-1&&(r.index=a=(a+1)%r.length);var l=r[a];gt.indexOf(l)==-1&&(p(l),n.preventDefault())}}function m(){var t=Z.editor.hasSelection(!0);a("copy").disabled=a("cut").disabled=!t}function b(){a("undo").disabled=0==ut.length,a("redo").disabled=0==ct.length}function v(t){ft.forEach(function(t){$(t)&&(a(t).disabled=Z.standalone)})}function y(t,e){var n=t.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()}),r=$(n+"-tmpl").innerHTML,o=new Element("form",{role:"dialog",className:n});return e.insert(o),o.update(r)}function w(t){var e=$$(".overlay")[0],n=y(t,e);return X="modal",e.style.display="",it.animate(e,"show"),it.animate(n,"show"),n}function x(t){var e=$$(".overlay")[0],n=e.lastChild;it.animate(e,"hide"),it.animate(n,"hide").then(function(){e.style.display="none",n.remove(),X="editor"})}function S(t,e,n){function r(t,e){X="editor",i.style.display="none";var n=i.lastChild;n.remove(),console.info("output",e),t&&t(e)}function o(n,o){t(Object.assign({},e,{onOk:function(t){r(e&&e.onOk,t),n(t)},onCancel:function(t){r(e&&e.onCancel,t),o(t)}}))}var i=$$(".overlay")[0];return i.style.display="",X="modal",new Promise(function(t,r){console.info("input",e),n===!1?it.animate(i,"show").then(o.bind(null,t,r)):o(t,r)})}function O(t,e){null!=t&&(1==e&&t.isDummy()||(ut.push(t),ct.clear(),ut.length>lt&&ut.splice(0,1),b()))}function T(){p(null),Z.editor.struct().isBlank()||O(rt.fromNewCanvas(new tt))}function E(){S(at.open).then(function(t){_(t.structStr,{badHeaderRecover:!0,fragment:t.fragment})})}function A(){S(at.save,{server:q,struct:Z.editor.struct()})}function C(t,e,n){if(!n){var r={};n=Z.editor.struct().clone(null,null,!1,r);var o=Z.editor.getSelection(!0).atoms||[];o=o.map(function(t){return r[t]})}var i=q.then(function(){return q[t](Object.assign({struct:et.stringify(n,{ignoreErrors:!0})},o&&o.length>0?{selected:o}:null,e))});return i.catch(function(t){alert(t)}).then(function(t){}),i}function P(t,e,n){return C(t,e,n).then(function(e){return _(e.struct,{rescale:"layout"==t})})}function N(){var t=a("zoom-list");t.on("focus",function(){X="zoom"}),t.on("blur",function(){X="editor"}),t.on("change",B),B()}function j(){a("zoom-list").selectedIndex++,B(!0)}function R(){a("zoom-list").selectedIndex--,B(!0)}function B(t){var e=a("zoom-list"),n=e.selectedIndex,r=e.length;console.assert(0<=n&&n<r,"Zoom out of range"),a("zoom-in").disabled=n==r-1,a("zoom-out").disabled=0==n;var o=parseFloat(e.value)/100;t&&Z.editor.zoom(o)}function M(){Z.editor.struct().hasRxnArrow()?at.automap({onOk:function(t){return P("automap",t)}}):alert("Auto-Mapping can only be applied to reactions")}function _(t,e){e=e||{};var n=st.fromString(t,e,q);return n.catch(function(t){alert("Can't parse molecule!")}),n.then(function(t){return console.assert(t,"No molecule to update"),e.rescale&&t.rescale(),e.fragment?p("paste",t):O(rt.fromNewCanvas(t)),t},function(t){alert(t)})}function I(){O(rt.fromFragmentDeletion()),Z.editor.setSelection(null),Z.render.update()}function k(){Z.editor.tool()&&Z.editor.tool().OnCancel(),Z.editor.setSelection(null),ct.push(ut.pop().perform()),Z.render.update(),b()}function D(){Z.editor.tool()&&Z.editor.tool().OnCancel(),Z.editor.setSelection(null),ut.push(ct.pop().perform()),Z.render.update(),b()}function L(t){for(var e=[],n=0;n<10;n++){var r=W.select("#atom")[0].select("li")[n].id.substr(5);r=r.charAt(0).toUpperCase()+r.slice(1),e.push(r)}e.indexOf(Q[t.values[0]].label)<0&&(dt.current>=dt.capacity&&(dt.current=0),dt.storage[dt.current]=Q[t.values[0]].label,o(),dt.current++)}function F(){at.periodTable({onOk:function(t){var e;return"single"==t.mode?(e={label:Q[t.values[0]].label},L(t)):e={label:"L#",atomList:new tt.AtomList({notList:"not-list"==t.mode,ids:t.values})},p("atom-table",e),!0}})}function G(){at.genericGroups({onOk:function(t){var e={label:t.values[0]};return p("atom-reagenerics",e),!0}})}function U(){var t=JSON.parse(localStorage["ketcher-tmpl"]||"null")||[],e=t.map(function(t){return{struct:et.parse(t),props:{group:"User"}}});S(at.templates,{tmpls:ht,userTmpls:e},!0).then(function(t){return p("template-C",t),!0})}function H(t){console.assert(t,"The null tool");var e=[].slice.call(arguments,1);if(mt[t])return mt[t].apply(null,e);if(Z.editor.hasSelection()){if("erase"==t)return I(),null;if(t.startsWith("atom-"))return O(rt.fromAtomsAttrs(Z.editor.getSelection().atoms,e[0]||z(t)),!0),Z.render.update(),null;if(t.startsWith("transform-flip"))return O(rt.fromFlip(Z.editor.getSelection(),t.endsWith("h")?"horizontal":"vertical"),!0),Z.render.update(),null}return"transform-rotate"==t||t.startsWith("select-")||Z.editor.setSelection(null),"select-lasso"==t?{tool:"select",opts:"lasso"}:"select-rectangle"==t?{tool:"select",opts:"rectangle"}:"select-fragment"==t?{tool:"select",opts:"fragment"}:"erase"==t?{tool:"eraser",opts:1}:t.startsWith("atom-")?{tool:"atom",opts:e[0]||z(t)}:t.startsWith("bond-")?{tool:"bond",opts:t.substr(5)}:"chain"==t?{tool:"chain"}:t.startsWith("template")?{tool:"template",opts:e[0]||{struct:et.parse(ot[parseInt(t.split("-")[1])])}}:"charge-plus"==t?{tool:"charge",opts:1}:"charge-minus"==t?{tool:"charge",opts:-1}:"sgroup"==t?{tool:"sgroup"}:"sgroup-data"==t?{tool:"sgroup",opts:"DAT"}:"reaction-arrow"==t?{tool:"reactionarrow"}:"reaction-plus"==t?{tool:"reactionplus"}:"reaction-map"==t?{tool:"reactionmap"}:"reaction-unmap"==t?{tool:"reactionunmap"}:"rgroup-label"==t?{tool:"rgroupatom"}:"rgroup-fragment"==t?{tool:"rgroupfragment"}:"rgroup-attpoints"==t?{tool:"apoint"}:t.startsWith("transform-rotate")?{tool:"rotate"}:null}function z(t){var e=t.substr(5);switch(e){case"any":return{label:"A"};default:return e=e.capitalize(),console.assert(Q.getElementByLabel(e),"No such atom exist"),{label:e}}}var V,W,Y,q,K,X,Z=n.ui={},J=t("./keynorm"),Q=t("../chem/element"),tt=t("../chem/struct"),et=t("../chem/molfile"),nt=(t("../chem/smiles"),t("../editor")),rt=t("../editor/action.js"),ot=t("./templates"),it=t("./utils"),at=t("./modal"),st=t("./structformat"),lt=32,ut=[],ct=[],pt=null,ht=null,ft=["layout","clean","arom","dearom","cip","reaction-automap","recognize","check","analyse","miew"],dt={storage:[],capacity:7,current:0},gt=["cut","copy","paste"],mt={new:T,open:E,save:A,undo:k,redo:D,"zoom-in":j,"zoom-out":R,"period-table":F,"generic-groups":G,"template-lib":U,layout:function(){return P("layout")},clean:function(){return P("clean")},arom:function(){return P("aromatize")},dearom:function(){return P("dearomatize")},cip:function(){return P("calculateCip")},cut:function(){var t=Z.editor.selectedStruct();return I(),t.isBlank()?null:t},copy:function(){var t=Z.editor.selectedStruct();return Z.editor.setSelection(null),t.isBlank()?null:t},paste:function(t){if(t.isBlank())throw"Not a valid structure to paste";return Z.editor.setSelection(null),{tool:"paste",opts:t}},about:function(){var t=S.bind(null,at.about);q.then(function(e){return t(Object.assign(e,K),!0)},function(){return t(K,!0)})},"select-all":function(){Z.editor.selectAll(),p(null)},"deselect-all":function(){Z.editor.setSelection(null)},"force-update":function(){Z.render.update(!0)},"qs-serialize":function(){var t=et.stringify(Z.editor.struct()),e="mol="+encodeURIComponent(t).replace(/%20/g,"+"),n=document.location.search;document.location.search=n?n.search("mol=")==-1?n+"&"+e:n.replace(/mol=[^&$]*/,e):"?"+e},"reaction-automap":M,recognize:function(){S(at.recognize,{server:q}).then(function(t){_(t.structStr,{rescale:!0,fragment:t.fragment})})},check:function(){S(at.check,{check:C.bind(null,"check")})},analyse:function(){C("calculate",{properties:["molecular-weight","most-abundant-mass","monoisotopic-mass","gross","mass-composition"]
}).then(function(t){return S(at.calculatedValues,t,!0)})},settings:function(){S(at.settings,{server:q}).then(function(t){t.onlyCurrentSession||localStorage.setItem("ketcher-opts",JSON.stringify(t.localStorageOpts)),console.log("ketcher-opts",t.localStorageOpts),Z.editor.options(t.opts),Z.render=Z.editor.render})},help:function(){S(at.help)},miew:function(){var t=st.toString(Z.editor.struct(),"cml",q);t.then(function(t){S(at.miew,{structStr:t},!0).then(function(t){t.structStr&&_(t.structStr)})})}};e.exports={init:r,load:_},Object.assign(Z,e.exports),Object.assign(Z,{render:null,editor:null,updateClipboardButtons:m,selectAction:p,addUndoAction:O,showDialog:w,hideDialog:x,showSGroupProperties:at.sgroup,showRGroupTable:S.bind(null,at.rgroup),showElemTable:at.periodTable,showReaGenericsTable:at.genericGroups,showAtomAttachmentPoints:at.attachmentPoints,showAtomProperties:at.atomProps,showBondProperties:at.bondProps,showRLogicTable:at.rgroupLogic,showLabelEditor:function(t){return S(at.labelEdit,t,!0)}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../chem/element":22,"../chem/molfile":24,"../chem/smiles":28,"../chem/struct":33,"../editor":39,"../editor/action.js":37,"./keynorm":92,"./modal":97,"./structformat":111,"./templates":112,"./utils":113}],92:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){var e=t.split(/-(?!$)/),n=e[e.length-1];"Space"==n&&(n=" ");for(var r=void 0,o=void 0,i=void 0,a=void 0,s=0;s<e.length-1;s++){var l=e[s];if(/^(cmd|meta|m)$/i.test(l))a=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))o=!0;else if(/^s(hift)?$/i.test(l))i=!0;else{if(!/^mod$/i.test(l))throw new Error("Unrecognized modifier name: "+l);f?a=!0:o=!0}}return r&&(n="Alt-"+n),o&&(n="Ctrl-"+n),a&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function i(t){var e=Object.create(null);for(var n in t)e[o(n)]=t[n];return e}function a(t,e,n){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n!==!1&&e.shiftKey&&(t="Shift-"+t),t}function s(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,h.default)(t),r=1==n.length&&" "!=n;return r&&!e?a(n,t,!r):a(h.default.base[t.keyCode],t,!0)}function l(t){return t instanceof KeyboardEvent?s.apply(void 0,arguments):"object"==("undefined"==typeof t?"undefined":c(t))?i(t):o(t)}function u(t,e){var n=(0,h.default)(e),r=1==n.length&&" "!=n,o=t[a(n,e,!r)],i=void 0;return!o&&e.shiftKey&&r&&(i=h.default.base[e.keyCode])&&(o=t[a(i,e,!0)]),o}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p=t("w3c-keyname"),h=r(p),f="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);l.lookup=u,e.exports=l},{"w3c-keyname":20}],93:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){return(0,a.h)(l.default,{caption:"About",name:"about",params:t,buttons:["Close"]},(0,a.h)("a",{href:"http://lifescience.opensource.epam.com/ketcher/",target:"_blank"},(0,a.h)("img",{src:"logo.jpg"})),(0,a.h)("dl",null,(0,a.h)("dt",null,(0,a.h)("a",{href:"http://lifescience.opensource.epam.com/ketcher/help.html",target:"_blank"},"Ketcher")),(0,a.h)("dd",null,"version ",(0,a.h)("var",null,t.version)),t.buildNumber?(0,a.h)("dd",null,"build #",(0,a.h)("var",null,t.buildNumber),"at ",(0,a.h)("time",null,"props.buildDate}")):null,t.indigoVersion?(0,a.h)("div",null,(0,a.h)("dt",null,(0,a.h)("a",{href:"http://lifescience.opensource.epam.com/indigo/",target:"_blank"},"Indigo Toolkit")),(0,a.h)("dd",null,"version ",(0,a.h)("var",null,t.indigoVersion))):(0,a.h)("dd",null,"standalone"),(0,a.h)("dt",null,(0,a.h)("a",{href:"http://lifescience.opensource.epam.com/",target:"_blank"},"EPAM Life Sciences")),(0,a.h)("dd",null,(0,a.h)("a",{href:"http://lifescience.opensource.epam.com/ketcher/#feedback",target:"_blank"},"Feedback"))))}function i(t){var e=$$(".overlay")[0];return(0,a.render)((0,a.h)(o,t),e)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=i;var a=t("preact"),s=t("../component/dialog"),l=r(s)},{"../component/dialog":82,preact:17}],94:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){var e=t.value,n=t.onChange;return(0,g.h)("select",{value:e,onChange:function(t){return n(t.target.value)}},h(8).map(function(t){return(0,g.h)("option",{value:t},t+" decimal places")}))}function l(t){var e=t.value;return(0,g.h)("input",{type:"text",spellcheck:"false",value:e,onKeyDown:function(t){return c(t)}})}function u(t){for(var e,n=t.value,r=[],o=/\b([A-Z][a-z]{0,3})(\d*)\s*\b/g,i=0;e=o.exec(n);)r.push(n.substring(i,e.index)+e[1]),e[2].length>0&&r.push((0,g.h)("sub",null,e[2])),i=e.index+e[0].length;return 0==i?r.push(n):r.push(n.substring(i,n.length)),(0,g.h)("div",{className:"chem-input",spellcheck:"false",contenteditable:"true",onKeyDown:function(t){return c(t)}},r)}function c(t){var e=["Tab","ArrowLeft","ArrowRight","Home","End"],n=(0,b.default)(t);e.indexOf(n)==-1&&t.preventDefault()}function p(t,e){return"number"==typeof t?t.toFixed(e):t.replace(/[0-9]*\.[0-9]+/g,function(t){return(+t).toFixed(e)})}function h(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.apply(null,{length:t}).map(function(t,n){return n+e})}function f(t){var e=$$(".overlay")[0];return(0,g.render)((0,g.h)(w,t),e)}Object.defineProperty(n,"__esModule",{value:!0});var d=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.default=f;var g=t("preact"),m=t("w3c-keyname"),b=r(m),v=t("../component/dialog"),y=r(v),w=function(t){function e(){o(this,e);var t=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.state={roundWeight:3,roundMass:3},t}return a(e,t),d(e,[{key:"changeRound",value:function(t,e){var n={};n[t]=+e,this.setState(n)}},{key:"render",value:function(t,e){var n=this;return(0,g.h)(y.default,{caption:"Calculated Values",name:"analyse",params:this.props,buttons:["Close"]},(0,g.h)("ul",null,[{name:"Chemical Formula",key:"gross"},{name:"Molecular Weight",key:"molecular-weight",round:"roundWeight"},{name:"Exact Mass",key:"monoisotopic-mass",round:"roundMass"},{name:"Elemental Analysis",key:"mass-composition"}].map(function(r){return(0,g.h)("li",null,(0,g.h)("label",null,r.name,":"),"gross"==r.key?(0,g.h)(u,{value:t[r.key]}):(0,g.h)(l,{value:r.round?p(t[r.key],e[r.round]):t[r.key]}),r.round?(0,g.h)(s,{value:e[r.round],onChange:function(t){return n.changeRound(r.round,t)}}):null)})))}}]),e}(g.Component)},{"../component/dialog":82,preact:17,"w3c-keyname":20}],95:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){var e=$$(".overlay")[0];return(0,u.render)((0,u.h)(g,t),e)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.default=s;var u=t("preact"),c=t("../component/dialog"),p=r(c),h=t("../component/tabs"),f=r(h),d=[{title:"Valence",value:"valence"},{title:"Radical",value:"radicals"},{title:"Pseudoatom",value:"pseudoatoms"},{title:"Stereochemistry",value:"stereo"},{title:"Query",value:"query"},{title:"Overlapping Atoms",value:"overlapping_atoms"},{title:"Overlapping Bonds",value:"overlapping_bonds"},{title:"R-Groups",value:"rgroups"},{title:"Chirality",value:"chiral"},{title:"3D Structure",value:"3d"}],g=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={data:{},checker:{}},d.forEach(function(t){n.state.checker[t.value]=!0}),n.onCheck(),n}return a(e,t),l(e,[{key:"changeTab",value:function(t){0==t&&this.onCheck()}},{key:"onCheck",value:function(){var t=this,e=[];for(var n in this.state.checker)this.state.checker[n]&&e.push(n);this.props.check({types:e}).then(function(e){0==Object.keys(e).length?t.setState({data:"correct"}):t.setState({data:e})})}},{key:"checkItem",value:function(t){this.state.checker[t]=!this.state.checker[t],this.setState({checker:this.state.checker})}},{key:"render",value:function(t){var e=this,n=["Check","Settings"];return(0,u.h)(p.default,{caption:"Structure Check",name:"check",params:t,buttons:["Close"]},(0,u.h)(f.default,{className:"tabs",captions:n,changeTab:function(t){return e.changeTab(t)}},(0,u.h)("dl",{className:"result"},"correct"==this.state.data?(0,u.h)("li",null,(0,u.h)("div",{className:"error-name"},"No errors found")):d.filter(function(t){return!!e.state.data[t.value]}).map(function(t){return(0,u.h)("div",null,(0,u.h)("dt",null,t.title," error : "),(0,u.h)("dd",null,e.state.data[t.value]))})),(0,u.h)("ul",{className:"settings"},d.map(function(t){return(0,u.h)("li",null,(0,u.h)("label",null,(0,u.h)("input",{type:"checkbox",checked:e.state.checker[t.value],onClick:function(n){return e.checkItem(t.value)}}),t.title," check"))}))))}}]),e}(u.Component)},{"../component/dialog":82,"../component/tabs":89,preact:17}],96:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){return(0,a.h)(l.default,{caption:"Help",name:"help",params:t,buttons:["Close"]},(0,a.h)(c.default,{captions:["Ketcher","Miew"]},(0,a.h)("iframe",{className:"help-frame",src:"doc/help.html"}),(0,a.h)("iframe",{className:"help-frame",src:"doc/miew/help3D.html"})))}function i(t){var e=$$(".overlay")[0];return(0,a.render)((0,a.h)(o,t),e)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=i;var a=t("preact"),s=t("../component/dialog"),l=r(s),u=t("../component/tabs"),c=r(u)},{"../component/dialog":82,"../component/tabs":89,preact:17}],97:[function(t,e,n){function r(t){t.required=!0,f("periodTable",t)}function o(t){t.required=!0,f("genericGroups",t)}function i(t){h("attachmentPoints",t)}function a(t){h("bondProps",t)}function s(t){h("automap",t)}function l(t){function e(e){var n=this==e.target,r=n?this.value.strip().capitalize():e;n&&(this.value=r);var i=p.getElementByLabel(r);null==i&&"A"!==r&&"*"!==r&&"Q"!==r&&"X"!==r&&"R"!==r&&(console.assert(n,"Incorrect input params label"),r=this.value=t.label,"A"!==r&&"*"!==r&&(i=p.getElementByLabel(r))),"A"==r||"*"==r?o.value="any":i?o.value=i.toString():o.value=""}function n(){i.forEach(function(t){t.stop()})}var r=h("atomProps",Object.assign({},t,{onOk:function(e){n(),t.onOk(e)},onCancel:function(t){n()}})),o=r.select(".number")[0],i=[];i[0]=$(r.charge).on("change",function(){""===this.value.strip()||"0"==this.value?this.value="":this.value.match(/^[1-9][0-9]{0,1}[-+]$/)?this.value=(this.value.endsWith("-")?"-":"")+this.value.substr(0,this.value.length-1):this.value.match(/^[+-]?[1-9][0-9]{0,1}$/)||(this.value=t.charge)}),i[1]=$(r.isotope).on("change",function(){this.value==o.value||""==this.value.strip()||"0"==this.value?this.value="":this.value.match(/^[1-9][0-9]{0,2}$/)||(this.value=t.isotope)}),i[2]=$(r.label).on("change",e),e(t.label)}function u(t){var e=h("rgroupLogic",Object.assign({},t,{onOk:function(e){t.onOk({range:e.range.replace(/\s*/g,"").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,""),resth:1==e.resth,ifthen:parseInt(e.ifthen,10)})}})),n=t.rgroupLabels.reduce(function(e,n){return t.label==n?e:e+'<option value="'+n+'">IF R'+t.label+" THEN R"+n+"</option>"},'<option value="0">Always</option>');$(e.ifthen).update(n),e.ifthen.value=t.ifthen}function c(t){return g.match(t)?g(t):d(t)}var p=t("../../chem/element"),h=t("./input"),f=t("./select"),d=t("./sgroup"),g=t("./sgroup-special"),m=t("./open").default,b=t("./save").default,v=t("./labeledit").default,y=t("./template-lib"),w=t("./rgroup").default,x=t("./about").default,S=t("./recognize").default,O=t("./check").default,T=t("./analyse").default,E=t("./settings").default,A=t("./help").default,C=t("./miew").default;y.default.init=y.init,e.exports={periodTable:r,rgroup:w,genericGroups:o,attachmentPoints:i,atomProps:l,bondProps:a,automap:s,rgroupLogic:u,sgroup:c,open:m,save:b,templates:y.default,labelEdit:v,about:x,recognize:S,check:O,calculatedValues:T,settings:E,help:A,miew:C}},{"../../chem/element":22,"./about":93,"./analyse":94,"./check":95,"./help":96,"./input":98,"./labeledit":99,"./miew":100,"./open":101,"./recognize":103,"./rgroup":104,"./save":105,"./select":106,"./settings":107,"./sgroup":109,"./sgroup-special":108,"./template-lib":110}],98:[function(t,e,n){(function(n){function r(t,e){function n(n){var i="OK"==n?"onOk":"onCancel";if(s.forEach(function(t){t.stop()}),a.hideDialog(t),e&&i in e){var l={};o(r,function(t){l[t.name]="checkbox"==t.type?t.checked:t.value}),e[i](l)}}var r=a.showDialog(t),s=[];return s[0]=r.on("click","input[type=button]",function(t,e){n(e.value)}),s[1]=r.on("keydown",function(t){var e=i(t),r=document.activeElement,o=r&&"TEXTAREA"==r.tagName;(e.startsWith("Esc")||"Enter"==e&&!o)&&(n("Enter"==e?"OK":"Cancel"),t.preventDefault()),t.stopPropagation()}),o(r,function(t){e.hasOwnProperty(t.name)&&(t["checkbox"==t.type?"checked":"value"]=e[t.name])}),r.select("input, select")[0].activate(),r}function o(t,e){$(t).descendants().each(function(t){var n=t.type,r=t.name;r&&"fieldset"!=t.nodeName.toLowerCase()&&!t.disabled&&"submit"!=n&&"reset"!=n&&"button"!=n&&e(t)})}var i=t("w3c-keyname"),a=n.ui;e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"w3c-keyname":20}],99:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){var e=Math.abs(t.charge),n=["",":",".","^^"][t.radical]||"",r="";return e&&(r=t.charge<0?"-":"+"),(t.isotope||"")+t.label+n+(e>1?e:"")+r}function l(t){var e=t.match(/^(\d+)?([a-z*]{1,3})(\.|:|\^\^)?(\d+[-+]|[-+])?$/i);if(e){console.info("match",e);var n="*"==e[2]?"A":e[2].capitalize(),r=0,o=0,i=0;if(e[1]&&(o=parseInt(e[1])),e[3]&&(i={":":1,".":2,"^^":3}[e[3]]),e[4]&&(r=parseInt(e[4]),isNaN(r)&&(r=1),e[4].endsWith("-")&&(r=-r)),"A"==n||"Q"==n||"X"==n||"M"==n||null!=f.default.getElementByLabel(n))return{label:n,charge:r,isotope:o,radical:i}}return null}function u(t){var e=$$(".overlay")[0];return(0,p.render)((0,p.h)(b,{params:t}),e)}Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.default=u;var p=t("preact"),h=t("../../chem/element"),f=r(h),d=t("../../chem/generics"),g=(r(d),t("../component/dialog")),m=r(g),b=function(t){function e(t){var n=t.params;o(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.state={input:n.letter||s(n)},r}return a(e,t),c(e,[{key:"result",value:function(){return l(this.state.input)}},{key:"type",value:function(t){this.setState({input:t})}},{key:"render",value:function(t){var e=this;return(0,p.h)(m.default,{caption:"",name:"labeledit",params:t.params,result:function(){return e.result()}},(0,p.h)("input",{type:"text",maxlength:"20",size:"10",onInput:function(t){return e.type(t.target.value)},value:this.state.input}))}}]),e}(p.Component)},{"../../chem/element":22,"../../chem/generics":23,"../component/dialog":82,preact:17}],100:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(){var t=JSON.parse(localStorage.getItem("ketcher-opts"));if(!t)return x;var e=x;return t.miewTheme&&(e.settings.theme=h(t.miewTheme)),t.miewAtomLabel&&(e.settings.atomLabel=h(t.miewAtomLabel)),t.miewMode&&(e.reps[0].mode=O[h(t.miewMode)]),e}function l(t){var e=t;return e.href||(e=document.createElement("a"),e.href=t),e.origin?e.origin:(e.hostname||(e=document.location),e.protocol+"//"+e.hostname+(e.port?":"+e.port:""))}function u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"&";return Array.isArray(t)?t.reduce(function(t,e){var n=u(e);return null!==n&&t.push(n),t},[]).join(e):"object"==("undefined"==typeof t?"undefined":m(t))?Object.keys(t).reduce(function(e,n){var r=t[n];return e.push("object"==("undefined"==typeof r?"undefined":m(r))?u(r):encodeURIComponent(n)+"="+encodeURIComponent(r)),e},[]).join(e):null}function c(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(r,o){window.addEventListener("message",function o(i){i.origin==l(e)&&"miewLoadComplete"==i.data&&!function(){window.removeEventListener("message",o);var e=t.MIEWS[0];e._opts.load=!1,e._menuDisabled=!0,e.init()&&(e.setOptions(n),e.benchmarkGfx().then(function(){e.run(),setTimeout(function(){return r(e)},10)}))}()})})}function p(t,e){return t.saveData(),new Promise(function(t,n){window.addEventListener("message",function n(r){r.origin==l(e)&&r.data.startsWith("CML:")&&(window.removeEventListener("message",n),t(atob(r.data.slice(4))))})})}function h(t){return t.replace(/\s(.)/g,function(t){return t.toUpperCase()}).replace(/\s/g,"").replace(/^(.)/,function(t){return t.toLowerCase()})}function f(t){var e=$$(".overlay")[0];return(0,b.render)((0,b.h)(T,t),e)}Object.defineProperty(n,"__esModule",{value:!0});var d=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},g=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};n.default=f;var b=t("preact"),v=t("../component/dialog"),y=r(v),w="miew/index.html",x={preset:"small",settings:{theme:"light",atomLabel:"bright",autoPreset:!1,inversePanning:!0},reps:[{mode:"LN",colorer:"AT",selector:"all"}]},S={location:"no",menubar:"no",toolbar:"no",directories:"no",modal:"yes",alwaysRaised:"yes"},O={lines:"LN",ballsAndSticks:"BS",licorice:"LC"},T=function(t){function e(t){o(this,e),console.info("init");var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.opts=s(),n}return a(e,t),g(e,[{key:"load",value:function(t){var e=this,n=c(t.target.contentWindow,w,this.opts);this.setState({miew:n}),this.state.miew.then(function(t){t.parse(e.props.structStr,{fileType:"cml",loaded:!0}),e.setState({miew:t})})}},{key:"save",value:function(t){var e=this;if(this.props.onOk){var n=p(this.state.miew,w);this.setState({structStr:n}),this.state.structStr.then(function(t){e.props.onOk({structStr:t})})}}},{key:"window",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){var t=d({},this.opts,{load:"CML:"+btoa(this.props.structStr),sourceType:"message"}),e=this.base.getBoundingClientRect(),n=d({},S,{top:Math.round(e.top),left:Math.round(e.left),width:Math.round(e.width),height:Math.round(e.height)}),r=window.open(w+"?"+u(t),"miew",u(n,","));r&&(this.props.onCancel&&this.props.onCancel(),r.onload=function(){console.info("windowed")})})},{key:"render",value:function(t){var e=this,n=this.state,r=n.miew,o=n.structStr;return(0,b.h)(y.default,{caption:"3D View",name:"miew",params:t,buttons:["Close",(0,b.h)("button",{disabled:r instanceof Promise||o instanceof Promise,onClick:function(t){return e.save(t)}},"Apply"),(0,b.h)("button",{className:"window",disabled:/MSIE|rv:11/i.test(navigator.userAgent),onClick:function(t){return e.window()}},"Detach to new window")]},(0,b.h)("iframe",{id:"miew-iframe",src:w,onLoad:function(t){return e.load(t)}}))}}]),e}(b.Component)},{"../component/dialog":82,preact:17}],101:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(){return Object.keys(h.map).reduce(function(t,e){return t.concat.apply(t,[h.map[e].mime].concat(o(h.map[e].ext)))},[]).join(",")}function u(t){var e=$$(".overlay")[0];return(0,p.render)((0,p.h)(b,t),e)}Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.default=u;var p=t("preact"),h=t("../structformat"),f=t("../component/dialog"),d=r(f),g=t("../component/openbutton"),m=r(g),b=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={structStr:"",fragment:!1},n}return s(e,t),c(e,[{key:"result",value:function(){var t=this.state,e=t.structStr,n=t.fragment;return e?{structStr:e,fragment:n}:null}},{key:"changeStructStr",value:function(t){this.setState({structStr:t})}},{key:"changeFragment",value:function(t){this.setState({fragment:t.checked})}},{key:"render",value:function(){var t=this,e=this.state,n=e.structStr,r=e.fragment;return(0,p.h)(d.default,{caption:"Open Structure",name:"open",result:function(){return t.result()},params:this.props,buttons:[(0,p.h)(m.default,{className:"open",server:this.props.server,type:l(),onLoad:function(e){return t.changeStructStr(e)}},"Open From File…"),"Cancel","OK"]},(0,p.h)("textarea",{value:n,onInput:function(e){return t.changeStructStr(e.target.value)}}),(0,p.h)("label",null,(0,p.h)("input",{type:"checkbox",checked:r,onClick:function(e){return t.changeFragment(e.target)}}),"Load as a fragment"))}}]),e}(p.Component)},{"../component/dialog":82,"../component/openbutton":83,"../structformat":111,preact:17}],102:[function(t,e,n){function r(){return[{name:"showAtomIds",label:"Show atom Ids",type:"boolean",defaultValue:!1,tab:"debug"},{name:"showBondIds",label:"Show bonds Ids",type:"boolean",defaultValue:!1,tab:"debug"},{name:"showHalfBondIds",label:"Show half bonds Ids",type:"boolean",defaultValue:!1,tab:"debug"},{name:"showLoopIds",label:"Show loop Ids",type:"boolean",defaultValue:!1,tab:"debug"},{name:"showValenceWarnings",label:"Show valence warnings",type:"boolean",defaultValue:!0,tab:"render"},{name:"atomColoring",label:"Atom coloring",type:"boolean",defaultValue:!0,tab:"render"},{name:"hideChiralFlag",label:"Do not show the Chiral flag",type:"boolean",defaultValue:!1,tab:"render"},{name:"carbonExplicitly",label:"Display carbon explicitly",type:"boolean",defaultValue:!1,tab:"atoms"},{name:"showCharge",label:"Display charge",type:"boolean",defaultValue:!0,tab:"atoms"},{name:"showValence",label:"Display valence",type:"boolean",defaultValue:!0,tab:"atoms"},{name:"showHydrogenLabels",label:"Show hydrogen labels",type:"string",defaultValue:"on",values:["off","Hetero","Terminal","Terminal and Hetero","on"],tab:"atoms"},{name:"aromaticCircle",label:"Aromatic Bonds as circle",type:"boolean",defaultValue:!0,tab:"bonds"},{name:"doubleBondWidth",label:"Double bond width",type:"field",defaultValue:6,values:[0,96],defaultMeasure:"px",measures:["cm","px","pt","inch"],tab:"bonds"},{name:"bondThickness",label:"Bond thickness",type:"field",defaultValue:2,values:[0,96],defaultMeasure:"px",measures:["cm","px","pt","inch"],tab:"bonds"},{name:"stereoBondWidth",label:"Stereo (Wedge) bond width",type:"field",defaultValue:6,values:[0,96],defaultMeasure:"px",measures:["cm","px","pt","inch"],tab:"bonds"},{name:"font",label:"Font",type:"font",defaultValue:"30px Arial",tab:"render"},{name:"fontsz",label:"Font size",type:"field",defaultValue:13,values:[0,96],defaultMeasure:"px",measures:["cm","px","pt","inch"],tab:"render"},{name:"fontszsub",label:"Sub font size",type:"field",defaultValue:13,values:[0,96],defaultMeasure:"px",measures:["cm","px","pt","inch"],tab:"render"},{name:"miewMode",label:"Display mode",type:"string",defaultValue:"lines",values:["lines","balls and sticks","licorice"],tab:"miew"},{name:"miewTheme",label:"Background color",type:"string",defaultValue:"light",values:["light","dark"],tab:"miew"},{name:"miewAtomLabel",label:"Label coloring",type:"string",defaultValue:"bright",values:["no","bright","inverse","black and white","black"],tab:"miew"}]}e.exports=r},{}],103:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){var e=$$(".overlay")[0];return(0,u.render)((0,u.h)(b,t),e)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.default=s;var u=t("preact"),c=t("../../api"),p=(r(c),t("../component/dialog")),h=r(p),f=t("../component/structrender"),d=r(f),g=t("../component/spin"),m=r(g),b=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={file:null,structStr:null,fragment:!1},n}return a(e,t),l(e,[{key:"result",value:function(){var t=this.state,e=t.structStr,n=t.fragment;return!e||e instanceof Promise?null:{structStr:e,fragment:n}}},{key:"uploadImage",value:function(t){this.setState({file:t.target.files[0],structStr:null})}},{key:"url",value:function(){if(!this.state.file)return null;var t=window.URL||window.webkitURL;return t?t.createObjectURL(this.state.file):"No preview"}},{key:"recognize",value:function(){var t=this,e=this.props.server.recognize(this.state.file).then(function(e){t.setState({structStr:e.struct})},function(e){t.setState({structStr:null}),setTimeout(function(){return alert("Error! The picture isn't recognized.")},200)});this.setState({structStr:e})}},{key:"checkFragment",value:function(t){this.state.fragment=!this.state.fragment}},{key:"imageError",value:function(t){this.setState({file:null}),alert("Error, it isn't a picture")}},{key:"render",value:function(){var t=this,e=this.state,n=e.file,r=e.structStr,o=e.fragment;return(0,u.h)(h.default,{caption:"Import From Image",name:"recognize",result:function(){return t.result()},params:this.props,buttons:[(0,u.h)("label",{className:"open"},"Choose file…",(0,u.h)("input",{onChange:function(e){return t.uploadImage(e)},accept:"image/*",type:"file"})),(0,u.h)("span",{className:"open-filename"},n?n.name:null),n&&!r?(0,u.h)("button",{onClick:function(e){return t.recognize(e)}},"Recognize"):null,"Cancel","OK"]},(0,u.h)("div",{className:"picture"},n?(0,u.h)("img",{id:"pic",src:this.url()||"",onError:function(e){return t.imageError(e)}}):null),(0,u.h)("div",{className:"output"},r?r instanceof Promise?(0,u.h)(m.default,null):(0,u.h)(d.default,{className:"struct",struct:r}):null),(0,u.h)("label",null,(0,u.h)("input",{type:"checkbox",checked:o,onClick:function(e){return t.checkFragment(e.target)}}),"Load as a fragment"))}}]),e}(u.Component)},{"../../api":21,"../component/dialog":82,"../component/spin":86,"../component/structrender":87,preact:17}],104:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){var e=$$(".overlay")[0];return(0,u.render)("multiple"==t.mode?(0,u.h)(d,{params:t}):(0,u.h)(f,{params:t}),e)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.default=s;var u=t("preact"),c=t("../component/dialog"),p=r(c),h=function(t){function e(t){var n=t.params;o(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.values=n.values?n.values.map(function(t){return parseInt(t.substr(1))-1;
}):[],r}return a(e,t),l(e,[{key:"name",value:function(t){return"R"+(t+1)}},{key:"render",value:function(t){var e=this;return(0,u.h)(p.default,{caption:"R-Group",name:"rgroup",params:t.params,result:function(){return e.result()}},(0,u.h)("ul",null,Array.apply(null,{length:32}).map(function(t,n){return(0,u.h)("li",null,(0,u.h)("button",{className:e.selected(n)?"selected":"",onClick:function(t){t.preventDefault(),e.select(n)}},e.name(n)))})))}}]),e}(u.Component),f=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state.value=n.values.length?n.values[0]:null,n}return a(e,t),l(e,[{key:"select",value:function(t){this.setState({value:t!==this.state.value?t:null})}},{key:"selected",value:function(t){return t===this.state.value}},{key:"result",value:function(){return{values:null!=this.state.value?[this.name(this.state.value)]:[]}}}]),e}(h),d=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state.values=n.values,n}return a(e,t),l(e,[{key:"select",value:function(t){var e=this.state.values,n=e.indexOf(t);n<0?e.push(t):e.splice(n,1),this.setState({values:e})}},{key:"selected",value:function(t){return this.state.values.includes(t)}},{key:"result",value:function(){var t=this;return{values:this.state.values.map(function(e){return t.name(e)})}}}]),e}(h)},{"../component/dialog":82,preact:17}],105:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(t){var e=$$(".overlay")[0];return(0,c.render)((0,c.h)(b,t),e)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.default=l;var c=t("preact"),p=t("../structformat"),h=o(p),f=t("../component/dialog"),d=r(f),g=t("../component/savebutton"),m=r(g),b=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={type:t.struct.hasRxnArrow()?"rxn":"mol"},n.changeType().catch(t.onCancel),n}return s(e,t),u(e,[{key:"changeType",value:function(t){var e=this,n=this.state.type;t&&(n=t.target.value,t.preventDefault());var r=h.toString(this.props.struct,n,this.props.server);return r.then(function(t){return e.setState({type:n,structStr:t})},function(t){alert(t)})}},{key:"saveTemplate",value:function(t){var e=JSON.parse(localStorage["ketcher-tmpl"]||"null")||[];e.push(this.state.structStr),localStorage["ketcher-tmpl"]=JSON.stringify(e),this.props.onOk()}},{key:"render",value:function(){var t=this,e=this.state,n=e.type,r=e.structStr,o=h.map[n];return console.assert(o,"Unknown chemical file type"),(0,c.h)(d.default,{caption:"Save Structure",name:"save",params:this.props,buttons:[(0,c.h)(m.default,{className:"save",data:r,filename:"ketcher"+o.ext[0],type:o.mime,server:this.props.server,onSave:function(){return t.props.onOk()}},"Save To File…"),(0,c.h)("button",{className:"save-tmpl",onClick:function(e){return t.saveTemplate(e)}},"Save to Templates"),"Close"]},(0,c.h)("label",null,"Format:",(0,c.h)("select",{value:n,onChange:function(e){return t.changeType(e)}},[this.props.struct.hasRxnArrow()?"rxn":"mol","smiles","smarts","cml","inchi"].map(function(t){return(0,c.h)("option",{value:t},h.map[t].name)}))),(0,c.h)("textarea",{className:n,value:r,readonly:!0,ref:function(t){return t.select()}}))}}]),e}(c.Component)},{"../component/dialog":82,"../component/savebutton":84,"../structformat":111,preact:17}],106:[function(t,e,n){(function(n){function r(t,e){function n(t){s.select(".selected").each(function(t){t.removeClassName("selected")}),t?s.select("button").each(function(e){var n=e.value||e.textContent||e.innerText;t.indexOf(n)>=0&&e.addClassName("selected")}):e.required&&(l.disabled=!0)}function r(){var t=[];return s.select(".selected").each(function(e){var n=e.value||e.textContent||e.innerText;t.push(n)}),t}function a(n){var o="OK"==n?"onOk":"onCancel";c.forEach(function(t){t.stop()}),i.hideDialog(t),console.assert("onOk"!=o||!e.required||0!=r().length,"No elements selected"),e&&o in e&&e[o]({mode:u,values:r()})}var s=i.showDialog(t),l=s.select("input[value=OK]")[0],u=e.mode||"single",c=[];c[0]=s.on("click","input[type=button]",function(t,e){a(e.value)}),c[1]=s.on("click","button",function(t,r){"single"===u&&(r.hasClassName("selected")?e.required&&l.click():n(null)),r.toggleClassName("selected"),e.required&&(l.disabled=0===s.select(".selected").length),t.stop()}),c[2]=s.on("click","input[name=mode]",function(t,e){e.value!=u&&("single"==e.value&&n(null),u=e.value)}),c[3]=s.on("keydown",function(t){var e=o(t);(e.startsWith("Esc")||"Enter"==e&&!l.disabled)&&(a("Enter"==e?"OK":"Cancel"),t.preventDefault()),t.stopPropagation()}),n(e.values),s.select("input[name=mode]").each(function(t){t.value==u&&(t.checked=!0)}),s.select("button, input")[0].activate()}var o=t("w3c-keyname"),i=n.ui;e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"w3c-keyname":20}],107:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){var e=t.name,n=t.value,r=t.onChange;return(0,h.h)("select",{onChange:function(t){return r(e,"on"==t.target.value)},value:n?"on":"off"},(0,h.h)("option",{value:"on"},"on"),(0,h.h)("option",{value:"off"},"off"))}function l(t){function e(t){var e=u(t.target.value,i,"px");return e<=o[0]||e>o[1]?void(t.target.value=u(r,"px",i)):void a(n,e)}var n=t.name,r=t.value,o=t.values,i=t.measureValue,a=t.onChange;return(0,h.h)("div",null,(0,h.h)("input",{type:"number",min:o[0],max:o[1],onChange:function(t){return e(t)},value:u(r,"px",i)}),(0,h.h)("select",{className:"measure",value:i||"px",onChange:function(t){return a(n+"Measure",t.target.value)}},(0,h.h)("option",{value:"cm"},"cm"),(0,h.h)("option",{value:"px"},"px"),(0,h.h)("option",{value:"pt"},"pt"),(0,h.h)("option",{value:"inch"},"inch")))}function u(t,e,n){if(!t)return null;var r={px:1,cm:37.795278,pt:1.333333,inch:96};return"px"==n||"pt"==n?(t*r[e]/r[n]).toFixed():(t*r[e]/r[n]).toFixed(3)}function c(t){var e=$$(".overlay")[0];return(0,h.render)((0,h.h)(E,{params:t}),e)}Object.defineProperty(n,"__esModule",{value:!0});var p=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.default=c;var h=t("preact"),f=t("../component/dialog"),d=r(f),g=t("../component/openbutton"),m=r(g),b=t("../component/savebutton"),v=r(b),y=t("../component/accordion"),w=r(y),x=t("../component/systemfonts"),S=r(x),O=t("./options"),T=r(O),E=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));n.defOpts=(0,T.default)(),n.state={onlyCurrentSession:!1};var r=n.getDefOpts(n.defOpts);return r=Object.assign(r,t.opts,JSON.parse(localStorage.getItem("ketcher-opts"))),n.setState({opts:r}),n.changeState=n.changeState.bind(n),n.createSelectList=n.createSelectList.bind(n),n}return a(e,t),p(e,[{key:"getDefOpts",value:function(t){for(var e={},n=0;n<t.length;n++)"field"==t[n].type&&(e[t[n].name+"Measure"]=t[n].defaultMeasure),e[t[n].name]=t[n].defaultValue;return e}},{key:"result",value:function(){return{opts:this.state.opts,localStorageOpts:this.state.opts,onlyCurrentSession:this.state.onlyCurrentSession}}},{key:"uploadSettings",value:function(t){try{var e=JSON.parse(t),n=Object.assign(this.state.opts,e);this.setState({opts:n})}catch(t){console.info("Bad file")}}},{key:"changeState",value:function(t,e){var n={};n[t]=e,this.setState(Object.assign(this.state.opts,n))}},{key:"createSelectList",value:function(t){var e=this.changeState,n=t.values,r=t.type,o=t.name,i=t.label,a=null;switch(r){case"font":a=(0,h.h)("div",null,(0,h.h)(S.default,{current:this.state.opts.font,onChange:function(t){return e(o,"30px "+t.target.value)}}));break;case"field":a=(0,h.h)(l,{name:o,onChange:e,values:n,value:this.state.opts[o],measureValue:this.state.opts[o+"Measure"]});break;case"boolean":a=(0,h.h)("div",null,(0,h.h)(s,{name:o,onChange:e,value:this.state.opts[o]}));break;default:var u=n.map(function(t){return(0,h.h)("option",{value:t}," ",t," ")});a=(0,h.h)("div",null,(0,h.h)("select",{onChange:function(t){return e(o,t.target.value)},value:this.state.opts[o]},u))}return(0,h.h)("li",null,(0,h.h)("div",null," ",i," "),a)}},{key:"draw",value:function(t){var e=this.createSelectList,n=this.defOpts.map(function(n){if(n.tab===t)return e(n)});return(0,h.h)("ul",null," ",n," ")}},{key:"reset",value:function(t){var e=this.getDefOpts(this.defOpts);this.setState({opts:e})}},{key:"apply",value:function(t){this.setState({onlyCurrentSession:!0})}},{key:"render",value:function(t,e){var n=this,r=["Rendering customization options","Atoms","Bonds","3D Viewer","Options for debugging"],o={0:!0,1:!1,2:!1,3:!1,4:!1};return(0,h.h)(d.default,{caption:"Settings",name:"settings",params:t.params,result:function(){return n.result()},buttons:[(0,h.h)(m.default,{className:"open",server:this.props.server,onLoad:function(t){return n.uploadSettings(t)}},"Open From File…"),(0,h.h)(v.default,{className:"save",data:JSON.stringify(this.state.opts),filename:"ketcher-settings"},"Save To File…"),(0,h.h)("button",{onClick:function(t){return n.reset(t)}},"Reset"),"OK","Cancel"]},(0,h.h)("div",{className:"accordion-wrapper"},(0,h.h)(w.default,{className:"accordion",captions:r,active:o},(0,h.h)("div",{className:"content"},this.draw("render")),(0,h.h)("div",{className:"content"},this.draw("atoms")),(0,h.h)("div",{className:"content"},this.draw("bonds")),(0,h.h)("div",{className:"content"},this.draw("miew")),(0,h.h)("div",{className:"content"},this.draw("debug"))),(0,h.h)("label",{className:"current"},(0,h.h)("input",{type:"checkbox",onChange:function(t){return n.apply(t)}}),"Apply settings only for current session")))}}]),e}(h.Component)},{"../component/accordion":81,"../component/dialog":82,"../component/openbutton":83,"../component/savebutton":84,"../component/systemfonts":88,"./options":102,preact:17}],108:[function(t,e,n){(function(n){function r(t){function e(t,e){if(console.info("set context:",t,c),console.assert(c.context||e,"Field setup should be forced"),e||t!=c.context.name){c.context=u.find(function(e){return e.name==t}),console.assert(c.context,"Can't find such context");var r=c.context.value.reduce(function(t,e){return t+'<option value="'+e.name+'">'+e.name+"</option>"},"");$(s.fieldName).update(r),n(c.context.value[0].name,!0),e&&(s.context.value=t)}}function n(t,e){if(console.info("set field:",t,c),console.assert(c.field||e,"Field setup should be forced"),t||t!=c.field.name){if(c.field=c.context.value.find(function(e){return e.name==t}),console.assert(c.field,"Can't find such field"),c.field.value){var n=c.field.value.reduce(function(t,e){return t+'<option value="'+e+'">'+e+"</option>"},"");s.fieldValue.outerHTML='<select size="10" name="fieldValue">'+n+"</select>"}else s.fieldValue.outerHTML='<textarea name="fieldValue"></textarea>';s.fieldName.value=t}}function r(e){var n="OK"==e?"onOk":"onCancel",r="onOk"!=n||o(s);r&&(f.forEach(function(t){t.stop()}),l.hideDialog("sgroupSpecial"),n in t&&r&&t[n](r))}var s=l.showDialog("sgroupSpecial"),c={};console.assert(!t.type||"DAT"==t.type);var p=t.attrs.fieldName&&i(t.attrs.fieldName,t.attrs.fieldValue)||t.context||"Fragment";e(p,!0),t.attrs.fieldName&&n(t.attrs.fieldName,!0),s.fieldValue.value=t.attrs.fieldValue;var h=t.attrs.attached?"attached":t.attrs.absolute===!1?"relative":"absolute";s.getInputs("radio","fieldPos").find(function(t){return t.value==h}).checked=!0;var f=[];f[0]=s.on("click","input[type=button]",function(t,e){r(e.value)}),f[1]=$(s.context).on("change",function(){e(s.context.value)}),f[2]=$(s.fieldName).on("change",function(){n(s.fieldName.value)}),f[3]=s.on("keydown",function(t){var e=a(t);(e.startsWith("Esc")||"Enter"==e)&&(r("Enter"==e?"OK":"Cancel"),t.preventDefault()),t.stopPropagation()}),s.select("button, select, textarea, input")[0].activate()}function o(t){var e={mul:null,connectivity:"",name:"",subscript:""};e.fieldName=t.fieldName.value.strip(),e.fieldValue=t.fieldValue.value.strip();var n=t.getInputs("radio","fieldPos").find(function(t){return t.checked}).value;return e.absolute="absolute"==n,e.attached="attached"==n,""==e.fieldValue?(alert("Please, specify data field value."),null):{type:"DAT",attrs:e}}function i(t,e){console.info("search:",s.unicodeLiteral(t),s.unicodeLiteral(e));var n=u.find(function(n){var r=n.value.find(function(e){return e.name==t});return!!r&&(!e||!r.value||!!r.value.find(function(t){return t==e}))});return n&&n.name}var a=t("w3c-keyname"),s=t("../../util"),l=n.ui,u=[{name:"Fragment",value:[{name:"MDLBG_FRAGMENT_STEREO",value:["abs","(+)-enantiomer","(-)-enantiomer","racemate","steric","rel","R(a)","S(a)","R(p)","S(p)"]},{name:"MDLBG_FRAGMENT_COEFFICIENT",value:null},{name:"MDLBG_FRAGMENT_CHARGE",value:null},{name:"MDLBG_FRAGMENT_RADICALS",value:null}]},{name:"Single Bond",value:[{name:"MDLBG_STEREO_KEY",value:["erythro","threo","alpha","beta","endo","exo","anti","syn","ECL","STG"]},{name:"MDLBG_BOND_KEY",value:["Value=4"]}]},{name:"Atom",value:[{name:"MDLBG_STEREO_KEY",value:["RS","SR","P-3","P-3-PI","SP-4","SP-4-PI","T-4","T-4-PI","SP-5","SP-5-PI","TB-5","TB-5-PI","OC-6","TB-5-PI","TP-6","PB-7","CU-8","SA-8","DD-8","HB-9","TPS-9","HB-9"]}]},{name:"Group",value:[{name:"MDLBG_STEREO_KEY",value:["cis","trans"]}]}];r.match=function(t){return!("DAT"!=t.type||t.attrs.fieldName&&!i(t.attrs.fieldName,t.attrs.fieldValue))},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util":115,"w3c-keyname":20}],109:[function(t,e,n){(function(n){function r(t){function e(){var t=r.type.value;return"DAT"==t?(r.select(".base")[0].hide(),void r.select(".data")[0].show()):(r.select(".base")[0].show(),r.select(".data")[0].hide(),r.label.disabled="SRU"!=t&&"MUL"!=t&&"SUP"!=t,r.connectivity.disabled="SRU"!=t,void("MUL"!=t||r.label.value.match(/^[1-9][0-9]{0,2}$/)?"SRU"==t?r.label.value="n":"GEN"!=t&&"SUP"!=t||(r.label.value=""):r.label.value="1"))}function n(e){var n="OK"==e?"onOk":"onCancel",i="onOk"!=n||o(r);i&&(u.forEach(function(t){t.stop()}),a.hideDialog("sgroup"),n in t&&i&&t[n](i))}var r=a.showDialog("sgroup"),s=t.type||"GEN";switch(r.type.value=s,e(),s){case"SRU":r.connectivity.value=t.attrs.connectivity,r.label.value=t.attrs.subscript;break;case"MUL":r.label.value=t.attrs.mul;break;case"SUP":r.label.value=t.attrs.name;break;case"DAT":r.fieldName.value=t.attrs.fieldName,r.fieldValue.value=t.attrs.fieldValue;var l=t.attrs.attached?"attached":t.attrs.absolute?"absolute":"relative";r.getInputs("radio","fieldPos").find(function(t){return t.value==l}).checked=!0}"DAT"!=s&&(r.fieldName.value="",r.fieldValue.value="");var u=[];u[0]=r.on("click","input[type=button]",function(t,e){n(e.value)}),u[1]=$(r.type).on("change",e),u[2]=$(r.label).on("change",function(){"MUL"!=r.type.value||r.label.value.match(/^[1-9][0-9]{0,2}$/)||(r.label.value="1")}),u[3]=r.on("keydown",function(t){var e=i(t);(e.startsWith("Esc")||"Enter"==e)&&(n("Enter"==e?"OK":"Cancel"),t.preventDefault()),t.stopPropagation()}),r.select("button, select, textarea, input")[0].activate()}function o(t){var e=t.type.value,n={mul:null,connectivity:"",name:"",subscript:"",fieldName:"",fieldValue:"",attached:!1,absolute:!1};switch(e){case"SRU":if(n.connectivity=t.connectivity.value.strip(),n.subscript=t.label.value.strip(),1!=n.subscript.length||!n.subscript.match(/^[a-zA-Z]$/))return alert(n.subscript.length?"SRU subscript should consist of a single letter.":"Please provide an SRU subscript."),null;break;case"MUL":n.mul=parseInt(t.label.value,10);break;case"SUP":if(n.name=t.label.value.strip(),!n.name)return alert("Please provide a name for the superatom."),null;break;case"DAT":n.fieldName=t.fieldName.value.strip(),n.fieldValue=t.fieldValue.value.strip();var r=t.getInputs("radio","fieldPos").find(function(t){return t.checked}).value;if(n.absolute="absolute"==r,n.attached="attached"==r,""==n.fieldName||""==n.fieldValue)return alert("Please, specify data field name and value."),null}return{type:e,attrs:n}}var i=t("w3c-keyname"),a=n.ui;e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"w3c-keyname":20}],110:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function l(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function u(t,e){return console.assert(t.props&&t.props.group,"No group"),t.struct.name||t.props.group+" template "+(e+1)}function c(t){return t.reduce(function(t,e){var n=e.props.group||"Ungroupt",r=t.find(function(t){return t.name==n});return r||(r={name:n,templates:[]},t.push(r)),r.templates.push(e),t},[])}function p(t,e){console.warn("partition",t);for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}function h(t){var e=["-","[","]","/","{","}","(",")","*","+","?",".","\\","^","$","|"],n=RegExp("["+e.join("\\")+"]","g");return t.replace(n,"\\$&")}function f(t,e){if(console.warn("filter",e),!e)return t;var n=RegExp(h(e),"i");return t.reduce(function(t,e){if(e.name.search(n)!=-1&&e.templates.length>0)t.push(e);else{var r=e.templates.filter(function(t,e){return u(t,e).search(n)!=-1});r.length>0&&t.push({name:e.name,templates:r})}return t},[])}function d(t,e){console.warn("group",e);var n=t.find(function(t){return t.name==e});return n?n.templates:t.reduce(function(t,e){return t.concat.apply(t,l(e.templates))},[])}function g(t){var e=t.tmpl,n=s(t,["tmpl"]);return e.props&&e.props.prerender?(0,O.h)("svg",n,(0,O.h)("use",{xlinkHref:e.props.prerender})):(0,O.h)(R.default,S({struct:e.struct,options:{autoScaleMargin:15}},n))}function m(t){return fetch(t,{credentials:"same-origin"}).then(function(e){if(e.ok)return e.text();throw"Could not fetch "+t})}function b(t){var e=t.props.prerender,n=e&&e.split("#",2);return{file:e&&n[0],id:e&&n[1]}}function v(t,e,n){var r=t.reduce(function(t,e){var n=b(e).file;return n&&t.indexOf(n)==-1&&t.push(n),t},[]),o=Promise.all(r.map(function(t){return m(e+t).catch(function(){return null})}));return o.then(function(t){return t.forEach(function(t){t&&(n.innerHTML+=t)}),r.filter(function(e,n){return!!t[n]})})}function y(t,e){return m(t+"library.sdf").then(function(n){var r=C.default.parse(n),o=v(r,t,e);return o.then(function(t){return r.map(function(e){var n=b(e);return n.file&&(e.props.prerender=t.indexOf(n.file)!=-1?"#"+n.id:""),e})})})}function w(t){var e=$$(".overlay")[0],n=c(t.tmpls).concat({name:"User Templates",templates:t.userTmpls});return(0,O.render)((0,O.h)(L,S({lib:n},t)),e)}Object.defineProperty(n,"__esModule",{value:!0});var x=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),S=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};n.init=y,n.default=w;var O=t("preact"),T=t("lru-memoize"),E=r(T),A=t("../../chem/sdf"),C=r(A),P=t("../component/visibleview"),N=r(P),j=t("../component/structrender"),R=r(j),B=t("../component/select"),M=r(B),_=t("../component/dialog"),I=r(_),k=(0,E.default)(30)(function(t,e){return f(t,e)}),D=(0,E.default)(5)(function(t,e,n){return p(n,d(t,e))}),L=function(t){function e(t){o(this,e),console.info("lib constructor");var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={selected:null,filter:"",group:n.props.lib[0].name},n}return a(e,t),x(e,[{key:"select",value:function(t){t==this.state.selected?this.props.onOk(this.result()):this.setState({selected:t})}},{key:"selectGroup",value:function(t){this.state.group!=t&&this.setState({group:t,selected:null})}},{key:"setFilter",value:function(t){this.setState({filter:t.trim(),selected:null})}},{key:"result",value:function(){var t=this.state.selected;return console.assert(!t||t.props,"Incorrect SDF parse"),t?{struct:t.struct,aid:parseInt(t.props.atomid)||null,bid:parseInt(t.props.bondid)||null}:null}},{key:"renderRow",value:function(t,e){var n=this;return(0,O.h)("div",{className:"tr",key:e},t.map(function(t,r){return(0,O.h)("div",{className:"td",title:u(t,e+r)},(0,O.h)(g,{tmpl:t,className:t==n.state.selected?"struct selected":"struct",onClick:function(){return n.select(t)}}))}))}},{key:"render",value:function(){var t=this,e=3,n=this.state,r=n.group,o=n.filter,i=k(this.props.lib,o);return console.info("all rerender"),(0,O.h)(I.default,{caption:"Template Library",name:"template-lib",params:this.props,result:function(){return t.result()}},(0,O.h)("label",null,(0,O.h)("input",{type:"search",placeholder:"Filter",value:o,onInput:function(e){return t.setFilter(e.target.value)}})),(0,O.h)(M.default,{className:"groups",onChange:function(e){return t.selectGroup(e)},value:r,options:i.map(function(t){return t.name})}),(0,O.h)(N.default,{data:D(i,r,e),rowHeight:120,className:"table"},function(e,n){return t.renderRow(e,n)}))}}]),e}(O.Component)},{"../../chem/sdf":25,"../component/dialog":82,"../component/select":85,"../component/structrender":87,"../component/visibleview":90,"lru-memoize":13,preact:17}],111:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n=t.trim();if(n.indexOf("$RXN")!=-1)return"rxn";var r=n.match(/^(M  END|\$END MOL)$/m);if(r){var o=r.index+r[0].length;if(o==n.length||n.slice(o,o+20).search(/^\$(MOL|END CTAB)$/m)!=-1)return"mol"}return"<"==n[0]&&n.indexOf("<molecule")!=-1?"cml":"InChI"==n.slice(0,5)?"inchi":n.indexOf("\n")==-1?"smiles":e?null:"mol"}function i(t,e,n){return console.assert(c[e],"No such format"),new Promise(function(r,o){var i=u.default.stringify(t);r("mol"==e||"rxn"==e?i:n.then(function(){return n.convert({struct:i,output_format:c[e].mime})},function(){throw Error(c[e].name+" is not supported in the standalone mode")}).then(function(t){return t.struct}))})}function a(t,e,n){return new Promise(function(r,i){var a=o(t);if(console.assert(c[a],"No such format"),"mol"==a||"rxn"==a){var s=u.default.parse(t,e);r(s)}else!function(){var e=c[a].supportsCoords;r(n.then(function(){return e?n.convert({struct:t,output_format:c.mol.mime}):n.layout({struct:t.trim(),output_format:c.mol.mime})},function(){throw Error(c[a].name+" is not supported in the standalone mode")}).then(function(t){var n=u.default.parse(t.struct);return e||n.rescale(),n}))}()})}function s(t,e){if("inchi"==e){if(0!==t.rgroups.count())throw"R-group fragments are not supported and will be discarded";t=t.clone(),t.sgroups.each(function(t,e){if("MUL"!=e.type&&!/^INDIGO_.+_DESC$/i.test(e.data.fieldName))throw Error("InChi data format doesn't support s-groups")})}}Object.defineProperty(n,"__esModule",{value:!0}),n.map=void 0,n.guess=o,n.toString=i,n.fromString=a,n.couldBeSaved=s;var l=t("../chem/molfile"),u=r(l),c=n.map={mol:{name:"MDL Molfile",mime:"chemical/x-mdl-molfile",ext:[".mol"],supportsCoords:!0},rxn:{name:"MDL Rxnfile",mime:"chemical/x-mdl-rxnfile",ext:[".rxn"],supportsCoords:!0},smiles:{name:"Daylight SMILES",mime:"chemical/x-daylight-smiles",ext:[".smi",".smiles"]},smarts:{name:"Daylight SMARTS",mime:"chemical/x-daylight-smarts",ext:[".smarts"]},cml:{name:"CML",mime:"chemical/x-cml",ext:[".cml",".mrv"],supportsCoords:!0},inchi:{name:"InChI String",mime:"chemical/x-inchi",ext:[".inchi"]}}},{"../chem/molfile":24}],112:[function(t,e,n){e.exports=["Benzene\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  6  6  0     0  0            999 V2000\n    0.8660    2.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7320    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7320    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.8660    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  2  0     0  0\n  3  4  1  0     0  0\n  4  5  2  0     0  0\n  5  6  1  0     0  0\n  6  1  2  0     0  0\nM  END\n","Cyclopentadiene\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  5  5  0     0  0            999 V2000\n    0.0000    1.4257    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.8090    0.8379    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.5000   -0.1132    0.0000 C   0  0  0  0  0  0        0  0  0\n   -0.5000   -0.1132    0.0000 C   0  0  0  0  0  0        0  0  0\n   -0.8090    0.8379    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  2  0     0  0\n  3  4  1  0     0  0\n  4  5  2  0     0  0\n  5  1  1  0     0  0\nM  END\n","Cyclohexane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  6  6  0     0  0            999 V2000\n    0.8660    2.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7320    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7320    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.8660    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  1  0     0  0\n  3  4  1  0     0  0\n  4  5  1  0     0  0\n  5  6  1  0     0  0\n  6  1  1  0     0  0\nM  END\n","Cyclopentane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  5  5  0     0  0            999 V2000\n    0.8090    1.5389    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.6180    0.9511    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.3090    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.3090    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    0.9511    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  1  0     0  0\n  3  4  1  0     0  0\n  4  5  1  0     0  0\n  5  1  1  0     0  0\nM  END\n","Cyclopropane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  3  3  0     0  0            999 V2000\n   -3.2250   -0.2750    0.0000 C   0  0  0  0  0  0        0  0  0\n   -2.2250   -0.2750    0.0000 C   0  0  0  0  0  0        0  0  0\n   -2.7250    0.5910    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  1  0     0  0\n  1  3  1  0     0  0\nM  END\n","Cyclobutane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  4  4  0     0  0            999 V2000\n   -3.8250    1.5500    0.0000 C   0  0  0  0  0  0        0  0  0\n   -3.8250    0.5500    0.0000 C   0  0  0  0  0  0        0  0  0\n   -2.8250    1.5500    0.0000 C   0  0  0  0  0  0        0  0  0\n   -2.8250    0.5500    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  1  3  1  0     0  0\n  3  4  1  0     0  0\n  4  2  1  0     0  0\nM  END\n","Cycloheptane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  7  7  0     0  0            999 V2000\n    0.0000    1.6293    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.7835    2.2465    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7559    2.0242    0.0000 C   0  0  0  0  0  0        0  0  0\n    2.1897    1.1289    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    0.6228    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7566    0.2224    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.7835    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n  6  7  1  0     0  0\n  5  7  1  0     0  0\n  1  5  1  0     0  0\n  4  6  1  0     0  0\n  3  4  1  0     0  0\n  2  3  1  0     0  0\n  1  2  1  0     0  0\nM  END\n","Cyclooctane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  8  8  0     0  0            999 V2000\n    0.0000    0.7053    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    1.7078    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.7053    2.4131    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.7056    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7079    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    2.4133    0.7053    0.0000 C   0  0  0  0  0  0        0  0  0\n    2.4133    1.7078    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7079    2.4131    0.0000 C   0  0  0  0  0  0        0  0  0\n  8  3  1  0     0  0\n  7  8  1  0     0  0\n  6  7  1  0     0  0\n  5  6  1  0     0  0\n  4  5  1  0     0  0\n  1  4  1  0     0  0\n  2  3  1  0     0  0\n  1  2  1  0     0  0\nM  END\n"]},{}],113:[function(t,e,n){function r(){var t,e=document.createElement("transitionTest"),n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(t in n)if(void 0!==e.style[t])return n[t];return!1}function o(t,e){s||e();var n=function(){e(),t.removeEventListener(s,n,!1)};t.addEventListener(s,n,!1)}function i(t){var e=$$(".overlay")[0],n=$("loading");return"show"==t?(e.style.display="",a(e,"show").then(function(){n.style.display=""})):a(e,"hide").then(function(){e.style.display="none",n.style.display="none"})}function a(t,e){var n="show"==e?"hide":"show";return new Promise(function(r){t.removeClassName("animate"),t.addClassName(n),setTimeout(function(){t.addClassName("animate"),t.addClassName(e),t.removeClassName(n),console.info("replace",e,t.classList)},0),console.info("start",e,t.classList),o(t,function(){t.hasClassName(e)&&(t.removeClassName("animate"),t.removeClassName(e),r(t))})})}var s=r();e.exports={animate:a,loading:i}},{}],114:[function(t,e,n){function r(){1==arguments.length&&"min"in arguments[0]&&"max"in arguments[0]&&(this.p0=arguments[0].min,this.p1=arguments[0].max),2==arguments.length?(this.p0=arguments[0],
this.p1=arguments[1]):4==arguments.length?(this.p0=new i(arguments[0],arguments[1]),this.p1=new i(arguments[2],arguments[3])):0==arguments.length?(this.p0=new i,this.p1=new i):new Error("Box2Abs constructor only accepts 4 numbers or 2 vectors or no arguments!")}var o=t("./index"),i=t("./vec2");r.prototype.toString=function(){return this.p0.toString()+" "+this.p1.toString()},r.fromRelBox=function(t){return o.assertDefined(t),new r(t.x,t.y,t.x+t.width,t.y+t.height)},r.prototype.clone=function(){return new r(this.p0,this.p1)},r.union=function(t,e){return o.assertDefined(t),o.assertDefined(e),new r(i.min(t.p0,e.p0),i.max(t.p1,e.p1))},r.prototype.extend=function(t,e){return o.assertDefined(t),e=e||t,new r(this.p0.sub(t),this.p1.add(e))},r.prototype.include=function(t){return o.assertDefined(t),new r(this.p0.min(t),this.p1.max(t))},r.prototype.contains=function(t,e){return e=(e||0)-0,o.assertDefined(t),t.x>=this.p0.x-e&&t.x<=this.p1.x+e&&t.y>=this.p0.y-e&&t.y<=this.p1.y+e},r.prototype.translate=function(t){return o.assertDefined(t),new r(this.p0.add(t),this.p1.add(t))},r.prototype.transform=function(t,e){return o.assert(!o.isNullOrUndefined(t)),new r(t.call(e,this.p0),t.call(e,this.p1))},r.prototype.sz=function(){return this.p1.sub(this.p0)},r.prototype.centre=function(){return i.centre(this.p0,this.p1)},r.prototype.pos=function(){return this.p0},e.exports=r},{"./index":115,"./vec2":119}],115:[function(t,e,n){function r(t){return(t-0).toFixed(8)}function o(t){return{x:t.x,y:t.y,width:t.width,height:t.height}}function i(t){if("stopPropagation"in t)t.stopPropagation();else{if(!("cancelBubble"in t))throw Error("Browser unrecognized");t.cancelBubble=!0}}function a(t){return"preventDefault"in t&&t.preventDefault(),Prototype.Browser.IE&&(t.returnValue=!1,t.keyCode=0),!1}function s(t){function e(t,e){for(var n=t.toString(16).toUpperCase();n.length<e;)n="0"+n;return n}var n,r="";for(n=0;n<t.length;++n)r+=t.charCodeAt(n)>126||t.charCodeAt(n)<32?"\\u"+e(t.charCodeAt(n),4):t[n];return r}function l(t,e,n,r){t[n]=Object.isUndefined(e[n])?r:e[n]}function u(t,e){if(!t)throw new Error(e?"Assertion failed: "+e:"Assertion failed")}function c(t){u(!f(t))}function p(t){return Object.isUndefined(t)}function h(t){return null===t}function f(t){return p(t)||h(t)}function d(t){return t===Object(t)}e.exports={tfx:r,stopEventPropagation:i,preventDefault:a,unicodeLiteral:s,ifDef:l,assert:u,assertDefined:c,isUndefined:p,isNull:h,isNullOrUndefined:f,isObject:d,relBox:o}},{}],116:[function(t,e,n){function r(t){if("undefined"!=typeof t&&t.constructor!==Object)throw Error('Passed object is not an instance of "Object"!');this._obj=t||{},this._count=0}r.prototype.each=function(t,e){var n,r,o;for(n in this._obj)o=parseInt(n,10),r=this._obj[n],isNaN(o)||(n=o),t.call(e,n,r)},r.prototype.map=function(t,e){var n=new r;return this.each(function(r,o){n.set(r,t.call(e,r,o))},this),n},r.prototype.find=function(t,e){var n,r,o;for(n in this._obj)if(r=parseInt(n,10),o=this._obj[n],isNaN(r)||(n=r),t.call(e,n,o))return n},r.prototype.findAll=function(t,e){var n,r,o,i=[];for(n in this._obj)r=parseInt(n,10),o=this._obj[n],isNaN(r)||(n=r),t.call(e,n,o)&&i.push(n);return i},r.prototype.keys=function(){var t,e=[];for(t in this._obj)e.push(t);return e},r.prototype.ikeys=function(){var t=[];for(var e in this._obj)t.push(e-0);return t},r.prototype.set=function(t,e){var n;return this._count+=("undefined"!=typeof e?1:0)-("undefined"!=typeof this._obj[t]?1:0),"undefined"==typeof e?(n=this._obj[t],delete this._obj[t],n):(this._obj[t]=e,e)},r.prototype.get=function(t){if(this._obj[t]!==Object.prototype[t])return this._obj[t]},r.prototype.has=function(t){return this._obj[t]!==Object.prototype[t]},r.prototype.unset=function(t){return this.set(t,void 0)},r.prototype.update=function(t){for(var e in t)this.set(e,t[e])},r.prototype.clear=function(){this._obj={},this._count=0},r.prototype.count=function(){return this._count},r.prototype.idList=function(){return Object.keys(this._obj)},r.prototype.keyOf=function(t){for(var e in this._obj)if(this._obj[e]===t)return e},e.exports=r},{}],117:[function(t,e,n){function r(){this._map=new o,this._nextId=0}var o=t("./map.js");r.prototype.newId=function(){return this._nextId++},r.prototype.add=function(t){var e=this._nextId++;return this._map.set(e,t),e},r.prototype.set=function(t,e){this._map.set(t,e)},r.prototype.get=function(t){return this._map.get(t)},r.prototype.has=function(t){return this._map.has(t)},r.prototype.remove=function(t){return this._map.unset(t)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.ikeys=function(){return this._map.ikeys()},r.prototype.each=function(t,e){this._map.each(t,e)},r.prototype.map=function(t,e){return this._map.map(t,e)},r.prototype.find=function(t,e){return this._map.find(t,e)},r.prototype.count=function(){return this._map.count()},r.prototype.keyOf=function(t){return this._map.keyOf(t)},e.exports=r},{"./map.js":116}],118:[function(t,e,n){var r={empty:function(){return{}},single:function(t){var e={};return r.add(e,t),e},size:function(t){var e=0;for(var n in t)t[n]!==Object.prototype[n]&&e++;return e},contains:function(t,e){return"undefined"!=typeof t[e]&&t[e]!==Object.prototype[e]},subset:function(t,e){for(var n in t)if(t[n]!==Object.prototype[n]&&e[n]!==t[n])return!1;return!0},intersection:function(t,e){var n={};for(var o in t)t[o]!==Object.prototype[o]&&e[o]===t[o]&&r.add(n,o);return n},disjoint:function(t,e){for(var n in t)if(t[n]!==Object.prototype[n]&&e[n]===t[n])return!1;return!0},eq:function(t,e){return r.subset(t,e)&&r.subset(e,t)},each:function(t,e,n){for(var r in t)t[r]!==Object.prototype[r]&&e.call(n,t[r])},filter:function(t,e,n){var r={};for(var o in t)t[o]!==Object.prototype[o]&&e.call(n,t[o])&&(r[t[o]]=t[o]);return r},pick:function(t){for(var e in t)if(t[e]!==Object.prototype[e])return t[e];return null},list:function(t){var e=[];for(var n in t)t[n]!==Object.prototype[n]&&e.push(t[n]);return e},add:function(t,e){t[e]=e},mergeIn:function(t,e){r.each(e,function(e){r.add(t,e)})},remove:function(t,e){var n=t[e];return delete t[e],n},clone:function(t){var e={};return r.mergeIn(e,t),e},fromList:function(t){var e={};if(t)for(var n=0;n<t.length;++n)e[t[n]-0]=t[n]-0;return e},keySetInt:function(t){var e={};return t.each(function(t){e[t-0]=t-0}),e},find:function(t,e,n){for(var r in t)if(t[r]!==Object.prototype[r]&&e.call(n,t[r]))return r;return null}};e.exports=r},{}],119:[function(t,e,n){function r(t,e,n){if(0==arguments.length)this.x=0,this.y=0,this.z=0;else if(1==arguments.length)this.x=parseFloat(t.x||0),this.y=parseFloat(t.y||0),this.z=parseFloat(t.z||0);else if(2==arguments.length)this.x=parseFloat(t||0),this.y=parseFloat(e||0),this.z=0;else{if(3!=arguments.length)throw new Error("Vec2(): invalid arguments");this.x=parseFloat(t),this.y=parseFloat(e),this.z=parseFloat(n)}}var o=t("./index");r.ZERO=new r(0,0),r.UNIT=new r(1,1),r.segmentIntersection=function(t,e,n,r){var o=(t.x-n.x)*(e.y-n.y)-(t.y-n.y)*(e.x-n.x),i=(t.x-r.x)*(e.y-r.y)-(t.y-r.y)*(e.x-r.x),a=(n.x-t.x)*(r.y-t.y)-(n.y-t.y)*(r.x-t.x),s=(n.x-e.x)*(r.y-e.y)-(n.y-e.y)*(r.x-e.x);return o*i<=0&&a*s<=0},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},r.prototype.equals=function(t){return o.assertDefined(t),this.x==t.x&&this.y==t.y},r.prototype.add=function(t){return o.assertDefined(t),new r(this.x+t.x,this.y+t.y,this.z+t.z)},r.prototype.add_=function(t){o.assertDefined(t),this.x+=t.x,this.y+=t.y,this.z+=t.z},r.prototype.get_xy0=function(){return new r(this.x,this.y)},r.prototype.sub=function(t){return o.assertDefined(t),new r(this.x-t.x,this.y-t.y,this.z-t.z)},r.prototype.scaled=function(t){return o.assertDefined(t),new r(this.x*t,this.y*t,this.z*t)},r.prototype.negated=function(){return new r((-this.x),(-this.y),(-this.z))},r.prototype.yComplement=function(t){return t=t||0,new r(this.x,t-this.y,this.z)},r.prototype.addScaled=function(t,e){return o.assertDefined(t),o.assertDefined(e),new r(this.x+t.x*e,this.y+t.y*e,this.z+t.z*e)},r.prototype.normalized=function(){return this.scaled(1/this.length())},r.prototype.normalize=function(){var t=this.length();return!(t<1e-6)&&(this.x/=t,this.y/=t,!0)},r.prototype.turnLeft=function(){return new r((-this.y),this.x,this.z)},r.prototype.coordStr=function(){return this.x.toString()+" , "+this.y.toString()},r.prototype.toString=function(){return"("+this.x.toFixed(2)+","+this.y.toFixed(2)+")"},r.dist=function(t,e){return o.assertDefined(t),o.assertDefined(e),r.diff(t,e).length()},r.max=function(t,e){return o.assertDefined(t),o.assertDefined(e),new r(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))},r.min=function(t,e){return o.assertDefined(t),o.assertDefined(e),new r(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))},r.prototype.max=function(t){return o.assertDefined(t),new r.max(this,t)},r.prototype.min=function(t){return o.assertDefined(t),new r.min(this,t)},r.prototype.ceil=function(){return new r(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},r.sum=function(t,e){return o.assertDefined(t),o.assertDefined(e),new r(t.x+e.x,t.y+e.y,t.z+e.z)},r.dot=function(t,e){return o.assertDefined(t),o.assertDefined(e),t.x*e.x+t.y*e.y},r.cross=function(t,e){return o.assertDefined(t),o.assertDefined(e),t.x*e.y-t.y*e.x},r.prototype.rotate=function(t){o.assertDefined(t);var e=Math.sin(t),n=Math.cos(t);return this.rotateSC(e,n)},r.prototype.rotateSC=function(t,e){return o.assertDefined(t),o.assertDefined(e),new r(this.x*e-this.y*t,this.x*t+this.y*e,this.z)},r.angle=function(t,e){return o.assertDefined(t),o.assertDefined(e),Math.atan2(r.cross(t,e),r.dot(t,e))},r.prototype.oxAngle=function(){return Math.atan2(this.y,this.x)},r.diff=function(t,e){return o.assertDefined(t),o.assertDefined(e),new r(t.x-e.x,t.y-e.y,t.z-e.z)},r.lc=function(){for(var t=new r,e=0;e<arguments.length/2;++e)t=t.addScaled(arguments[2*e],arguments[2*e+1]);return t},r.lc2=function(t,e,n,i){return o.assertDefined(t),o.assertDefined(n),o.assertDefined(e),o.assertDefined(i),new r(t.x*e+n.x*i,t.y*e+n.y*i,t.z*e+n.z*i)},r.centre=function(t,e){return new r.lc2(t,.5,e,.5)},r.shiftRayBox=function(t,e,n){o.assertDefined(t),o.assertDefined(e),o.assertDefined(n);var i=[n.p0,new r(n.p1.x,n.p0.y),n.p1,new r(n.p0.x,n.p1.y)],a=i.map(function(e){return e.sub(t)});e=e.normalized();for(var s=a.map(function(t){return r.cross(t,e)}),l=a.map(function(t){return r.dot(t,e)}),u=-1,c=-1,p=0;p<4;++p)s[p]>0?(u<0||l[u]<l[p])&&(u=p):(c<0||l[c]<l[p])&&(c=p);if(c<0||u<0)return 0;var h,f;return l[u]>l[c]?(h=c,f=u):(h=u,f=c),l[h]+Math.abs(s[h])*(l[f]-l[h])/(Math.abs(s[h])+Math.abs(s[f]))},e.exports=r},{"./index":115}]},{},[63])(63)});
//# sourceMappingURL=ketcher.js.map
